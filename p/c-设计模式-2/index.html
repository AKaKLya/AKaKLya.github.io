<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="C++ STL åº“ä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼ C++ æ ‡å‡†æ¨¡æ¿åº“ï¼ˆSTLï¼‰çš„è®¾è®¡ä»¥æ³›å‹ç¼–ç¨‹ä¸ºæ ¸å¿ƒï¼Œä½†å…¶ä¸­ä¹Ÿå·§å¦™èå…¥äº†å¤šç§ç»å…¸è®¾è®¡æ¨¡å¼çš„æ€æƒ³ã€‚ä»¥ä¸‹æ˜¯ STL ä¸­ä¸€äº›å…¸å‹è®¾è®¡æ¨¡å¼çš„åº”ç”¨åŠç¤ºä¾‹ï¼š 1. è¿­ä»£å™¨æ¨¡å¼ (Iterator Pattern) ç›®çš„ï¼šæä¾›ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼éå†å®¹å™¨å…ƒç´ ï¼Œæ— éœ€æš´éœ²å®¹å™¨å†…éƒ¨ç»“æ„ã€‚ STL å®ç°ï¼š æ‰€æœ‰å®¹å™¨ï¼ˆå¦‚ vector, list, mapï¼‰å‡æä¾› begin() å’Œ end() æ–¹æ³•è¿”å›è¿­ä»£å™¨ã€‚ ç®—æ³•ï¼ˆå¦‚ for_each, copyï¼‰é€šè¿‡è¿­ä»£å™¨æ“ä½œå®¹å™¨ï¼Œä¸å…·ä½“å®¹å™¨ç±»å‹è§£è€¦ã€‚ 1 2 3 4 5 std::vector&lt;int&gt; vec = {1, 2, 3}; // ä½¿ç”¨è¿­ä»£å™¨éå† for (auto it = vec.begin(); it != vec.end(); ++it) { std::cout &lt;&lt; *it &lt;&lt; &#34; &#34;; } 2. é€‚é…å™¨æ¨¡å¼ (Adapter Pattern) ç›®çš„ï¼šè½¬æ¢æ¥å£ä»¥å…¼å®¹ä¸åŒç»„ä»¶ã€‚ STL å®ç°ï¼š å®¹å™¨é€‚é…å™¨ï¼šstack, queue, priority_queue åŸºäºåº•å±‚å®¹å™¨ï¼ˆå¦‚ dequeï¼‰é€‚é…æ¥å£ã€‚ è¿­ä»£å™¨é€‚é…å™¨ï¼šreverse_iterator åå‘éå†å®¹å™¨ï¼Œback_insert_iterator ç”¨äºå°¾éƒ¨æ’å…¥ã€‚ 1 2 3 4 // åŸºäº deque å®ç°æ ˆ std::stack&lt;int, std::deque&lt;int&gt;&gt; stk; stk.">
<title>C&#43;&#43;è®¾è®¡æ¨¡å¼ 2</title>

<link rel='canonical' href='http://localhost:1313/p/c-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-2/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="C++è®¾è®¡æ¨¡å¼ 2">
<meta property='og:description' content="C++ STL åº“ä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼ C++ æ ‡å‡†æ¨¡æ¿åº“ï¼ˆSTLï¼‰çš„è®¾è®¡ä»¥æ³›å‹ç¼–ç¨‹ä¸ºæ ¸å¿ƒï¼Œä½†å…¶ä¸­ä¹Ÿå·§å¦™èå…¥äº†å¤šç§ç»å…¸è®¾è®¡æ¨¡å¼çš„æ€æƒ³ã€‚ä»¥ä¸‹æ˜¯ STL ä¸­ä¸€äº›å…¸å‹è®¾è®¡æ¨¡å¼çš„åº”ç”¨åŠç¤ºä¾‹ï¼š 1. è¿­ä»£å™¨æ¨¡å¼ (Iterator Pattern) ç›®çš„ï¼šæä¾›ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼éå†å®¹å™¨å…ƒç´ ï¼Œæ— éœ€æš´éœ²å®¹å™¨å†…éƒ¨ç»“æ„ã€‚ STL å®ç°ï¼š æ‰€æœ‰å®¹å™¨ï¼ˆå¦‚ vector, list, mapï¼‰å‡æä¾› begin() å’Œ end() æ–¹æ³•è¿”å›è¿­ä»£å™¨ã€‚ ç®—æ³•ï¼ˆå¦‚ for_each, copyï¼‰é€šè¿‡è¿­ä»£å™¨æ“ä½œå®¹å™¨ï¼Œä¸å…·ä½“å®¹å™¨ç±»å‹è§£è€¦ã€‚ 1 2 3 4 5 std::vector&lt;int&gt; vec = {1, 2, 3}; // ä½¿ç”¨è¿­ä»£å™¨éå† for (auto it = vec.begin(); it != vec.end(); ++it) { std::cout &lt;&lt; *it &lt;&lt; &#34; &#34;; } 2. é€‚é…å™¨æ¨¡å¼ (Adapter Pattern) ç›®çš„ï¼šè½¬æ¢æ¥å£ä»¥å…¼å®¹ä¸åŒç»„ä»¶ã€‚ STL å®ç°ï¼š å®¹å™¨é€‚é…å™¨ï¼šstack, queue, priority_queue åŸºäºåº•å±‚å®¹å™¨ï¼ˆå¦‚ dequeï¼‰é€‚é…æ¥å£ã€‚ è¿­ä»£å™¨é€‚é…å™¨ï¼šreverse_iterator åå‘éå†å®¹å™¨ï¼Œback_insert_iterator ç”¨äºå°¾éƒ¨æ’å…¥ã€‚ 1 2 3 4 // åŸºäº deque å®ç°æ ˆ std::stack&lt;int, std::deque&lt;int&gt;&gt; stk; stk.">
<meta property='og:url' content='http://localhost:1313/p/c-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-2/'>
<meta property='og:site_name' content='AKaKLya'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='1074-01-04T12:57:17&#43;08:00'/><meta property='article:modified_time' content='1074-01-04T12:57:17&#43;08:00'/>
<meta name="twitter:title" content="C++è®¾è®¡æ¨¡å¼ 2">
<meta name="twitter:description" content="C++ STL åº“ä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼ C++ æ ‡å‡†æ¨¡æ¿åº“ï¼ˆSTLï¼‰çš„è®¾è®¡ä»¥æ³›å‹ç¼–ç¨‹ä¸ºæ ¸å¿ƒï¼Œä½†å…¶ä¸­ä¹Ÿå·§å¦™èå…¥äº†å¤šç§ç»å…¸è®¾è®¡æ¨¡å¼çš„æ€æƒ³ã€‚ä»¥ä¸‹æ˜¯ STL ä¸­ä¸€äº›å…¸å‹è®¾è®¡æ¨¡å¼çš„åº”ç”¨åŠç¤ºä¾‹ï¼š 1. è¿­ä»£å™¨æ¨¡å¼ (Iterator Pattern) ç›®çš„ï¼šæä¾›ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼éå†å®¹å™¨å…ƒç´ ï¼Œæ— éœ€æš´éœ²å®¹å™¨å†…éƒ¨ç»“æ„ã€‚ STL å®ç°ï¼š æ‰€æœ‰å®¹å™¨ï¼ˆå¦‚ vector, list, mapï¼‰å‡æä¾› begin() å’Œ end() æ–¹æ³•è¿”å›è¿­ä»£å™¨ã€‚ ç®—æ³•ï¼ˆå¦‚ for_each, copyï¼‰é€šè¿‡è¿­ä»£å™¨æ“ä½œå®¹å™¨ï¼Œä¸å…·ä½“å®¹å™¨ç±»å‹è§£è€¦ã€‚ 1 2 3 4 5 std::vector&lt;int&gt; vec = {1, 2, 3}; // ä½¿ç”¨è¿­ä»£å™¨éå† for (auto it = vec.begin(); it != vec.end(); ++it) { std::cout &lt;&lt; *it &lt;&lt; &#34; &#34;; } 2. é€‚é…å™¨æ¨¡å¼ (Adapter Pattern) ç›®çš„ï¼šè½¬æ¢æ¥å£ä»¥å…¼å®¹ä¸åŒç»„ä»¶ã€‚ STL å®ç°ï¼š å®¹å™¨é€‚é…å™¨ï¼šstack, queue, priority_queue åŸºäºåº•å±‚å®¹å™¨ï¼ˆå¦‚ dequeï¼‰é€‚é…æ¥å£ã€‚ è¿­ä»£å™¨é€‚é…å™¨ï¼šreverse_iterator åå‘éå†å®¹å™¨ï¼Œback_insert_iterator ç”¨äºå°¾éƒ¨æ’å…¥ã€‚ 1 2 3 4 // åŸºäº deque å®ç°æ ˆ std::stack&lt;int, std::deque&lt;int&gt;&gt; stk; stk.">
  


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/d_hu15622052934649275245.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">AKaKLya</a></h1>
            <h2 class="site-description">ç‚¹å‡»</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/CaiJimmy/hugo-theme-stack'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#c-stl-åº“ä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼">C++ STL åº“ä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼</a></li>
    <li><a href="#ç°ä»£cè®¾è®¡æ¨¡å¼">ç°ä»£C++è®¾è®¡æ¨¡å¼</a>
      <ol>
        <li><a href="#ä¸€åˆ›å»ºå‹æ¨¡å¼5ç§">ä¸€ã€åˆ›å»ºå‹æ¨¡å¼ï¼ˆ5ç§ï¼‰</a></li>
        <li><a href="#äºŒç»“æ„å‹æ¨¡å¼7ç§">äºŒã€ç»“æ„å‹æ¨¡å¼ï¼ˆ7ç§ï¼‰</a></li>
        <li><a href="#ä¸‰è¡Œä¸ºå‹æ¨¡å¼11ç§">ä¸‰ã€è¡Œä¸ºå‹æ¨¡å¼ï¼ˆ11ç§ï¼‰</a></li>
        <li><a href="#å››ç°ä»£cå…³é”®ä¼˜åŒ–æŠ€æœ¯">å››ã€ç°ä»£C++å…³é”®ä¼˜åŒ–æŠ€æœ¯</a></li>
        <li><a href="#äº”æ¨¡å¼é€‰æ‹©å»ºè®®è¡¨">äº”ã€æ¨¡å¼é€‰æ‹©å»ºè®®è¡¨</a></li>
      </ol>
    </li>
    <li><a href="#ç¬¬ä¸€ç« è½¯ä»¶è®¾è®¡çš„è‰ºæœ¯">ç¬¬ä¸€ç« ï¼šè½¯ä»¶è®¾è®¡çš„è‰ºæœ¯</a>
      <ol>
        <li><a href="#å‡†åˆ™1ç†è§£è½¯ä»¶è®¾è®¡çš„é‡è¦æ€§">å‡†åˆ™1ï¼šç†è§£è½¯ä»¶è®¾è®¡çš„é‡è¦æ€§</a></li>
        <li><a href="#å‡†åˆ™-2ä¸ºå˜åŒ–è€Œè®¾è®¡">å‡†åˆ™ 2ï¼šä¸ºå˜åŒ–è€Œè®¾è®¡</a></li>
        <li><a href="#å‡†åˆ™3åˆ†ç¦»æ¥å£ä»¥é¿å…äººä¸ºè€¦åˆ">å‡†åˆ™3ï¼šåˆ†ç¦»æ¥å£ä»¥é¿å…äººä¸ºè€¦åˆ</a></li>
        <li><a href="#å‡†åˆ™4ä¸ºå¯æµ‹è¯•æ€§è€Œè®¾è®¡">å‡†åˆ™4ï¼šä¸ºå¯æµ‹è¯•æ€§è€Œè®¾è®¡</a></li>
        <li><a href="#å‡†åˆ™5ä¸ºæ‰©å±•è€Œè®¾è®¡">å‡†åˆ™5ï¼šä¸ºæ‰©å±•è€Œè®¾è®¡</a></li>
      </ol>
    </li>
    <li><a href="#ç¬¬äºŒç« å»ºç«‹æŠ½è±¡çš„è‰ºæœ¯">ç¬¬äºŒç« ï¼šå»ºç«‹æŠ½è±¡çš„è‰ºæœ¯</a>
      <ol>
        <li><a href="#å‡†åˆ™6éµå¾ªæŠ½è±¡çš„é¢„æœŸè¡Œä¸º">å‡†åˆ™6ï¼šéµå¾ªæŠ½è±¡çš„é¢„æœŸè¡Œä¸º</a></li>
        <li><a href="#å‡†åˆ™7ç†è§£åŸºç±»ä¸æ¦‚å¿µçš„æ·±å±‚å…±æ€§">å‡†åˆ™7ï¼šç†è§£åŸºç±»ä¸æ¦‚å¿µçš„æ·±å±‚å…±æ€§</a></li>
        <li><a href="#å‡†åˆ™8ç†è§£é‡è½½é›†åˆçš„è¯­ä¹‰è¦æ±‚">å‡†åˆ™8ï¼šç†è§£é‡è½½é›†åˆçš„è¯­ä¹‰è¦æ±‚</a></li>
        <li><a href="#å‡†åˆ™9å…³æ³¨æŠ½è±¡çš„æ‰€æœ‰æƒå½’å±">å‡†åˆ™9ï¼šå…³æ³¨æŠ½è±¡çš„æ‰€æœ‰æƒå½’å±</a></li>
        <li><a href="#å‡†åˆ™10å»ºè®®åˆ›å»ºæ¶æ„è®¾è®¡æ–‡æ¡£">å‡†åˆ™10ï¼šå»ºè®®åˆ›å»ºæ¶æ„è®¾è®¡æ–‡æ¡£</a></li>
      </ol>
    </li>
    <li><a href="#ç¬¬ä¸‰ç« è®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒä»·å€¼">ç¬¬ä¸‰ç« ï¼šè®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒä»·å€¼</a>
      <ol>
        <li><a href="#å‡†åˆ™-11ç†è§£è®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒä»·å€¼">å‡†åˆ™ 11ï¼šç†è§£è®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒä»·å€¼</a></li>
        <li><a href="#å‡†åˆ™12è­¦æƒ•è®¾è®¡æ¨¡å¼çš„è¯¯è§£">å‡†åˆ™12ï¼šè­¦æƒ•è®¾è®¡æ¨¡å¼çš„è¯¯è§£</a></li>
        <li><a href="#å‡†åˆ™13è®¾è®¡æ¨¡å¼æ— å¤„ä¸åœ¨">å‡†åˆ™13ï¼šè®¾è®¡æ¨¡å¼æ— å¤„ä¸åœ¨</a></li>
        <li><a href="#å‡†åˆ™14ä½¿ç”¨è®¾è®¡æ¨¡å¼çš„åç§°æ¥ä¼ è¾¾æ„å›¾">å‡†åˆ™14ï¼šä½¿ç”¨è®¾è®¡æ¨¡å¼çš„åç§°æ¥ä¼ è¾¾æ„å›¾</a></li>
      </ol>
    </li>
    <li><a href="#ç¬¬å››ç« è®¿é—®è€…è®¾è®¡æ¨¡å¼">ç¬¬å››ç« ï¼šè®¿é—®è€…è®¾è®¡æ¨¡å¼</a>
      <ol>
        <li><a href="#å‡†åˆ™15ä¸ºæ·»åŠ ç±»å‹æˆ–æ“ä½œè¿›è¡Œè®¾è®¡">å‡†åˆ™15ï¼šä¸ºæ·»åŠ ç±»å‹æˆ–æ“ä½œè¿›è¡Œè®¾è®¡</a></li>
        <li><a href="#å‡†åˆ™16ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ‰©å±•æ“ä½œ">å‡†åˆ™16ï¼šä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ‰©å±•æ“ä½œ</a></li>
        <li><a href="#å‡†åˆ™17è€ƒè™‘ä½¿ç”¨-stdvariant-å®ç°è®¿é—®è€…">å‡†åˆ™17ï¼šè€ƒè™‘ä½¿ç”¨ std::variant å®ç°è®¿é—®è€…</a></li>
        <li><a href="#å‡†åˆ™18è­¦æƒ•æ— ç¯è®¿é—®è€…çš„æ€§èƒ½">å‡†åˆ™18ï¼šè­¦æƒ•æ— ç¯è®¿é—®è€…çš„æ€§èƒ½</a></li>
      </ol>
    </li>
    <li><a href="#ç¬¬äº”ç« -ç­–ç•¥å’Œå‘½ä»¤è®¾è®¡æ¨¡å¼">ç¬¬äº”ç«  ç­–ç•¥å’Œå‘½ä»¤è®¾è®¡æ¨¡å¼</a>
      <ol>
        <li><a href="#å‡†åˆ™19ä½¿ç”¨ç­–ç•¥éš”ç¦»äº‹ç‰©çš„å®ç°æ–¹å¼">å‡†åˆ™19ï¼šä½¿ç”¨ç­–ç•¥éš”ç¦»äº‹ç‰©çš„å®ç°æ–¹å¼</a></li>
        <li><a href="#å‡†åˆ™20ä¼˜å…ˆä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿">å‡†åˆ™20ï¼šä¼˜å…ˆä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿</a></li>
        <li><a href="#å‡†åˆ™21ä½¿ç”¨å‘½ä»¤æ¨¡å¼éš”ç¦»æ“ä½œå†…å®¹">å‡†åˆ™21ï¼šä½¿ç”¨å‘½ä»¤æ¨¡å¼éš”ç¦»æ“ä½œå†…å®¹</a></li>
        <li><a href="#å‡†åˆ™22ä¼˜å…ˆä½¿ç”¨å€¼è¯­ä¹‰è€Œéå¼•ç”¨è¯­ä¹‰">å‡†åˆ™22ï¼šä¼˜å…ˆä½¿ç”¨å€¼è¯­ä¹‰è€Œéå¼•ç”¨è¯­ä¹‰</a></li>
        <li><a href="#å‡†åˆ™23ä¼˜å…ˆä½¿ç”¨åŸºäºå€¼çš„ç­–ç•¥å’Œå‘½ä»¤å®ç°">å‡†åˆ™23ï¼šä¼˜å…ˆä½¿ç”¨åŸºäºå€¼çš„ç­–ç•¥å’Œå‘½ä»¤å®ç°</a></li>
      </ol>
    </li>
    <li><a href="#ç¬¬å…­ç« -é€‚é…å™¨è§‚å¯Ÿè€…å’Œcrtpè®¾è®¡æ¨¡å¼">ç¬¬å…­ç«  é€‚é…å™¨ã€è§‚å¯Ÿè€…å’ŒCRTPè®¾è®¡æ¨¡å¼</a>
      <ol>
        <li><a href="#å‡†åˆ™24ä½¿ç”¨é€‚é…å™¨æ ‡å‡†åŒ–æ¥å£">å‡†åˆ™24ï¼šä½¿ç”¨é€‚é…å™¨æ ‡å‡†åŒ–æ¥å£</a></li>
        <li><a href="#å‡†åˆ™25åº”ç”¨è§‚å¯Ÿè€…ä½œä¸ºæŠ½è±¡é€šçŸ¥æœºåˆ¶">å‡†åˆ™25ï¼šåº”ç”¨è§‚å¯Ÿè€…ä½œä¸ºæŠ½è±¡é€šçŸ¥æœºåˆ¶</a></li>
        <li><a href="#å‡†åˆ™26ä½¿ç”¨crtpå¼•å…¥é™æ€ç±»å‹ç±»åˆ«"><strong>å‡†åˆ™26ï¼šä½¿ç”¨CRTPå¼•å…¥é™æ€ç±»å‹ç±»åˆ«</strong></a></li>
        <li><a href="#å‡†åˆ™27ä½¿ç”¨-crtp-å®ç°é™æ€æ··å…¥ç±»">å‡†åˆ™27ï¼šä½¿ç”¨ CRTP å®ç°é™æ€æ··å…¥ç±»</a></li>
      </ol>
    </li>
    <li><a href="#ç¬¬ä¸ƒç« æ¡¥æ¥åŸå‹å’Œå¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼">ç¬¬ä¸ƒç« ï¼šæ¡¥æ¥ã€åŸå‹å’Œå¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼</a>
      <ol>
        <li><a href="#å‡†åˆ™-28æ„å»ºæ¡¥æ¢ä»¥æ¶ˆé™¤ç‰©ç†ä¾èµ–">å‡†åˆ™ 28ï¼šæ„å»ºæ¡¥æ¢ä»¥æ¶ˆé™¤ç‰©ç†ä¾èµ–</a></li>
        <li><a href="#å‡†åˆ™-29æ³¨æ„æ¡¥æ¥çš„æ€§èƒ½å¢ç›Šä¸æŸå¤±">å‡†åˆ™ 29ï¼šæ³¨æ„æ¡¥æ¥çš„æ€§èƒ½å¢ç›Šä¸æŸå¤±</a></li>
        <li><a href="#å‡†åˆ™-30åº”ç”¨åŸå‹æ¨¡å¼è¿›è¡ŒæŠ½è±¡å¤åˆ¶æ“ä½œ">å‡†åˆ™ 30ï¼šåº”ç”¨åŸå‹æ¨¡å¼è¿›è¡ŒæŠ½è±¡å¤åˆ¶æ“ä½œ</a></li>
        <li><a href="#å‡†åˆ™-31ä½¿ç”¨å¤–éƒ¨å¤šæ€å®ç°éä¾µå…¥å¼è¿è¡Œæ—¶å¤šæ€">å‡†åˆ™ 31ï¼šä½¿ç”¨å¤–éƒ¨å¤šæ€å®ç°éä¾µå…¥å¼è¿è¡Œæ—¶å¤šæ€</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/c-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-2/">C&#43;&#43;è®¾è®¡æ¨¡å¼ 2</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jan 04, 1074</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 92 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="c-stl-åº“ä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼">C++ STL åº“ä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼
</h2><p>C++ æ ‡å‡†æ¨¡æ¿åº“ï¼ˆSTLï¼‰çš„è®¾è®¡ä»¥<strong>æ³›å‹ç¼–ç¨‹</strong>ä¸ºæ ¸å¿ƒï¼Œä½†å…¶ä¸­ä¹Ÿå·§å¦™èå…¥äº†å¤šç§ç»å…¸è®¾è®¡æ¨¡å¼çš„æ€æƒ³ã€‚ä»¥ä¸‹æ˜¯ STL ä¸­ä¸€äº›å…¸å‹è®¾è®¡æ¨¡å¼çš„åº”ç”¨åŠç¤ºä¾‹ï¼š</p>
<hr>
<p><strong>1. è¿­ä»£å™¨æ¨¡å¼ (Iterator Pattern)</strong></p>
<ul>
<li><strong>ç›®çš„</strong>ï¼šæä¾›ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼éå†å®¹å™¨å…ƒç´ ï¼Œæ— éœ€æš´éœ²å®¹å™¨å†…éƒ¨ç»“æ„ã€‚</li>
<li><strong>STL å®ç°</strong>ï¼š
<ul>
<li>æ‰€æœ‰å®¹å™¨ï¼ˆå¦‚ <code>vector</code>, <code>list</code>, <code>map</code>ï¼‰å‡æä¾› <code>begin()</code> å’Œ <code>end()</code> æ–¹æ³•è¿”å›è¿­ä»£å™¨ã€‚</li>
<li>ç®—æ³•ï¼ˆå¦‚ <code>for_each</code>, <code>copy</code>ï¼‰é€šè¿‡è¿­ä»£å™¨æ“ä½œå®¹å™¨ï¼Œä¸å…·ä½“å®¹å™¨ç±»å‹è§£è€¦ã€‚</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vec</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ä½¿ç”¨è¿­ä»£å™¨éå†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">vec</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">vec</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">it</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<p><strong>2. é€‚é…å™¨æ¨¡å¼ (Adapter Pattern)</strong></p>
<ul>
<li><strong>ç›®çš„</strong>ï¼šè½¬æ¢æ¥å£ä»¥å…¼å®¹ä¸åŒç»„ä»¶ã€‚</li>
<li><strong>STL å®ç°</strong>ï¼š
<ul>
<li><strong>å®¹å™¨é€‚é…å™¨</strong>ï¼š<code>stack</code>, <code>queue</code>, <code>priority_queue</code> åŸºäºåº•å±‚å®¹å™¨ï¼ˆå¦‚ <code>deque</code>ï¼‰é€‚é…æ¥å£ã€‚</li>
<li><strong>è¿­ä»£å™¨é€‚é…å™¨</strong>ï¼š<code>reverse_iterator</code> åå‘éå†å®¹å™¨ï¼Œ<code>back_insert_iterator</code> ç”¨äºå°¾éƒ¨æ’å…¥ã€‚</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// åŸºäº deque å®ç°æ ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">stack</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">deque</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">stk</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">stk</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">stk</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<p><strong>3. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)</strong></p>
<ul>
<li><strong>ç›®çš„</strong>ï¼šåŠ¨æ€åˆ‡æ¢ç®—æ³•æˆ–ç­–ç•¥ã€‚</li>
<li><strong>STL å®ç°</strong>ï¼š
<ul>
<li>ç®—æ³•ï¼ˆå¦‚ <code>sort</code>, <code>transform</code>ï¼‰é€šè¿‡å‡½æ•°å¯¹è±¡ï¼ˆFunctorï¼‰æˆ– Lambda æ¥å—è‡ªå®šä¹‰ç­–ç•¥ã€‚</li>
<li>åˆ†é…å™¨ï¼ˆAllocatorï¼‰å…è®¸è‡ªå®šä¹‰å†…å­˜ç®¡ç†ç­–ç•¥ã€‚</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// è‡ªå®šä¹‰æ’åºç­–ç•¥ï¼šé™åºæ’åˆ—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vec</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">(</span><span class="n">vec</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vec</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="p">[](</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">;</span> <span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<ol start="4">
<li><strong>å·¥å‚æ–¹æ³•æ¨¡å¼ (Factory Method Pattern)</strong></li>
</ol>
<ul>
<li><strong>ç›®çš„</strong>ï¼šå°†å¯¹è±¡åˆ›å»ºé€»è¾‘å°è£…åˆ°å­ç±»ã€‚</li>
<li><strong>STL å®ç°</strong>ï¼š
<ul>
<li>å®¹å™¨é€šè¿‡ <code>emplace()</code> æˆ– <code>insert()</code> æ–¹æ³•å†…éƒ¨æ„é€ å¯¹è±¡ã€‚</li>
<li>åˆ†é…å™¨ï¼ˆAllocatorï¼‰çš„ <code>allocate()</code> å’Œ <code>construct()</code> æ–¹æ³•å°è£…å†…å­˜åˆ†é…ä¸å¯¹è±¡æ„é€ ã€‚</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">alloc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="n">alloc</span><span class="p">.</span><span class="n">allocate</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>  <span class="c1">// åˆ†é…å†…å­˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">alloc</span><span class="p">.</span><span class="n">construct</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>       <span class="c1">// æ„é€ å¯¹è±¡
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<ol start="5">
<li><strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ (Template Method Pattern)</strong></li>
</ol>
<ul>
<li><strong>ç›®çš„</strong>ï¼šå®šä¹‰ç®—æ³•éª¨æ¶ï¼Œå­ç±»å®ç°å…·ä½“æ­¥éª¤ã€‚</li>
<li><strong>STL å®ç°</strong>ï¼š
<ul>
<li>æµåº“ï¼ˆ<code>&lt;iomanip&gt;</code>ï¼‰é€šè¿‡è™šå‡½æ•°ï¼ˆå¦‚ <code>std::streambuf::overflow()</code>ï¼‰å®šä¹‰æµç¨‹ï¼Œå­ç±»é‡å†™å…·ä½“è¡Œä¸ºã€‚</li>
<li>åˆ†é…å™¨æä¾›ç»Ÿä¸€æ¥å£ï¼Œç”¨æˆ·å¯è‡ªå®šä¹‰å†…å­˜ç®¡ç†ç»†èŠ‚ã€‚</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CustomAllocator</span> <span class="o">:</span> <span class="k">public</span> <span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è‡ªå®šä¹‰å†…å­˜åˆ†é…é€»è¾‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span><span class="o">*</span> <span class="n">allocate</span><span class="p">(</span><span class="n">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<ol start="6">
<li><strong>äº«å…ƒæ¨¡å¼ (Flyweight Pattern)</strong></li>
</ol>
<ul>
<li><strong>ç›®çš„</strong>ï¼šå…±äº«ç»†ç²’åº¦å¯¹è±¡ä»¥å‡å°‘å†…å­˜å¼€é”€ã€‚</li>
<li><strong>STL å®ç°</strong>ï¼š
<ul>
<li><code>std::string</code> çš„çŸ­å­—ç¬¦ä¸²ä¼˜åŒ–ï¼ˆSSOï¼‰ï¼šå°å­—ç¬¦ä¸²ç›´æ¥å­˜å‚¨åœ¨å¯¹è±¡å†…éƒ¨ï¼Œå¤§å­—ç¬¦ä¸²ä½¿ç”¨å †å†…å­˜ã€‚</li>
<li><code>std::function</code> é€šè¿‡ç±»å‹æ“¦é™¤ï¼ˆType Erasureï¼‰å…±äº«è°ƒç”¨é€»è¾‘ã€‚</li>
</ul>
</li>
</ul>
<hr>
<ol start="7">
<li><strong>ä»£ç†æ¨¡å¼ (Proxy Pattern)</strong></li>
</ol>
<ul>
<li><strong>ç›®çš„</strong>ï¼šé€šè¿‡ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹åŸå¯¹è±¡çš„è®¿é—®ã€‚</li>
<li><strong>STL å®ç°</strong>ï¼š
<ul>
<li><code>std::vector&lt;bool&gt;</code> çš„ç‰¹åŒ–ç‰ˆæœ¬ä½¿ç”¨ä»£ç†ç±»å‹ç¼©å­˜å‚¨ï¼ˆæ¯ä¸ª <code>bool</code> å  1 bitï¼‰ã€‚</li>
<li><code>std::reference_wrapper</code> æä¾›å¼•ç”¨çš„ä»£ç†ï¼Œç”¨äºåœ¨å®¹å™¨ä¸­å­˜å‚¨å¼•ç”¨ã€‚</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">reference_wrapper</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">refs</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">refs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">refs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>  <span class="c1">// ä»£ç†å¼•ç”¨ï¼Œé¿å…æ‹·è´
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<p><strong>æ€»ç»“</strong></p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:left"><strong>è®¾è®¡æ¨¡å¼</strong></th>
<th style="text-align:left"><strong>STL åº”ç”¨åœºæ™¯</strong></th>
<th style="text-align:left"><strong>å…³é”®æŠ€æœ¯</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">è¿­ä»£å™¨æ¨¡å¼</td>
<td style="text-align:left">å®¹å™¨éå† (<code>vector</code>, <code>map</code>)</td>
<td style="text-align:left">è¿­ä»£å™¨æ¥å£ (<code>begin()</code>, <code>end()</code>)</td>
</tr>
<tr>
<td style="text-align:left">é€‚é…å™¨æ¨¡å¼</td>
<td style="text-align:left"><code>stack</code>, <code>queue</code>, åå‘è¿­ä»£å™¨</td>
<td style="text-align:left">ç»„åˆ + æ¥å£è½¬æ¢</td>
</tr>
<tr>
<td style="text-align:left">ç­–ç•¥æ¨¡å¼</td>
<td style="text-align:left">ç®—æ³•è‡ªå®šä¹‰è¡Œä¸º (<code>sort</code>, <code>transform</code>)</td>
<td style="text-align:left">å‡½æ•°å¯¹è±¡ + Lambda</td>
</tr>
<tr>
<td style="text-align:left">å·¥å‚æ–¹æ³•æ¨¡å¼</td>
<td style="text-align:left">å¯¹è±¡æ„é€  (<code>allocator</code>, <code>emplace()</code>)</td>
<td style="text-align:left">æ¨¡æ¿ + åˆ†é…å™¨</td>
</tr>
<tr>
<td style="text-align:left">æ¨¡æ¿æ–¹æ³•æ¨¡å¼</td>
<td style="text-align:left">æµç¼“å†²åŒº (<code>streambuf</code>)</td>
<td style="text-align:left">è™šå‡½æ•° + ç»§æ‰¿</td>
</tr>
<tr>
<td style="text-align:left">äº«å…ƒæ¨¡å¼</td>
<td style="text-align:left"><code>std::string</code> ä¼˜åŒ–</td>
<td style="text-align:left">çŸ­å­—ç¬¦ä¸²ä¼˜åŒ– (SSO)</td>
</tr>
<tr>
<td style="text-align:left">ä»£ç†æ¨¡å¼</td>
<td style="text-align:left"><code>vector&lt;bool&gt;</code>, <code>reference_wrapper</code></td>
<td style="text-align:left">ç‰¹åŒ–æ¨¡æ¿ + ç±»å‹ä»£ç†</td>
</tr>
</tbody>
</table></div>
<hr>
<p><strong>å…³é”®ç‚¹</strong></p>
<ul>
<li><strong>æ³›å‹ç¼–ç¨‹ä¼˜å…ˆ</strong>ï¼šSTL é€šè¿‡æ¨¡æ¿å’Œç¼–è¯‘æ—¶å¤šæ€å®ç°çµæ´»æ€§ï¼Œè€Œéä¼ ç»Ÿé¢å‘å¯¹è±¡çš„å¤šæ€ã€‚</li>
<li><strong>æ¨¡å¼éšå¼åº”ç”¨</strong>ï¼šè®¸å¤šæ¨¡å¼ä»¥æ³›å‹æ–¹å¼å®ç°ï¼ˆå¦‚ç­–ç•¥æ¨¡å¼é€šè¿‡æ¨¡æ¿å‚æ•°ä¼ é€’å‡½æ•°å¯¹è±¡ï¼‰ã€‚</li>
<li><strong>æ€§èƒ½è‡³ä¸Š</strong>ï¼šSTL è®¾è®¡é¿å…è™šå‡½æ•°å¼€é”€ï¼Œå¼ºè°ƒé›¶æˆæœ¬æŠ½è±¡ï¼ˆZero-overhead Abstractionï¼‰ã€‚</li>
</ul>
<p>ç†è§£è¿™äº›æ¨¡å¼åœ¨ STL ä¸­çš„åº”ç”¨ï¼Œèƒ½å¸®åŠ©ä½ æ›´é«˜æ•ˆåœ°ä½¿ç”¨æ ‡å‡†åº“ï¼Œå¹¶åœ¨è‡ªå®šä¹‰ç»„ä»¶æ—¶å€Ÿé‰´å…¶è®¾è®¡æ€æƒ³ã€‚</p>
<h2 id="ç°ä»£cè®¾è®¡æ¨¡å¼">ç°ä»£C++è®¾è®¡æ¨¡å¼
</h2><h3 id="ä¸€åˆ›å»ºå‹æ¨¡å¼5ç§">ä¸€ã€åˆ›å»ºå‹æ¨¡å¼ï¼ˆ5ç§ï¼‰
</h3><p><strong>1. å·¥å‚æ–¹æ³•æ¨¡å¼ (Factory Method)</strong></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå»¶è¿Ÿå¯¹è±¡åˆ›å»ºåˆ°å­ç±»<br/>
<strong>è§£å†³é—®é¢˜</strong>ï¼šé¿å…ä»£ç ä¸å…·ä½“ç±»è€¦åˆ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Creator</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">create</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WidgetFactory</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Creator</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;</span> <span class="n">create</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">ConcreteWidget</span><span class="o">&gt;</span><span class="p">();</span> <span class="c1">// ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>2. æŠ½è±¡å·¥å‚æ¨¡å¼ (Abstract Factory)</strong></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šåˆ›å»ºç›¸å…³å¯¹è±¡å®¶æ—<br/>
<strong>è§£å†³é—®é¢˜</strong>ï¼šè·¨å¹³å°UIç»„ä»¶ç”Ÿæˆ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">GUIFactory</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Button</span><span class="o">&gt;</span> <span class="n">createButton</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Menu</span><span class="o">&gt;</span> <span class="n">createMenu</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WinFactory</span> <span class="o">:</span> <span class="k">public</span> <span class="n">GUIFactory</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Button</span><span class="o">&gt;</span> <span class="n">createButton</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">WinButton</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...å…¶ä»–æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>3. å•ä¾‹æ¨¡å¼ (Singleton)</strong></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå…¨å±€å”¯ä¸€å®ä¾‹<br/>
<strong>è§£å†³é—®é¢˜</strong>ï¼šé…ç½®ç®¡ç†ã€æ—¥å¿—ç³»ç»Ÿ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Logger</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="n">Logger</span><span class="o">&amp;</span> <span class="n">instance</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">static</span> <span class="n">Logger</span> <span class="n">logger</span><span class="p">;</span> <span class="c1">// Meyer&#39;så•ä¾‹ (çº¿ç¨‹å®‰å…¨)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">logger</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ é™¤æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼æ“ä½œç¬¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Logger</span><span class="p">(</span><span class="k">const</span> <span class="n">Logger</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Logger</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Logger</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Logger</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>4. å»ºé€ è€…æ¨¡å¼ (Builder)</strong></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šåˆ†æ­¥æ„å»ºå¤æ‚å¯¹è±¡<br/>
<strong>è§£å†³é—®é¢˜</strong>ï¼šç®€åŒ–å¤šå‚æ•°å¯¹è±¡æ„é€ </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pizza</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Builder</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">Builder</span><span class="o">&amp;</span> <span class="n">setSize</span><span class="p">(</span><span class="kt">int</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/*...*/</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">Builder</span><span class="o">&amp;</span> <span class="n">addTopping</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">topping</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/*...*/</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">Pizza</span> <span class="nf">build</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Pizza</span><span class="p">{</span><span class="o">*</span><span class="k">this</span><span class="p">};</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Pizza</span><span class="p">(</span><span class="k">const</span> <span class="n">Builder</span><span class="o">&amp;</span> <span class="n">builder</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* åˆå§‹åŒ–é€»è¾‘ */</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä½¿ç”¨ç¤ºä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Pizza</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Pizza</span><span class="o">::</span><span class="n">Builder</span><span class="p">().</span><span class="n">setSize</span><span class="p">(</span><span class="mi">12</span><span class="p">).</span><span class="n">addTopping</span><span class="p">(</span><span class="s">&#34;Cheese&#34;</span><span class="p">).</span><span class="n">build</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>5. åŸå‹æ¨¡å¼ (Prototype)</strong></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šé€šè¿‡å…‹éš†åˆ›å»ºå¯¹è±¡<br/>
<strong>è§£å†³é—®é¢˜</strong>ï¼šé¿å…é‡å¤åˆå§‹åŒ–å¼€é”€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Shape</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Shape</span><span class="o">&gt;</span> <span class="n">clone</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Circle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Shape</span><span class="o">&gt;</span> <span class="n">clone</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Circle</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span> <span class="c1">// åˆ©ç”¨æ‹·è´æ„é€ å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="äºŒç»“æ„å‹æ¨¡å¼7ç§">äºŒã€ç»“æ„å‹æ¨¡å¼ï¼ˆ7ç§ï¼‰
</h3><p><strong>6. é€‚é…å™¨æ¨¡å¼ (Adapter)</strong></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šè½¬æ¢æ¥å£å…¼å®¹æ€§<br/>
<strong>è§£å†³é—®é¢˜</strong>ï¼šæ•´åˆæ—§ç‰ˆAPI</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LegacyPrinter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">printDocument</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">text</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/*...*/</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PrinterAdapter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">print</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">text</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">legacy_</span><span class="p">.</span><span class="n">printDocument</span><span class="p">(</span><span class="n">text</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">LegacyPrinter</span> <span class="n">legacy_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>7. æ¡¥æ¥æ¨¡å¼ (Bridge)</strong></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šåˆ†ç¦»æŠ½è±¡ä¸å®ç°<br/>
<strong>è§£å†³é—®é¢˜</strong>ï¼šå¤šç»´åº¦æ‰©å±•é—®é¢˜</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Renderer</span> <span class="p">{</span> <span class="c1">// å®ç°éƒ¨åˆ†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">drawCircle</span><span class="p">(</span><span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="kt">float</span> <span class="n">y</span><span class="p">,</span> <span class="kt">float</span> <span class="n">radius</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Shape</span> <span class="p">{</span> <span class="c1">// æŠ½è±¡éƒ¨åˆ†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Shape</span><span class="p">(</span><span class="n">Renderer</span><span class="o">&amp;</span> <span class="n">renderer</span><span class="p">)</span> <span class="o">:</span> <span class="n">renderer_</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">protected</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Renderer</span><span class="o">&amp;</span> <span class="n">renderer_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>8. ç»„åˆæ¨¡å¼ (Composite)</strong></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šç»Ÿä¸€å¤„ç†æ ‘å½¢ç»“æ„<br/>
<strong>è§£å†³é—®é¢˜</strong>ï¼šæ–‡ä»¶ç³»ç»Ÿç®¡ç†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">FileSystemComponent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">list</span><span class="p">(</span><span class="kt">int</span> <span class="n">indent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Directory</span> <span class="o">:</span> <span class="k">public</span> <span class="n">FileSystemComponent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">FileSystemComponent</span><span class="o">&gt;</span> <span class="n">comp</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">children_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">comp</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">list</span><span class="p">(</span><span class="kt">int</span> <span class="n">indent</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">child</span> <span class="p">:</span> <span class="n">children_</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">child</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">(</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">FileSystemComponent</span><span class="o">&gt;&gt;</span> <span class="n">children_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>9. è£…é¥°å™¨æ¨¡å¼ (Decorator)</strong></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šåŠ¨æ€æ·»åŠ èŒè´£<br/>
<strong>è§£å†³é—®é¢˜</strong>ï¼šæµå¤„ç†å¢å¼º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DataStream</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">write</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">data</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CompressedStream</span> <span class="o">:</span> <span class="k">public</span> <span class="n">DataStream</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">CompressedStream</span><span class="p">(</span><span class="n">DataStream</span><span class="o">&amp;</span> <span class="n">stream</span><span class="p">)</span> <span class="o">:</span> <span class="n">stream_</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">write</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">data</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">auto</span> <span class="n">compressed</span> <span class="o">=</span> <span class="n">compress</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">stream_</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">compressed</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">DataStream</span><span class="o">&amp;</span> <span class="n">stream_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>10. å¤–è§‚æ¨¡å¼ (Facade)</strong></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šç®€åŒ–å¤æ‚å­ç³»ç»Ÿæ¥å£<br/>
<strong>è§£å†³é—®é¢˜</strong>ï¼šç®€åŒ–æ•°æ®åº“æ“ä½œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DatabaseFacade</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">executeQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">sql</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">connection_</span><span class="p">.</span><span class="n">connect</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">parser_</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">executor_</span><span class="p">.</span><span class="n">execute</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">connection_</span><span class="p">.</span><span class="n">disconnect</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">ConnectionManager</span> <span class="n">connection_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">QueryParser</span> <span class="n">parser_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">QueryExecutor</span> <span class="n">executor_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>11. äº«å…ƒæ¨¡å¼ (Flyweight)</strong></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå…±äº«ç»†ç²’åº¦å¯¹è±¡<br/>
<strong>è§£å†³é—®é¢˜</strong>ï¼šå¤§é‡é‡å¤å¯¹è±¡çš„å†…å­˜ä¼˜åŒ–</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Font</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Font</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">)</span> <span class="o">:</span> <span class="n">name_</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/*...*/</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...å­—ä½“å±æ€§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">FontFactory</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Font</span><span class="o">&amp;</span> <span class="n">getFont</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">fonts_</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">it</span> <span class="o">==</span> <span class="n">fonts_</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">it</span> <span class="o">=</span> <span class="n">fonts_</span><span class="p">.</span><span class="n">emplace</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Font</span><span class="o">&gt;</span><span class="p">(</span><span class="n">name</span><span class="p">)).</span><span class="n">first</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">*</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Font</span><span class="o">&gt;&gt;</span> <span class="n">fonts_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>12. ä»£ç†æ¨¡å¼ (Proxy)</strong></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šæ§åˆ¶å¯¹è±¡è®¿é—®<br/>
<strong>è§£å†³é—®é¢˜</strong>ï¼šå»¶è¿ŸåŠ è½½ã€æƒé™æ§åˆ¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Image</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">display</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RealImage</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Image</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">RealImage</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">filename</span><span class="p">)</span> <span class="p">{</span> <span class="n">loadFromDisk</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">display</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="cm">/* æ˜¾ç¤ºå›¾ç‰‡ */</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ProxyImage</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Image</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">ProxyImage</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">filename</span><span class="p">)</span> <span class="o">:</span> <span class="n">filename_</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">display</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">realImage_</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">realImage_</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">RealImage</span><span class="o">&gt;</span><span class="p">(</span><span class="n">filename_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">realImage_</span><span class="o">-&gt;</span><span class="n">display</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">RealImage</span><span class="o">&gt;</span> <span class="n">realImage_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">filename_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="ä¸‰è¡Œä¸ºå‹æ¨¡å¼11ç§">ä¸‰ã€è¡Œä¸ºå‹æ¨¡å¼ï¼ˆ11ç§ï¼‰
</h3><p>ï¼ˆä»¥ä¸‹ä¸ºéƒ¨åˆ†å®ç°ç¤ºä¾‹ï¼‰</p>
<p><strong>13. ç­–ç•¥æ¨¡å¼ (Strategy)</strong></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå°è£…å¯äº’æ¢ç®—æ³•<br/>
<strong>è§£å†³é—®é¢˜</strong>ï¼šæ”¯ä»˜æ–¹å¼åˆ‡æ¢</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">using</span> <span class="n">PaymentStrategy</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PaymentProcessor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">setStrategy</span><span class="p">(</span><span class="n">PaymentStrategy</span> <span class="n">strategy</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">strategy_</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">strategy</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">bool</span> <span class="nf">processPayment</span><span class="p">(</span><span class="kt">double</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">strategy_</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">PaymentStrategy</span> <span class="n">strategy_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä½¿ç”¨ç¤ºä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">PaymentProcessor</span> <span class="n">processor</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">processor</span><span class="p">.</span><span class="n">setStrategy</span><span class="p">([](</span><span class="kt">double</span> <span class="n">amt</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ä¿¡ç”¨å¡é€»è¾‘ */</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="n">processor</span><span class="p">.</span><span class="n">processPayment</span><span class="p">(</span><span class="mf">100.0</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>14. è§‚å¯Ÿè€…æ¨¡å¼ (Observer)</strong></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šçŠ¶æ€å˜æ›´é€šçŸ¥<br/>
<strong>è§£å†³é—®é¢˜</strong>ï¼šäº‹ä»¶å¤„ç†ç³»ç»Ÿ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Observable</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">subscribe</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">observer</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">observers_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">observer</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">notify</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">data</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">obs</span> <span class="p">:</span> <span class="n">observers_</span><span class="p">)</span> <span class="n">obs</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;&gt;</span> <span class="n">observers_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä½¿ç”¨ç¤ºä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Observable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">counter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">counter</span><span class="p">.</span><span class="n">subscribe</span><span class="p">([](</span><span class="kt">int</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Value changed: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">value</span><span class="p">;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="n">counter</span><span class="p">.</span><span class="n">notify</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>15. å‘½ä»¤æ¨¡å¼ (Command)</strong></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå°†è¯·æ±‚å°è£…ä¸ºå¯¹è±¡<br/>
<strong>è§£å†³é—®é¢˜</strong>ï¼šæ’¤é”€/é‡åšåŠŸèƒ½</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">EditorCommand</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">execute</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">undo</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">InsertCommand</span> <span class="o">:</span> <span class="k">public</span> <span class="n">EditorCommand</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">InsertCommand</span><span class="p">(</span><span class="n">Document</span><span class="o">&amp;</span> <span class="n">doc</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">pos</span><span class="p">,</span> <span class="kt">char</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">doc_</span><span class="p">(</span><span class="n">doc</span><span class="p">),</span> <span class="n">pos_</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span> <span class="n">c_</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">execute</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="n">doc_</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pos_</span><span class="p">,</span> <span class="n">c_</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">undo</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="n">doc_</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">pos_</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Document</span><span class="o">&amp;</span> <span class="n">doc_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">size_t</span> <span class="n">pos_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">c_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>16. æ¨¡æ¿æ–¹æ³•æ¨¡å¼ (Template Method)</strong></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå®šä¹‰ç®—æ³•éª¨æ¶<br/>
<strong>è§£å†³é—®é¢˜</strong>ï¼šæµç¨‹æ ‡å‡†åŒ–</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DataExporter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">exportData</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">openConnection</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">fetchData</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">formatData</span><span class="p">();</span> <span class="c1">// è™šå‡½æ•°é’©å­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">closeConnection</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">protected</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">formatData</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...å…¶ä»–æ­¥éª¤å®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CSVExporter</span> <span class="o">:</span> <span class="k">public</span> <span class="n">DataExporter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">protected</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">formatData</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="cm">/* CSVæ ¼å¼å¤„ç† */</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>17. çŠ¶æ€æ¨¡å¼ (State)</strong></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå°è£…çŠ¶æ€è¡Œä¸º<br/>
<strong>è§£å†³é—®é¢˜</strong>ï¼šè®¢å•çŠ¶æ€æµè½¬</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OrderState</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">handle</span><span class="p">(</span><span class="n">OrderContext</span><span class="o">&amp;</span> <span class="n">context</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OrderContext</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">transitionTo</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">OrderState</span><span class="o">&gt;</span> <span class="n">state</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">state_</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">process</span><span class="p">()</span> <span class="p">{</span> <span class="n">state_</span><span class="o">-&gt;</span><span class="n">handle</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">OrderState</span><span class="o">&gt;</span> <span class="n">state_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="å››ç°ä»£cå…³é”®ä¼˜åŒ–æŠ€æœ¯">å››ã€ç°ä»£C++å…³é”®ä¼˜åŒ–æŠ€æœ¯
</h3><ol>
<li><strong>æ™ºèƒ½æŒ‡é’ˆç®¡ç†èµ„æº</strong>
<code>std::unique_ptr</code>/<code>std::shared_ptr</code>æ›¿ä»£åŸå§‹æŒ‡é’ˆ</li>
<li><strong>Lambdaè¡¨è¾¾å¼</strong>
æ›¿ä»£å°å‹ç­–ç•¥ç±»å’Œå‘½ä»¤å¯¹è±¡</li>
<li><strong>ç§»åŠ¨è¯­ä¹‰</strong>
ä¼˜åŒ–å¯¹è±¡ä¼ é€’æ•ˆç‡</li>
<li><strong>ç±»å‹æ¨å¯¼ (auto)</strong>
ç®€åŒ–æ¨¡æ¿ä»£ç </li>
<li><strong>å¯å˜å‚æ•°æ¨¡æ¿</strong>
æ”¯æŒä»»æ„å‚æ•°çš„å·¥å‚æ–¹æ³•</li>
<li><strong>std::function</strong>
ç»Ÿä¸€å›è°ƒæ¥å£</li>
</ol>
<hr>
<h3 id="äº”æ¨¡å¼é€‰æ‹©å»ºè®®è¡¨">äº”ã€æ¨¡å¼é€‰æ‹©å»ºè®®è¡¨
</h3><div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:left">é—®é¢˜åœºæ™¯</th>
<th style="text-align:left">æ¨èæ¨¡å¼</th>
<th style="text-align:left">ç°ä»£C++ç‰¹æ€§åº”ç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">éœ€è¦è¿è¡Œæ—¶ç®—æ³•åˆ‡æ¢</td>
<td style="text-align:left">ç­–ç•¥æ¨¡å¼</td>
<td style="text-align:left"><code>std::function</code> + lambda</td>
</tr>
<tr>
<td style="text-align:left">éœ€è¦æ’¤é”€/é‡åšåŠŸèƒ½</td>
<td style="text-align:left">å‘½ä»¤æ¨¡å¼</td>
<td style="text-align:left">æ™ºèƒ½æŒ‡é’ˆç®¡ç†å‘½ä»¤å†å²</td>
</tr>
<tr>
<td style="text-align:left">å¤„ç†å¤æ‚å¯¹è±¡åˆ›å»ºæµç¨‹</td>
<td style="text-align:left">å»ºé€ è€…æ¨¡å¼</td>
<td style="text-align:left">Fluentæ¥å£é“¾å¼è°ƒç”¨</td>
</tr>
<tr>
<td style="text-align:left">éœ€è¦ä¼˜åŒ–å¤§é‡ç›¸ä¼¼å¯¹è±¡</td>
<td style="text-align:left">äº«å…ƒæ¨¡å¼</td>
<td style="text-align:left"><code>unordered_map</code>ç¼“å­˜ç®¡ç†</td>
</tr>
<tr>
<td style="text-align:left">è·¨å¹³å°UIç»„ä»¶ç”Ÿæˆ</td>
<td style="text-align:left">æŠ½è±¡å·¥å‚æ¨¡å¼</td>
<td style="text-align:left">æ¨¡æ¿ç‰¹åŒ–ä¸åŒå¹³å°å®ç°</td>
</tr>
</tbody>
</table></div>
<hr>
<p>é€šè¿‡ç»“åˆç°ä»£C++ç‰¹æ€§ï¼Œä¼ ç»Ÿè®¾è®¡æ¨¡å¼å¯ä»¥å®ç°æ›´ç®€æ´ã€æ›´é«˜æ•ˆã€æ›´å®‰å…¨çš„ä»£ç ç»“æ„ã€‚æ¯ä¸ªæ¨¡å¼çš„æ ¸å¿ƒä»·å€¼åœ¨äº<strong>è§£è€¦å˜åŒ–æ–¹å‘</strong>ï¼Œè€Œç°ä»£è¯­è¨€ç‰¹æ€§åˆ™æä¾›äº†æ›´ä¼˜é›…çš„å®ç°æ‰‹æ®µã€‚</p>
<h2 id="ç¬¬ä¸€ç« è½¯ä»¶è®¾è®¡çš„è‰ºæœ¯">ç¬¬ä¸€ç« ï¼šè½¯ä»¶è®¾è®¡çš„è‰ºæœ¯
</h2><p><strong>ä»€ä¹ˆæ˜¯è½¯ä»¶è®¾è®¡ï¼Ÿä¸ºä»€ä¹ˆä½ åº”è¯¥å…³å¿ƒå®ƒï¼Ÿ</strong></p>
<p>åœ¨è¿™ä¸€ç« ä¸­ï¼Œæˆ‘å°†ä¸ºæœ¬ä¹¦å…³äºè½¯ä»¶è®¾è®¡çš„å†…å®¹å¥ å®šåŸºç¡€ã€‚æˆ‘ä¼šè§£é‡Šä»€ä¹ˆæ˜¯è½¯ä»¶è®¾è®¡ï¼Œå¸®åŠ©ä½ ç†è§£ä¸ºä»€ä¹ˆå®ƒæ˜¯é¡¹ç›®æˆåŠŸçš„å…³é”®å› ç´ ï¼Œå¹¶ä¸”ä¸ºä»€ä¹ˆå®ƒæ˜¯ä½ å¿…é¡»åšå¯¹çš„ä¸€ä»¶äº‹ã€‚<br/>åŒæ—¶ï¼Œä½ ä¼šçœ‹åˆ°è½¯ä»¶è®¾è®¡æ˜¯éå¸¸å¤æ‚çš„ï¼Œäº‹å®ä¸Šï¼Œå®ƒæ˜¯è½¯ä»¶å¼€å‘ä¸­æœ€å¤æ‚çš„éƒ¨åˆ†ã€‚<br/>å› æ­¤ï¼Œæˆ‘è¿˜ä¼šä»‹ç»å‡ ç§è½¯ä»¶è®¾è®¡åŸåˆ™ï¼Œå¸®åŠ©ä½ åœ¨æ­£ç¡®çš„é“è·¯ä¸Šå‰è¡Œã€‚</p>
<p><strong>å‡†åˆ™1ï¼šç†è§£è½¯ä»¶è®¾è®¡çš„é‡è¦æ€§</strong></p>
<p>åœ¨â€œå‡†åˆ™1ï¼šç†è§£è½¯ä»¶è®¾è®¡çš„é‡è¦æ€§â€ä¸­ï¼Œæˆ‘ä¼šèšç„¦äºå¤§å±€è§‚å¹¶è§£é‡Šè½¯ä»¶é¢„æœŸä¼šç»å†å˜åŒ–ã€‚å› æ­¤ï¼Œè½¯ä»¶åº”è¯¥èƒ½å¤Ÿåº”å¯¹è¿™äº›å˜åŒ–ã€‚<br/>ç„¶è€Œï¼Œè¯´èµ·æ¥å®¹æ˜“åšèµ·æ¥éš¾ï¼Œå› ä¸ºåœ¨ç°å®ä¸­ï¼Œè€¦åˆå’Œä¾èµ–å…³ç³»ä½¿å¾—å¼€å‘è€…çš„å·¥ä½œå˜å¾—å¤æ‚å¾—å¤šã€‚è¿™äº›é—®é¢˜å¯ä»¥é€šè¿‡è½¯ä»¶è®¾è®¡æ¥è§£å†³ã€‚<br/>æˆ‘å°†ä»‹ç»è½¯ä»¶è®¾è®¡ä½œä¸ºç®¡ç†ä¾èµ–å…³ç³»å’ŒæŠ½è±¡çš„è‰ºæœ¯â€”â€”è¿™æ˜¯è½¯ä»¶å·¥ç¨‹çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ã€‚</p>
<p><strong>å‡†åˆ™2ï¼šä¸ºå˜åŒ–è€Œè®¾è®¡</strong></p>
<p>åœ¨â€œå‡†åˆ™2ï¼šä¸ºå˜åŒ–è€Œè®¾è®¡â€ä¸­ï¼Œæˆ‘å°†æ˜ç¡®è®¨è®ºè€¦åˆå’Œä¾èµ–å…³ç³»ï¼Œå¹¶å¸®åŠ©ä½ ç†è§£å¦‚ä½•è®¾è®¡ä»¥é€‚åº”å˜åŒ–ï¼Œä½¿è½¯ä»¶æ›´å…·é€‚åº”æ€§ã€‚ä¸ºæ­¤ï¼Œæˆ‘å°†ä»‹ç»å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰å’Œä¸è¦é‡å¤è‡ªå·±ï¼ˆDRYï¼‰åŸåˆ™ï¼Œè¿™ä¸¤ä¸ªåŸåˆ™å¯ä»¥å¸®åŠ©ä½ å®ç°è¿™ä¸€ç›®æ ‡ã€‚</p>
<ul>
<li><strong>å•ä¸€èŒè´£åŸåˆ™ (SRP)</strong>ï¼šæ¯ä¸ªæ¨¡å—æˆ–ç±»åº”åªæœ‰ä¸€ä¸ªæ”¹å˜çš„ç†ç”±ï¼Œå³åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½ã€‚</li>
<li><strong>ä¸è¦é‡å¤è‡ªå·± (DRY)</strong>ï¼šé¿å…ä»£ç é‡å¤ï¼Œç¡®ä¿é€»è¾‘åªåœ¨ä¸€ä¸ªåœ°æ–¹å®ç°ã€‚</li>
</ul>
<p><strong>å‡†åˆ™3ï¼šåˆ†ç¦»æ¥å£ä»¥é¿å…äººä¸ºè€¦åˆ</strong></p>
<p>åœ¨â€œå‡†åˆ™3ï¼šåˆ†ç¦»æ¥å£ä»¥é¿å…äººä¸ºè€¦åˆâ€ä¸­ï¼Œæˆ‘ä¼šè¿›ä¸€æ­¥è®¨è®ºè€¦åˆé—®é¢˜ï¼Œç‰¹åˆ«æ˜¯é€šè¿‡æ¥å£äº§ç”Ÿçš„è€¦åˆã€‚<br/>æˆ‘è¿˜ä¼šä»‹ç»æ¥å£éš”ç¦»åŸåˆ™ï¼ˆISPï¼‰ï¼Œè¿™æ˜¯ä¸€ç§å‡å°‘ç”±æ¥å£å¼•èµ·çš„äººä¸ºè€¦åˆçš„æ–¹æ³•ã€‚</p>
<ul>
<li><strong>æ¥å£éš”ç¦»åŸåˆ™ (ISP)</strong>ï¼šå®¢æˆ·ç«¯ä¸åº”è¢«è¿«ä¾èµ–äºå®ƒä»¬ä¸ä½¿ç”¨çš„æ¥å£ã€‚<br/>è¿™æ„å‘³ç€æ¥å£åº”è¯¥å°½é‡å°è€Œå…·ä½“ï¼Œè€Œä¸æ˜¯å¤§è€Œæ³›ã€‚</li>
</ul>
<p><strong>å‡†åˆ™4ï¼šä¸ºå¯æµ‹è¯•æ€§è®¾è®¡</strong></p>
<p>åœ¨â€œå‡†åˆ™4ï¼šä¸ºå¯æµ‹è¯•æ€§è®¾è®¡â€ä¸­ï¼Œæˆ‘ä¼šå…³æ³¨ç”±äºäººä¸ºè€¦åˆå¯¼è‡´çš„å¯æµ‹è¯•æ€§é—®é¢˜ã€‚<br/>ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä¼šæå‡ºå¦‚ä½•æµ‹è¯•ç§æœ‰æˆå‘˜å‡½æ•°çš„é—®é¢˜ï¼Œå¹¶æ¼”ç¤ºåˆ†ç¦»å…³æ³¨ç‚¹çš„åº”ç”¨æ˜¯å”¯ä¸€çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<ul>
<li><strong>åˆ†ç¦»å…³æ³¨ç‚¹</strong>ï¼šå°†ä¸åŒåŠŸèƒ½åˆ†ç¦»åˆ°ä¸åŒçš„æ¨¡å—æˆ–ç±»ä¸­ï¼Œä»¥ä¾¿æ›´å®¹æ˜“è¿›è¡Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ã€‚</li>
</ul>
<p><strong>å‡†åˆ™5ï¼šä¸ºæ‰©å±•æ€§è®¾è®¡</strong></p>
<p>åœ¨â€œå‡†åˆ™5ï¼šä¸ºæ‰©å±•æ€§è®¾è®¡â€ä¸­ï¼Œæˆ‘ä¼šè®¨è®ºä¸€ç§é‡è¦çš„å˜åŒ–ç±»å‹ï¼šæ‰©å±•ã€‚å°±åƒä»£ç åº”è¯¥æ˜“äºæ›´æ”¹ä¸€æ ·ï¼Œå®ƒä¹Ÿåº”è¯¥æ˜“äºæ‰©å±•ã€‚æˆ‘ä¼šç»™ä½ ä¸€äº›å®ç°è¿™ä¸€ç›®æ ‡çš„æƒ³æ³•ï¼Œå¹¶å±•ç¤ºå¼€é—­åŸåˆ™ï¼ˆOCPï¼‰çš„ä»·å€¼ã€‚</p>
<ul>
<li><strong>å¼€é—­åŸåˆ™ (OCP)</strong>ï¼šè½¯ä»¶å®ä½“ï¼ˆç±»ã€æ¨¡å—ã€å‡½æ•°ç­‰ï¼‰åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥é€šè¿‡æ·»åŠ æ–°åŠŸèƒ½æ¥æ‰©å±•ç³»ç»Ÿï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰çš„ä»£ç ã€‚</li>
</ul>
<hr>
<h3 id="å‡†åˆ™1ç†è§£è½¯ä»¶è®¾è®¡çš„é‡è¦æ€§">å‡†åˆ™1ï¼šç†è§£è½¯ä»¶è®¾è®¡çš„é‡è¦æ€§
</h3><p>å¦‚æœæˆ‘é—®ä½ å“ªäº›ä»£ç å±æ€§å¯¹ä½ æ¥è¯´æœ€é‡è¦ï¼Œç»è¿‡ä¸€äº›æ€è€ƒåï¼Œä½ å¯èƒ½ä¼šè¯´è¯¸å¦‚å¯è¯»æ€§ã€å¯æµ‹è¯•æ€§ã€å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§ã€å¯å¤ç”¨æ€§å’Œå¯æ‰©å±•æ€§ä¹‹ç±»çš„ä¸œè¥¿ã€‚æˆ‘å®Œå…¨åŒæ„ã€‚<br/>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ç°åœ¨é—®ä½ å¦‚ä½•å®ç°è¿™äº›ç›®æ ‡ï¼Œå¾ˆæœ‰å¯èƒ½ä½ ä¼šå¼€å§‹åˆ—ä¸¾ä¸€äº›C++ç‰¹æ€§ï¼šRAIIã€ç®—æ³•ã€lambdaè¡¨è¾¾å¼ã€æ¨¡å—ç­‰ç­‰ã€‚</p>
<p><strong>ç‰¹æ€§ä¸æ˜¯è½¯ä»¶è®¾è®¡</strong></p>
<p>æ˜¯çš„ï¼ŒC++ æä¾›äº†å¾ˆå¤šç‰¹æ€§ã€‚éå¸¸å¤šï¼å¤§çº¦ä¸€åŠçš„è¿‘2000é¡µå°åˆ·ç‰ˆC++æ ‡å‡†éƒ½ç”¨äºè§£é‡Šè¯­è¨€æœºåˆ¶å’Œç‰¹æ€§ã€‚<br/>è‡ªC++11å‘å¸ƒä»¥æ¥ï¼Œæœ‰ä¸€ä¸ªæ˜ç¡®çš„æ‰¿è¯ºï¼šæ¯ä¸‰å¹´ï¼ŒC++æ ‡å‡†åŒ–å§”å‘˜ä¼šéƒ½ä¼šç»™æˆ‘ä»¬å¸¦æ¥ä¸€ä¸ªæ–°çš„C++æ ‡å‡†ï¼Œå…¶ä¸­åŒ…å«é¢å¤–çš„å…¨æ–°ç‰¹æ€§ã€‚<br/>é‰´äºæ­¤ï¼ŒC++ç¤¾åŒºéå¸¸å¼ºè°ƒç‰¹æ€§å’Œè¯­è¨€æœºåˆ¶å¹¶ä¸ä»¤äººæ„å¤–ã€‚å¤§å¤šæ•°ä¹¦ç±ã€è®²åº§å’Œåšå®¢éƒ½é›†ä¸­åœ¨ç‰¹æ€§ã€æ–°åº“å’Œè¯­è¨€ç»†èŠ‚ä¸Šã€‚</p>
<p>å‡ ä¹æ„Ÿè§‰åƒæ˜¯ç‰¹æ€§æ˜¯ç”¨C++ç¼–ç¨‹ä¸­æœ€é‡è¦çš„ä¸œè¥¿ï¼Œå¹¶ä¸”å¯¹C++é¡¹ç›®çš„æˆåŠŸè‡³å…³é‡è¦ã€‚ä½†è¯´å®è¯ï¼Œå®ƒä»¬å¹¶ä¸æ˜¯ã€‚<br/>æ— è®ºæ˜¯å¯¹æ‰€æœ‰ç‰¹æ€§çš„äº†è§£è¿˜æ˜¯C++æ ‡å‡†çš„é€‰æ‹©ï¼Œéƒ½ä¸æ˜¯é¡¹ç›®æˆåŠŸçš„å…³é”®å› ç´ ,ä½ ä¸åº”è¯¥æŒ‡æœ›ç‰¹æ€§æ¥æ‹¯æ•‘ä½ çš„é¡¹ç›®ã€‚<br/>ç›¸åï¼Œä¸€ä¸ªé¡¹ç›®å³ä½¿ä½¿ç”¨è¾ƒæ—§çš„C++æ ‡å‡†ï¼Œç”šè‡³åªä½¿ç”¨å¯ç”¨ç‰¹æ€§çš„ä¸€å°éƒ¨åˆ†ï¼Œä¹Ÿå¯ä»¥éå¸¸æˆåŠŸã€‚<br/>æ’‡å¼€è½¯ä»¶å¼€å‘ä¸­çš„äººä¸ºå› ç´ ä¸è°ˆï¼Œå¯¹äºé¡¹ç›®æˆè´¥æ›´é‡è¦çš„é—®é¢˜æ˜¯è½¯ä»¶çš„æ•´ä½“ç»“æ„ã€‚</p>
<p>æœ€ç»ˆï¼Œæ­£æ˜¯è¿™ç§ç»“æ„å†³å®šäº†å¯ç»´æŠ¤æ€§ï¼šä¿®æ”¹ä»£ç ã€æ‰©å±•ä»£ç å’Œæµ‹è¯•ä»£ç æœ‰å¤šå®¹æ˜“ï¼Ÿå¦‚æœæ²¡æœ‰è½»æ¾ä¿®æ”¹ä»£ç ã€æ·»åŠ æ–°åŠŸèƒ½å¹¶å¯¹å…¶æ­£ç¡®æ€§æœ‰ä¿¡å¿ƒçš„èƒ½åŠ›ï¼Œé¡¹ç›®å°†èµ°åˆ°ç”Ÿå‘½å‘¨æœŸçš„å°½å¤´ã€‚<br/>ç»“æ„è¿˜å†³å®šäº†é¡¹ç›®çš„å¯æ‰©å±•æ€§ï¼šé¡¹ç›®åœ¨å´©æºƒä¹‹å‰èƒ½å¢é•¿åˆ°å¤šå¤§ï¼Ÿåœ¨å¤§å®¶å¼€å§‹äº’ç›¸å¹²æ‰°ä¹‹å‰ï¼Œæœ‰å¤šå°‘äººå¯ä»¥å‚ä¸å®ç°é¡¹ç›®çš„æ„¿æ™¯ï¼Ÿ</p>
<p>æ•´ä½“ç»“æ„å°±æ˜¯é¡¹ç›®çš„<strong>è®¾è®¡</strong>,è®¾è®¡åœ¨é¡¹ç›®æˆåŠŸä¸­çš„ä½œç”¨è¿œæ¯”ä»»ä½•ç‰¹æ€§éƒ½è¦é‡è¦å¾—å¤šã€‚<br/>å¥½çš„è½¯ä»¶ä¸ä»…ä»…åœ¨äºæ­£ç¡®ä½¿ç”¨æŸä¸ªç‰¹æ€§,è€Œæ˜¯å…³äºåšå®çš„æ¶æ„å’Œè®¾è®¡ã€‚<br/>è‰¯å¥½çš„è½¯ä»¶è®¾è®¡å¯ä»¥å®¹å¿ä¸€äº›ç³Ÿç³•çš„å®ç°å†³ç­–ï¼Œä½†ç³Ÿç³•çš„è½¯ä»¶è®¾è®¡ä¸èƒ½ä»…é è‹±é›„å¼çš„ä½¿ç”¨ï¼ˆæ—§æˆ–æ–°çš„ï¼‰ç‰¹æ€§æ¥æŒ½æ•‘ã€‚</p>
<p><strong>è½¯ä»¶è®¾è®¡ï¼šç®¡ç†ä¾èµ–å…³ç³»å’ŒæŠ½è±¡çš„è‰ºæœ¯</strong></p>
<p><strong>ä¸ºä»€ä¹ˆè½¯ä»¶è®¾è®¡å¯¹é¡¹ç›®çš„è´¨é‡å¦‚æ­¤é‡è¦ï¼Ÿ</strong></p>
<p>å‡è®¾ç›®å‰ä¸€åˆ‡è¿è¡Œè‰¯å¥½ï¼Œåªè¦è½¯ä»¶æ²¡æœ‰å˜åŒ–ä¸”ä¸éœ€è¦æ·»åŠ æ–°åŠŸèƒ½ï¼Œä½ å°±å¯ä»¥é«˜æ•æ— å¿§ã€‚</p>
<p>ç„¶è€Œï¼Œè¿™ç§çŠ¶æ€é€šå¸¸ä¸ä¼šæŒç»­å¾ˆä¹…ï¼Œå¯ä»¥åˆç†é¢„æœŸï¼ŒæŸäº›äº‹æƒ…å°†ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ¯•ç«Ÿï¼Œåœ¨è½¯ä»¶å¼€å‘ä¸­å”¯ä¸€ä¸å˜çš„å°±æ˜¯å˜åŒ–ï¼Œå®ƒæ˜¯æ‰€æœ‰é—®é¢˜åŠè§£å†³æ–¹æ¡ˆèƒŒåçš„é©±åŠ¨åŠ›ã€‚</p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè½¯ä»¶è¢«ç§°ä¸ºâ€œè½¯â€ä»¶ï¼šå› ä¸ºå®ƒç›¸å¯¹ç¡¬ä»¶æ¥è¯´æ˜¯æŸ”è½¯ä¸”å¯å¡‘çš„ã€‚å°½ç®¡æˆ‘ä»¬æœŸæœ›è½¯ä»¶èƒ½è½»æ¾é€‚åº”å˜åŒ–ï¼Œä½†ç°å®å¾€å¾€å¹¶éå¦‚æ­¤ã€‚</p>
<p>ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œå‡è®¾ä½ ä»é—®é¢˜è·Ÿè¸ªç³»ç»Ÿä¸­é€‰æ‹©äº†ä¸€ä¸ªè¯„ä¼°ä¸º2çš„ä»»åŠ¡ï¼Œæ— è®º2ä»£è¡¨ä»€ä¹ˆï¼Œå®ƒå¬èµ·æ¥éƒ½ä¸æ˜¯å¤§ä»»åŠ¡ï¼Œæ‰€ä»¥ä½ æœ‰ä¿¡å¿ƒå¯ä»¥å¾ˆå¿«å®Œæˆã€‚</p>
<p>æ€€ç€è‰¯å¥½çš„æ„¿æœ›ï¼Œä½ å…ˆç†è§£é¢„æœŸè¦æ±‚ï¼Œç„¶åå¼€å§‹åœ¨ä¸€ä¸ªå®ä½“Aä¸Šè¿›è¡Œä¿®æ”¹ã€‚<br/>ç”±äºæµ‹è¯•åé¦ˆï¼ˆä½ å¾ˆå¹¸è¿æœ‰æµ‹è¯•ï¼ï¼‰ï¼Œä½ å¾ˆå¿«æ„è¯†åˆ°è¿˜éœ€è§£å†³å®ä½“Bçš„é—®é¢˜ï¼Œè¿™ä»¤äººæƒŠè®¶ï¼Œå› ä¸ºä½ æ²¡é¢„æ–™åˆ°Bä¼šæ¶‰åŠå…¶ä¸­ã€‚</p>
<p>å°½ç®¡å¦‚æ­¤ï¼Œä½ è¿˜æ˜¯ç»§ç»­è°ƒæ•´Bï¼Œç„¶è€Œï¼Œå¤œé—´æ„å»ºæ˜¾ç¤ºè¿™å¯¼è‡´äº†Cå’ŒDåœæ­¢å·¥ä½œã€‚<br/>æ·±å…¥è°ƒæŸ¥åï¼Œä½ å‘ç°é—®é¢˜çš„æ ¹æºéå¸ƒä»£ç åº“çš„å¾ˆå¤§ä¸€éƒ¨åˆ†ã€‚<br/>è¿™ä¸ªçœ‹ä¼¼ç®€å•çš„ä»»åŠ¡å·²æ¼”å˜æˆå¤§è§„æ¨¡ä¸”é«˜é£é™©çš„ä»£ç ä¿®æ”¹ã€‚ä½ è§£å†³é—®é¢˜çš„ä¿¡å¿ƒæ¶ˆå¤±ï¼Œæœ¬å‘¨çš„å·¥ä½œè®¡åˆ’ä¹Ÿè¢«æ‰“ä¹±ã€‚</p>
<p><strong>ä¹Ÿè®¸è¿™ä¸ªæ•…äº‹å¬èµ·æ¥å¾ˆç†Ÿæ‚‰</strong></p>
<p>ä¹Ÿè®¸è¿™ä¸ªæ•…äº‹å¯¹ä½ æ¥è¯´å¾ˆç†Ÿæ‚‰ï¼Œä¹Ÿè®¸ä½ ç”šè‡³å¯ä»¥è´¡çŒ®ä¸€äº›ä½ è‡ªå·±ç»å†çš„â€œæˆ˜äº‰æ•…äº‹â€ã€‚<br/>äº‹å®ä¸Šï¼Œå¤§å¤šæ•°å¼€å‘è€…éƒ½æœ‰ç±»ä¼¼çš„ç»å†ã€‚<br/>è€Œè¿™äº›ç»å†çš„é—®é¢˜é€šå¸¸éƒ½æºè‡ªåŒä¸€ä¸ªæ ¹æºï¼šä¾èµ–å…³ç³»ã€‚æ­£å¦‚Kent Beckåœ¨ä»–çš„æµ‹è¯•é©±åŠ¨å¼€å‘ä¸€ä¹¦ä¸­æ‰€è¡¨è¾¾çš„ï¼š</p>
<p><strong>ä¾èµ–å…³ç³»æ˜¯æ‰€æœ‰è§„æ¨¡è½¯ä»¶å¼€å‘ä¸­çš„å…³é”®é—®é¢˜ã€‚</strong></p>
<p>ä¾èµ–å…³ç³»æ˜¯æ¯ä¸ªè½¯ä»¶å¼€å‘è€…å­˜åœ¨çš„ç¥¸æ ¹ â€œä½†æ˜¯å½“ç„¶ä¼šæœ‰ä¾èµ–å…³ç³»ï¼Œâ€ ä½ å¯èƒ½ä¼šäº‰è¾©é“ï¼Œâ€œæ€»æ˜¯ä¼šæœ‰ä¾èµ–å…³ç³»ï¼Œå¦åˆ™ä¸åŒçš„ä»£ç ç‰‡æ®µå¦‚ä½•ååŒå·¥ä½œå‘¢ï¼Ÿâ€ å½“ç„¶ï¼Œä½ æ˜¯å¯¹çš„ã€‚<br/>ä¸åŒçš„ä»£ç ç‰‡æ®µéœ€è¦ååŒå·¥ä½œï¼Œè¿™ç§äº¤äº’æ€»ä¼šäº§ç”ŸæŸç§å½¢å¼çš„è€¦åˆã€‚<br/>ç„¶è€Œï¼Œè™½ç„¶å­˜åœ¨å¿…è¦ä¸”ä¸å¯é¿å…çš„ä¾èµ–å…³ç³»ï¼Œä½†ä¹Ÿå­˜åœ¨æˆ‘ä»¬å› ç¼ºä¹å¯¹é—®é¢˜çš„ç†è§£ã€æ²¡æœ‰æ¸…æ™°çš„æ•´ä½“è§†è§’æˆ–åªæ˜¯ä¸å¤Ÿæ³¨æ„è€Œæ— æ„å¼•å…¥çš„äººä¸ºä¾èµ–å…³ç³»ã€‚<br/>ä¸ç”¨è¯´ï¼Œè¿™äº›äººé€ ä¾èµ–å…³ç³»ä¼šå¸¦æ¥éº»çƒ¦ï¼Œå®ƒä»¬ä½¿å¾—ç†è§£æˆ‘ä»¬çš„è½¯ä»¶ã€ä¿®æ”¹è½¯ä»¶ã€æ·»åŠ æ–°åŠŸèƒ½å’Œç¼–å†™æµ‹è¯•å˜å¾—æ›´åŠ å›°éš¾ã€‚<br/>å› æ­¤ï¼Œä½œä¸ºè½¯ä»¶å¼€å‘è€…çš„ä¸»è¦ä»»åŠ¡ä¹‹ä¸€ï¼ˆå¦‚æœä¸æ˜¯æœ€é‡è¦çš„ä»»åŠ¡ï¼‰ï¼Œå°±æ˜¯å°½é‡å‡å°‘äººä¸ºä¾èµ–å…³ç³»ã€‚</p>
<p>è¿™ç§ä¾èµ–å…³ç³»çš„æœ€å°åŒ–æ˜¯è½¯ä»¶æ¶æ„å’Œè®¾è®¡çš„ç›®æ ‡ã€‚ç”¨Robert C. Martinçš„è¯æ¥è¯´ï¼š</p>
<p><strong>è½¯ä»¶æ¶æ„çš„ç›®æ ‡æ˜¯å°†æ„å»ºå’Œç»´æŠ¤æ‰€éœ€ç³»ç»Ÿæ‰€éœ€çš„äººåŠ›èµ„æºæœ€å°åŒ–ã€‚</strong></p>
<p>æ¶æ„å’Œè®¾è®¡æ˜¯å‡å°‘ä»»ä½•é¡¹ç›®å·¥ä½œé‡æ‰€éœ€çš„å·¥å…·ã€‚å®ƒä»¬å¤„ç†ä¾èµ–å…³ç³»å¹¶é€šè¿‡æŠ½è±¡æ¥é™ä½å¤æ‚æ€§ã€‚ç”¨æˆ‘è‡ªå·±çš„è¯æ¥è¯´ï¼š</p>
<p><strong>è½¯ä»¶è®¾è®¡æ˜¯ç®¡ç†è½¯ä»¶ç»„ä»¶ä¹‹é—´ç›¸äº’ä¾èµ–çš„è‰ºæœ¯ã€‚å®ƒæ—¨åœ¨æœ€å°åŒ–äººä¸ºï¼ˆæŠ€æœ¯ï¼‰ä¾èµ–ï¼Œå¹¶å¼•å…¥å¿…è¦çš„æŠ½è±¡å’Œå¦¥åã€‚</strong></p>
<p>æ˜¯çš„ï¼Œè½¯ä»¶è®¾è®¡æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œå®ƒä¸æ˜¯ä¸€é—¨ç§‘å­¦ï¼Œä¹Ÿæ²¡æœ‰ä¸€å¥—ç®€å•è€Œæ˜ç¡®çš„ç­”æ¡ˆã€‚<br/>å¾ˆå¤šæ—¶å€™ï¼Œè®¾è®¡çš„æ•´ä½“å›¾æ™¯ä¼šè®©æˆ‘ä»¬éš¾ä»¥æ‰æ‘¸ï¼Œæˆ‘ä»¬ä¼šè¢«è½¯ä»¶å®ä½“ä¹‹é—´å¤æ‚çš„ç›¸äº’ä¾èµ–æ‰€å‹å€’ï¼Œä½†æˆ‘ä»¬è¯•å›¾åº”å¯¹è¿™ç§å¤æ‚æ€§ï¼Œå¹¶é€šè¿‡å¼•å…¥é€‚å½“çš„æŠ½è±¡æ¥å‡å°‘å®ƒã€‚<br/>è¿™æ ·ï¼Œæˆ‘ä»¬å°†ç»†èŠ‚çš„å±‚æ¬¡ä¿æŒåœ¨ä¸€ä¸ªåˆç†çš„æ°´å¹³ã€‚ç„¶è€Œï¼Œå¾ˆå¤šæ—¶å€™å›¢é˜Ÿä¸­çš„ä¸ªåˆ«å¼€å‘è€…å¯èƒ½å¯¹æ¶æ„å’Œè®¾è®¡æœ‰ä¸åŒçš„æƒ³æ³•ã€‚æˆ‘ä»¬å¯èƒ½æ— æ³•å®ç°è‡ªå·±å¯¹è®¾è®¡çš„æ„¿æ™¯ï¼Œå¹¶è¢«è¿«åšå‡ºå¦¥åä»¥ç»§ç»­å‰è¿›ã€‚</p>
<p>åœ¨å‰é¢çš„å¼•ç”¨ä¸­ï¼Œæ¶æ„å’Œè®¾è®¡è¿™ä¸¤ä¸ªè¯å¯ä»¥äº’æ¢ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬éå¸¸ç›¸ä¼¼ä¸”ç›®æ ‡ç›¸åŒã€‚<br/>ç„¶è€Œï¼Œå®ƒä»¬å¹¶ä¸æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œå¦‚æœä½ çœ‹ä¸€ä¸‹è½¯ä»¶å¼€å‘çš„ä¸‰ä¸ªå±‚æ¬¡ï¼Œç›¸ä¼¼æ€§å’Œå·®å¼‚æ€§å°±ä¼šå˜å¾—æ¸…æ™°èµ·æ¥ã€‚</p>
<p><strong>è½¯ä»¶å¼€å‘çš„ä¸‰ä¸ªå±‚æ¬¡</strong></p>
<p>è½¯ä»¶æ¶æ„å’Œè½¯ä»¶è®¾è®¡æ˜¯è½¯ä»¶å¼€å‘ä¸‰ä¸ªå±‚æ¬¡ä¸­çš„ä¸¤ä¸ªï¼Œç¬¬ä¸‰ä¸ªå±‚æ¬¡æ˜¯å®ç°ç»†èŠ‚ã€‚<br/>ä¸ºäº†è®©ä½ æ›´ç›´è§‚åœ°ç†è§£è¿™ä¸‰ä¸ªå±‚æ¬¡ï¼Œæˆ‘ä»¬ä»¥å»ºç­‘é¢†åŸŸä¸ºä¾‹ï¼Œç±»æ¯”æ¶æ„ã€è®¾è®¡å’Œå®ç°ç»†èŠ‚çš„å…³ç³»ã€‚å‡è®¾ä½ æ˜¯ä¸€åå»ºç­‘è®¾è®¡å¸ˆï¼ˆæ˜¯çš„ï¼Œä¸æ˜¯ååœ¨ç”µè„‘å‰å–ç€å’–å•¡çš„è½¯ä»¶æ¶æ„å¸ˆï¼Œè€Œæ˜¯åœ¨å·¥åœ°ç°åœºçš„æˆ¿å±‹å»ºç­‘å¸ˆï¼‰ã€‚ä½ çš„èŒè´£åŒ…æ‹¬ï¼š</p>
<ul>
<li>ç¡®ä¿æˆ¿å±‹ä¸å‘¨å›´ç¯å¢ƒåè°ƒï¼›</li>
<li>ä¿è¯ç»“æ„ç¨³å›ºæ€§ï¼›</li>
<li>è§„åˆ’æˆ¿é—´å¸ƒå±€ã€ç®¡é“ç³»ç»Ÿç­‰ï¼›</li>
<li>å…¼é¡¾ç¾è§‚ä¸åŠŸèƒ½æ€§ï¼ˆä¾‹å¦‚å®½æ•çš„å®¢å…ã€å¨æˆ¿ä¸é¤å…çš„ä¾¿æ·åŠ¨çº¿ï¼‰ã€‚</li>
</ul>
<p>è¿™äº›å·¥ä½œå±äº<strong>æ¶æ„</strong>å’Œ<strong>è®¾è®¡</strong>å±‚é¢ã€‚ä¸¤è€…çš„ç•Œé™å¾€å¾€æ˜¯æ¨¡ç³Šçš„â€”â€”æ¶æ„å…³æ³¨å…¨å±€ä¸”éš¾ä»¥åæœŸæ›´æ”¹çš„å†³ç­–ï¼Œè€Œè®¾è®¡å¤„ç†æ›´ç»†ç²’åº¦çš„éƒ¨åˆ†ï¼ˆå¦‚é—¨çª—ä½ç½®ï¼‰ã€‚ä½†æ— è®ºæ˜¯æ¶æ„è¿˜æ˜¯è®¾è®¡ï¼Œä½ éƒ½ä¸ä¼šæ“å¿ƒå†°ç®±ã€ç”µè§†çš„æ‘†æ”¾æˆ–è£…é¥°ç»†èŠ‚â€”â€”è¿™äº›å±äº<strong>å®ç°ç»†èŠ‚</strong>ï¼Œå¯¹åº”è½¯ä»¶å¼€å‘ä¸­çš„å…·ä½“ç¼–ç å®ç°ã€‚</p>
<p><strong>å®ç°ç»†èŠ‚ï¼šæœ€å…·ä½“çš„å±‚æ¬¡</strong></p>
<p>åœ¨è½¯ä»¶ä¸­ï¼Œå®ç°ç»†èŠ‚æ˜¯<strong>å¦‚ä½•è§£å†³é—®é¢˜</strong>çš„å±‚é¢ï¼Œæ¶‰åŠï¼š</p>
<ul>
<li>é€‰æ‹©C++æ ‡å‡†æˆ–è¯­è¨€ç‰¹æ€§ï¼ˆå¦‚<code>std::make_unique</code>å·¥å‚å‡½æ•°ã€<code>std::enable_if</code>å®ç°SFINAEï¼‰ï¼›</li>
<li>å¤„ç†å†…å­˜ç®¡ç†ã€å¼‚å¸¸å®‰å…¨å’Œæ€§èƒ½ä¼˜åŒ–ï¼›</li>
<li>åº”ç”¨æƒ¯ç”¨æ³•ï¼ˆå¦‚â€œå¤åˆ¶-äº¤æ¢â€æƒ¯ç”¨æ³•ã€RAIIï¼‰ã€‚</li>
</ul>
<p><strong>å…³é”®ç‚¹</strong>ï¼šå®ç°ç»†èŠ‚é€šå¸¸ä¸å¼•å…¥æŠ½è±¡æˆ–è§£è€¦ï¼Œè€Œæ˜¯é€šè¿‡<strong>å°è£…</strong>ï¼ˆå¦‚RAIIå°†èµ„æºç®¡ç†ä¸ä¸šåŠ¡é€»è¾‘éš”ç¦»ï¼‰æå‡ä»£ç å¥å£®æ€§ã€‚</p>
<p><strong>è½¯ä»¶è®¾è®¡ï¼šå…³æ³¨äº¤äº’ä¸å¯ç»´æŠ¤æ€§</strong></p>
<p>è½¯ä»¶è®¾è®¡èšç„¦äºï¼š</p>
<ul>
<li><strong>å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§ã€å¯æµ‹è¯•æ€§</strong>ï¼›</li>
<li>è½¯ä»¶å®ä½“ï¼ˆç±»ã€å‡½æ•°ï¼‰çš„<strong>ç‰©ç†ä¸é€»è¾‘ä¾èµ–å…³ç³»</strong>ï¼›</li>
<li>åº”ç”¨è®¾è®¡æ¨¡å¼ï¼ˆå¦‚è®¿é—®è€…æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ã€è£…é¥°æ¨¡å¼ï¼‰è§£è€¦å¤æ‚ç³»ç»Ÿã€‚</li>
</ul>
<p><strong>å…³é”®ç‚¹</strong>ï¼šè®¾è®¡æ¨¡å¼é€šå¸¸æ˜¯è¯­è¨€æ— å…³çš„ï¼Œå¸®åŠ©å°†å¤æ‚é€»è¾‘åˆ†è§£ä¸ºå¯ç®¡ç†çš„æ¨¡å—ã€‚</p>
<p><strong>è½¯ä»¶æ¶æ„ï¼šæ¨¡ç³Šä½†å…³é”®çš„â€œå¤§å†³ç­–â€</strong></p>
<p>è½¯ä»¶æ¶æ„æ˜¯ä¸‰ä¸ªå±‚æ¬¡ä¸­æœ€éš¾å®šä¹‰çš„ï¼Œä½†æ ¸å¿ƒåœ¨äºï¼š</p>
<ul>
<li>åˆ¶å®š<strong>éš¾ä»¥åæœŸæ›´æ”¹çš„é‡å¤§å†³ç­–</strong>ï¼ˆå¦‚é€‰æ‹©å¾®æœåŠ¡æ¶æ„æˆ–å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ï¼‰ï¼›</li>
<li>ç¡®ä¿ç³»ç»Ÿå„éƒ¨åˆ†å˜æ›´æ—¶äº’ä¸å½±å“ï¼›</li>
<li>ä½¿ç”¨æ¶æ„æ¨¡å¼ï¼ˆå¦‚å¾®æœåŠ¡ã€äº‹ä»¶é©±åŠ¨ï¼‰å®šä¹‰æ¨¡å—æˆ–ç»„ä»¶é—´çš„ç»“æ„ä¸ä¾èµ–ã€‚</li>
</ul>
<p><strong>å…³é”®æ´è§</strong>ï¼š</p>
<blockquote>
<p>â€œæ¶æ„æ˜¯ä½ å¸Œæœ›èƒ½åœ¨é¡¹ç›®åˆæœŸå°±æ­£ç¡®å†³ç­–ï¼Œä½†å®é™…æœªå¿…æ¯”å…¶ä»–å†³ç­–æ›´å®¹æ˜“æ­£ç¡®ã€‚â€
â€”â€”Ralph Johnson</p>
</blockquote>
<p><strong>æŒ‘æˆ˜</strong>ï¼šéšç€å¾®æœåŠ¡ç­‰æŠ€æœ¯çš„æ™®åŠï¼Œâ€œå¤§â€ä¸â€œå°â€çš„ç•Œé™å˜å¾—æ¨¡ç³Šï¼Œæ¶æ„å¸¸ç”±é¡¹ç›®ä¸­çš„æ ¸å¿ƒå¼€å‘è€…å‡­ç»éªŒç•Œå®šã€‚</p>
<p><strong>æƒ¯ç”¨æ³•ï¼šè·¨è¶Šå±‚æ¬¡çš„æ¨¡å¼</strong></p>
<p>æƒ¯ç”¨æ³•ï¼ˆIdiomï¼‰æ˜¯è¯­è¨€ç‰¹å®šçš„å¸¸è§è§£å†³æ–¹æ¡ˆï¼Œå¯èƒ½å±äºè®¾è®¡æˆ–å®ç°ç»†èŠ‚ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li><strong>å®ç°ç»†èŠ‚æƒ¯ç”¨æ³•</strong>ï¼šRAIIã€å¤åˆ¶-äº¤æ¢ï¼›</li>
<li><strong>è®¾è®¡æƒ¯ç”¨æ³•</strong>ï¼šéè™šæ¥å£ï¼ˆNVIï¼ŒåŸºäºæ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼‰ã€Pimplï¼ˆåŸºäºæ¡¥æ¥æ¨¡å¼ï¼‰ã€‚</li>
</ul>
<p><strong>æ ¸å¿ƒåŒºåˆ«</strong>ï¼š</p>
<ul>
<li><strong>æŠ½è±¡</strong>ï¼ˆè®¾è®¡å±‚ï¼‰é€šè¿‡éšè—ç»†èŠ‚ç®€åŒ–äº¤äº’ï¼›</li>
<li><strong>å°è£…</strong>ï¼ˆå®ç°å±‚ï¼‰é€šè¿‡é›†ä¸­ç®¡ç†é€»è¾‘æå‡å®‰å…¨æ€§</li>
</ul>
<hr>
<p><strong>å¯¹è¯­è¨€ç‰¹æ€§çš„è¿‡åº¦å…³æ³¨</strong></p>
<p>å¦‚æœè½¯ä»¶æ¶æ„å’Œè½¯ä»¶è®¾è®¡å¦‚æ­¤é‡è¦ï¼Œä¸ºä½•C++ç¤¾åŒºå´å¦‚æ­¤ç—´è¿·äºè¯­è¨€ç‰¹æ€§ï¼Ÿä¸ºä½•æˆ‘ä»¬æ€»è¥é€ ä¸€ç§é”™è§‰ï¼Œè®¤ä¸ºC++æ ‡å‡†ã€è¯­è¨€æœºåˆ¶å’Œç‰¹æ€§èƒ½å†³å®šé¡¹ç›®çš„æˆè´¥ï¼Ÿæˆ‘è®¤ä¸ºæœ‰ä¸‰ä¸ªä¸»è¦åŸå› ï¼š</p>
<p><strong>ç¬¬ä¸€ï¼Œç‰¹æ€§çš„å¤æ‚æ€§ä¸æƒ¯æ€§å¡‘é€ </strong>
C++è¯­è¨€ç‰¹æ€§æ•°é‡åºå¤§ä¸”ç»†èŠ‚å¤æ‚ï¼Œç¤¾åŒºéœ€è¦å¤§é‡æ—¶é—´è®¨è®ºå¦‚ä½•æ­£ç¡®ä½¿ç”¨å®ƒä»¬ï¼Œå»ºç«‹å¯¹â€œè‰¯å¥½å®è·µâ€å’Œâ€œä¸è‰¯å®è·µâ€çš„å…±è¯†ã€‚æˆ‘ä»¬éœ€è¦å…±åŒå¡‘é€ <strong>ç¬¦åˆC++æƒ¯ç”¨æ³•</strong>çš„ç¼–ç¨‹æ–‡åŒ–ã€‚</p>
<p><strong>ç¬¬äºŒï¼Œå¯¹ç‰¹æ€§çš„é”™è¯¯æœŸæœ›</strong>
ä»¥C++20æ¨¡å—ï¼ˆModulesï¼‰ä¸ºä¾‹â€”â€”å®ƒæ— ç–‘æ˜¯è‡ªC++è¯ç”Ÿä»¥æ¥æœ€é‡å¤§çš„æŠ€æœ¯é©æ–°ä¹‹ä¸€ï¼Œå¯èƒ½ç»ˆç»“å¤´æ–‡ä»¶åŒ…å«çš„ç¹çæ¨¡å¼ã€‚ä½†è®¸å¤šäººè¯¯ä»¥ä¸ºæ¨¡å—èƒ½ä¿®å¤ä»£ç çš„ç»“æ„æ€§é—®é¢˜ï¼Œç”šè‡³æ‹¯æ•‘é¡¹ç›®ã€‚ç„¶è€Œï¼Œæ¨¡å—çš„ä½œç”¨æ˜¯<strong>åæ˜ ç°æœ‰ç»“æ„</strong>ï¼Œè€Œéæ”¹è¿›è®¾è®¡ã€‚å®ƒæ— æ³•æ©ç›–è®¾è®¡ç¼ºé™·ï¼Œåè€Œå¯èƒ½æš´éœ²é—®é¢˜ã€‚</p>
<p><strong>ç¬¬ä¸‰ï¼Œè½¯ä»¶è®¾è®¡çš„å¤æ‚æ€§è¿œè¶…è¯­è¨€ç‰¹æ€§</strong>
ç›¸æ¯”è½¯ä»¶è®¾è®¡ä¸­è§£è€¦å®ä½“ã€ç®¡ç†ä¾èµ–çš„å¤æ‚æ€§ï¼Œè¯­è¨€ç‰¹æ€§çš„è§„åˆ™ï¼ˆæ— è®ºæœ‰å¤šå°‘ä¾‹å¤–æƒ…å†µï¼‰æ›´å®¹æ˜“è§£é‡Šã€‚å…³äºç‰¹æ€§çš„é—®é¢˜é€šå¸¸æœ‰æ˜ç¡®ç­”æ¡ˆï¼Œè€Œè½¯ä»¶è®¾è®¡çš„ç­”æ¡ˆå¾€å¾€æ˜¯ <strong>â€œè§†æƒ…å†µè€Œå®šâ€</strong>ã€‚å¦‚ä½•è®©ä»£ç æ›´å¯ç»´æŠ¤ã€å¯æ‰©å±•ã€å¯æµ‹è¯•ï¼Œé«˜åº¦ä¾èµ–é¡¹ç›®å…·ä½“æƒ…å¢ƒã€‚æ­£å¦‚é‚£å¥åè¨€ï¼š</p>
<blockquote>
<p>â€œè®¾è®¡ä¸ç¼–ç¨‹æ˜¯äººç±»æ´»åŠ¨ï¼›å¿˜è®°è¿™ä¸€ç‚¹ï¼Œä¸€åˆ‡å°†å¤±å»æ„ä¹‰ã€‚â€</p>
</blockquote>
<hr>
<p><strong>ä¸ºä½•æˆ‘ä»¬ä»éœ€å…³æ³¨ç‰¹æ€§ï¼Ÿ</strong></p>
<p>è¿™ä¸‰ä¸ªåŸå› å…±åŒå¯¼è‡´äº†ç¤¾åŒºå¯¹ç‰¹æ€§çš„è¿‡åº¦å…³æ³¨ã€‚ä½†è¯·æ³¨æ„ï¼Œ<strong>ç‰¹æ€§æœ¬èº«å¹¶éä¸é‡è¦</strong>ã€‚æ­£ç¡®ç†è§£å’Œä½¿ç”¨å®ƒä»¬è‡³å…³é‡è¦ï¼Œä½†ä»…å‡­ç‰¹æ€§æ— æ³•æ‹¯æ•‘é¡¹ç›®ã€‚</p>
<hr>
<p><strong>å›å½’è½¯ä»¶è®¾è®¡ä¸åŸåˆ™çš„æ ¸å¿ƒ</strong></p>
<p>ç‰¹æ€§å›ºç„¶é‡è¦ï¼Œä½†è½¯ä»¶è®¾è®¡æ‰æ˜¯é¡¹ç›®æˆåŠŸçš„åŸºçŸ³ã€‚æœ¬ä¹¦å°†èšç„¦äºï¼š</p>
<ul>
<li><strong>è½¯ä»¶è®¾è®¡å†³ç­–èƒŒåçš„é€»è¾‘</strong>ï¼›</li>
<li><strong>è®¾è®¡åŸåˆ™</strong>ï¼ˆå¦‚SOLIDã€DRYï¼‰ï¼›</li>
<li><strong>ä¾èµ–ç®¡ç†</strong>ä¸<strong>æŠ½è±¡è®¾è®¡</strong>ï¼›</li>
<li><strong>ç°ä»£C++ä»£ç çš„åˆç†åº”ç”¨</strong>ï¼ˆå¦‚C++20æ¦‚å¿µï¼‰ï¼Œè€Œéç›²ç›®è¿½æ±‚<code>noexcept</code>æˆ–æ»¥ç”¨<code>constexpr</code>ã€‚</li>
</ul>
<p><strong>å…³é”®ç»“è®º</strong></p>
<p>ä¼˜ç§€çš„è½¯ä»¶å¼€å‘è€…å¿…é¡»æ·±å…¥ç†è§£è½¯ä»¶è®¾è®¡ã€‚å› ä¸ºï¼š</p>
<ul>
<li><strong>ä¼˜ç§€è½¯ä»¶æˆæœ¬ä½å»‰</strong>ï¼Œç³Ÿç³•è½¯ä»¶ä»£ä»·é«˜æ˜‚ï¼›</li>
<li>è¯­è¨€ç‰¹æ€§æ˜¯å·¥å…·ï¼Œè®¾è®¡èƒ½åŠ›æ‰æ˜¯æ ¸å¿ƒç«äº‰åŠ›ï¼›</li>
<li>çœŸæ­£çš„æŒ‘æˆ˜åœ¨äº<strong>å¹³è¡¡ç‰¹æ€§ä½¿ç”¨ä¸è®¾è®¡å†³ç­–</strong>ï¼Œæ„å»ºå¯æŒç»­æ¼”è¿›çš„ç³»ç»Ÿã€‚</li>
</ul>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>å°†è½¯ä»¶è®¾è®¡è§†ä¸ºç¼–å†™è½¯ä»¶çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ã€‚</li>
<li>å‡å°‘å¯¹C++è¯­è¨€ç»†èŠ‚çš„å…³æ³¨ï¼Œæ›´å¤šåœ°å…³æ³¨è½¯ä»¶è®¾è®¡ã€‚</li>
<li>é¿å…ä¸å¿…è¦çš„è€¦åˆå’Œä¾èµ–ï¼Œä½¿è½¯ä»¶æ›´èƒ½é€‚åº”é¢‘ç¹çš„å˜åŒ–ã€‚</li>
<li>ç†è§£è½¯ä»¶è®¾è®¡æ˜¯ç®¡ç†ä¾èµ–å…³ç³»å’ŒæŠ½è±¡çš„è‰ºæœ¯ã€‚è®¤è¯†åˆ°è½¯ä»¶è®¾è®¡ä¸è½¯ä»¶æ¶æ„ä¹‹é—´çš„ç•Œé™æ˜¯æµåŠ¨çš„ã€‚</li>
</ul>
<h3 id="å‡†åˆ™-2ä¸ºå˜åŒ–è€Œè®¾è®¡">å‡†åˆ™ 2ï¼šä¸ºå˜åŒ–è€Œè®¾è®¡
</h3><p>ä¼˜ç§€è½¯ä»¶çš„æ ¸å¿ƒç‰¹å¾ä¹‹ä¸€æ˜¯<strong>æ˜“å˜æ›´æ€§</strong>ã€‚è¿™ä¸€ç‰¹æ€§ç”šè‡³éšå«åœ¨&quot;è½¯ä»¶&quot;ï¼ˆ<em>software</em>ï¼‰ä¸€è¯ä¸­â€”â€”ä¸ç¡¬ä»¶ï¼ˆ<em>hardware</em>ï¼‰ä¸åŒï¼Œè½¯ä»¶åº”èƒ½è½»æ¾é€‚åº”éœ€æ±‚å˜åŒ–ï¼ˆå‚è§å‡†åˆ™ 1ï¼šç†è§£è½¯ä»¶è®¾è®¡çš„é‡è¦æ€§ï¼‰ã€‚ç„¶è€Œï¼Œå®é™…å¼€å‘ä¸­æˆ‘ä»¬å¸¸å‘ç°ï¼šçœ‹ä¼¼ç®€å•çš„ä»£ç å˜æ›´ï¼Œå¾€å¾€éœ€è¦è€—è´¹æ•°å¤©ç”šè‡³æ•°å‘¨ã€‚</p>
<hr>
<p><strong>åˆ†ç¦»å…³æ³¨ç‚¹</strong></p>
<p>é™ä½äººä¸ºè€¦åˆã€ç®€åŒ–å˜æ›´çš„æœ€ä½³å®è·µæ˜¯<strong>åˆ†ç¦»å…³æ³¨ç‚¹</strong>ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š</p>
<blockquote>
<p>å°†åŠŸèƒ½æ‹†åˆ†ä¸º<strong>é«˜å†…èšã€ä½è€¦åˆ</strong>çš„ç‹¬ç«‹æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—ä¸“æ³¨å•ä¸€èŒè´£ã€‚
â€”â€”ã€Šç¨‹åºå‘˜ä¿®ç‚¼ä¹‹é“ã€‹</p>
</blockquote>
<p>è¿™ç§æ€æƒ³é€šè¿‡ä¸åŒæœ¯è¯­è¢«åå¤å¼ºè°ƒï¼š</p>
<ul>
<li><strong>æ­£äº¤æ€§</strong>ï¼ˆOrthogonalityï¼‰ï¼šåˆ†ç¦»è½¯ä»¶ä¸­æ­£äº¤çš„ç»´åº¦</li>
<li><strong>å†…èšæ€§</strong>ï¼ˆCohesionï¼‰ï¼šæ¨¡å—å†…éƒ¨å…ƒç´ çš„å…³è”å¼ºåº¦ï¼ˆé«˜å†…èšæ¨¡å—åº”ä½œä¸ºæ•´ä½“å¤„ç†ï¼‰</li>
<li><strong>å•ä¸€èŒè´£åŸåˆ™</strong>ï¼ˆSRPï¼‰ï¼šä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå˜æ›´ç†ç”±</li>
</ul>
<p><strong>å…³é”®æ´å¯Ÿ</strong>ï¼š</p>
<ul>
<li>å°†<strong>å› ä¸åŒåŸå› è€Œå˜åŒ–</strong>çš„éƒ¨åˆ†åˆ†ç¦»</li>
<li>ä»…å°†çœŸæ­£ç›¸å…³çš„å†…å®¹èšåˆ</li>
<li>å‡å°‘äººä¸ºè€¦åˆï¼Œä½¿å˜æ›´åªéœ€ä¿®æ”¹ä¸€å¤„</li>
</ul>
<p><strong>äººä¸ºè€¦åˆçš„ä»£ç ç¤ºä¾‹</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"> <span class="c1">//#include &lt;some_json_library.h&gt;  // Potential physical dependency 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Document</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">virtual</span> <span class="o">~</span><span class="n">Document</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="k">virtual</span> <span class="kt">void</span> <span class="nf">exportToJSON</span><span class="p">(</span> <span class="cm">/*...*/</span> <span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="k">virtual</span> <span class="kt">void</span> <span class="nf">serialize</span><span class="p">(</span> <span class="n">ByteStream</span><span class="o">&amp;</span><span class="p">,</span> <span class="cm">/*...*/</span> <span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl"><span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>çœ‹ä¼¼åˆç†çš„è®¾è®¡</strong>ï¼š</p>
<ul>
<li>åŸºç±»æä¾›<code>exportToJSON()</code>å’Œ<code>serialize()</code>ç­‰é€šç”¨åŠŸèƒ½</li>
<li>æ´¾ç”Ÿç±»ï¼ˆå¦‚PDFã€Wordæ–‡æ¡£ï¼‰å®ç°å…·ä½“é€»è¾‘</li>
<li>ç”¨æˆ·æ— éœ€äº†è§£å…·ä½“æ–‡æ¡£ç±»å‹å³å¯æ“ä½œ</li>
</ul>
<p><strong>å®é™…éšè—çš„ä¸‰å¤§è€¦åˆé—®é¢˜</strong>ï¼š</p>
<hr>
<p><strong>1. ç¬¬ä¸‰æ–¹åº“çš„å¼ºåˆ¶ç»‘å®š</strong></p>
<ul>
<li>
<p><strong>JSONå¯¼å‡ºçš„é™·é˜±</strong>ï¼š
æ¯ä¸ªæ´¾ç”Ÿç±»å¿…é¡»å®ç°<code>exportToJSON()</code>ï¼Œå¯¼è‡´å¼ºåˆ¶ä¾èµ–æŸä¸ªJSONåº“ï¼ˆå¦‚<code>rapidjson</code>æˆ–<code>simdjson</code>ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PDFDocument</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Document</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">exportToJSON</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">rapidjson</span><span class="o">::</span><span class="n">Document</span> <span class="n">json</span><span class="p">;</span>  <span class="c1">// ç›´æ¥ä¾èµ–ç‰¹å®šJSONåº“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// å®ç°ç»†èŠ‚...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>åæœ</strong>ï¼š
<ul>
<li>æ‰€æœ‰æ–‡æ¡£ç±»å‹è¢«åŒä¸€JSONåº“ç»‘å®š</li>
<li>æ›´æ¢åº“éœ€ä¿®æ”¹æ‰€æœ‰æ´¾ç”Ÿç±»</li>
<li>ç³»ç»Ÿå˜å¾—è‡ƒè‚¿ï¼Œå¤ç”¨æ€§é™ä½</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<p><strong>2. æ¥å£ç­¾åæ³„æ¼å®ç°ç»†èŠ‚</strong></p>
<ul>
<li>
<p><strong>éšå¼è€¦åˆç¤ºä¾‹</strong>ï¼š
å‡è®¾<code>exportToJSON()</code>å‚æ•°è®¾è®¡å—é™äºå½“å‰JSONåº“ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">virtual</span> <span class="kt">void</span> <span class="nf">exportToJSON</span><span class="p">(</span><span class="n">rapidjson</span><span class="o">::</span><span class="n">PrettyWriter</span><span class="o">&amp;</span> <span class="n">writer</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>åæœ</strong>ï¼š
<ul>
<li>æ›´æ¢JSONåº“æ—¶ï¼Œæ¥å£ç­¾åè¢«è¿«ä¿®æ”¹</li>
<li>æ‰€æœ‰è°ƒç”¨æ–¹ä»£ç éœ€åŒæ­¥è°ƒæ•´</li>
<li>å˜æ›´å½±å“èŒƒå›´è¶…å‡ºé¢„æœŸ</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<p><strong>3. åºåˆ—åŒ–ä¸æ–‡æ¡£ç±»å‹çš„å…¨å±€è€¦åˆ</strong></p>
<ul>
<li>
<p><strong>æšä¸¾å¯¼è‡´çš„è¿é”ååº”</strong>ï¼š
åºåˆ—åŒ–éœ€è¦æ ‡è¯†æ–‡æ¡£ç±»å‹ï¼Œå¼•å…¥å…¨å±€æšä¸¾ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">DocumentType</span> <span class="p">{</span> <span class="n">pdf</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="cm">/*...*/</span> <span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ´¾ç”Ÿç±»å®ç°åºåˆ—åŒ–æ—¶ä¾èµ–æ­¤æšä¸¾ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">PDFDocument</span><span class="o">::</span><span class="n">serialize</span><span class="p">(</span><span class="n">ByteStream</span><span class="o">&amp;</span> <span class="n">stream</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">stream</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">DocumentType</span><span class="o">::</span><span class="n">pdf</span><span class="p">));</span>  <span class="c1">// æ‰€æœ‰æ–‡æ¡£ç±»çŸ¥æ™“å…¶ä»–ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// å…¶ä»–åºåˆ—åŒ–é€»è¾‘...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>åæœ</strong>ï¼š
<ul>
<li>æ·»åŠ æ–°æ–‡æ¡£ç±»å‹éœ€ä¿®æ”¹å…¨å±€æšä¸¾</li>
<li>æ‰€æœ‰ç°æœ‰æ–‡æ¡£ç±»çš„åºåˆ—åŒ–é€»è¾‘è¢«å½±å“</li>
<li>è¿åå¼€é—­åŸåˆ™ï¼ˆå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼‰</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>è®¾è®¡ç¼ºé™·æ€»ç»“</strong></p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:left">é—®é¢˜ç±»å‹</th>
<th style="text-align:left">å¼•å‘åŸå› </th>
<th style="text-align:left">ç»´æŠ¤ä»£ä»·</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>ç¬¬ä¸‰æ–¹åº“ç»‘å®š</strong></td>
<td style="text-align:left">æ´¾ç”Ÿç±»ç›´æ¥å®ç°å…·ä½“åº“é€»è¾‘</td>
<td style="text-align:left">æ›´æ¢æŠ€æœ¯æ ˆéœ€å…¨é‡é‡å†™</td>
</tr>
<tr>
<td style="text-align:left"><strong>æ¥å£æ³„æ¼å®ç°ç»†èŠ‚</strong></td>
<td style="text-align:left">æ¥å£å‚æ•°ä¸ç‰¹å®šåº“å¼ºå…³è”</td>
<td style="text-align:left">è°ƒç”¨æ–¹ä»£ç éšå®ç°åº“å˜æ›´è€Œä¿®æ”¹</td>
</tr>
<tr>
<td style="text-align:left"><strong>å…¨å±€ç±»å‹è€¦åˆ</strong></td>
<td style="text-align:left">åºåˆ—åŒ–ä¾èµ–å…±äº«æšä¸¾</td>
<td style="text-align:left">æ–°å¢ç±»å‹å¯¼è‡´è¿é”ä»£ç ä¿®æ”¹</td>
</tr>
</tbody>
</table></div>
<p><strong>ä¼˜åŒ–æ–¹å‘ï¼šè§£è€¦è®¾è®¡</strong></p>
<ol>
<li>
<p><strong>åˆ†ç¦»æ•°æ®ä¸æ“ä½œ</strong></p>
<ul>
<li>å°†JSONå¯¼å‡ºã€åºåˆ—åŒ–ç­‰èƒ½åŠ›æ‹†åˆ†ä¸ºç‹¬ç«‹ç»„ä»¶</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">JSONExporter</span> <span class="p">{</span>  <span class="c1">// ç‹¬ç«‹JSONå¤„ç†ç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="k">export</span><span class="p">(</span><span class="k">const</span> <span class="n">Document</span><span class="o">&amp;</span> <span class="n">doc</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PDFDocument</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Document</span> <span class="p">{</span> <span class="cm">/*...*/</span> <span class="p">};</span>  <span class="c1">// ä¸å†å®ç°JSONé€»è¾‘
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>ä¾èµ–æ³¨å…¥å–ä»£ç»§æ‰¿</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DocumentProcessor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">DocumentProcessor</span><span class="p">(</span><span class="n">JSONExporter</span><span class="o">&amp;</span> <span class="n">exporter</span><span class="p">,</span> <span class="n">Serializer</span><span class="o">&amp;</span> <span class="n">serializer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">exporter_</span><span class="p">(</span><span class="n">exporter</span><span class="p">),</span> <span class="n">serializer_</span><span class="p">(</span><span class="n">serializer</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">process</span><span class="p">(</span><span class="k">const</span> <span class="n">Document</span><span class="o">&amp;</span> <span class="n">doc</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">exporter_</span><span class="p">.</span><span class="k">export</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">serializer_</span><span class="p">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">doc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">JSONExporter</span><span class="o">&amp;</span> <span class="n">exporter_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Serializer</span><span class="o">&amp;</span> <span class="n">serializer_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>ä½¿ç”¨é€‚é…å™¨æ¨¡å¼éš”ç¦»ç¬¬ä¸‰æ–¹åº“</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RapidJSONAdapter</span> <span class="o">:</span> <span class="k">public</span> <span class="n">JSONExporter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="k">export</span><span class="p">(</span><span class="k">const</span> <span class="n">Document</span><span class="o">&amp;</span> <span class="n">doc</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">rapidjson</span><span class="o">::</span><span class="n">Document</span> <span class="n">json</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// è½¬æ¢é€»è¾‘å°è£…åœ¨æ­¤
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<hr>
<p><strong>å…³é”®å¯ç¤º</strong></p>
<ul>
<li><strong>è­¦æƒ•&quot;å…¨èƒ½åŸºç±»&quot;</strong>ï¼šç»§æ‰¿ä¸æ˜¯ä»£ç å¤ç”¨çš„å”¯ä¸€æ‰‹æ®µ</li>
<li><strong>å»¶è¿ŸæŠ€æœ¯å†³ç­–</strong>ï¼šé€šè¿‡æŠ½è±¡å±‚éš”ç¦»å…·ä½“å®ç°ç»†èŠ‚</li>
<li><strong>æ­£äº¤æ€§è®¾è®¡</strong>ï¼šç¡®ä¿ä¸åŒåŠŸèƒ½ç»´åº¦ç›¸äº’ç‹¬ç«‹ï¼Œå˜æ›´äº’ä¸å½±å“</li>
</ul>
<blockquote>
<p>&ldquo;å¥½çš„ç³»ç»Ÿè®¾è®¡ä¸æ˜¯é¿å…å˜æ›´ï¼Œè€Œæ˜¯è®©å˜æ›´å‘ç”Ÿåœ¨æ­£ç¡®çš„åœ°æ–¹ã€‚&rdquo;
â€”â€”ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹</p>
</blockquote>
<p>æˆ‘åº”è¯¥æ˜ç¡®æŒ‡å‡ºï¼Œ<code>Document</code> ç±»å¯¹é€‰å®š JSON åº“å­˜åœ¨æ½œåœ¨çš„ç‰©ç†ä¾èµ–ã€‚</p>
<p>å¦‚æœ <code>&lt;Document.h&gt;</code> å¤´æ–‡ä»¶åŒ…å«äº†æ‰€é€‰ JSON åº“ä¸­çš„ä»»ä½•å¤´æ–‡ä»¶ï¼ˆå¦‚â€œäººå·¥è€¦åˆçš„ä¾‹å­â€ä»£ç ç‰‡æ®µæ‰€ç¤ºï¼‰ï¼Œ</p>
<p>ä¾‹å¦‚å› ä¸º <code>exportToJSON()</code> å‡½æ•°æœŸæœ›åŸºäºè¯¥åº“çš„ä¸€äº›å‚æ•°ï¼Œé‚£ä¹ˆå°±å­˜åœ¨å¯¹è¯¥åº“çš„æ˜ç¡®ä¾èµ–ã€‚</p>
<p>ç„¶è€Œï¼Œå¦‚æœæ¥å£èƒ½å¤Ÿæ­£ç¡®æŠ½è±¡è¿™äº›ç»†èŠ‚ï¼Œå¹¶ä¸” <code>&lt;Document.h&gt;</code> å¤´æ–‡ä»¶ä¸åŒ…å«æ¥è‡ª JSON åº“çš„ä»»ä½•å†…å®¹ï¼Œé‚£ä¹ˆè¿™ç§ç‰©ç†ä¾èµ–å¯èƒ½ä¼šè¢«é¿å…ã€‚</p>
<p>å› æ­¤ï¼Œè¿™å–å†³äºä¾èµ–å…³ç³»èƒ½å¦è¢«ï¼ˆä»¥åŠå¦‚ä½•è¢«ï¼‰è‰¯å¥½åœ°æŠ½è±¡ã€‚</p>
<p>â€œé«˜å±‚æ¬¡ã€ä½å±‚æ¬¡â€”â€”æˆ‘ç°åœ¨æœ‰ç‚¹ç³Šæ¶‚äº†ï¼Œâ€ä½ æŠ±æ€¨é“ã€‚æ˜¯çš„ï¼Œæˆ‘çŸ¥é“è¿™ä¸¤ä¸ªæœ¯è¯­é€šå¸¸ä¼šè®©äººæ„Ÿåˆ°å›°æƒ‘ã€‚åœ¨æˆ‘ä»¬ç»§ç»­ä¹‹å‰ï¼Œå…ˆè®©æˆ‘ä»¬æ˜ç¡®è¿™ä¸¤ä¸ªæœ¯è¯­çš„å®šä¹‰ã€‚</p>
<p>è¿™ä¸¤ä¸ªæœ¯è¯­çš„èµ·æºä¸æˆ‘ä»¬ç”¨ç»Ÿä¸€å»ºæ¨¡è¯­è¨€ï¼ˆUMLï¼‰ç»˜åˆ¶å›¾è¡¨çš„æ–¹å¼æœ‰å…³ï¼šæˆ‘ä»¬è®¤ä¸ºç¨³å®šçš„åŠŸèƒ½å‡ºç°åœ¨é¡¶éƒ¨ï¼ˆé«˜å±‚æ¬¡ï¼‰ï¼Œè€Œæ›´å¸¸å˜åŒ–ã€å…·æœ‰å¯å˜æ€§æˆ–å¯å¡‘æ€§çš„åŠŸèƒ½å‡ºç°åœ¨åº•éƒ¨ï¼ˆä½å±‚æ¬¡ï¼‰ã€‚</p>
<p>é—æ†¾çš„æ˜¯ï¼Œå½“æˆ‘ä»¬ç»˜åˆ¶æ¶æ„å›¾æ—¶ï¼Œé€šå¸¸ä¼šè¯•å›¾å±•ç¤ºå„éƒ¨åˆ†å¦‚ä½•ç›¸äº’æ„å»ºï¼Œå› æ­¤æœ€ç¨³å®šçš„éƒ¨åˆ†ä¼šå‡ºç°åœ¨æ¶æ„çš„åº•éƒ¨ã€‚è¿™è‡ªç„¶ä¼šå¼•èµ·ä¸€äº›æ··æ·†ã€‚</p>
<p>ä¸è®ºå¦‚ä½•ç»˜åˆ¶ï¼Œè¯·è®°ä½è¿™ä¸¤ä¸ªæœ¯è¯­ï¼šé«˜å±‚æ¬¡æŒ‡çš„æ˜¯æ¶æ„ä¸­ç¨³å®šçš„éƒ¨åˆ†ï¼Œä½å±‚æ¬¡æŒ‡çš„æ˜¯æ›´å¸¸å˜åŒ–æˆ–æ›´å¯èƒ½å˜åŒ–çš„æ–¹é¢ã€‚</p>
<p>å›åˆ°é—®é¢˜æœ¬èº«ï¼šå•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰å»ºè®®æˆ‘ä»¬åˆ†ç¦»å…³æ³¨ç‚¹å’Œé‚£äº›ä¸å±äºåŒä¸€èŒè´£çš„éƒ¨åˆ†ï¼Œå³ç¼ºä¹å†…èšæ€§çš„éƒ¨åˆ†ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒå»ºè®®æˆ‘ä»¬å°†å› ä¸åŒåŸå› è€Œå˜åŒ–çš„éƒ¨åˆ†åˆ†ç¦»ä¸ºå˜åŒ–ç‚¹ã€‚</p>
<p>æ ¹æ®è¿™ä¸€å»ºè®®ï¼ŒDocumentç±»è¢«é‡æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Document</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">virtual</span> <span class="o">~</span><span class="n">Document</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ä¸å†æœ‰&#39;exportToJSON()&#39;å’Œ&#39;serialize()&#39;å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ä»…ä¿ç•™ä¸ä¼šå¯¼è‡´å¼ºè€¦åˆçš„æœ€åŸºæœ¬æ–‡æ¡£æ“ä½œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>JSONå’Œåºåˆ—åŒ–æ–¹é¢ä¸å†å±äºDocumentç±»çš„æ ¸å¿ƒåŠŸèƒ½ã€‚</p>
<p>Documentç±»åº”ä»…ä»£è¡¨ä¸åŒç±»å‹æ–‡æ¡£çš„æœ€åŸºæœ¬æ“ä½œï¼Œæ‰€æœ‰æ­£äº¤å…³æ³¨ç‚¹éƒ½åº”è¢«åˆ†ç¦»ï¼Œè¿™å°†ä½¿ä¿®æ”¹æ›´åŠ å®¹æ˜“ã€‚</p>
<p>ä¾‹å¦‚ï¼Œé€šè¿‡å°†JSONæ–¹é¢éš”ç¦»ä¸ºä¸€ä¸ªç‹¬ç«‹çš„å˜åŒ–ç‚¹å’Œæ–°JSONç»„ä»¶ï¼Œæ›´æ¢JSONåº“åªä¼šå½±å“è¯¥ç»„ä»¶ã€‚</p>
<p>ä¿®æ”¹å¯ä»¥é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹è¿›è¡Œï¼Œä¸å…¶ä»–æ­£äº¤å…³æ³¨ç‚¹å®Œå…¨éš”ç¦»ã€‚</p>
<p>åŒæ—¶ï¼Œä½¿ç”¨å¤šä¸ªJSONåº“æ”¯æŒJSONæ ¼å¼ä¹Ÿä¼šæ›´ç®€å•ã€‚</p>
<p>æ­¤å¤–ï¼Œä»»ä½•å…³äºæ–‡æ¡£åºåˆ—åŒ–çš„ä¿®æ”¹åªä¼šå½±å“ä»£ç ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼šæ–°çš„åºåˆ—åŒ–ç»„ä»¶ã€‚åºåˆ—åŒ–ç»„ä»¶å°†ä½œä¸ºå˜åŒ–ç‚¹ï¼Œå®ç°éš”ç¦»ä¸”ç®€å•çš„ä¿®æ”¹ã€‚è¿™æ˜¯æœ€ç†æƒ³çš„æƒ…å†µã€‚</p>
<p>è™½ç„¶ä½ å¯¹Documentç¤ºä¾‹æœ€åˆæ„Ÿåˆ°å¤±æœ›ï¼Œä½†ç°åœ¨ä¼¼ä¹åˆæœ‰äº†ä¿¡å¿ƒï¼Œä¹Ÿè®¸ä½ è„¸ä¸Šè¿˜å¸¦ç€&quot;æˆ‘æ—©è¯¥æƒ³åˆ°ï¼&ldquo;çš„å¾®ç¬‘ã€‚</p>
<p>ä½†ä½ ä»æœªå®Œå…¨æ»¡æ„ï¼š&ldquo;æ˜¯çš„ï¼Œæˆ‘è®¤åŒåˆ†ç¦»å…³æ³¨ç‚¹çš„æ€»ä½“æ€è·¯ï¼Œä½†å¦‚ä½•åœ¨è½¯ä»¶ç»“æ„ä¸­å®ç°è¿™ç§åˆ†ç¦»ï¼Ÿå…·ä½“è¯¥æ€ä¹ˆåšï¼Ÿ&ldquo;è¿™æ˜¯ä¸€ä¸ªæå¥½çš„é—®é¢˜ï¼Œä½†ç­”æ¡ˆä¼—å¤šï¼Œæˆ‘å°†åœ¨åç»­ç« èŠ‚ä¸­é€ä¸€è§£ç­”ï¼Œæœ€å…³é”®çš„ç¬¬ä¸€æ­¥æ˜¯è¯†åˆ«å˜åŒ–ç‚¹ï¼Œå³ä»£ç ä¸­é¢„æœŸä¼šå‘ç”Ÿå˜åŒ–çš„éƒ¨åˆ†ã€‚è¿™äº›å˜åŒ–ç‚¹åº”è¢«æå–ã€éš”ç¦»å’Œå°è£…ï¼Œæ¶ˆé™¤å¯¹è¿™äº›å˜åŒ–çš„ä¾èµ–ã€‚è¿™å°†æœ€ç»ˆä½¿ä¿®æ”¹æ›´å®¹æ˜“ã€‚</p>
<p>&ldquo;ä½†è¿™ä»åªæ˜¯è¡¨é¢å»ºè®®ï¼&ldquo;ä½ è¯´å¾—å¯¹ï¼Œé—æ†¾çš„æ˜¯ï¼Œæ²¡æœ‰å”¯ä¸€æˆ–ç®€å•çš„ç­”æ¡ˆï¼Œå…·ä½“æƒ…å†µå…·ä½“åˆ†æï¼Œä½†æˆ‘æ‰¿è¯ºåœ¨åç»­ç« èŠ‚ä¸­ç»™å‡ºè®¸å¤šå…·ä½“æ–¹æ¡ˆï¼ˆæ¯•ç«Ÿè¿™æ˜¯ä¸€æœ¬å…³äºè½¯ä»¶è®¾è®¡â€”â€”ç®¡ç†ä¾èµ–å…³ç³»çš„ä¹¦ï¼‰ã€‚</p>
<p>ä½œä¸ºé¢„å‘Šï¼Œç¬¬3ç« å°†ä»‹ç»è§£å†³è¿™ä¸€é—®é¢˜çš„é€šç”¨å®ç”¨æ–¹æ³•ï¼šè®¾è®¡æ¨¡å¼ã€‚é€šè¿‡è®¿é—®è€…æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ã€å¤–éƒ¨å¤šæ€ç­‰æ¨¡å¼ï¼Œæˆ‘å°†å±•ç¤ºå¦‚ä½•åˆ†ç¦»å…³æ³¨ç‚¹ã€‚è¿™äº›æ¨¡å¼å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œä½†å…±åŒç‚¹æ˜¯é€šè¿‡å¼•å…¥æŠ½è±¡æ¥å‡å°‘ä¾èµ–ã€‚æ­¤å¤–ï¼Œæˆ‘å°†è¯¦ç»†æ¢è®¨å¦‚ä½•åœ¨ç°ä»£C++ä¸­å®ç°è¿™äº›æ¨¡å¼ã€‚</p>
<hr>
<p><strong>ä¸è¦é‡å¤è‡ªå·±ï¼ˆDRYåŸåˆ™ï¼‰</strong></p>
<p>å¯ä¿®æ”¹æ€§è¿˜æœ‰ç¬¬äºŒä¸ªé‡è¦æ–¹é¢ã€‚ä¸ºè¯´æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘å°†å¼•å…¥å¦ä¸€ä¸ªç¤ºä¾‹ï¼šç‰©å“ç±»å±‚æ¬¡ç»“æ„ã€‚</p>
<p>å±‚æ¬¡ç»“æ„çš„é¡¶ç«¯æ˜¯ItemåŸºç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Money.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Money</span> <span class="p">{</span> <span class="cm">/*...*/</span> <span class="p">};</span> 
</span></span><span class="line"><span class="cl"><span class="n">Money</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span> <span class="n">Money</span> <span class="n">money</span><span class="p">,</span> <span class="kt">double</span> <span class="n">factor</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="n">Money</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span> <span class="n">Money</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">Money</span> <span class="n">rhs</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Item.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Money.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">Item</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">Item</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="n">Money</span> <span class="nf">price</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ItemåŸºç±»ä»£è¡¨å…·æœ‰ä»·æ ¼æ ‡ç­¾ï¼ˆç”±Moneyç±»è¡¨ç¤ºï¼‰çš„å„ç±»ç‰©å“çš„æŠ½è±¡ã€‚</p>
<p>é€šè¿‡price()å‡½æ•°å¯ä»¥æŸ¥è¯¢ä»·æ ¼ã€‚è™½ç„¶å®é™…å¯èƒ½æœ‰å¤šç§ç‰©å“ï¼Œä½†ä¸ºç®€åŒ–è¯´æ˜ï¼Œæˆ‘ä»¬ä»…ä»¥CppBookå’ŒConferenceTicketä¸ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;CppBook.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Item.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Money.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CppBook</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Item</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">CppBook</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">title</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">author</span><span class="p">,</span> <span class="n">Money</span> <span class="n">price</span> <span class="p">)</span>   
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">title_</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="p">,</span> <span class="n">author_</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">author</span><span class="p">)</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="p">,</span> <span class="n">priceWithTax_</span><span class="p">(</span> <span class="n">price</span> <span class="o">*</span> <span class="mf">1.15</span> <span class="p">)</span>  <span class="c1">// 15%ç¨ç‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">{}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">title</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">title_</span><span class="p">;</span> <span class="p">}</span>      
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">author</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">author_</span><span class="p">;</span> <span class="p">}</span>    
</span></span><span class="line"><span class="cl">    <span class="n">Money</span> <span class="nf">price</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span> <span class="k">return</span> <span class="n">priceWithTax_</span><span class="p">;</span> <span class="p">}</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">title_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">author_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">Money</span> <span class="n">priceWithTax_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>CppBookç±»çš„æ„é€ å‡½æ•°æ¥æ”¶ä¹¦åã€ä½œè€…ï¼ˆå­—ç¬¦ä¸²å½¢å¼ï¼‰å’Œä»·æ ¼ï¼ˆMoneyå½¢å¼ï¼‰ã€‚å®ƒé€šè¿‡title()ã€author()å’Œprice()å‡½æ•°æä¾›è®¿é—®æ¥å£ã€‚ç‰¹åˆ«çš„æ˜¯price()å‡½æ•°ï¼šç”±äºä¹¦ç±éœ€ç¼´ç¨ï¼ŒåŸå§‹ä»·æ ¼éœ€æŒ‰15%ç¨ç‡è°ƒæ•´ã€‚</p>
<p>ConferenceTicketç±»æ˜¯ç¬¬äºŒä¸ªItemç¤ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;ConferenceTicket.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Item.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Money.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ConferenceTicket</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Item</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">ConferenceTicket</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="n">Money</span> <span class="n">price</span> <span class="p">)</span>  
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">name_</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="p">,</span> <span class="n">priceWithTax_</span><span class="p">(</span> <span class="n">price</span> <span class="o">*</span> <span class="mf">1.15</span> <span class="p">)</span>  <span class="c1">// 15%ç¨ç‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">{}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">name</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">name_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="n">Money</span> <span class="nf">price</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span> <span class="k">return</span> <span class="n">priceWithTax_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">Money</span> <span class="n">priceWithTax_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ConferenceTicketä¸CppBookç±»ä¼¼ï¼Œä½†æ„é€ å‡½æ•°åªéœ€ä¼šè®®åç§°å’Œä»·æ ¼ã€‚åŒæ ·ï¼Œä¼šè®®é—¨ç¥¨ä»·æ ¼ä¹ŸæŒ‰15%ç¨ç‡è°ƒæ•´ã€‚</p>
<p>é€šè¿‡è¿™ä¸ªè®¾è®¡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨main()å‡½æ•°ä¸­åˆ›å»ºå¤šä¸ªç‰©å“å¹¶è®¡ç®—æ€»ä»·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;CppBook.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;ConferenceTicket.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;&gt;</span> <span class="n">items</span><span class="p">{};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">items</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">CppBook</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;Effective C++&#34;</span><span class="p">,</span> <span class="mf">19.99</span><span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="n">items</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">CppBook</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;C++ Templates&#34;</span><span class="p">,</span> <span class="mf">49.99</span><span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="n">items</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">ConferenceTicket</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;CppCon&#34;</span><span class="p">,</span> <span class="mf">999.0</span><span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="n">items</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">ConferenceTicket</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;Meeting C++&#34;</span><span class="p">,</span> <span class="mf">699.0</span><span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="n">items</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">ConferenceTicket</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;C++ on Sea&#34;</span><span class="p">,</span> <span class="mf">499.0</span><span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Money</span> <span class="k">const</span> <span class="n">total_price</span> <span class="o">=</span> 
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">accumulate</span><span class="p">(</span> <span class="n">begin</span><span class="p">(</span><span class="n">items</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">items</span><span class="p">),</span> <span class="n">Money</span><span class="p">{},</span> 
</span></span><span class="line"><span class="cl">            <span class="p">[](</span> <span class="n">Money</span> <span class="n">accu</span><span class="p">,</span> <span class="k">auto</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">item</span> <span class="p">){</span> 
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">accu</span> <span class="o">+</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">price</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨main()ä¸­åˆ›å»ºäº†ä¸¤ä¸ªä¹¦ç±å’Œä¸‰ä¸ªä¼šè®®é—¨ç¥¨ï¼Œå¹¶è®¡ç®—å«ç¨æ€»ä»·ã€‚è¿™çœ‹ä¼¼è‰¯å¥½çš„è®¾è®¡å®ç°äº†å…³æ³¨ç‚¹åˆ†ç¦»ï¼Œæ¯ä¸ªç‰©å“ç±»ç‹¬ç«‹å¤„ç†ä»·æ ¼è®¡ç®—ï¼Œç¬¦åˆSRPåŸåˆ™å¹¶éš”ç¦»äº†å˜åŒ–ç‚¹ã€‚ç„¶è€Œï¼Œè¯¥è®¾è®¡å­˜åœ¨é‡å¤§ç¼ºé™·ï¼šç¨ç‡å˜æ›´å°†å½±å“æ‰€æœ‰æ´¾ç”Ÿç±»ã€‚ä¾‹å¦‚ï¼Œè‹¥ç¨ç‡ä»15%è°ƒæ•´ä¸º12%æˆ–16%ï¼Œéœ€è¦ä¿®æ”¹æ¯ä¸ªç±»çš„è®¡ç®—é€»è¾‘ï¼Œå¯¼è‡´æ”¹åŠ¨éå¸ƒä»£ç åº“ã€‚</p>
<p>æ­£å¦‚SRPå»ºè®®åˆ†ç¦»å˜åŒ–ç‚¹ï¼Œæˆ‘ä»¬è¿˜åº”é¿å…åœ¨ä»£ç åº“ä¸­é‡å¤ä¿¡æ¯ã€‚æ¯ä¸ªèŒè´£åº”åœ¨ç³»ç»Ÿä¸­ä»…å­˜åœ¨ä¸€æ¬¡ï¼Œè¿™å°±æ˜¯&quot;ä¸è¦é‡å¤è‡ªå·±&rdquo;ï¼ˆDRYï¼‰åŸåˆ™ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œç¨ç‡åº”ä»…åœ¨ä¸€å¤„è¡¨ç¤ºï¼Œä¾¿äºç»Ÿä¸€ä¿®æ”¹ã€‚SRPä¸DRYé€šå¸¸ç›¸è¾…ç›¸æˆï¼Œä½†æœ‰æ—¶éœ€è¦é¢å¤–æ­¥éª¤æ¥å®ç°ä¸¤è€…ã€‚æˆ‘å°†åœ¨åç»­ç« èŠ‚ï¼ˆå‚è§&quot;å‡†åˆ™35ï¼šä½¿ç”¨è£…é¥°å™¨å®ç°å±‚æ¬¡åŒ–å®šåˆ¶&rdquo;ï¼‰è¯¦ç»†æ¢è®¨è¯¥é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<hr>
<p><strong>é¿å…è¿‡æ—©çš„åˆ†ç¦»å…³æ³¨ç‚¹</strong></p>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘å¸Œæœ›å·²ç»è¯´æœä½ éµå®ˆ SRPï¼ˆå•ä¸€èŒè´£åŸåˆ™ï¼‰å’Œ DRYï¼ˆä¸è¦é‡å¤è‡ªå·±ï¼‰æ˜¯ä¸€ä¸ªéå¸¸åˆç†çš„æƒ³æ³•ã€‚</p>
<p>ä½ ç”šè‡³å¯èƒ½ä¼šå¦‚æ­¤åšå®šåœ°è®¡åˆ’å°†æ‰€æœ‰ç±»å’Œå‡½æ•°åˆ†ç¦»æˆæœ€å°çš„åŠŸèƒ½å•å…ƒï¼Œæ¯•ç«Ÿï¼Œè¿™å°±æ˜¯ç›®æ ‡ï¼Œå¯¹å§ï¼Ÿå¦‚æœä½ ç°åœ¨æ­£åœ¨è¿™ä¹ˆæƒ³ï¼Œè¯·åœä¸‹æ¥ï¼æ·±å‘¼å¸ä¸€ä¸‹ã€‚å†æ¥ä¸€æ¬¡ã€‚ç„¶åè¯·ä»”ç»†è†å¬ Katerina Trajchevska çš„æ™ºæ…§ï¼š</p>
<p><strong>â€œä¸è¦è¯•å›¾å®ç° SOLIDï¼Œè€Œæ˜¯ç”¨ SOLID æ¥å®ç°å¯ç»´æŠ¤æ€§ã€‚â€</strong></p>
<p>SRP å’Œ DRY éƒ½æ˜¯ä½ å®ç°æ›´å¥½å¯ç»´æŠ¤æ€§å’Œç®€åŒ–å˜æ›´çš„å·¥å…·ï¼Œè€Œä¸æ˜¯ä½ çš„ç›®æ ‡ï¼Œè™½ç„¶ä»é•¿è¿œæ¥çœ‹è¿™ä¸¤è€…éƒ½éå¸¸é‡è¦ï¼Œä½†åœ¨æ²¡æœ‰æ˜ç¡®äº†è§£å“ªäº›å˜åŒ–ä¼šå½±å“ä½ çš„æƒ…å†µä¸‹åˆ†ç¦»å®ä½“å¯èƒ½ä¼šé€‚å¾—å…¶åã€‚</p>
<p>ä¸ºå˜åŒ–è€Œè®¾è®¡é€šå¸¸æœ‰åˆ©äºæŸä¸€ç§ç‰¹å®šçš„å˜åŒ–ï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œè¿™å¯èƒ½ä¼šä½¿å…¶ä»–ç§ç±»çš„å˜åŒ–å˜å¾—æ›´åŠ å›°éš¾ã€‚<br/>è¿™ç§ç†å¿µæ˜¯ä¼—æ‰€å‘¨çŸ¥çš„ YAGNI åŸåˆ™ï¼ˆYou Arenâ€™t Gonna Need Itï¼Œä½ ä¸ä¼šéœ€è¦å®ƒï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥åŸåˆ™è­¦å‘Šä½ é¿å…è¿‡åº¦è®¾è®¡ï¼ˆå‚è§â€œæŒ‡å¯¼åŸåˆ™ 5ï¼šä¸ºæ‰©å±•è€Œè®¾è®¡â€ï¼‰ã€‚</p>
<p>å¦‚æœä½ æœ‰ä¸€ä¸ªæ˜ç¡®çš„è®¡åˆ’ï¼Œå¹¶ä¸”çŸ¥é“é¢„æœŸçš„å˜åŒ–ç±»å‹ï¼Œé‚£ä¹ˆåº”ç”¨ SRP å’Œ DRY æ¥ç®€åŒ–é‚£ç§å˜åŒ–ã€‚<br/>ç„¶è€Œï¼Œå¦‚æœä½ ä¸çŸ¥é“ä¼šæœ‰ä»€ä¹ˆæ ·çš„å˜åŒ–ï¼Œè¯·ä¸è¦çŒœæµ‹â€”â€”åªéœ€ç­‰å¾…ï¼Œç­‰åˆ°ä½ æ¸…æ¥šåœ°çŸ¥é“é¢„æœŸçš„å˜åŒ–ç±»å‹ï¼Œç„¶åå†è¿›è¡Œé‡æ„ä»¥ä½¿å˜åŒ–å°½å¯èƒ½ç®€å•ã€‚</p>
<p>æ€»ä¹‹ï¼Œè½¯ä»¶ä¸­çš„å˜åŒ–æ˜¯é¢„æœŸçš„ï¼Œå› æ­¤ä¸ºå˜åŒ–è€Œè®¾è®¡æ˜¯è‡³å…³é‡è¦çš„ã€‚åˆ†ç¦»å…³æ³¨ç‚¹å¹¶æœ€å°åŒ–é‡å¤ï¼Œä»¥ä¾¿ä½ å¯ä»¥è½»æ¾åœ°è¿›è¡Œæ›´æ”¹ï¼Œè€Œä¸å¿…æ‹…å¿ƒä¼šç ´åå…¶ä»–æ­£äº¤çš„æ–¹é¢ã€‚</p>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>é¢„æœŸè½¯ä»¶ä¸­çš„å˜åŒ–ã€‚</li>
<li>ä¸ºæ˜“äºæ›´æ”¹è€Œè®¾è®¡ï¼Œä½¿è½¯ä»¶æ›´å…·é€‚åº”æ€§ã€‚</li>
<li>é¿å…å°†ä¸ç›¸å…³çš„æ­£äº¤æ–¹é¢ç»„åˆåœ¨ä¸€èµ·ï¼Œä»¥é˜²æ­¢è€¦åˆã€‚</li>
<li>ç†è§£è€¦åˆå¢åŠ äº†å˜æ›´çš„å¯èƒ½æ€§ï¼Œå¹¶ä½¿å˜æ›´æ›´åŠ å›°éš¾ã€‚</li>
<li>éµå¾ªå•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰æ¥åˆ†ç¦»å…³æ³¨ç‚¹ã€‚</li>
<li>éµå®ˆä¸è¦é‡å¤è‡ªå·±ï¼ˆDRYï¼‰åŸåˆ™ä»¥æœ€å°åŒ–é‡å¤ã€‚</li>
<li>å¦‚æœä½ ä¸ç¡®å®šä¸‹ä¸€æ¬¡å˜æ›´ï¼Œé¿å…è¿‡æ—©æŠ½è±¡ã€‚</li>
</ul>
<h3 id="å‡†åˆ™3åˆ†ç¦»æ¥å£ä»¥é¿å…äººä¸ºè€¦åˆ">å‡†åˆ™3ï¼šåˆ†ç¦»æ¥å£ä»¥é¿å…äººä¸ºè€¦åˆ
</h3><p><strong>æ¥å£éš”ç¦»ï¼šè§£è€¦æ­£äº¤åŠŸèƒ½</strong></p>
<p>è®©æˆ‘ä»¬é‡æ–°å®¡è§†å‡†åˆ™2ï¼šä¸ºå˜æ›´è€Œè®¾è®¡ä¸­çš„<code>Document</code>ç±»æ¡ˆä¾‹ã€‚å°½ç®¡å·²æ‹†åˆ†JSONå¯¼å‡ºå’Œåºåˆ—åŒ–åŠŸèƒ½ï¼Œä½†æ¥å£è®¾è®¡ä»å­˜åœ¨æ›´æ·±å±‚çš„è€¦åˆé—®é¢˜ã€‚</p>
<hr>
<p><strong>é—®é¢˜ï¼šå…¨èƒ½æ¥å£å¼•å‘çš„è¿é”ååº”</strong></p>
<p>åŸ<code>Document</code>æ¥å£å¼ºåˆ¶æ´¾ç”Ÿç±»å®ç°æ‰€æœ‰æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Document</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">Document</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">exportToJSON</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// JSONå¯¼å‡º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">ByteStream</span><span class="o">&amp;</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// åºåˆ—åŒ–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ... å…¶ä»–æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¼ºé™·ç¤ºä¾‹</strong>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">exportDocument</span><span class="p">(</span><span class="k">const</span> <span class="n">Document</span><span class="o">&amp;</span> <span class="n">doc</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">doc</span><span class="p">.</span><span class="n">exportToJSON</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">);</span>  <span class="c1">// ä»…éœ€JSONå¯¼å‡ºåŠŸèƒ½
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>éšæ€§ä¾èµ–</strong>ï¼š
<ul>
<li><code>exportDocument()</code>å‡½æ•°è¢«è¿«ä¾èµ–<code>Document</code>çš„æ‰€æœ‰æ¥å£ï¼ˆåŒ…æ‹¬æ— å…³çš„<code>serialize()</code>ï¼‰</li>
<li>ä¿®æ”¹<code>ByteStream</code>ç±»æˆ–<code>serialize()</code>ç­¾åä¼šå¯¼è‡´æ‰€æœ‰<code>Document</code>ç”¨æˆ·é‡æ–°ç¼–è¯‘</li>
<li>æ–°å¢æ¥å£ï¼ˆå¦‚XMLå¯¼å‡ºï¼‰ä¼šæ³¢åŠæ‰€æœ‰å®¢æˆ·ç«¯ä»£ç </li>
</ul>
</li>
</ul>
<hr>
<p><strong>è§£å†³æ–¹æ¡ˆï¼šæ¥å£éš”ç¦»åŸåˆ™ï¼ˆISPï¼‰</strong></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š</p>
<blockquote>
<p>å®¢æˆ·ç«¯ä¸åº”è¢«è¿«ä¾èµ–å…¶ä¸ä½¿ç”¨çš„æ–¹æ³•ã€‚</p>
</blockquote>
<p><strong>é‡æ„æ­¥éª¤</strong>ï¼š</p>
<ol>
<li><strong>æ‹†åˆ†æ­£äº¤æ¥å£</strong></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// JSONå¯¼å‡ºèƒ½åŠ›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">JSONExportable</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">JSONExportable</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">exportToJSON</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// åºåˆ—åŒ–èƒ½åŠ›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Serializable</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">Serializable</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">ByteStream</span><span class="o">&amp;</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç»„åˆå¼Documentæ¥å£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Document</span> <span class="o">:</span> <span class="k">public</span> <span class="n">JSONExportable</span><span class="p">,</span> <span class="k">public</span> <span class="n">Serializable</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ... å…¶ä»–åŸºç¡€åŠŸèƒ½
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li><strong>å®¢æˆ·ç«¯æŒ‰éœ€ä¾èµ–</strong></li>
</ol>
<p>cpp</p>
<p>å¤åˆ¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">exportDocument</span><span class="p">(</span><span class="k">const</span> <span class="n">JSONExportable</span><span class="o">&amp;</span> <span class="n">exportable</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">exportable</span><span class="p">.</span><span class="n">exportToJSON</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">);</span>  <span class="c1">// ä»…ä¾èµ–æ‰€éœ€æ¥å£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>è§£è€¦ç¼–è¯‘ä¾èµ–</strong>ï¼šä¿®æ”¹<code>Serializable</code>ä¸å½±å“ä»…ä½¿ç”¨<code>JSONExportable</code>çš„å®¢æˆ·ç«¯</li>
<li><strong>æ¥å£æ‰©å±•å®‰å…¨</strong>ï¼šæ–°å¢æ¥å£ï¼ˆå¦‚<code>XMLExportable</code>ï¼‰ä¸ä¼šå¯¼è‡´ç°æœ‰å®¢æˆ·ç«¯è¢«è¿«é€‚é…</li>
<li><strong>ç¬¦åˆSRP</strong>ï¼šæ¯ä¸ªæ¥å£ä¸“æ³¨å•ä¸€èƒ½åŠ›ç»´åº¦</li>
</ul>
<hr>
<p><strong>ISPä¸SRPçš„å…³ç³»</strong></p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:left">åŸåˆ™</th>
<th style="text-align:left">å…³æ³¨ç‚¹</th>
<th style="text-align:left">åº”ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>SRP</strong></td>
<td style="text-align:left">ç±»/æ¨¡å—çš„èŒè´£å•ä¸€æ€§</td>
<td style="text-align:left">æ•´ä½“æ¶æ„è®¾è®¡</td>
</tr>
<tr>
<td style="text-align:left"><strong>ISP</strong></td>
<td style="text-align:left">æ¥å£æ–¹æ³•çš„æ­£äº¤æ€§</td>
<td style="text-align:left">æ¥å£æŠ½è±¡å±‚è®¾è®¡</td>
</tr>
</tbody>
</table></div>
<p><strong>å…³é”®æ´å¯Ÿ</strong>ï¼š</p>
<ul>
<li>ISPæ˜¯SRPåœ¨æ¥å£è®¾è®¡ä¸­çš„ç‰¹ä¾‹</li>
<li>è¿åISPå¿…ç„¶è¿åSRPï¼Œä½†åä¹‹ä¸æˆç«‹</li>
<li>æ¥å£èšåˆçš„è¯±æƒ‘æ™®éå­˜åœ¨ï¼ˆå¦‚&quot;å…¨èƒ½åŸºç±»&rdquo;ï¼‰ï¼Œéœ€é€šè¿‡è®¾è®¡è¯„å®¡æå‰è§„é¿</li>
</ul>
<hr>
<p><strong>æ¨¡æ¿è®¾è®¡ä¸­çš„ISPæ€æƒ³</strong></p>
<p>ISPä¸ä»…é€‚ç”¨äºé¢å‘å¯¹è±¡è®¾è®¡ï¼Œä¹Ÿå½±å“æ¨¡æ¿ç¼–ç¨‹ã€‚ä»¥<code>std::copy</code>ä¸ºä¾‹ï¼š</p>
<p><strong>ä¸è‰¯è®¾è®¡ï¼šè¿‡åº¦çº¦æŸè¿­ä»£å™¨ç±»å‹</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">ForwardIt</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">copy</span><span class="p">(</span><span class="n">ForwardIt</span> <span class="n">first</span><span class="p">,</span> <span class="n">ForwardIt</span> <span class="n">last</span><span class="p">,</span> <span class="n">ForwardIt</span> <span class="n">d_first</span><span class="p">);</span>  <span class="c1">// è¦æ±‚å‰å‘è¿­ä»£å™¨
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>é—®é¢˜</strong>ï¼šæ— æ³•é€‚é…è¾“å…¥æµè¿­ä»£å™¨ï¼ˆä»…æ”¯æŒå•å‘éå†ï¼‰</li>
</ul>
<p><strong>ä¼˜åŒ–è®¾è®¡ï¼šæœ€å°åŒ–æ¨¡æ¿çº¦æŸ</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">InputIt</span><span class="p">,</span> <span class="k">typename</span> <span class="n">OutputIt</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">copy</span><span class="p">(</span><span class="n">InputIt</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIt</span> <span class="n">last</span><span class="p">,</span> <span class="n">OutputIt</span> <span class="n">d_first</span><span class="p">);</span>  <span class="c1">// ä»…è¦æ±‚è¾“å…¥/è¾“å‡ºè¿­ä»£å™¨
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>C++20æ¦‚å¿µå¢å¼º</strong>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">input_iterator</span> <span class="n">InputIt</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">output_iterator</span> <span class="n">OutputIt</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">OutputIt</span> <span class="n">copy</span><span class="p">(</span><span class="n">InputIt</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIt</span> <span class="n">last</span><span class="p">,</span> <span class="n">OutputIt</span> <span class="n">d_first</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>è®¾è®¡å¯ç¤º</strong>ï¼š</p>
<ul>
<li><strong>ç²¾å‡†è¡¨è¾¾éœ€æ±‚</strong>ï¼šæ¨¡æ¿å‚æ•°ä»…å£°æ˜å¿…è¦æ“ä½œï¼ˆå¦‚<code>input_iterator</code>åªéœ€<code>++</code>å’Œ<code>*</code>ï¼‰</li>
<li><strong>æå‡æ³›ç”¨æ€§</strong>ï¼šæ”¯æŒæ›´å¹¿æ³›çš„é€‚é…å™¨ï¼ˆå¦‚æ–‡ä»¶æµã€ç½‘ç»œæµè¿­ä»£å™¨ï¼‰</li>
<li><strong>å‡å°‘éšå¼ä¾èµ–</strong>ï¼šé¿å…å¼ºåˆ¶ç”¨æˆ·å®ç°æ— å…³æ¥å£</li>
</ul>
<hr>
<p><strong>æœ€ä½³å®è·µæ¸…å•</strong></p>
<ol>
<li><strong>æ¥å£è®¾è®¡æ—¶</strong>ï¼š
<ul>
<li>ä¸ºæ¯ä¸ªæ­£äº¤åŠŸèƒ½ç»´åº¦å®šä¹‰ç‹¬ç«‹æ¥å£</li>
<li>é€šè¿‡å¤šé‡ç»§æ‰¿ç»„åˆå¤æ‚èƒ½åŠ›ï¼ˆè€Œéå•ä¸€åºå¤§æ¥å£ï¼‰</li>
</ul>
</li>
<li><strong>å®¢æˆ·ç«¯ç¼–ç æ—¶</strong>ï¼š
<ul>
<li>ä¾èµ–æœ€å…·ä½“çš„æ¥å£ç±»å‹ï¼ˆå¦‚<code>JSONExportable</code>è€Œé<code>Document</code>ï¼‰</li>
</ul>
</li>
<li><strong>æ¨¡æ¿è®¾è®¡æ—¶</strong>ï¼š
<ul>
<li>ä½¿ç”¨C++æ¦‚å¿µç²¾å‡†çº¦æŸæ¨¡æ¿å‚æ•°</li>
<li>ä¼˜å…ˆé€‰æ‹©æœ€å®½æ¾çš„è¿­ä»£å™¨ç±»åˆ«ï¼ˆè¾“å…¥/è¾“å‡ºè¿­ä»£å™¨ &gt; å‰å‘è¿­ä»£å™¨ï¼‰</li>
</ul>
</li>
<li><strong>é‡æ„ç­–ç•¥</strong>ï¼š
<ul>
<li>è¯†åˆ«è¢«å¼ºåˆ¶å®ç°çš„&quot;ç©ºæ–¹æ³•&rdquo;ï¼ˆå¦‚æŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œæç¤ºæ¥å£éœ€æ‹†åˆ†</li>
<li>ä½¿ç”¨é€‚é…å™¨æ¨¡å¼åŒ…è£…é—ç•™æ¥å£ï¼Œé€æ­¥è¿ç§»</li>
</ul>
</li>
</ol>
<blockquote>
<p>&ldquo;è‰¯å¥½çš„æ¥å£è®¾è®¡å¦‚åŒç²¾ç¡®çš„æ‰‹æœ¯åˆ€â€”â€”åªåˆ‡å¼€å¿…è¦çš„éƒ¨åˆ†ï¼Œä¿æŒå…¶ä»–ç»„ç»‡çš„å®Œæ•´ã€‚&rdquo;
â€”â€”ã€ŠC++è½¯ä»¶è®¾è®¡ã€‹</p>
</blockquote>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>æ³¨æ„è€¦åˆä¹Ÿä¼šå½±å“æ¥å£ã€‚</li>
<li>éµå®ˆæ¥å£éš”ç¦»åŸåˆ™ï¼ˆISPï¼‰ä»¥åˆ†ç¦»æ¥å£ä¸­çš„å…³æ³¨ç‚¹ã€‚</li>
<li>å°† ISP è§†ä¸ºå•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰çš„ä¸€ä¸ªç‰¹ä¾‹ã€‚</li>
<li>ç†è§£ ISP æ—¢é€‚ç”¨äºç»§æ‰¿å±‚æ¬¡ç»“æ„ï¼Œä¹Ÿé€‚ç”¨äºæ¨¡æ¿ã€‚</li>
</ul>
<h3 id="å‡†åˆ™4ä¸ºå¯æµ‹è¯•æ€§è€Œè®¾è®¡">å‡†åˆ™4ï¼šä¸ºå¯æµ‹è¯•æ€§è€Œè®¾è®¡
</h3><p>æ­£å¦‚å‡†åˆ™1ï¼šç†è§£è½¯ä»¶è®¾è®¡çš„é‡è¦æ€§æ‰€è¿°ï¼Œè½¯ä»¶å¿…ç„¶é¢ä¸´å˜æ›´ã€‚ä½†æ¯æ¬¡ä¿®æ”¹éƒ½å¯èƒ½æ„å¤–ç ´åç°æœ‰åŠŸèƒ½â€”â€”å°½ç®¡æˆ‘ä»¬å°½åŠ›é¿å…ï¼Œé£é™©å§‹ç»ˆå­˜åœ¨ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬ä¾èµ–<strong>æµ‹è¯•</strong>ä½œä¸ºå®‰å…¨ç½‘ï¼š</p>
<blockquote>
<p>æµ‹è¯•æ˜¯è½¯ä»¶å˜æ›´çš„ä¿æŠ¤å±‚ï¼Œæ˜¯ç¡®ä¿åŠŸèƒ½å®Œæ•´æ€§çš„æ•‘ç”Ÿè¡£ã€‚</p>
</blockquote>
<p>ç„¶è€Œï¼Œç¼–å†™æµ‹è¯•çš„å‰ææ˜¯<strong>è½¯ä»¶å¿…é¡»å¯æµ‹è¯•</strong>ã€‚æœ¬å‡†åˆ™å°†æ­ç¤ºå¦‚ä½•é€šè¿‡è®¾è®¡æå‡å¯æµ‹è¯•æ€§ã€‚</p>
<hr>
<p><strong>æŒ‘æˆ˜ï¼šå¦‚ä½•æµ‹è¯•ç§æœ‰æˆå‘˜å‡½æ•°ï¼Ÿ</strong></p>
<p>è€ƒè™‘ä»¥ä¸‹<code>Widget</code>ç±»ï¼Œå…¶ç§æœ‰æ–¹æ³•<code>updateCollection()</code>éœ€è¦æµ‹è¯•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Widget</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">updateCollection</span><span class="p">(</span><span class="cm">/*å‚æ•°*/</span><span class="p">);</span>  <span class="c1">// éœ€æµ‹è¯•çš„ç§æœ‰æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Blob</span><span class="o">&gt;</span> <span class="n">blobs_</span><span class="p">;</span>         <span class="c1">// æ•°æ®æˆå‘˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ... å…¶ä»–å¯èƒ½çš„æ•°æ®æˆå‘˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å¸¸è§é”™è¯¯æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>
<p><strong>ç™½ç›’æµ‹è¯•</strong>ï¼šé€šè¿‡å…¬æœ‰æ–¹æ³•é—´æ¥æµ‹è¯•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">addBlob</span><span class="p">(</span><span class="k">const</span> <span class="n">Blob</span><span class="o">&amp;</span> <span class="n">blob</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">updateCollection</span><span class="p">();</span>  <span class="c1">// å†…éƒ¨è°ƒç”¨ç§æœ‰æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>é—®é¢˜</strong>ï¼šæµ‹è¯•ä¾èµ–å®ç°ç»†èŠ‚ï¼Œå®ç°å˜æ›´ä¼šå¯¼è‡´æµ‹è¯•å¤±æ•ˆã€‚</p>
</li>
<li>
<p><strong>å‹å…ƒç±»</strong>ï¼šæˆäºˆæµ‹è¯•ç±»ç‰¹æ®Šæƒé™</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Widget</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">friend</span> <span class="k">class</span> <span class="nc">TestWidget</span><span class="p">;</span>  <span class="c1">// å£°æ˜æµ‹è¯•ç±»ä¸ºå‹å…ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">updateCollection</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>é—®é¢˜</strong>ï¼šç”Ÿäº§ä»£ç åå‘ä¾èµ–æµ‹è¯•ä»£ç ï¼Œå½¢æˆå¾ªç¯ä¾èµ–ã€‚</p>
</li>
<li>
<p><strong>ç»§æ‰¿æš´éœ²</strong>ï¼šå°†æ–¹æ³•æ”¹ä¸º<code>protected</code>å¹¶æ´¾ç”Ÿæµ‹è¯•ç±»</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TestWidget</span> <span class="o">:</span> <span class="k">private</span> <span class="n">Widget</span> <span class="p">{</span>  <span class="c1">// é€šè¿‡ç»§æ‰¿è®¿é—®protectedæ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="nf">testUpdate</span><span class="p">()</span> <span class="p">{</span> <span class="n">updateCollection</span><span class="p">();</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>é—®é¢˜</strong>ï¼šæ»¥ç”¨ç»§æ‰¿æœºåˆ¶ï¼Œç ´åå°è£…æ€§ã€‚</p>
</li>
</ol>
<hr>
<p><strong>ç»ˆææ–¹æ¡ˆï¼šå…³æ³¨ç‚¹åˆ†ç¦»</strong></p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šå°†éœ€æµ‹è¯•çš„åŠŸèƒ½ä»ç±»ä¸­è§£è€¦ï¼Œä½¿å…¶ç‹¬ç«‹å¯æµ‹ã€‚</p>
<p><strong>æ–¹æ¡ˆ1ï¼šæå–ä¸ºè‡ªç”±å‡½æ•°</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// å°†æ›´æ–°é€»è¾‘æå–ä¸ºç‹¬ç«‹å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">updateCollection</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Blob</span><span class="o">&gt;&amp;</span> <span class="n">blobs</span><span class="p">,</span> <span class="cm">/*å‚æ•°*/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å®ç°åŸç§æœ‰æ–¹æ³•é€»è¾‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Widget</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Blob</span><span class="o">&gt;</span> <span class="n">blobs_</span><span class="p">;</span>  <span class="c1">// æ•°æ®æˆå‘˜ä»å°è£…åœ¨ç±»å†…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// è°ƒç”¨æ–¹å¼ï¼šupdateCollection(blobs_, ...);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>ç›´æ¥æµ‹è¯•</strong>ï¼šæ— éœ€ä¾èµ–<code>Widget</code>ç±»å³å¯æµ‹è¯•<code>updateCollection</code></li>
<li><strong>å¢å¼ºå°è£…</strong>ï¼šè‡ªç”±å‡½æ•°ä»…èƒ½é€šè¿‡å…¬æœ‰æ¥å£è®¿é—®æ•°æ®ï¼Œå‡å°‘å¯¹ç§æœ‰æˆå‘˜çš„æš´éœ²</li>
</ul>
<p><strong>æ–¹æ¡ˆ2ï¼šå°è£…ä¸ºç‹¬ç«‹ç±»</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="n">widget_details</span> <span class="p">{</span>  <span class="c1">// ç»†èŠ‚å‘½åç©ºé—´éš”ç¦»å®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BlobCollection</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">updateCollection</span><span class="p">(</span><span class="cm">/*å‚æ•°*/</span><span class="p">);</span>  <span class="c1">// å…¬å¼€å¯æµ‹è¯•æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Blob</span><span class="o">&gt;</span> <span class="n">blobs_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c1">// namespace widget_details
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Widget</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">widget_details</span><span class="o">::</span><span class="n">BlobCollection</span> <span class="n">blobs_</span><span class="p">;</span>  <span class="c1">// ç»„åˆä»£æ›¿ç»§æ‰¿
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>èŒè´£æ¸…æ™°</strong>ï¼š<code>BlobCollection</code>ä¸“æ³¨é›†åˆç®¡ç†ï¼Œç¬¦åˆSRP</li>
<li><strong>æµ‹è¯•å‹å¥½</strong>ï¼šå¯ç›´æ¥å®ä¾‹åŒ–<code>BlobCollection</code>è¿›è¡Œå•å…ƒæµ‹è¯•</li>
</ul>
<hr>
<p><strong>è®¾è®¡åŸåˆ™çš„ååŒæ•ˆåº”</strong></p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:left">åŸåˆ™</th>
<th style="text-align:left">åº”ç”¨åœºæ™¯</th>
<th style="text-align:left">æ”¶ç›Š</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>SRP</strong></td>
<td style="text-align:left">åˆ†ç¦»é›†åˆç®¡ç†ä¸Widgetæ ¸å¿ƒé€»è¾‘</td>
<td style="text-align:left">åŠŸèƒ½å˜æ›´äº’ä¸å½±å“</td>
</tr>
<tr>
<td style="text-align:left"><strong>å°è£…æ€§</strong></td>
<td style="text-align:left">é™åˆ¶è‡ªç”±å‡½æ•°/ç±»å¯¹ç§æœ‰æ•°æ®çš„è®¿é—®</td>
<td style="text-align:left">é™ä½æ„å¤–ä¿®æ”¹é£é™©</td>
</tr>
<tr>
<td style="text-align:left"><strong>ç»„åˆä¼˜äºç»§æ‰¿</strong></td>
<td style="text-align:left">ä½¿ç”¨BlobCollectionç»„åˆ</td>
<td style="text-align:left">é¿å…ç»§æ‰¿é“¾çš„è„†å¼±æ€§</td>
</tr>
</tbody>
</table></div>
<hr>
<p><strong>å…³é”®å®è·µå»ºè®®</strong></p>
<ol>
<li><strong>è­¦æƒ•&quot;æµ‹è¯•åé—¨&rdquo;</strong>ï¼š
<ul>
<li>é¿å…ä½¿ç”¨å‹å…ƒã€ç»§æ‰¿æˆ–é¢„å¤„ç†å®ç ´åå°è£…</li>
<li>ä¼˜å…ˆé€šè¿‡è®¾è®¡è€Œéæƒé™çªç ´å®ç°å¯æµ‹è¯•æ€§</li>
</ul>
</li>
<li><strong>å‡½æ•°æå–æ ‡å‡†</strong>ï¼š
<ul>
<li>å½“ç§æœ‰æ–¹æ³•é€»è¾‘å¤æ‚åˆ°éœ€è¦ç‹¬ç«‹æµ‹è¯•æ—¶ï¼Œå³åº”è§£è€¦</li>
<li>è™šå‡½æ•°éœ€ç‰¹æ®Šå¤„ç†ï¼ˆåç»­ç« èŠ‚è®¨è®ºï¼‰</li>
</ul>
</li>
<li><strong>æµ‹è¯•é©±åŠ¨è®¾è®¡(TDD)</strong>ï¼š
<ul>
<li>ç¼–å†™æµ‹è¯•å‰æ€è€ƒï¼šå¦‚ä½•æœ€å°åŒ–è¢«æµ‹å•å…ƒçš„å¤–éƒ¨ä¾èµ–ï¼Ÿ</li>
<li>é€šè¿‡æµ‹è¯•ç”¨ä¾‹åæ¨æ¨¡å—è¾¹ç•Œæ˜¯å¦åˆç†</li>
</ul>
</li>
</ol>
<blockquote>
<p>&ldquo;å¯æµ‹è¯•æ€§ä¸æ˜¯äº‹åè¡¥æ•‘ï¼Œè€Œæ˜¯ä¼˜ç§€è®¾è®¡çš„è‡ªç„¶ç»“æœã€‚&rdquo;
â€”â€”ã€Šä¿®æ”¹ä»£ç çš„è‰ºæœ¯ã€‹</p>
</blockquote>
<hr>
<p><strong>ä»å°è£…æ€§çœ‹å‡½æ•°æå–</strong></p>
<p>Scott Meyersåœ¨ã€ŠEffective C++ã€‹ä¸­æŒ‡å‡ºï¼š</p>
<blockquote>
<p><strong>ä¼˜å…ˆé€‰æ‹©éæˆå‘˜éå‹å…ƒå‡½æ•°</strong></p>
<ul>
<li>æˆå‘˜å‡½æ•°å¯è®¿é—®æ‰€æœ‰ç§æœ‰æˆå‘˜ï¼Œå‰Šå¼±å°è£…</li>
<li>è‡ªç”±å‡½æ•°ä»…é€šè¿‡å…¬æœ‰æ¥å£äº¤äº’ï¼Œå¢å¼ºå°è£…</li>
</ul>
</blockquote>
<p><strong>ç¤ºä¾‹å¯¹æ¯”</strong>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// æ–¹æ¡ˆAï¼šæˆå‘˜å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">WidgetA</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">update</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* ç›´æ¥è®¿é—®blobs_ */</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Blob</span><span class="o">&gt;</span> <span class="n">blobs_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ–¹æ¡ˆBï¼šè‡ªç”±å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">WidgetB</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Blob</span><span class="o">&gt;&amp;</span> <span class="n">getBlobs</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">blobs_</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Blob</span><span class="o">&gt;</span> <span class="n">blobs_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="n">WidgetB</span><span class="o">&amp;</span> <span class="n">widget</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* é€šè¿‡getBlobs()è®¿é—® */</span> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>æ–¹æ¡ˆB</strong>ä¸­ï¼Œ<code>update</code>å‡½æ•°æ— æ³•ç›´æ¥è®¿é—®<code>blobs_</code>ï¼Œå¿…é¡»é€šè¿‡å…¬æœ‰æ¥å£ï¼Œå°è£…æ€§æ›´ä¼˜ã€‚</li>
</ul>
<hr>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li><strong>æµ‹è¯•å³è®¾è®¡æŒ‡æ ‡</strong>ï¼šéš¾ä»¥æµ‹è¯•çš„ä»£ç å¾€å¾€æš—ç¤ºè®¾è®¡ç¼ºé™·</li>
<li><strong>è§£è€¦ä¸ºç‹</strong>ï¼šé€šè¿‡åˆ†ç¦»å…³æ³¨ç‚¹ä½¿ç»„ä»¶ç‹¬ç«‹å¯æµ‹</li>
<li><strong>å¹³è¡¡ä¹‹é“</strong>ï¼šåœ¨å°è£…æ€§ä¸å¯æµ‹è¯•æ€§é—´å¯»æ‰¾æœ€ä¼˜è§£</li>
<li><strong>å·¥å…·è¾…åŠ©</strong>ï¼šåˆ©ç”¨ä¾èµ–æ³¨å…¥ã€ç­–ç•¥æ¨¡å¼ç­‰æå‡å¯æµ‹è¯•æ€§ï¼ˆåç»­ç« èŠ‚è¯¦è§£ï¼‰</li>
</ul>
<p>é€šè¿‡æœ¬å‡†åˆ™ï¼Œæˆ‘ä»¬å­¦ä¼šå°†å¯æµ‹è¯•æ€§èå…¥è®¾è®¡DNAï¼Œè®©å˜æ›´æ›´å®‰å…¨ã€ç³»ç»Ÿæ›´å¥å£®ã€‚</p>
<h3 id="å‡†åˆ™5ä¸ºæ‰©å±•è€Œè®¾è®¡">å‡†åˆ™5ï¼šä¸ºæ‰©å±•è€Œè®¾è®¡
</h3><p>å…³äºè½¯ä»¶å˜æ›´ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦æ–¹é¢å°šæœªå¼ºè°ƒï¼šå¯æ‰©å±•æ€§ã€‚å¯æ‰©å±•æ€§åº”æˆä¸ºè®¾è®¡çš„é¦–è¦ç›®æ ‡ã€‚å› ä¸ºå¦ç‡åœ°è¯´ï¼Œè‹¥ä»£ç æ— æ³•æ·»åŠ æ–°åŠŸèƒ½ï¼Œå°±æ„å‘³ç€å…¶ç”Ÿå‘½å‘¨æœŸçš„ç»ˆç»“ã€‚å› æ­¤ï¼Œæ·»åŠ æ–°åŠŸèƒ½â€”â€”æ‰©å±•ä»£ç åº“â€”â€”å…·æœ‰æ ¹æœ¬é‡è¦æ€§ã€‚æ­£å› å¦‚æ­¤ï¼Œå¯æ‰©å±•æ€§ç†åº”æˆä¸ºä¼˜ç§€è½¯ä»¶è®¾è®¡çš„æ ¸å¿ƒç›®æ ‡ä¸é©±åŠ¨åŠ›ã€‚</p>
<hr>
<p><strong>å¼€æ”¾-å°é—­åŸåˆ™ï¼ˆOCPï¼‰</strong></p>
<p>å¯æ‰©å±•æ€§ä¸ä¼šå‡­ç©ºå®ç°ï¼Œè€Œæ˜¯éœ€è¦åœ¨è®¾è®¡æ—¶æ˜¾å¼è€ƒè™‘ã€‚å›é¡¾&quot;å‡†åˆ™2ï¼šä¸ºå˜åŒ–è€Œè®¾è®¡&quot;ä¸­çš„æ–‡æ¡£åºåˆ—åŒ–ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ›¾ä½¿ç”¨å¸¦æœ‰çº¯è™šå‡½æ•°<code>serialize()</code>çš„<code>Document</code>åŸºç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Document</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">virtual</span> <span class="o">~</span><span class="n">Document</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">serialize</span><span class="p">(</span> <span class="n">ByteStream</span><span class="o">&amp;</span> <span class="n">bs</span><span class="p">,</span> <span class="cm">/*...*/</span> <span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ´¾ç”Ÿç±»ï¼ˆå¦‚<code>PDF</code>ï¼‰éœ€å®ç°<code>serialize()</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PDF</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Document</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="n">serialize</span><span class="p">(</span> <span class="n">ByteStream</span><span class="o">&amp;</span> <span class="n">bs</span><span class="p">,</span> <span class="cm">/*...*/</span> <span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…³é”®é—®é¢˜åœ¨äºå¦‚ä½•å®ç°åºåˆ—åŒ–ã€‚ä¸ºå®ç°ååºåˆ—åŒ–ï¼Œéœ€åœ¨å­—èŠ‚æµå¼€å¤´å­˜å‚¨æ–‡æ¡£ç±»å‹æ ‡è¯†ã€‚æˆ‘ä»¬æ›¾ä½¿ç”¨æšä¸¾ç±»å‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">DocumentType</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">pdf</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">word</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... æ›´å¤šæ–‡æ¡£ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½†æ­¤è®¾è®¡å¯¼è‡´æ‰€æœ‰æ–‡æ¡£ç±»ï¼ˆPDFã€Wordç­‰ï¼‰è€¦åˆäºåŒä¸€æšä¸¾ã€‚å½“æ–°å¢XMLæ–‡æ¡£ç±»å‹æ—¶ï¼Œå¿…é¡»ä¿®æ”¹æšä¸¾ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">DocumentType</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">pdf</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">word</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">xml</span><span class="p">,</span>  <span class="c1">// æ–°å¢ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¼šå¯¼è‡´æ‰€æœ‰ç°æœ‰æ–‡æ¡£ç±»é‡æ–°ç¼–è¯‘ï¼Œä¸”é™åˆ¶äº†å¤–éƒ¨æ‰©å±•èƒ½åŠ›ï¼ˆæ— æ³•ä¿®æ”¹æšä¸¾åˆ™æ— æ³•æ·»åŠ æ–°ç±»å‹ï¼‰ã€‚<br/>è¿™æ˜¾ç„¶è¿åäº†<strong>å¼€æ”¾-å°é—­åŸåˆ™ï¼ˆOCPï¼‰</strong>â€”â€”è½¯ä»¶å®ä½“åº”å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚</p>
<hr>
<p><strong>è§£å†³æ–¹æ¡ˆï¼šåˆ†ç¦»å…³æ³¨ç‚¹</strong></p>
<p>é€šè¿‡å°†åºåˆ—åŒ–é€»è¾‘æå–ä¸ºç‹¬ç«‹ç»„ä»¶ï¼ˆå¦‚å›¾1-6æ‰€ç¤ºï¼‰ï¼Œæˆ‘ä»¬è§£é™¤äº†æ–‡æ¡£ç±»å‹é—´çš„è€¦åˆï¼š</p>
<p>åºåˆ—åŒ–ç»„ä»¶ä¾èµ–æ‰€æœ‰æ–‡æ¡£ç±»å‹ï¼Œä½†æ–‡æ¡£ç±»å‹å½¼æ­¤ç‹¬ç«‹ã€‚æ–°å¢<code>XML</code>ç±»æ—¶ï¼Œä»…éœ€åœ¨åºåˆ—åŒ–ç»„ä»¶ä¸­å¤„ç†æ–°ç±»å‹ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰æ–‡æ¡£ç±»ã€‚è¿™ç§è‡ªä¸‹è€Œä¸Šçš„ä¾èµ–ç¬¦åˆæ¶æ„å±‚çº§åŸåˆ™â€”â€”ä½å±‚ç»„ä»¶å¯ä¾èµ–é«˜å±‚ç»„ä»¶ï¼Œåä¹‹åˆ™ä¸ç„¶ã€‚</p>
<hr>
<p><strong>ç¼–è¯‘æœŸæ‰©å±•æ€§</strong></p>
<p>æ‰©å±•æ€§è®¾è®¡åŒæ ·é€‚ç”¨äºç¼–è¯‘æœŸå¤šæ€ã€‚C++æ ‡å‡†åº“é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°æ‰©å±•æ€§ï¼š</p>
<p><strong>å‡½æ•°é‡è½½</strong>
<code>std::swap</code>å…è®¸ä¸ºè‡ªå®šä¹‰ç±»å‹ç‰¹åŒ–äº¤æ¢é€»è¾‘ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="n">custom</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CustomType</span> <span class="p">{</span> <span class="cm">/*...*/</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">swap</span><span class="p">(</span><span class="n">CustomType</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="n">CustomType</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* å®šåˆ¶å®ç° */</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä½¿ç”¨æ–¹å¼ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">;</span> <span class="c1">// å¯ç”¨ADLæŸ¥æ‰¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>      <span class="c1">// ä¼˜å…ˆè°ƒç”¨å®šåˆ¶ç‰ˆæœ¬
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>æ¨¡æ¿ä¸æ¦‚å¿µ</strong>
æ ‡å‡†ç®—æ³•ï¼ˆå¦‚<code>std::find</code>ï¼‰é€šè¿‡æ¨¡æ¿å‚æ•°æ¥å—è‡ªå®šä¹‰è¿­ä»£å™¨å’Œè°“è¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">InputIt</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">InputIt</span> <span class="n">find</span><span class="p">(</span><span class="n">InputIt</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIt</span> <span class="n">last</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">InputIt</span><span class="p">,</span> <span class="k">typename</span> <span class="n">UnaryPredicate</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">InputIt</span> <span class="n">find_if</span><span class="p">(</span><span class="n">InputIt</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIt</span> <span class="n">last</span><span class="p">,</span> <span class="n">UnaryPredicate</span> <span class="n">p</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>æ¨¡æ¿ç‰¹åŒ–</strong>
<code>std::hash</code>å…è®¸ä¸ºè‡ªå®šä¹‰ç±»å‹ç‰¹åŒ–å“ˆå¸Œè®¡ç®—ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">std</span><span class="o">::</span><span class="n">hash</span><span class="o">&lt;</span><span class="n">CustomType</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">size_t</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">CustomType</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="k">const</span> <span class="k">noexcept</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="cm">/* å®šåˆ¶å“ˆå¸Œè®¡ç®— */</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<p><strong>é¿å…è¿‡åº¦è®¾è®¡</strong></p>
<p>å°½ç®¡å¯æ‰©å±•æ€§è‡³å…³é‡è¦ï¼Œä½†éœ€è­¦æƒ•<strong>è¿‡æ—©æŠ½è±¡</strong>ã€‚éµå¾ªYAGNIï¼ˆYou Ain&rsquo;t Gonna Need Itï¼‰åŸåˆ™ï¼šè‹¥ä¸ç¡®å®šæœªæ¥éœ€æ±‚ï¼Œä¼˜å…ˆä¿æŒç®€å•ã€‚è¿‡åº¦è®¾è®¡å¯èƒ½å¯¼è‡´ï¼š</p>
<ul>
<li>ä¸å¿…è¦çš„å¤æ‚æ€§</li>
<li>é™åˆ¶æœªæ¥æ‰©å±•æ–¹å‘ï¼ˆå¦‚åé‡ç±»å‹æ‰©å±•å´é˜»ç¢æ“ä½œæ‰©å±•ï¼‰</li>
</ul>
<p><strong>å¹³è¡¡ç­–ç•¥ï¼š</strong></p>
<ul>
<li>æ˜ç¡®é¢„æœŸæ‰©å±•ç‚¹æ—¶ï¼Œé¢„å…ˆè®¾è®¡æ‰©å±•æ¥å£</li>
<li>ä¸ç¡®å®šæ—¶ï¼Œé€šè¿‡é‡æ„é€æ­¥å¼•å…¥æ‰©å±•æœºåˆ¶</li>
</ul>
<hr>
<p><strong>å‡†åˆ™5è¦ç‚¹</strong></p>
<p>âœ… <strong>æå€¡</strong></p>
<ul>
<li>é‡‡ç”¨å¼€æ”¾-å°é—­åŸåˆ™ï¼ˆOCPï¼‰ï¼Œé€šè¿‡åŸºç±»ã€æ¨¡æ¿ã€é‡è½½æˆ–ç‰¹åŒ–æ”¯æŒæ‰©å±•</li>
<li>è¯†åˆ«é¢„æœŸæ‰©å±•ç‚¹å¹¶è®¾è®¡æ˜“æ‰©å±•ç»“æ„</li>
</ul>
<p>âŒ <strong>é¿å…</strong></p>
<ul>
<li>ä¿®æ”¹ç°æœ‰ä»£ç å®ç°æ‰©å±•ï¼ˆè¿åOCPï¼‰</li>
<li>ä¸ç¡®å®šéœ€æ±‚æ—¶çš„è¿‡åº¦æŠ½è±¡</li>
</ul>
<p><strong>æ ¸å¿ƒæç¤º</strong>ï¼š
å¯æ‰©å±•æ€§æ˜¯å¯æŒç»­è½¯ä»¶çš„å…³é”®ã€‚é€šè¿‡åˆ†ç¦»å…³æ³¨ç‚¹ã€åˆç†ä½¿ç”¨å¤šæ€ä¸æ¨¡æ¿æœºåˆ¶ï¼Œæ„å»ºé€‚åº”æ¼”è¿›çš„ç³»ç»Ÿæ¶æ„ã€‚</p>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>ä¼˜å…ˆè®¾è®¡ä¾¿äºæ‰©å±•ä»£ç ã€‚</li>
<li>éµå®ˆå¼€æ”¾å°é—­åŸåˆ™ï¼ˆOCPï¼‰ï¼Œä½¿ä»£ç å¯¹æ‰©å±•å¼€æ”¾ï¼Œä½†å¯¹ä¿®æ”¹å…³é—­ã€‚</li>
<li>é€šè¿‡åŸºç±»ã€æ¨¡æ¿ã€å‡½æ•°é‡è½½æˆ–æ¨¡æ¿ç‰¹åŒ–æ¥è®¾è®¡ä»¥æ”¯æŒä»£ç æ·»åŠ ã€‚</li>
<li>å¦‚æœä½ ä¸ç¡®å®šä¸‹ä¸€ä¸ªæ·»åŠ æ˜¯ä»€ä¹ˆï¼Œè¯·é¿å…è¿‡æ—©æŠ½è±¡ã€‚</li>
</ul>
<h2 id="ç¬¬äºŒç« å»ºç«‹æŠ½è±¡çš„è‰ºæœ¯">ç¬¬äºŒç« ï¼šå»ºç«‹æŠ½è±¡çš„è‰ºæœ¯
</h2><p><strong>æŠ½è±¡åœ¨è½¯ä»¶è®¾è®¡ä¸æ¶æ„ä¸­çš„æ ¸å¿ƒåœ°ä½</strong></p>
<p>æŠ½è±¡æ˜¯è½¯ä»¶è®¾è®¡ä¸æ¶æ„çš„åŸºçŸ³ã€‚ä¼˜ç§€çš„æŠ½è±¡æ˜¯ç®¡ç†å¤æ‚æ€§çš„å…³é”®ï¼Œæ²¡æœ‰å®ƒä»¬ï¼Œè‰¯å¥½çš„è®¾è®¡ä¸åˆç†çš„æ¶æ„å°†æ— ä»è°ˆèµ·ã€‚ç„¶è€Œï¼Œæ„å»ºå¹¶æ­£ç¡®è¿ç”¨æŠ½è±¡ç»éæ˜“äº‹â€”â€”è¿™æ›´åƒæ˜¯ä¸€é—¨è‰ºæœ¯è€Œéç²¾ç¡®ç§‘å­¦ï¼Œå……æ»¡äº†ç²¾å¦™æƒè¡¡ã€‚æœ¬ç« å°†æ·±å…¥æ¢è®¨æŠ½è±¡çš„æœ¬è´¨åŠå…¶æ„å»ºä¹‹é“ã€‚</p>
<hr>
<p><strong>å‡†åˆ™6ï¼šéµå¾ªæŠ½è±¡çš„é¢„æœŸè¡Œä¸º</strong></p>
<p>æŠ½è±¡çš„æœ¬è´¨åœ¨äºè¡¨è¾¾ä¸€ç»„<strong>éœ€æ±‚ä¸å¥‘çº¦</strong>ã€‚æ¯ä¸ªæŠ½è±¡èƒŒåéƒ½éšå«äº†ç‰¹å®šçš„è¡Œä¸ºæ‰¿è¯ºï¼Œéµå¾ªè¿™äº›é¢„æœŸæ˜¯ç»´æŠ¤ç³»ç»Ÿä¸€è‡´æ€§çš„å…³é”®ã€‚æœ¬å‡†åˆ™å°†å¼•å…¥ <strong>é‡Œæ°æ›¿æ¢åŸåˆ™(LSP)</strong>ï¼Œé˜é‡Šä¸ºä½•å­ç±»å¿…é¡»å®Œå…¨éµå¾ªåŸºç±»çš„è¡Œä¸ºå¥‘çº¦ã€‚</p>
<p><strong>å‡†åˆ™7ï¼šç†è§£åŸºç±»ä¸æ¦‚å¿µçš„å…±æ€§</strong></p>
<p>ä½œä¸ºæœ€å¸¸ç”¨çš„ä¸¤ç§æŠ½è±¡æœºåˆ¶ï¼Œ<strong>åŸºç±»ï¼ˆç»§æ‰¿)</strong> ä¸  <strong>æ¦‚å¿µ(æ¨¡æ¿çº¦æŸ)</strong> åœ¨è¯­ä¹‰å±‚é¢å…·æœ‰æ·±å±‚ç›¸ä¼¼æ€§ã€‚äºŒè€…éƒ½èƒ½å®šä¹‰è¡Œä¸ºè§„èŒƒï¼Œä½†å®ç°æ–¹å¼è¿¥å¼‚ã€‚æœ¬å‡†åˆ™å°†å¯¹æ¯”äºŒè€…çš„å…±æ€§ä¸å·®å¼‚ï¼Œæ­ç¤ºæŠ½è±¡è¡¨è¾¾çš„æ™®é€‚è§„å¾‹ã€‚</p>
<p><strong>å‡†åˆ™8ï¼šæŠŠæ¡é‡è½½é›†åˆçš„è¯­ä¹‰å¥‘çº¦</strong></p>
<p>å‡½æ•°é‡è½½æ„æˆç¬¬ä¸‰ç§æŠ½è±¡å½¢å¼ã€‚æ¯ä¸ªé‡è½½å‡½æ•°éƒ½éœ€éµå¾ª<strong>é‡è½½é›†åˆçš„è¯­ä¹‰å¥‘çº¦</strong>ï¼Œå…¶è¡Œä¸ºå¿…é¡»æ»¡è¶³è°ƒç”¨æ–¹çš„ç»Ÿä¸€é¢„æœŸã€‚æœ¬å‡†åˆ™å°†æ‰©å±•LSPåŸåˆ™ï¼Œæ¢è®¨é‡è½½æœºåˆ¶ä¸­çš„è¡Œä¸ºä¸€è‡´æ€§è¦æ±‚ã€‚</p>
<p><strong>å‡†åˆ™9ï¼šå…³æ³¨æŠ½è±¡çš„æ‰€æœ‰æƒå½’å±</strong></p>
<p>ä»æ¶æ„è§†è§’çœ‹ï¼ŒæŠ½è±¡çš„<strong>æ‰€æœ‰æƒå½’å±</strong>ç›´æ¥å½±å“ç³»ç»Ÿç»“æ„ã€‚æœ¬å‡†åˆ™å¼•å…¥<strong>ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDIPï¼‰</strong>ï¼Œé˜æ˜å¦‚ä½•é€šè¿‡æŠ½è±¡å®ç°å±‚çº§è§£è€¦ã€‚ä»…å¼•å…¥æŠ½è±¡å¹¶ä¸è¶³å¤Ÿâ€”â€”å¿…é¡»ç¡®ä¿é«˜å±‚æ¨¡å—æ‹¥æœ‰æŠ½è±¡å®šä¹‰ï¼Œä½å±‚å®ç°ä¾èµ–é«˜å±‚æ¥å£ã€‚</p>
<p><strong>å‡†åˆ™10ï¼šæ„å»ºæ¶æ„è®¾è®¡æ–‡æ¡£</strong></p>
<p>æ¶æ„è®¾è®¡æ–‡æ¡£æ˜¯æŠ½è±¡ä½“ç³»çš„è“å›¾ã€‚æœ¬å‡†åˆ™å°†æ¢è®¨æ–‡æ¡£åŒ–çš„ä»·å€¼ï¼šæ˜ç¡®æŠ½è±¡è¾¹ç•Œã€è®°å½•è®¾è®¡å†³ç­–ã€ä¿ƒè¿›å›¢é˜Ÿå…±è¯†ã€‚å³ä½¿é‡‡ç”¨è½»é‡çº§å½¢å¼ï¼Œæ¶æ„æ–‡æ¡£ä¹Ÿèƒ½æ˜¾è‘—æå‡ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ä¸æ¼”è¿›èƒ½åŠ›ã€‚</p>
<hr>
<p>æŠ½è±¡æ„å»ºçš„è‰ºæœ¯åœ¨äºå¹³è¡¡è¡¨è¾¾åŠ›ä¸çº¦æŸåŠ›ã€‚é€šè¿‡è¿™äº”å¤§å‡†åˆ™ï¼Œæˆ‘ä»¬å°†é€æ­¥æŒæ¡å®šä¹‰ç²¾ç¡®å¥‘çº¦ã€ç®¡ç†ä¾èµ–æ–¹å‘ã€å®ç°å¯æŒç»­æ¼”è¿›çš„å®è·µæ–¹æ³•ã€‚æ¯ä¸€å±‚ç²¾å¿ƒè®¾è®¡çš„æŠ½è±¡ï¼Œéƒ½æ˜¯å¯¹æŠ—è½¯ä»¶ç†µå¢çš„åšå®å±éšœã€‚</p>
<hr>
<h3 id="å‡†åˆ™6éµå¾ªæŠ½è±¡çš„é¢„æœŸè¡Œä¸º">å‡†åˆ™6ï¼šéµå¾ªæŠ½è±¡çš„é¢„æœŸè¡Œä¸º
</h3><p>è§£è€¦è½¯ä»¶çš„æ ¸å¿ƒåœ¨äºå¼•å…¥æŠ½è±¡ï¼Œè€Œæ„å»ºè‰¯å¥½çš„æŠ½è±¡å´å……æ»¡æŒ‘æˆ˜ã€‚æœ¬èŠ‚é€šè¿‡ç»å…¸ç¤ºä¾‹æ­ç¤ºæŠ½è±¡è¡Œä¸ºé¢„æœŸçš„é‡è¦æ€§ï¼Œå¹¶é˜é‡Š <strong>é‡Œæ°æ›¿æ¢åŸåˆ™(LSP)</strong> çš„æ ¸å¿ƒè¦ä¹‰ã€‚</p>
<hr>
<p><strong>è¿åè¡Œä¸ºé¢„æœŸçš„å…¸å‹æ¡ˆä¾‹</strong></p>
<p>è€ƒè™‘ä¸€ä¸ª<code>Rectangle</code>åŸºç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Rectangle</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">Rectangle</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">getWidth</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>    
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">getHeight</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setWidth</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">setHeight</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">getArea</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">width</span><span class="p">;</span>    
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">height</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ä½œä¸ºåŸºç±»ï¼Œæä¾›è™šææ„å‡½æ•°ç¡®ä¿å¤šæ€æ­£ç¡®æ€§</li>
<li>åŒ…å«å®½é«˜å±æ€§å’Œå¯¹åº”çš„è®¿é—®/ä¿®æ”¹æ–¹æ³•</li>
<li><code>setWidth</code>ä¸<code>setHeight</code>å¯ç‹¬ç«‹ä¿®æ”¹ç»´åº¦</li>
<li><code>getArea</code>è¿”å›å®½é«˜ä¹˜ç§¯</li>
</ul>
<p>æ´¾ç”Ÿç±»<code>Square</code>ç»§æ‰¿<code>Rectangle</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Square</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Rectangle</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">setWidth</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">setHeight</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">getArea</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ•°å­¦ä¸Šæ­£æ–¹å½¢æ˜¯çŸ©å½¢ç‰¹ä¾‹ï¼Œä½†ä»£ç å®ç°éœ€ä¿æŒå®½é«˜ç›¸ç­‰</li>
<li>é‡å†™<code>setWidth</code>å’Œ<code>setHeight</code>åŒæ­¥ä¿®æ”¹å¦ä¸€ç»´åº¦</li>
</ul>
<p><strong>é—®é¢˜çˆ†å‘ç‚¹</strong>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">transform</span><span class="p">(</span><span class="n">Rectangle</span><span class="o">&amp;</span> <span class="n">rect</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">rect</span><span class="p">.</span><span class="n">setWidth</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>    
</span></span><span class="line"><span class="cl">    <span class="n">rect</span><span class="p">.</span><span class="n">setHeight</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">assert</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">getArea</span><span class="p">()</span> <span class="o">==</span> <span class="mi">28</span><span class="p">);</span> <span class="c1">// æ–­è¨€å¤±è´¥ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Square</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span><span class="p">.</span><span class="n">setWidth</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">transform</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>  <span class="c1">// ä¼ å…¥æ­£æ–¹å½¢å®ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>transform</code>å‡½æ•°é¢„æœŸç‹¬ç«‹ä¿®æ”¹å®½é«˜åé¢ç§¯ä¸º28</li>
<li>ä¼ å…¥<code>Square</code>æ—¶ï¼Œä¸¤æ¬¡setè°ƒç”¨å¼ºåˆ¶åŒæ­¥å®½é«˜ï¼Œå¯¼è‡´é¢ç§¯è®¡ç®—é”™è¯¯</li>
</ul>
<hr>
<p><strong>é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLSPï¼‰è¯¦è§£</strong></p>
<p>LSPè¦æ±‚å­ç±»å¿…é¡»å®Œå…¨éµå®ˆåŸºç±»çš„<strong>è¡Œä¸ºå¥‘çº¦</strong>ï¼Œå…·ä½“ä½“ç°ä¸ºï¼š</p>
<ol>
<li>
<p><strong>å‰ç½®æ¡ä»¶ä¸å¯å¼ºåŒ–</strong>
å­ç±»æ–¹æ³•ä¸èƒ½æ–½åŠ æ¯”åŸºç±»æ›´ä¸¥æ ¼çš„è¾“å…¥çº¦æŸ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// åŸºç±»æ¥å—i&gt;0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">virtual</span> <span class="kt">void</span> <span class="n">Base</span><span class="o">::</span><span class="n">f</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span> <span class="n">assert</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// é”™è¯¯ï¼šå­ç±»è¦æ±‚i&gt;10ï¼Œè¿åLSP
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="n">Derived</span><span class="o">::</span><span class="n">f</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span> <span class="n">assert</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">);</span> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>åç½®æ¡ä»¶ä¸å¯å¼±åŒ–</strong>
å­ç±»æ–¹æ³•éœ€æ»¡è¶³åŸºç±»æ‰¿è¯ºçš„è¾“å‡ºä¿è¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// åŸºç±»ä¿è¯è¿”å›æ­£å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">virtual</span> <span class="kt">int</span> <span class="n">Base</span><span class="o">::</span><span class="n">f</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="n">assert</span><span class="p">(</span><span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// é”™è¯¯ï¼šå­ç±»å¯èƒ½è¿”å›ä»»æ„å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">Derived</span><span class="o">::</span><span class="n">f</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="p">...</span> <span class="cm">/* æ— çº¦æŸ */</span> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>è¿”å›ç±»å‹åå˜(Covariant)</strong>
å­ç±»æ–¹æ³•å¯è¿”å› åŸºç±»è¿”å›ç±»å‹ çš„æ´¾ç”Ÿç±»</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Base</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Derived</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Base</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">virtual</span> <span class="n">Base</span><span class="o">*</span> <span class="n">Base</span><span class="o">::</span><span class="n">create</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">Derived</span><span class="o">*</span> <span class="n">Derived</span><span class="o">::</span><span class="n">create</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span> <span class="c1">// åˆæ³•åå˜
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>å‚æ•°ç±»å‹é€†å˜(Contravariant)</strong>
å­ç±»æ–¹æ³•åº”æ¥å—åŸºç±»å‚æ•°çš„è¶…ç±»å‹ï¼ˆC++è¯­æ³•ä¸æ”¯æŒï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">virtual</span> <span class="kt">void</span> <span class="n">Base</span><span class="o">::</span><span class="n">process</span><span class="p">(</span><span class="n">Derived</span><span class="o">*</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç†æƒ³æƒ…å†µï¼šå‚æ•°å¯ä¸ºBase*ï¼Œä½†C++ä¸å…è®¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="n">Derived</span><span class="o">::</span><span class="n">process</span><span class="p">(</span><span class="n">Base</span><span class="o">*</span> <span class="n">b</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span> 
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>ä¿æŒä¸å˜é‡(Invariants)</strong>
å­ç±»å¿…é¡»ç»´æŠ¤åŸºç±»å®šä¹‰çš„çŠ¶æ€çº¦æŸ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Base</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">protected</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">value_</span><span class="p">;</span> <span class="c1">// ä¸å˜é‡ï¼š1 &lt;= value_ &lt;= 10
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Derived</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Base</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Derived</span><span class="p">()</span> <span class="p">{</span> <span class="n">value_</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span> <span class="p">}</span> <span class="c1">// ç ´åä¸å˜é‡ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<hr>
<p><strong>å¯¹LSPçš„å¸¸è§è¯¯è§£ä¸è¯¯ç”¨</strong></p>
<ul>
<li>
<p><strong>æ•°å­¦IS-A â‰  ç¼–ç¨‹IS-A</strong>
å°½ç®¡å‡ ä½•å­¦ä¸­æ­£æ–¹å½¢å±äºçŸ©å½¢ï¼Œä½†ä»£ç ä¸­çš„è¡Œä¸ºå¥‘çº¦ç ´åä½¿ç»§æ‰¿å…³ç³»å¤±æ•ˆ</p>
</li>
<li>
<p><strong>åŠ¨æ€ç±»å‹æ£€æŸ¥æ˜¯è®¾è®¡å¼‚å‘³</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">process</span><span class="p">(</span><span class="n">Base</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">auto</span> <span class="n">d</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">Derived</span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ç‰¹æ®Šå¤„ç†Derivedç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å¸¸è§„å¤„ç†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ç§é’ˆå¯¹å…·ä½“å­ç±»çš„ç‰¹æ®Šå¤„ç†ï¼Œæš´éœ²æŠ½è±¡æ³„éœ²ï¼Œåº”è§†ä¸ºä¸¥é‡è®¾è®¡ç¼ºé™·</p>
</li>
</ul>
<hr>
<p><strong>æ„å»ºå¯é æŠ½è±¡çš„å…³é”®</strong></p>
<ol>
<li><strong>æ˜ç¡®å¥‘çº¦</strong>
é€šè¿‡ä»£ç æ³¨é‡Šã€æ–­è¨€æˆ–å¥‘çº¦ç¼–ç¨‹æ¡†æ¶ï¼ˆå¦‚C++20 Contractsï¼‰æ˜¾å¼å®šä¹‰å‰ç½®/åç½®æ¡ä»¶</li>
<li><strong>å°è£…ä¸å˜æ€§</strong>
é¿å…protectedæ•°æ®æˆå‘˜ï¼Œé€šè¿‡æ¥å£å¼ºåˆ¶çº¦æŸçŠ¶æ€æœ‰æ•ˆæ€§ï¼ˆéµå¾ªæ ¸å¿ƒå‡†åˆ™C.133ï¼‰</li>
<li><strong>è°¨æ…ä½¿ç”¨ç»§æ‰¿</strong>
ä¼˜å…ˆç»„åˆä¼˜äºç»§æ‰¿ï¼Œä»…åœ¨ä¸¥æ ¼æ»¡è¶³LSPæ—¶å»ºç«‹ç»§æ‰¿å±‚æ¬¡</li>
<li><strong>æ–‡æ¡£åŒ–é¢„æœŸ</strong>
å‚è€ƒC++æ ‡å‡†åº“å¯¹è¿­ä»£å™¨æ¦‚å¿µçš„è§„èŒƒï¼Œæ¸…æ™°æè¿°æŠ½è±¡çš„è¡Œä¸ºè¦æ±‚</li>
</ol>
<p><strong>å‡†åˆ™6è¦ç‚¹</strong>
âœ… <strong>éµå¾ª</strong></p>
<ul>
<li>å°†æŠ½è±¡è§†ä¸ºè¡Œä¸ºå¥‘çº¦é›†åˆ</li>
<li>é€šè¿‡LSPç¡®ä¿å­ç±»æ— ç¼æ›¿æ¢åŸºç±»</li>
<li>æ˜¾å¼å®šä¹‰å¹¶éªŒè¯å‰ç½®/åç½®æ¡ä»¶</li>
</ul>
<p>âŒ <strong>é¿å…</strong></p>
<ul>
<li>åŸºäºæ•°å­¦ç›´è§‰ç›²ç›®å»ºç«‹ç»§æ‰¿</li>
<li>åœ¨å­ç±»ä¸­å¼±åŒ–åç½®æ¡ä»¶æˆ–å¼ºåŒ–å‰ç½®æ¡ä»¶</li>
<li>é€šè¿‡è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥è§„é¿LSP</li>
</ul>
<p><strong>è®¾è®¡å¯ç¤º</strong>ï¼š
æŠ½è±¡æ˜¯è½¯ä»¶å·¥ç¨‹çš„åŸºçŸ³ï¼Œè€ŒLSPæ˜¯ç¡®ä¿æŠ½è±¡å¯é æ€§çš„æ ¸å¿ƒæœºåˆ¶ã€‚æ¯ä¸€æ¬¡ç»§æ‰¿å†³ç­–éƒ½åº”ä¼´éšå¯¹è¡Œä¸ºå¥‘çº¦çš„ä¸¥æ ¼éªŒè¯ï¼Œå”¯æœ‰å¦‚æ­¤ï¼Œæ‰èƒ½æ„å»ºå‡ºç»å¾—èµ·æ¼”è¿›çš„è½¯ä»¶ç³»ç»Ÿã€‚</p>
<h3 id="å‡†åˆ™7ç†è§£åŸºç±»ä¸æ¦‚å¿µçš„æ·±å±‚å…±æ€§">å‡†åˆ™7ï¼šç†è§£åŸºç±»ä¸æ¦‚å¿µçš„æ·±å±‚å…±æ€§
</h3><p>åœ¨å‡†åˆ™6ä¸­ï¼Œæˆ‘ä»¬èšç„¦äºç»§æ‰¿ä½“ç³»çš„è¡Œä¸ºå¥‘çº¦ï¼Œä½†é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLSPï¼‰çš„é€‚ç”¨èŒƒå›´è¿œä¸æ­¢äºæ­¤ã€‚</p>
<p>æœ¬èŠ‚å°†æ­ç¤º <strong>åŠ¨æ€å¤šæ€(åŸºç±»)</strong>  ä¸  <strong>é™æ€å¤šæ€(æ¦‚å¿µ)</strong> åœ¨æŠ½è±¡è¯­ä¹‰ä¸Šçš„æœ¬è´¨ç»Ÿä¸€ã€‚</p>
<hr>
<p><strong>åŠ¨æ€ä¸é™æ€æŠ½è±¡çš„è¯­ä¹‰å¯¹ç­‰æ€§</strong></p>
<p>å¯¹æ¯”ä¸¤ä¸ªä»£ç ç‰‡æ®µï¼š</p>
<p><strong>ç‰‡æ®µ1ï¼šåŸºäºç»§æ‰¿çš„åŠ¨æ€å¤šæ€</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Document</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">Document</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">exportToJSON</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">ByteStream</span><span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">useDocument</span><span class="p">(</span><span class="k">const</span> <span class="n">Document</span><span class="o">&amp;</span> <span class="n">doc</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">doc</span><span class="p">.</span><span class="n">exportToJSON</span><span class="p">();</span>  <span class="c1">// ä¾èµ–åŸºç±»æ¥å£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç‰‡æ®µ2ï¼šåŸºäºæ¦‚å¿µçš„é™æ€å¤šæ€</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">concept</span> <span class="n">Document</span> <span class="o">=</span> <span class="k">requires</span><span class="p">(</span><span class="n">T</span> <span class="n">t</span><span class="p">,</span> <span class="n">ByteStream</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">t</span><span class="p">.</span><span class="n">exportToJSON</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">t</span><span class="p">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="n">Document</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">useDocument</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">doc</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">doc</span><span class="p">.</span><span class="n">exportToJSON</span><span class="p">();</span>  <span class="c1">// ä¾èµ–æ¦‚å¿µçº¦æŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å…³é”®æ´å¯Ÿ</strong>ï¼š
ä¸¤æ®µä»£ç å‡è¦æ±‚<code>doc</code>å¯¹è±¡æ»¡è¶³<code>exportToJSON</code>å’Œ<code>serialize</code>çš„è¡Œä¸ºå¥‘çº¦ã€‚æ— è®ºé€šè¿‡è™šå‡½æ•°è¿˜æ˜¯æ¨¡æ¿æ¦‚å¿µï¼ŒæŠ½è±¡çš„æ ¸å¿ƒåœ¨äº<strong>å®šä¹‰é¢„æœŸè¡Œä¸ºé›†åˆ</strong>ã€‚åŸºç±»ä¸æ¦‚å¿µåœ¨æ­¤å±‚é¢å®ç°è¯­ä¹‰ç­‰ä»·ã€‚</p>
<hr>
<p><strong>C++æ¦‚å¿µçš„LSPå®è·µ</strong></p>
<p>ä»¥æ ‡å‡†åº“<code>std::copy</code>ç®—æ³•ä¸ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">InputIt</span><span class="p">,</span> <span class="k">typename</span> <span class="n">OutputIt</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">constexpr</span> <span class="n">OutputIt</span> <span class="n">copy</span><span class="p">(</span><span class="n">InputIt</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIt</span> <span class="n">last</span><span class="p">,</span> <span class="n">OutputIt</span> <span class="n">d_first</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="n">first</span> <span class="o">!=</span> <span class="n">last</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="n">d_first</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">first</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">d_first</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>InputIt</code>ä¸<code>OutputIt</code>è™½éC++20æ¦‚å¿µï¼Œä½†é€šè¿‡å‘½åæ¨¡æ¿å‚æ•°éšå«è¡Œä¸ºå¥‘çº¦ï¼š
<ul>
<li><code>InputIt</code>éœ€æ”¯æŒé€’å¢ã€è§£å¼•ç”¨åŠç»ˆæ­¢æ¡ä»¶åˆ¤æ–­</li>
<li><code>OutputIt</code>éœ€æ”¯æŒè§£å¼•ç”¨èµ‹å€¼ä¸é€’å¢</li>
</ul>
</li>
<li>ä»»ä½•ä¸æ»¡è¶³è¿™äº›éšå¼å¥‘çº¦çš„è¿­ä»£å™¨ç±»å‹å°†å¯¼è‡´ç®—æ³•å¤±æ•ˆï¼Œæ„æˆå¯¹LSPçš„è¿å</li>
</ul>
<p><strong>C++20æ¦‚å¿µçš„æ¼”è¿›</strong>ï¼š
æ ‡å‡†åº“é€šè¿‡åˆ†å±‚æ¦‚å¿µç²¾ç¡®å®šä¹‰è¿­ä»£å™¨è¦æ±‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">I</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">concept</span> <span class="n">input_or_output_iterator</span> <span class="o">=</span> <span class="cm">/*...*/</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">I</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">concept</span> <span class="n">input_iterator</span> <span class="o">=</span> 
</span></span><span class="line"><span class="cl">    <span class="n">input_or_output_iterator</span><span class="o">&lt;</span><span class="n">I</span><span class="o">&gt;</span> <span class="o">&amp;&amp;</span> <span class="cm">/* ç»†åŒ–è¦æ±‚ */</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">I</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">concept</span> <span class="n">forward_iterator</span> <span class="o">=</span> 
</span></span><span class="line"><span class="cl">    <span class="n">input_iterator</span><span class="o">&lt;</span><span class="n">I</span><span class="o">&gt;</span> <span class="o">&amp;&amp;</span> <span class="cm">/* æ–°å¢å‰å‘è¿­ä»£ç‰¹æ€§ */</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ç§åˆ†å±‚è®¾è®¡è·µè¡Œæ¥å£éš”ç¦»åŸåˆ™ï¼ˆISPï¼‰ï¼Œå…è®¸æŒ‰éœ€ç»„åˆæŠ½è±¡çº¦æŸã€‚</p>
<hr>
<p><strong>æ¦‚å¿µä½œä¸ºé™æ€æŠ½è±¡çš„è¯­ä¹‰è½½ä½“</strong></p>
<p>å°½ç®¡C++20æ¦‚å¿µæ— æ³•åœ¨è¯­æ³•å±‚é¢å¼ºåˆ¶è¯­ä¹‰ï¼Œä½†ä»é€šè¿‡ä»¥ä¸‹æ–¹å¼è¡¨è¾¾é¢„æœŸè¡Œä¸ºï¼š</p>
<ol>
<li><strong>æ“ä½œå¯è¡Œæ€§</strong>ï¼šé€šè¿‡<code>requires</code>å­å¥è§„å®šå¿…é¡»å­˜åœ¨çš„æˆå‘˜å‡½æ•°/æ“ä½œç¬¦</li>
<li><strong>è¡Œä¸ºçº¦å®š</strong>ï¼šä¾èµ–å‘½åçº¦å®šï¼ˆå¦‚<code>InputIt</code>æš—ç¤ºè¾“å…¥è¿­ä»£å™¨è¯­ä¹‰ï¼‰</li>
<li><strong>æ–‡æ¡£åŒ–å¥‘çº¦</strong>ï¼šæ ‡å‡†è§„èŒƒæ˜ç¡®æ¦‚å¿µçš„è¡Œä¸ºé¢„æœŸï¼ˆå¦‚è¿­ä»£å™¨æœ‰æ•ˆæ€§ä¿è¯ï¼‰</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼šè‡ªå®šä¹‰æ¦‚å¿µ</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">concept</span> <span class="n">Renderable</span> <span class="o">=</span> <span class="k">requires</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">obj</span><span class="p">,</span> <span class="n">RenderTarget</span><span class="o">&amp;</span> <span class="n">target</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="n">obj</span><span class="p">.</span><span class="n">render</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">same_as</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span><span class="p">;</span>  <span class="c1">// è¯­æ³•çº¦æŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// éšå«è¯­ä¹‰ï¼šrender()åº”å°†å¯¹è±¡ç»˜åˆ¶åˆ°targetä¸”æ— å‰¯ä½œç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨æ–¹ä»£ç å¯å®‰å…¨å‡å®šæ‰€æœ‰<code>Renderable</code>ç±»å‹éµå¾ªæ­¤å¥‘çº¦ã€‚</p>
<hr>
<p><strong>è®¾è®¡å¯ç¤º</strong></p>
<ol>
<li><strong>ç»Ÿä¸€è®¾è®¡åŸåˆ™</strong>
LSPé€‚ç”¨äºæ‰€æœ‰æŠ½è±¡å½¢å¼ï¼Œæ— è®ºåŠ¨æ€ï¼ˆè™šå‡½æ•°ï¼‰è¿˜æ˜¯é™æ€ï¼ˆæ¨¡æ¿/æ¦‚å¿µï¼‰ã€‚å­ç±»æˆ–æ¨¡æ¿å‚æ•°å¿…é¡»å®Œå…¨éµå®ˆæŠ½è±¡å±‚çš„è¡Œä¸ºçº¦å®šã€‚</li>
<li><strong>æ¦‚å¿µå³å¥‘çº¦</strong>
å°†C++20æ¦‚å¿µåŠä¼ ç»Ÿå‘½åæ¨¡æ¿å‚æ•°è§†ä¸ºç¼–è¯‘æœŸæ¥å£è§„èŒƒã€‚è®¾è®¡æ—¶åº”ï¼š
<ul>
<li>æ˜ç¡®æ¦‚å¿µçš„æœ€å°åŒ–çº¦æŸé›†åˆ</li>
<li>é€šè¿‡åˆ†å±‚ç»„åˆæ„å»ºå¤æ‚æŠ½è±¡ï¼ˆå¦‚è¿­ä»£å™¨ä½“ç³»ï¼‰</li>
<li>åœ¨æ–‡æ¡£ä¸­è¯¦è¿°è¯­ä¹‰é¢„æœŸ</li>
</ul>
</li>
<li><strong>é™æ€å¤šæ€çš„ä¼˜åŠ¿</strong>
ç›¸æ¯”ç»§æ‰¿ä½“ç³»ï¼Œæ¦‚å¿µæä¾›ï¼š
<ul>
<li>é›¶è¿è¡Œæ—¶å¼€é”€</li>
<li>æ›´å¼ºçš„ç±»å‹å®‰å…¨æ€§</li>
<li>å¯¹å€¼è¯­ä¹‰çš„åŸç”Ÿæ”¯æŒ</li>
</ul>
</li>
</ol>
<p><strong>å‡†åˆ™7è¦ç‚¹</strong>
âœ… <strong>å®è·µå»ºè®®</strong></p>
<ul>
<li>å°†LSPåŸåˆ™åŒæ­¥åº”ç”¨äºåŠ¨æ€ä¸é™æ€å¤šæ€è®¾è®¡</li>
<li>ä½¿ç”¨C++20æ¦‚å¿µæˆ–å‘½åæ¨¡æ¿å‚æ•°å®šä¹‰ç¼–è¯‘æœŸæŠ½è±¡</li>
<li>ä¸ºæ¯ä¸ªæ¦‚å¿µç¼–å†™æ¸…æ™°çš„è¡Œä¸ºå¥‘çº¦æ–‡æ¡£</li>
</ul>
<p>âŒ <strong>è§„é¿é™·é˜±</strong></p>
<ul>
<li>åœ¨æ¨¡æ¿ä»£ç ä¸­å¿½ç•¥è¯­ä¹‰çº¦æŸï¼ˆå¦‚å‡å®š<code>operator++</code>å¿…ç„¶å‰è¿›ï¼‰</li>
<li>åˆ›å»º&quot;å·¨æ— éœ¸&quot;æ¦‚å¿µï¼ˆè¿åæ¥å£éš”ç¦»åŸåˆ™ï¼‰</li>
</ul>
<p><strong>æ ¸å¿ƒæ€ç»´</strong>ï¼š
æŠ½è±¡çš„æœ¬è´¨æ˜¯è¡Œä¸ºå¥‘çº¦çš„å…·è±¡åŒ–ã€‚æ— è®ºæ˜¯è¿è¡Œæ—¶é€šè¿‡è™šå‡½æ•°åˆ†å‘ï¼Œè¿˜æ˜¯ç¼–è¯‘æœŸé€šè¿‡æ¦‚å¿µçº¦æŸï¼Œå¯¹å¥‘çº¦çš„å¿ è¯šåº¦å†³å®šç³»ç»Ÿçš„å¥å£®æ€§ã€‚é¢†æ‚Ÿè¿™ä¸€å…±æ€§ï¼Œæ–¹èƒ½æ¸¸åˆƒäºå¤šèŒƒå¼è®¾è®¡ä¹‹é—´ã€‚</p>
<h3 id="å‡†åˆ™8ç†è§£é‡è½½é›†åˆçš„è¯­ä¹‰è¦æ±‚">å‡†åˆ™8ï¼šç†è§£é‡è½½é›†åˆçš„è¯­ä¹‰è¦æ±‚
</h3><p>åœ¨å‡†åˆ™6ä¸­ï¼Œæˆ‘ä»¬å¼ºè°ƒæŠ½è±¡å±‚çš„è¡Œä¸ºå¥‘çº¦é‡è¦æ€§ã€‚</p>
<p>æœ¬èŠ‚å°†æ­ç¤º<strong>å‡½æ•°é‡è½½</strong>è¿™ä¸€ç¼–è¯‘æ—¶æŠ½è±¡æœºåˆ¶å¦‚ä½•æ‰¿è½½è¯­ä¹‰è¦æ±‚ï¼Œä»¥åŠè¿åè¿™äº›è¦æ±‚å¯èƒ½å¼•å‘çš„è®¾è®¡é£é™©ã€‚</p>
<hr>
<p><strong>è‡ªç”±å‡½æ•°çš„æŠ½è±¡åŠ›é‡</strong></p>
<p>ä»¥æ ‡å‡†åº“çš„<code>begin()</code>/<code>end()</code>ä¸ºä¾‹ï¼Œ<strong>éæˆå‘˜å‡½æ•°é‡è½½</strong>å±•ç°å‡ºç‹¬ç‰¹çš„ä¼˜åŠ¿ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Range</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">traverseRange</span><span class="p">(</span><span class="k">const</span> <span class="n">Range</span><span class="o">&amp;</span> <span class="n">range</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">begin</span><span class="p">;</span>  <span class="c1">// å¯ç”¨ADLçš„å‚æ•°ä¾èµ–æŸ¥æ‰¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">end</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">begin</span><span class="p">(</span><span class="n">range</span><span class="p">);</span> <span class="n">pos</span> <span class="o">!=</span> <span class="n">end</span><span class="p">(</span><span class="n">range</span><span class="p">);</span> <span class="o">++</span><span class="n">pos</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// éå†é€»è¾‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>éä¾µå…¥å¼æ‰©å±•</strong>ï¼šæ— éœ€ä¿®æ”¹å®¹å™¨ç±»å³å¯ä¸ºå†…ç½®æ•°ç»„æ·»åŠ è¿­ä»£æ”¯æŒ</li>
<li><strong>å¼€æ”¾å°é—­åŸåˆ™</strong>ï¼šé€šè¿‡æ–°å¢è‡ªç”±å‡½æ•°æ‰©å±•åŠŸèƒ½ï¼Œæ— éœ€æ”¹åŠ¨ç°æœ‰ä»£ç </li>
<li><strong>é€šç”¨æ€§æå‡</strong>ï¼šæ”¯æŒæ‰€æœ‰æä¾›<code>begin</code>/<code>end</code>é‡è½½çš„ç±»å‹ï¼ˆåŒ…æ‹¬ç¬¬ä¸‰æ–¹åº“ï¼‰</li>
</ul>
<p><strong>å¯¹æ¯”æˆå‘˜å‡½æ•°å±€é™</strong>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// ä¼ ç»Ÿæˆå‘˜å‡½æ•°å®ç°ï¼ˆä»…æ”¯æŒç‰¹å®šå®¹å™¨ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">traverseMember</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;</span> <span class="n">vec</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">it</span> <span class="o">=</span> <span class="n">vec</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">vec</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// éå†é€»è¾‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>æ— æ³•å¤„ç†å†…ç½®æ•°ç»„æˆ–è‡ªå®šä¹‰å®¹å™¨ç±»å‹</li>
<li>è¿åå¼€æ”¾å°é—­åŸåˆ™ï¼Œæ–°å¢å®¹å™¨éœ€ä¿®æ”¹éå†é€»è¾‘</li>
</ul>
<hr>
<p><strong>é‡è½½é›†åˆçš„éšå¼å¥‘çº¦</strong></p>
<p>ä»¥<code>swap</code>å‡½æ•°ä¸ºä¾‹ï¼Œä¸å½“å®ç°å°†å¼•å‘ç¾éš¾ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Widget</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// é”™è¯¯ï¼šä»…äº¤æ¢éƒ¨åˆ†æˆå‘˜å˜é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">swap</span><span class="p">(</span><span class="n">Widget</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="n">Widget</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">i</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">i</span><span class="p">);</span>  <span class="c1">// å¿½ç•¥jçš„äº¤æ¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä½¿ç”¨æ–¹ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Widget</span> <span class="n">x</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">},</span> <span class="n">y</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">22</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// é¢„æœŸï¼šx=(2,22), y=(1,11)
</span></span></span><span class="line"><span class="cl"><span class="c1">// å®é™…ï¼šx=(2,11), y=(1,22) â†’ è¿åè¡Œä¸ºå¥‘çº¦ï¼
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>è¯­ä¹‰é¢„æœŸ</strong>ï¼š<code>swap</code>åº”äº¤æ¢å¯¹è±¡<strong>å…¨éƒ¨å¯è§‚å¯ŸçŠ¶æ€</strong></li>
<li><strong>è¿ååæœ</strong>ï¼šè°ƒç”¨æ–¹æ— æ³•æ­£ç¡®æ¨ç†ç¨‹åºè¡Œä¸ºï¼Œå¯¼è‡´éšè”½ç¼ºé™·</li>
</ul>
<hr>
<p><strong>é‡è½½å‘½åçš„æ ¸å¿ƒå‡†åˆ™</strong></p>
<ol>
<li>
<p><strong>è¯­ä¹‰ä¸€è‡´æ€§åŸåˆ™</strong></p>
<ul>
<li>
<p><strong>C.162</strong>ï¼šå¯¹è¯­ä¹‰ç­‰ä»·çš„æ“ä½œè¿›è¡Œé‡è½½</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// æ­£ç¡®ï¼šæä¾›å¤šç§æ„é€ æ–¹å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">File</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">File</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">path</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="n">File</span><span class="p">(</span><span class="n">FILE</span><span class="o">*</span> <span class="n">handle</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>C.163</strong>ï¼šé¿å…å¯¹è¯­ä¹‰ä¸åŒçš„æ“ä½œä½¿ç”¨ç›¸åŒåç§°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// é”™è¯¯ï¼šfindå¯èƒ½æš—ç¤ºçº¿æ€§æœç´¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Range</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">binary_find</span><span class="p">(</span><span class="n">Range</span><span class="o">&amp;&amp;</span> <span class="n">r</span><span class="p">,</span> <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">);</span>  <span class="c1">// åº”å‘½åä¸ºbinary_search
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p><strong>æ ‡å‡†åº“å‘½åçº¦å®š</strong></p>
<ul>
<li><code>begin()</code>/<code>end()</code>å¿…é¡»è¿”å›å¯éå†çš„è¿­ä»£å™¨å¯¹</li>
<li><code>size()</code>åº”è¿”å›å…ƒç´ æ•°é‡ï¼Œè€Œéå­—èŠ‚å¤§å°</li>
<li><code>find()</code>é»˜è®¤è¡¨ç¤ºçº¿æ€§æŸ¥æ‰¾ï¼Œæœ‰åºæŸ¥æ‰¾éœ€ä½¿ç”¨<code>lower_bound</code>ç­‰</li>
</ul>
</li>
</ol>
<hr>
<p><strong>é‡è½½è®¾è®¡çš„å®è·µè¦ç‚¹</strong></p>
<p>âœ… <strong>æ­£ç¡®å®è·µ</strong></p>
<ul>
<li>éµå®ˆç°æœ‰é‡è½½é›†åˆçš„è¯­ä¹‰çº¦å®šï¼ˆå¦‚<code>std::swap</code>çš„å…¨çŠ¶æ€äº¤æ¢ï¼‰</li>
<li>é€šè¿‡ADLå®ç°éä¾µå…¥å¼æ‰©å±•</li>
<li>ä¸ºè‡ªå®šä¹‰ç±»å‹æä¾›æ ‡å‡†æ¥å£é‡è½½ï¼ˆå¦‚<code>begin</code>/<code>end</code>æ”¯æŒèŒƒå›´forå¾ªç¯ï¼‰</li>
</ul>
<p>âŒ <strong>è§„é¿é™·é˜±</strong></p>
<ul>
<li>åœ¨é‡è½½å‡½æ•°ä¸­å®ç°ä¸å‘½åä¸ç¬¦çš„è¡Œä¸ºï¼ˆå¦‚<code>sort</code>ä¸ä¿è¯ç¨³å®šæ€§ï¼‰</li>
<li>å¿½ç•¥å‚æ•°ä¾èµ–æŸ¥æ‰¾ï¼ˆADLï¼‰å¯¼è‡´è‡ªå®šä¹‰ç±»å‹æ— æ³•è¢«é€šç”¨ç®—æ³•è¯†åˆ«</li>
<li>æ»¥ç”¨é‡è½½å¯¼è‡´æ¥å£è¯­ä¹‰æ¨¡ç³Šï¼ˆå¦‚<code>process()</code>æ—¢å¤„ç†æ•°æ®åˆç®¡ç†èµ„æºï¼‰</li>
</ul>
<hr>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>å‡½æ•°é‡è½½æ˜¯ç¼–è¯‘æ—¶å¤šæ€çš„é‡è¦å½¢å¼ï¼Œæ‰¿è½½éšå¼è¡Œä¸ºå¥‘çº¦</li>
<li>é‡è½½å‘½åå¿…é¡»ä¼ é€’å‡†ç¡®è¯­ä¹‰ï¼Œéµå¾ªæ—¢æœ‰çº¦å®š</li>
<li>ä»»ä½•å¯¹é‡è½½é›†åˆçš„æ‰©å±•éƒ½éœ€ä¸¥æ ¼éµå¾ªLSPåŸåˆ™</li>
<li>è‡ªç”±å‡½æ•°é‡è½½æ˜¯å®ç°å¼€æ”¾å°é—­åŸåˆ™çš„åˆ©å™¨ï¼Œä½†éœ€è°¨æ…ç»´æŠ¤è¯­ä¹‰ä¸€è‡´æ€§</li>
</ul>
<h3 id="å‡†åˆ™9å…³æ³¨æŠ½è±¡çš„æ‰€æœ‰æƒå½’å±">å‡†åˆ™9ï¼šå…³æ³¨æŠ½è±¡çš„æ‰€æœ‰æƒå½’å±
</h3><p>åœ¨è½¯ä»¶æ¶æ„ä¸­ï¼ŒæŠ½è±¡çš„<strong>æ‰€æœ‰æƒå½’å±</strong>ç›´æ¥å½±å“ç³»ç»Ÿä¾èµ–æ–¹å‘ã€‚æœ¬èŠ‚é€šè¿‡ç»å…¸æ¡ˆä¾‹æ­ç¤º <strong>ä¾èµ–å€’ç½®åŸåˆ™(DIP)</strong> çš„æ ¸å¿ƒå®è·µï¼šé€šè¿‡é«˜å±‚æŒæ§æŠ½è±¡å®šä¹‰ï¼Œå®ç°æ¶æ„çº§è§£è€¦ã€‚</p>
<hr>
<p><strong>ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDIPï¼‰ç²¾è¦</strong></p>
<p><strong>æ ¸å¿ƒä¸»å¼ </strong>ï¼š</p>
<ol>
<li><strong>é«˜å±‚æ¨¡å—ä¸åº”ä¾èµ–ä½å±‚æ¨¡å—</strong>ï¼Œä¸¤è€…éƒ½åº”ä¾èµ–æŠ½è±¡</li>
<li><strong>æŠ½è±¡ä¸åº”ä¾èµ–ç»†èŠ‚</strong>ï¼Œç»†èŠ‚åº”ä¾èµ–æŠ½è±¡</li>
</ol>
<p><strong>ATMç³»ç»Ÿåä¾‹å‰–æ</strong>ï¼š</p>
<ul>
<li><strong>é—®é¢˜</strong>ï¼šå­˜æ¬¾ã€å–æ¬¾ã€è½¬è´¦ç­‰äº¤æ˜“ç±»ç›´æ¥è°ƒç”¨<code>UI</code>ç±»çš„å…·ä½“æ–¹æ³•ï¼ˆå¦‚<code>requestDepositAmount()</code>ï¼‰</li>
<li><strong>åæœ</strong>ï¼šæ–°å¢VIPå¿«é€Ÿè½¬è´¦åŠŸèƒ½éœ€ä¿®æ”¹<code>UI</code>ç±»ï¼Œå¯¼è‡´æ‰€æœ‰äº¤æ˜“ç±»é‡æ–°ç¼–è¯‘ï¼Œè¿åå¼€æ”¾å°é—­åŸåˆ™</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>ä¸ºæ¯ä¸ªäº¤æ˜“å®šä¹‰ä¸“å±æ¥å£ï¼ˆå¦‚<code>DepositUI</code>ï¼‰</li>
<li>å°†æ¥å£å£°æ˜ç½®äº<strong>é«˜å±‚æ¨¡å—</strong>ï¼ˆäº¤æ˜“é€»è¾‘å±‚ï¼‰</li>
<li>å…·ä½“<code>UI</code>å®ç°ç»§æ‰¿é«˜å±‚æ¥å£ï¼Œå½¢æˆè‡ªä¸‹è€Œä¸Šçš„ä¾èµ–</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;é«˜å±‚/DepositUI.h&gt; ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">DepositUI</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">int</span> <span class="n">requestAmount</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">confirm</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;ä½å±‚/ConsoleUI.h&gt; ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;é«˜å±‚/DepositUI.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">ConsoleDepositUI</span> <span class="o">:</span> <span class="k">public</span> <span class="n">DepositUI</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">requestAmount</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="cm">/* æ§åˆ¶å°è¾“å…¥é€»è¾‘ */</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">confirm</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="cm">/* ç¡®è®¤æç¤º */</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<p><strong>æ’ä»¶æ¶æ„çš„æ­£å‘è®¾è®¡</strong></p>
<p><strong>é”™è¯¯æ¨¡å¼</strong>ï¼š</p>
<ul>
<li>ç¼–è¾‘å™¨<code>Editor</code>ç›´æ¥å¼•ç”¨<code>VimModePlugin</code>ç±»</li>
<li><strong>ç¼ºé™·</strong>ï¼šæ¯æ–°å¢æ’ä»¶éœ€ä¿®æ”¹ç¼–è¾‘å™¨ä»£ç ï¼Œæ— æ³•æ‰©å±•</li>
</ul>
<p><strong>æ­£ç¡®å®è·µ</strong>ï¼š</p>
<p><strong>é«˜å±‚å®šä¹‰æ’ä»¶æ¥å£</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;ç¼–è¾‘å™¨/Plugin.h&gt; ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Plugin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">activate</span><span class="p">(</span><span class="n">Editor</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">deactivate</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ä½å±‚å®ç°å…·ä½“æ’ä»¶</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;ç¬¬ä¸‰æ–¹/VimModePlugin.h&gt; ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;ç¼–è¾‘å™¨/Plugin.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">VimModePlugin</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Plugin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">activate</span><span class="p">(</span><span class="n">Editor</span><span class="o">&amp;</span> <span class="n">e</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span> <span class="cm">/* Vimæ¨¡å¼æ¿€æ´»é€»è¾‘ */</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">deactivate</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="cm">/* æ¸…ç†èµ„æº */</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¼–è¾‘å™¨ä»…ä¾èµ–æŠ½è±¡æ¥å£</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;ç¼–è¾‘å™¨/Editor.h&gt; ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Plugin.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">Editor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Plugin</span><span class="o">*&gt;</span> <span class="n">plugins</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">addPlugin</span><span class="p">(</span><span class="n">Plugin</span><span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span> <span class="n">plugins</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<p><strong>æ¨¡æ¿ä¸é‡è½½çš„ä¾èµ–å€’ç½®</strong></p>
<p><strong>STLç®—æ³•èŒƒä¾‹</strong>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">InputIt</span><span class="p">,</span> <span class="k">typename</span> <span class="n">OutputIt</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">copy</span><span class="p">(</span><span class="n">InputIt</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIt</span> <span class="n">last</span><span class="p">,</span> <span class="n">OutputIt</span> <span class="n">d_first</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="n">first</span> <span class="o">!=</span> <span class="n">last</span><span class="p">)</span> <span class="o">*</span><span class="n">d_first</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">first</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>å€’ç½®é€»è¾‘</strong>ï¼šç®—æ³•å®šä¹‰<code>InputIt</code>/<code>OutputIt</code>æ¦‚å¿µï¼ˆé«˜å±‚çº¦æŸï¼‰ï¼Œå®¹å™¨è¿­ä»£å™¨ï¼ˆä½å±‚ï¼‰éœ€æ»¡è¶³è¿™äº›æ¦‚å¿µ</li>
<li><strong>ä¾èµ–æ–¹å‘</strong>ï¼šå®¹å™¨å®ç°ä¾èµ–STLç®—æ³•å®šä¹‰çš„æ ‡å‡†ï¼Œè€Œéåä¹‹</li>
</ul>
<p><strong>swapé‡è½½å®ç°</strong>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Widget</span> <span class="p">{</span> <span class="n">T</span> <span class="n">value</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">swap</span><span class="p">(</span><span class="n">Widget</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="n">Widget</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">value</span><span class="p">);</span> <span class="c1">// ä¾èµ–ç±»å‹Tçš„swapå®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>å¥‘çº¦ä¼ é€’</strong>ï¼š<code>Widget</code>çš„swapè¡Œä¸ºä¾èµ–<code>T</code>ç±»å‹çš„swapå®ç°ï¼Œæ‰€æœ‰ç›¸å…³æ–¹éµå¾ªåŒä¸€å¥—äº¤æ¢è¯­ä¹‰</li>
</ul>
<hr>
<p><strong>è®¾è®¡å¯ç¤º</strong></p>
<p>âœ… <strong>æ­£ç¡®å®è·µ</strong></p>
<ul>
<li>å°†å…³é”®æŠ½è±¡æ¥å£ç½®äºæ¶æ„é«˜å±‚ï¼ˆå¦‚æ ¸å¿ƒä¸šåŠ¡æ¨¡å—ï¼‰</li>
<li>ä½å±‚æ¨¡å—é€šè¿‡å®ç°é«˜å±‚æ¥å£å»ºç«‹ä¾èµ–</li>
<li>ä½¿ç”¨æ¨¡æ¿çº¦æŸæ—¶ï¼Œåœ¨é«˜å±‚å®šä¹‰æ¦‚å¿µè¦æ±‚</li>
</ul>
<p>âŒ <strong>è§„é¿é™·é˜±</strong></p>
<ul>
<li>è®©å…·ä½“å®ç°æ¨¡å—å®šä¹‰æŠ½è±¡æ¥å£ï¼ˆå¯¼è‡´åå‘ä¾èµ–ï¼‰</li>
<li>åœ¨ä½å±‚æ¨¡å—é—´å…±äº«æŠ½è±¡æ¥å£ï¼ˆå¼•å‘æ¨ªå‘è€¦åˆï¼‰</li>
</ul>
<p><strong>æ ¸å¿ƒå…¬å¼</strong>ï¼š
<strong>æŠ½è±¡æ‰€æœ‰æƒ == æ¶æ„æ§åˆ¶æƒ</strong>
æŒæ¡æŠ½è±¡å®šä¹‰æƒï¼Œæ–¹èƒ½æŒæ§ä¾èµ–æ–¹å‘ï¼Œæ„å»ºå¯æŒç»­æ¼”è¿›çš„ç³»ç»Ÿæ¶æ„ã€‚</p>
<h3 id="å‡†åˆ™10å»ºè®®åˆ›å»ºæ¶æ„è®¾è®¡æ–‡æ¡£">å‡†åˆ™10ï¼šå»ºè®®åˆ›å»ºæ¶æ„è®¾è®¡æ–‡æ¡£
</h3><p>è®©æˆ‘ä»¬èŠèŠä½ çš„è½¯ä»¶æ¶æ„ã€‚</p>
<p>å…ˆé—®ä¸€ä¸ªç®€å•çš„é—®é¢˜ï¼š<strong>ä½ æ˜¯å¦æœ‰æ¶æ„è®¾è®¡æ–‡æ¡£</strong>ï¼Ÿè¿™ä»½æ–‡æ¡£æ˜¯å¦æ¸…æ™°æè¿°äº†ç³»ç»Ÿæ ¸å¿ƒæ¨¡å—ã€æ¶æ„å±‚çº§åŠä¾èµ–å…³ç³»ï¼Ÿ</p>
<p>å¦‚æœä½ çš„å›ç­”æ˜¯è‚¯å®šçš„ï¼Œè¯·è·³è¿‡æœ¬å‡†åˆ™ã€‚</p>
<p>è‹¥ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œè¯·ç»§ç»­æ€è€ƒä»¥ä¸‹é—®é¢˜ï¼šä½ æ˜¯å¦å»ºç«‹äº†æŒç»­é›†æˆï¼ˆCIï¼‰ç¯å¢ƒï¼Ÿæ˜¯å¦ä½¿ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Ÿæ˜¯å¦åº”ç”¨é™æ€ä»£ç åˆ†æå·¥å…·ï¼Ÿå¦‚æœè¿™äº›éƒ½å·²å®ç°ï¼Œè¯´æ˜ä½ çš„å·¥ç¨‹åŸºç¡€è‰¯å¥½ï¼Œä½†ä¸ºä½•ç‹¬ç¼ºæ¶æ„æ–‡æ¡£ï¼Ÿ</p>
<p>&ldquo;ä½•å¿…å°é¢˜å¤§åšï¼Ÿæ²¡æœ‰æ¶æ„æ–‡æ¡£å¤©åˆä¸ä¼šå¡Œï¼æˆ‘ä»¬é‡‡ç”¨æ•æ·å¼€å‘ï¼Œéšæ—¶å¯ä»¥è°ƒæ•´ï¼&quot;â€”â€”è‹¥è¿™æ˜¯ä½ çš„å¿ƒå£°ï¼Œè¯·å®¹æˆ‘æŒ‡å‡ºä¸€ä¸ªå¸¸è§çš„è®¤çŸ¥è¯¯åŒºï¼Œæ•æ·æ–¹æ³•çš„æœ¬è´¨æ˜¯å¿«é€Ÿè·å–åé¦ˆ <strong>ï¼Œè€Œéçºµå®¹æ— åºä¿®æ”¹ã€‚æŒç»­é›†æˆã€æµ‹è¯•é©±åŠ¨å¼€å‘ç­‰æŠ€æœ¯å®è·µç¡®å®èƒ½å¿«é€Ÿæš´éœ²é—®é¢˜ï¼Œä½†æ¶æ„è´¨é‡å†³å®šäº†ä¿®æ”¹çš„éš¾æ˜“ç¨‹åº¦</strong> ã€‚</p>
<p>ä¼˜ç§€çš„æ¶æ„è®¾è®¡å¦‚åŒç²¾å¯†çš„åŸå¸‚ç®¡ç½‘ç³»ç»Ÿï¼Œèƒ½è®©å˜æ›´å¦‚åŒæ›´æ¢è·¯ç¯èˆ¬ä»å®¹ï¼Œè€ŒéåŠ¨è¾„&quot;å¼€è†›ç ´è‚š&rdquo;ã€‚</p>
<p><strong>æ¶æ„æ–‡æ¡£çš„æ ¸å¿ƒä»·å€¼</strong></p>
<p>è½¯ä»¶å¤§å¸ˆRalph Johnsonçš„æ´è§æ­ç¤ºäº†æ¶æ„çš„æœ¬è´¨ï¼š</p>
<blockquote>
<p>æˆåŠŸçš„è½¯ä»¶é¡¹ç›®ä¸­ï¼Œæ ¸å¿ƒå¼€å‘è€…å¯¹ç³»ç»Ÿè®¾è®¡æœ‰ç€å…±åŒè®¤çŸ¥ï¼Œè¿™ç§å…±è¯†å³æ¶æ„ã€‚</p>
</blockquote>
<p>è¯•æƒ³è¿™æ ·çš„åœºæ™¯ï¼š</p>
<ul>
<li>å›¢é˜Ÿæ–°æˆå‘˜æ˜¯å¦å‡†ç¡®ç†è§£ç°æœ‰æ¶æ„ï¼Ÿ</li>
<li>èµ„æ·±å·¥ç¨‹å¸ˆç¦»èŒæ˜¯å¦å¯¼è‡´æ¶æ„æ™ºæ…§æµå¤±ï¼Ÿ</li>
<li>å„æ¨¡å—è´Ÿè´£äººæ˜¯å¦å¯¹ç³»ç»Ÿæ¼”è¿›æ–¹å‘è¾¾æˆå…±è¯†ï¼Ÿ</li>
</ul>
<p>æ²¡æœ‰ä¹¦é¢åŒ–çš„æ¶æ„æ–‡æ¡£ï¼Œè¿™äº›é—®é¢˜çš„ç­”æ¡ˆå¾€å¾€ä»¤äººä¸å®‰ï¼Œå°±åƒå»ºç­‘å·¥åœ°æ²¡æœ‰è®¾è®¡è“å›¾ï¼Œä¸åŒå·¥ç§çš„å·¥äººå¯¹&quot;å·¦ä¾§è½¦åº“&quot;çš„ç†è§£å¯èƒ½å—è¾•åŒ—è¾™ã€‚</p>
<p>æ¶æ„æ–‡æ¡£æ­£æ˜¯å›¢é˜Ÿçš„&quot;è®¤çŸ¥é”šç‚¹&quot;ï¼Œç¡®ä¿æ‰€æœ‰äººæœç€åŒä¸€ç›®æ ‡å‰è¿›ã€‚</p>
<p><strong>æ¶æ„æ–‡æ¡£çš„å®è·µæ™ºæ…§</strong></p>
<p><strong>ç ´é™¤ä¸¤å¤§è¿·æ€</strong>ï¼š</p>
<ol>
<li><strong>æ–‡æ¡£å¿…ç„¶è¿‡æ—¶</strong>
èšç„¦å®è§‚è®¾è®¡è€Œéå®ç°ç»†èŠ‚ï¼šè®°å½•æ¨¡å—åˆ’åˆ†ã€é€šä¿¡æœºåˆ¶ã€å…³é”®æŠ€æœ¯é€‰å‹ç­‰ç¨³å®šè¦ç´ ï¼Œé¿å…é™·å…¥APIå‚æ•°ä¹‹ç±»çš„æ˜“å˜ç»†èŠ‚ã€‚å°±åƒåŸå¸‚åœ°å›¾æ— éœ€æ ‡æ³¨æ¯é—´å•†é“ºï¼Œä½†å¿…é¡»æ¸…æ™°å±•ç°ä¸»å¹²é“å’ŒåŠŸèƒ½åŒºã€‚</li>
<li><strong>ç¼–å†™æˆæœ¬é«˜æ˜‚</strong>
é‡‡ç”¨æ¸è¿›å¼æ„å»ºï¼š
<ul>
<li><strong>åˆå§‹é˜¶æ®µ</strong>ï¼šç”¨1é¡µå›¾æ–‡æè¿°æ ¸å¿ƒæ¨¡å—ä¸æ•°æ®æµå‘</li>
<li><strong>è¿­ä»£è¿‡ç¨‹</strong>ï¼šé€šè¿‡æ¶æ„è¯„å®¡ä¼šè®®é€æ­¥è¡¥å……è®¾è®¡å†³ç­–</li>
<li><strong>ç»´æŠ¤ç­–ç•¥</strong>ï¼šæ¯åŒå‘¨ç”±æŠ€æœ¯è´Ÿè´£äººåŒæ­¥æ›´æ–°å…³é”®å˜æ›´</li>
</ul>
</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼šå¾®æœåŠ¡æ¶æ„æ–‡æ¡£æ¡†æ¶</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-tex" data-lang="tex"><span class="line"><span class="cl"># ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ
</span></span><span class="line"><span class="cl">## æ ¸å¿ƒæœåŠ¡
</span></span><span class="line"><span class="cl">- è®¢å•æœåŠ¡ï¼šå¤„ç†äº¤æ˜“ç”Ÿå‘½å‘¨æœŸï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰
</span></span><span class="line"><span class="cl">- åº“å­˜æœåŠ¡ï¼šé‡‡ç”¨äº‹ä»¶æº¯æºæ¨¡å¼ç®¡ç†åº“å­˜
</span></span><span class="line"><span class="cl">- æ”¯ä»˜æœåŠ¡ï¼šé€šè¿‡é€‚é…å™¨æ¨¡å¼é›†æˆç¬¬ä¸‰æ–¹æ”¯ä»˜ç½‘å…³
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## é€šä¿¡æœºåˆ¶
</span></span><span class="line"><span class="cl">![æ¶æ„æ‹“æ‰‘å›¾]
</span></span><span class="line"><span class="cl">- æœåŠ¡é—´é€šä¿¡ï¼šgRPCï¼ˆproto3åè®®ï¼‰
</span></span><span class="line"><span class="cl">- äº‹ä»¶æ€»çº¿ï¼šKafkaé›†ç¾¤ï¼ˆåˆ†åŒºç­–ç•¥ï¼šè®¢å•IDå“ˆå¸Œï¼‰
</span></span><span class="line"><span class="cl">- ç¼“å­˜å±‚ï¼šRediså“¨å…µæ¨¡å¼ï¼ˆç¼“å­˜ç©¿é€é˜²æŠ¤ç­–ç•¥ï¼‰
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">## å…³é”®æŠ€æœ¯å†³ç­–
</span></span><span class="line"><span class="cl">- æ•°æ®åº“é€‰å‹ï¼š
</span></span><span class="line"><span class="cl">  - è®¢å•æœåŠ¡ï¼šPostgreSQLï¼ˆACIDäº‹åŠ¡éœ€æ±‚ï¼‰
</span></span><span class="line"><span class="cl">  - å•†å“æœåŠ¡ï¼šMongoDBï¼ˆçµæ´»Schemaæ”¯æŒï¼‰
</span></span><span class="line"><span class="cl">- éƒ¨ç½²æ¶æ„ï¼š
</span></span><span class="line"><span class="cl">  - K8så¤šå¯ç”¨åŒºéƒ¨ç½²
</span></span><span class="line"><span class="cl">  - æœåŠ¡ç½‘æ ¼ä½¿ç”¨Istioå®ç°é‡‘ä¸é›€å‘å¸ƒ
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>æ–‡æ¡£å³èµ„äº§</strong></p>
<p>ä¼˜ç§€æ¶æ„æ–‡æ¡£å¦‚åŒä¿é™©ç®±ä¸­çš„åœ°å¥‘ï¼š</p>
<ul>
<li><strong>çŸ¥è¯†ä¼ æ‰¿</strong>ï¼šæ–°æˆå‘˜é€šè¿‡æ–‡æ¡£å¿«é€Ÿå»ºç«‹ç³»ç»Ÿå…¨æ™¯è®¤çŸ¥</li>
<li><strong>å†³ç­–æº¯æº</strong>ï¼šè®°å½•æŠ€æœ¯é€‰å‹çš„æƒè¡¡è¿‡ç¨‹ï¼ˆå¦‚é€‰æ‹©RESTè€ŒéGraphQLçš„åŸå› ï¼‰</li>
<li><strong>è´¨é‡æŠ¤æ </strong>ï¼šç»“åˆArchUnitç­‰å·¥å…·è‡ªåŠ¨åŒ–éªŒè¯æ¶æ„çº¦æŸ</li>
</ul>
<p><strong>å®æ–½å»ºè®®</strong>ï¼š</p>
<ol>
<li><strong>å¯è§†åŒ–å·¥å…·</strong>ï¼šä½¿ç”¨C4æ¨¡å‹æˆ–UMLç»˜åˆ¶æ¶æ„å›¾</li>
<li><strong>ç‰ˆæœ¬åŒ–ç®¡ç†</strong>ï¼šå°†æ–‡æ¡£çº³å…¥ä»£ç ä»“åº“ï¼Œä¸å®ç°åŒæ­¥æ¼”è¿›</li>
<li><strong>æ´»æ–‡æ¡£æœºåˆ¶</strong>ï¼šåœ¨å…³é”®æ¨¡å—æ·»åŠ æ¶æ„å®ˆæŠ¤æµ‹è¯•</li>
</ol>
<hr>
<p><strong>å‡†åˆ™10è¦ç‚¹</strong>
âœ… <strong>ä»·å€¼è®¤çŸ¥</strong></p>
<ul>
<li>æ¶æ„æ–‡æ¡£æ˜¯å›¢é˜Ÿçš„æŠ€æœ¯å®ªæ³•ï¼Œç»´æŠ¤è®¤çŸ¥ä¸€è‡´æ€§</li>
<li>é¿å…&quot;å£å£ç›¸ä¼ &quot;å¯¼è‡´çš„çŸ¥è¯†è¡°å‡</li>
<li>ä¸ºç³»ç»Ÿæ¼”è¿›æä¾›å¯é åŸºçº¿</li>
</ul>
<p>âŒ <strong>è§„é¿è¯¯åŒº</strong></p>
<ul>
<li>å°†æ¶æ„æ–‡æ¡£ç­‰åŒäºAPIæ–‡æ¡£</li>
<li>å› è¿½æ±‚å®Œç¾è€Œå»¶è¿Ÿæ–‡æ¡£åŒ–</li>
<li>å…è®¸æ–‡æ¡£ä¸å®ç°é•¿æœŸåç¦»</li>
</ul>
<p><strong>ç»ˆæå¯ç¤º</strong>ï¼š
æ¶æ„æ–‡æ¡£ä¸æ˜¯æ•æ·çš„å¯¹ç«‹é¢ï¼Œè€Œæ˜¯å·¥ç¨‹ä¸“ä¸šæ€§çš„ä½“ç°ã€‚å®ƒå¦‚åŒèˆªæµ·å›¾ï¼Œè®©å›¢é˜Ÿåœ¨å¿«é€Ÿè¿­ä»£çš„æƒŠæ¶›éª‡æµªä¸­ä¿æŒèˆªå‘ï¼Œè®©æ¯æ¬¡æ¶æ„æ¼”è¿›éƒ½æˆä¸ºç²¾å¿ƒç­–åˆ’çš„å‡çº§ï¼Œè€Œéæ…Œä¸æ‹©è·¯çš„é€ƒäº¡ã€‚</p>
<h2 id="ç¬¬ä¸‰ç« è®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒä»·å€¼">ç¬¬ä¸‰ç« ï¼šè®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒä»·å€¼
</h2><p>è®¿é—®è€…ï¼ˆVisitorï¼‰ã€ç­–ç•¥ï¼ˆStrategyï¼‰ã€è£…é¥°å™¨ï¼ˆDecoratorï¼‰â€”â€”è¿™äº›è®¾è®¡æ¨¡å¼å°†åœ¨åç»­ç« èŠ‚æ·±å…¥æ¢è®¨ã€‚ä½†åœ¨é€ä¸€è§£æä¹‹å‰ï¼Œæˆ‘ä»¬éœ€å…ˆç†è§£è®¾è®¡æ¨¡å¼çš„æœ¬è´¨æ„ä¹‰ã€‚æœ¬ç« å°†æ­ç¤ºè®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒç‰¹å¾ã€åº”ç”¨ä»·å€¼åŠå…¶æ™®éå­˜åœ¨æ€§ã€‚</p>
<hr>
<p><strong>å‡†åˆ™11ï¼šç†è§£è®¾è®¡æ¨¡å¼çš„æ ¹æœ¬ç›®çš„</strong></p>
<p>åœ¨&quot;å‡†åˆ™1ï¼šè®¤è¯†è½¯ä»¶è®¾è®¡çš„é‡è¦æ€§&quot;ä¸­ï¼Œæˆ‘ä»¬å·²æåŠè®¾è®¡æ¨¡å¼çš„ä½œç”¨å±‚çº§ã€‚è®¾è®¡æ¨¡å¼çš„æœ¬è´¨åœ¨äºï¼š</p>
<ol>
<li><strong>æ¨¡å¼å‘½åè¡¨è¾¾æ„å›¾</strong>ï¼šå¦‚&quot;å·¥å‚æ¨¡å¼&quot;ç›´æŒ‡å¯¹è±¡åˆ›å»ºé€»è¾‘çš„å°è£…</li>
<li><strong>å¼•å…¥è§£è€¦æŠ½è±¡å±‚</strong>ï¼šé€šè¿‡ä¸­é—´å±‚éš”ç¦»å˜åŒ–ï¼Œé™ä½æ¨¡å—é—´è€¦åˆ</li>
<li><strong>ä¹…ç»è€ƒéªŒçš„è§£å†³æ–¹æ¡ˆ</strong>ï¼šç»å¤šå¹´å®è·µéªŒè¯çš„é€šç”¨é—®é¢˜åº”å¯¹ç­–ç•¥</li>
</ol>
<p>ä¾‹å¦‚ï¼Œè§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰é€šè¿‡è§£è€¦å‘å¸ƒè€…ä¸è®¢é˜…è€…ï¼Œå®ç°äº‹ä»¶é©±åŠ¨çš„æ¾è€¦åˆæ¶æ„ã€‚</p>
<hr>
<p><strong>å‡†åˆ™12ï¼šè­¦æƒ•è®¾è®¡æ¨¡å¼è®¤çŸ¥è¯¯åŒº</strong></p>
<p>ç ´é™¤å¸¸è§è¯¯è§£ï¼š</p>
<ul>
<li>
<p>âŒ <strong>éå®ç°ç»†èŠ‚</strong>ï¼šè®¾è®¡æ¨¡å¼æ˜¯æ¶æ„å±‚é¢çš„è“å›¾ï¼Œè€Œéå…·ä½“ä»£ç æ¨¡æ¿</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// é”™è¯¯è®¤çŸ¥ï¼šç­–ç•¥æ¨¡å¼å¿…é¡»ç”¨è™šå‡½æ•°å®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Strategy</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">execute</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ­£ç¡®å®è·µï¼šç­–ç•¥å¯ä»¥æ˜¯å‡½æ•°æŒ‡é’ˆã€æ¨¡æ¿å‚æ•°ç­‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Strategy</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Context</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Strategy</span> <span class="n">strategy_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span> <span class="n">strategy_</span><span class="p">();</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>âŒ <strong>ä¸é™äºOOP</strong>ï¼šå‡½æ•°å¼ç¼–ç¨‹ä¸­åŒæ ·å­˜åœ¨æ¨¡å¼ï¼ˆå¦‚é—­åŒ…å®ç°çŠ¶æ€æ¨¡å¼ï¼‰</p>
</li>
<li>
<p>âŒ <strong>éè¯­è¨€ç‰¹æ€§</strong>ï¼šæ¨¡å¼è§£å†³çš„æ˜¯é€šç”¨è®¾è®¡é—®é¢˜ï¼Œä¸è¯­è¨€è¯­æ³•æ— å…³</p>
</li>
</ul>
<hr>
<p><strong>å‡†åˆ™13ï¼šè®¾è®¡æ¨¡å¼æ— å¤„ä¸åœ¨</strong></p>
<p>C++æ ‡å‡†åº“ä¸­çš„æ¨¡å¼åº”ç”¨å®ä¾‹ï¼š</p>
<ol>
<li>
<p><strong>è¿­ä»£å™¨æ¨¡å¼ï¼ˆIteratorï¼‰</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vec</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">it</span><span class="o">=</span><span class="n">vec</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">it</span><span class="o">!=</span><span class="n">vec</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/*...*/</span> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>é€‚é…å™¨æ¨¡å¼ï¼ˆAdapterï¼‰</strong>
<code>std::stack</code>åŸºäº<code>deque/list</code>å®ç°æ ˆæ¥å£</p>
</li>
<li>
<p><strong>ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰</strong>
<code>std::filesystem::path</code>ç»Ÿä¸€å¤„ç†æ–‡ä»¶ä¸ç›®å½•è·¯å¾„</p>
</li>
</ol>
<hr>
<p><strong>å‡†åˆ™14ï¼šä»¥æ¨¡å¼åç§°ä¼ é€’è®¾è®¡æ„å›¾</strong></p>
<p>åœ¨ä»£ç ä¸­æ˜¾å¼ä½¿ç”¨æ¨¡å¼å‘½åï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// æ˜ç¡®å£°æ˜ä½¿ç”¨å·¥å‚æ¨¡å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">WidgetFactory</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;</span> <span class="n">create</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// é€šè¿‡ç±»å‹åä¼ è¾¾è®¿é—®è€…æ¨¡å¼åº”ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">ElementVisitor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">visit</span><span class="p">(</span><span class="n">ConcreteElement</span><span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æå‡ä»£ç è‡ªè§£é‡Šæ€§</li>
<li>ä¿ƒè¿›å›¢é˜Ÿè®¾è®¡å…±è¯†</li>
<li>æ–¹ä¾¿æ¶æ„è¯„å®¡ä¸é‡æ„</li>
</ul>
<hr>
<p><strong>è®¾è®¡æ¨¡å¼çš„ç»ˆæä»·å€¼</strong></p>
<p>è®¾è®¡æ¨¡å¼æ˜¯è½¯ä»¶å·¥ç¨‹çš„ç»éªŒç»“æ™¶ï¼Œå…¶æ ¸å¿ƒä»·å€¼åœ¨äºï¼š</p>
<ul>
<li><strong>æä¾›è®¾è®¡è¯æ±‡è¡¨</strong>ï¼šå¦‚&quot;é‡‡ç”¨è§‚å¯Ÿè€…æ¨¡å¼å¤„ç†äº‹ä»¶é€šçŸ¥&quot;</li>
<li><strong>å°è£…å˜åŒ–ç»´åº¦</strong>ï¼šå°†æ˜“å˜éƒ¨åˆ†éš”ç¦»åœ¨æ¨¡å¼æŠ½è±¡å±‚å</li>
<li><strong>ä¿ƒè¿›æ¶æ„æ¼”è¿›</strong>ï¼šé€šè¿‡æ¨¡å¼ç»„åˆåº”å¯¹éœ€æ±‚å˜åŒ–</li>
</ul>
<p>ç†è§£æ¨¡å¼æœ¬è´¨ï¼Œæ–¹èƒ½è¶…è¶Šå½¢å¼æ¨¡ä»¿ï¼Œå®ç°çµæ´»ä¼˜é›…çš„æ¶æ„è®¾è®¡ã€‚æ¥ä¸‹æ¥çš„ç« èŠ‚å°†æ·±å…¥è§£æå„æ¨¡å¼åœ¨ç°ä»£C++ä¸­çš„å®è·µåº”ç”¨ã€‚</p>
<h3 id="å‡†åˆ™-11ç†è§£è®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒä»·å€¼">å‡†åˆ™ 11ï¼šç†è§£è®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒä»·å€¼
</h3><p>æœ‰å¾ˆå¤§å¯èƒ½æ‚¨ä¹‹å‰å¬è¯´è¿‡è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”åœ¨æ‚¨çš„ç¼–ç¨‹èŒä¸šç”Ÿæ¶¯ä¸­å¾ˆæœ‰å¯èƒ½ä½¿ç”¨è¿‡å…¶ä¸­çš„ä¸€äº›ã€‚</p>
<p>è®¾è®¡æ¨¡å¼å¹¶ä¸æ˜¯æ–°äº‹ç‰©ï¼šå®ƒä»¬è‡³å°‘è‡ªâ€œå››äººç»„â€ï¼ˆGang of Fourï¼Œç®€ç§°GoFï¼‰åœ¨1994å¹´å‘å¸ƒä»–ä»¬çš„è®¾è®¡æ¨¡å¼ä¹¦ç±ä»¥æ¥å°±å­˜åœ¨äº†ã€‚</p>
<p>å°½ç®¡ä¸€ç›´æœ‰æ‰¹è¯„è€…ï¼Œä½†è®¾è®¡æ¨¡å¼çš„ç‰¹æ®Šä»·å€¼åœ¨æ•´ä¸ªè½¯ä»¶è¡Œä¸šä¸­å¾—åˆ°äº†å¹¿æ³›è®¤å¯ã€‚</p>
<p>ç„¶è€Œï¼Œå°½ç®¡è®¾è®¡æ¨¡å¼å·²ç»å­˜åœ¨å¾ˆé•¿æ—¶é—´å¹¶ä¸”éå¸¸é‡è¦ï¼Œå°½ç®¡ç§¯ç´¯äº†å¤§é‡çš„çŸ¥è¯†å’Œæ™ºæ…§ï¼Œåœ¨C++ç¤¾åŒºä¸­ä»ç„¶å­˜åœ¨è®¸å¤šå…³äºè®¾è®¡æ¨¡å¼çš„è¯¯è§£ã€‚</p>
<p>è¦æœ‰æ•ˆåœ°ä½¿ç”¨è®¾è®¡æ¨¡å¼ï¼Œç¬¬ä¸€æ­¥éœ€è¦ç†è§£ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ã€‚è®¾è®¡æ¨¡å¼å…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š</p>
<ul>
<li><strong>æœ‰ä¸€ä¸ªåç§°</strong>ï¼šæ¯ä¸ªè®¾è®¡æ¨¡å¼éƒ½æœ‰ä¸€ä¸ªæ˜ç¡®çš„åç§°ï¼Œè¿™æœ‰åŠ©äºå¼€å‘äººå‘˜å¿«é€Ÿè¯†åˆ«å’Œè®¨è®ºè¯¥æ¨¡å¼ã€‚</li>
<li><strong>å¸¦æœ‰æ„å›¾</strong>ï¼šè®¾è®¡æ¨¡å¼ä¸ä»…ä»…æ˜¯è§£å†³æŸä¸ªé—®é¢˜çš„æŠ€æœ¯æ‰‹æ®µï¼Œå®ƒè¿˜ä¼ è¾¾äº†ä¸€ä¸ªç‰¹å®šçš„è®¾è®¡æ„å›¾æˆ–ç›®æ ‡ã€‚<br/>ä¾‹å¦‚ï¼Œå•ä¾‹æ¨¡å¼çš„æ„å›¾æ˜¯ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚</li>
<li><strong>å¼•å…¥ä¸€ä¸ªæŠ½è±¡</strong>ï¼šè®¾è®¡æ¨¡å¼é€šè¿‡å®šä¹‰æ¥å£ã€åŸºç±»æˆ–å…¶ä»–å½¢å¼çš„æŠ½è±¡æ¥è§£å†³é—®é¢˜ã€‚<br/>è¿™ç§æŠ½è±¡ä½¿å¾—ä»£ç æ›´åŠ çµæ´»å’Œå¯æ‰©å±•ï¼Œèƒ½å¤Ÿé€‚åº”æœªæ¥çš„å˜åŒ–ã€‚</li>
<li><strong>ç»è¿‡éªŒè¯</strong>ï¼šè®¾è®¡æ¨¡å¼ä¸æ˜¯å‡­ç©ºæƒ³è±¡å‡ºæ¥çš„ï¼Œè€Œæ˜¯åŸºäºå®é™…é¡¹ç›®ä¸­çš„ç»éªŒå’Œæœ€ä½³å®è·µå‘å±•è€Œæ¥çš„ã€‚<br/>å®ƒä»¬å·²ç»è¢«è¯æ˜åœ¨å¤šç§åœºæ™¯ä¸‹æœ‰æ•ˆï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸åŒçš„é¡¹ç›®ä¸­å¤ç”¨ã€‚</li>
</ul>
<p><strong>è®¾è®¡æ¨¡å¼æœ‰ä¸€ä¸ªåç§°</strong></p>
<p>é¦–å…ˆï¼Œè®¾è®¡æ¨¡å¼æœ‰ä¸€ä¸ªåç§°ã€‚è™½ç„¶è¿™å¬èµ·æ¥éå¸¸æ˜¾è€Œæ˜“è§ä¸”å¿…è¦ï¼Œä½†ç¡®å®æ˜¯è®¾è®¡æ¨¡å¼çš„ä¸€ä¸ªåŸºæœ¬å±æ€§ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬ä¸¤ä¸ªäººåœ¨ä¸€ä¸ªé¡¹ç›®ä¸Šåˆä½œï¼Œå¹¶è¢«åˆ†é…è§£å†³ä¸€ä¸ªé—®é¢˜ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘å¯¹æ‚¨è¯´ï¼šâ€œæˆ‘ä¼šç”¨ä¸€ä¸ªVisitoræ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚â€ è¿™ä¸ä»…å‘Šè¯‰äº†æ‚¨æˆ‘ç†è§£çš„å®é™…é—®é¢˜æ˜¯ä»€ä¹ˆï¼Œè¿˜ç»™æ‚¨æä¾›äº†ä¸€ä¸ªå…³äºæˆ‘æå‡ºçš„è§£å†³æ–¹æ¡ˆçš„ç²¾ç¡®æ¦‚å¿µã€‚</p>
<p>è®¾è®¡æ¨¡å¼çš„åç§°ä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨éå¸¸é«˜çš„å±‚æ¬¡ä¸Šè¿›è¡Œæ²Ÿé€šï¼Œå¹¶ç”¨æå°‘çš„è¯æ±‡ä¼ è¾¾å¤§é‡ä¿¡æ¯ï¼š</p>
<p><strong>æˆ‘</strong>ï¼šæˆ‘ä¼šç”¨ä¸€ä¸ªVisitoræ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<br/>
<strong>ä½ </strong>ï¼šæˆ‘ä¸ç¡®å®šã€‚æˆ‘è€ƒè™‘ä½¿ç”¨ä¸€ä¸ªStrategyã€‚<br/>
<strong>æˆ‘</strong>ï¼šæ˜¯çš„ï¼Œæ‚¨å¯èƒ½æœ‰é“ç†ã€‚ä½†æ˜¯ç”±äºæˆ‘ä»¬éœ€è¦é¢‘ç¹æ‰©å±•æ“ä½œï¼Œæˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦è€ƒè™‘ä½¿ç”¨ä¸€ä¸ªDecoratorã€‚</p>
<p>é€šè¿‡ä»…ä»…ä½¿ç”¨Visitorã€Strategyå’ŒDecoratorè¿™äº›åç§°ï¼Œæˆ‘ä»¬å°±è®¨è®ºäº†ä»£ç åº“çš„æ¼”å˜ï¼Œå¹¶æè¿°äº†æˆ‘ä»¬æœŸæœ›åœ¨æœªæ¥å‡ å¹´å†…å¦‚ä½•æ‰©å±•å’Œå˜åŒ–ã€‚</p>
<p>å¦‚æœæ²¡æœ‰è¿™äº›åç§°ï¼Œæˆ‘ä»¬å°†å¾ˆéš¾è¡¨è¾¾æˆ‘ä»¬çš„æƒ³æ³•ï¼š</p>
<p><strong>æˆ‘</strong>ï¼šæˆ‘è®¤ä¸ºæˆ‘ä»¬åº”è¯¥åˆ›å»ºä¸€ä¸ªç³»ç»Ÿï¼Œå…è®¸æˆ‘ä»¬åœ¨ä¸åå¤ä¿®æ”¹ç°æœ‰ç±»å‹çš„æƒ…å†µä¸‹æ‰©å±•æ“ä½œã€‚<br/>
<strong>ä½ </strong>ï¼šæˆ‘ä¸ç¡®å®šã€‚ä¸å…¶å¢åŠ æ–°çš„æ“ä½œï¼Œæˆ‘é¢„è®¡ä¼šé¢‘ç¹æ·»åŠ æ–°çš„ç±»å‹ã€‚<br/>å› æ­¤ï¼Œæˆ‘æ›´å€¾å‘äºä¸€ç§å…è®¸æˆ‘è½»æ¾æ·»åŠ ç±»å‹çš„è§£å†³æ–¹æ¡ˆï¼Œä¸ºäº†å‡å°‘ä¸å®ç°ç»†èŠ‚çš„è€¦åˆï¼ˆè¿™æ˜¯å¯ä»¥é¢„æœŸçš„ï¼‰ï¼Œæˆ‘å»ºè®®å¼•å…¥ä¸€ä¸ªå˜ä½“ç‚¹æ¥æå–ç°æœ‰ç±»å‹çš„å®ç°ç»†èŠ‚ã€‚<br/>
<strong>æˆ‘</strong>ï¼šæ˜¯çš„ï¼Œæ‚¨å¯èƒ½æœ‰é“ç†ã€‚ä½†æ˜¯ç”±äºæˆ‘ä»¬éœ€è¦é¢‘ç¹æ‰©å±•æ“ä½œï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è®¾è®¡ç³»ç»Ÿï¼Œä»¥ä¾¿èƒ½å¤Ÿè½»æ¾æ„å»ºå’Œé‡ç”¨ç»™å®šçš„å®ç°ã€‚<br/></p>
<p>çœ‹åˆ°åŒºåˆ«äº†å—ï¼Ÿæ„Ÿè§‰åˆ°åŒºåˆ«äº†å—ï¼Ÿæ²¡æœ‰åç§°ï¼Œæˆ‘ä»¬å¿…é¡»æ˜ç¡®åœ°è®¨è®ºæ›´å¤šçš„ç»†èŠ‚ã€‚</p>
<p>æ˜¾ç„¶ï¼Œè¿™ç§ç²¾ç¡®çš„æ²Ÿé€šåªæœ‰åœ¨æˆ‘ä»¬å¯¹è®¾è®¡æ¨¡å¼æœ‰ç›¸åŒçš„ç†è§£æ—¶æ‰å¯èƒ½å®ç°ã€‚<br/>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆäº†è§£è®¾è®¡æ¨¡å¼å¹¶è®¨è®ºå®ƒä»¬å¦‚æ­¤é‡è¦çš„åŸå› ã€‚</p>
<p><strong>è®¾è®¡æ¨¡å¼å¸¦æœ‰æ„å›¾</strong></p>
<p>é€šè¿‡ä½¿ç”¨è®¾è®¡æ¨¡å¼çš„åç§°ï¼Œæ‚¨å¯ä»¥ç®€æ´åœ°è¡¨è¾¾æ‚¨çš„æ„å›¾ï¼Œå¹¶é™åˆ¶å¯èƒ½çš„è¯¯è§£ã€‚</p>
<p>è¿™å¼•å‡ºäº†è®¾è®¡æ¨¡å¼çš„ç¬¬äºŒä¸ªå±æ€§ï¼šæ„å›¾ã€‚è®¾è®¡æ¨¡å¼çš„åç§°ä¼ è¾¾äº†å®ƒçš„æ„å›¾ã€‚</p>
<p>å¦‚æœæ‚¨ä½¿ç”¨è®¾è®¡æ¨¡å¼çš„åç§°ï¼Œæ‚¨éšå«åœ°è¡¨è¾¾äº†æ‚¨è®¤ä¸ºçš„é—®é¢˜ä»¥åŠæ‚¨æ‰€çœ‹åˆ°çš„è§£å†³æ–¹æ¡ˆï¼Œ</p>
<p>å¸Œæœ›æ‚¨å·²ç»æ„è¯†åˆ°ï¼Œåœ¨æˆ‘ä»¬ç®€çŸ­çš„å¯¹è¯ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰è®¨è®ºä»»ä½•å…·ä½“çš„å®ç°ï¼Œæˆ‘ä»¬æ²¡æœ‰è°ˆè®ºå®ç°ç»†èŠ‚ã€ä»»ä½•ç‰¹æ€§æˆ–ä»»ä½•ç‰¹å®šçš„C++æ ‡å‡†ï¼Œæˆ‘ä»¬ç”šè‡³æ²¡æœ‰è®¨è®ºä»»ä½•ç‰¹å®šçš„ç¼–ç¨‹è¯­è¨€ï¼Œè¯·ä¸è¦å‡è®¾é€šè¿‡ç»™æ‚¨ä¸€ä¸ªè®¾è®¡æ¨¡å¼çš„åç§°ï¼Œæˆ‘å°±éšå«åœ°å‘Šè¯‰äº†æ‚¨å¦‚ä½•å®ç°è§£å†³æ–¹æ¡ˆï¼Œè¿™ä¸æ˜¯è®¾è®¡æ¨¡å¼çš„ç›®çš„ã€‚</p>
<p>ç›¸åï¼Œåç§°åº”è¯¥å‘Šè¯‰æ‚¨æˆ‘æè®®çš„ç»“æ„ã€æˆ‘è®¡åˆ’å¦‚ä½•ç®¡ç†ä¾èµ–å…³ç³»ä»¥åŠæˆ‘å¯¹ç³»ç»Ÿæ¼”åŒ–çš„æœŸæœ›ï¼Œè¿™å°±æ˜¯æ„å›¾ã€‚</p>
<p>å®é™…ä¸Šï¼Œè®¸å¤šè®¾è®¡æ¨¡å¼å…·æœ‰ç±»ä¼¼çš„ç»“æ„ï¼Œåœ¨GoFï¼ˆå››äººç»„ï¼‰çš„ä¹¦ä¸­ï¼Œè®¸å¤šè®¾è®¡æ¨¡å¼çœ‹èµ·æ¥éå¸¸ç›¸ä¼¼ï¼Œè¿™å½“ç„¶ä¼šå¼•èµ·å¾ˆå¤šå›°æƒ‘å’Œé—®é¢˜ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä»ç»“æ„ä¸Šçœ‹ï¼ŒStrategyï¼ˆç­–ç•¥ï¼‰ã€Commandï¼ˆå‘½ä»¤ï¼‰å’ŒBridgeï¼ˆæ¡¥æ¥ï¼‰è®¾è®¡æ¨¡å¼å‡ ä¹æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p>
<p>ç„¶è€Œï¼Œå®ƒä»¬çš„æ„å›¾éå¸¸ä¸åŒï¼Œå› æ­¤æ‚¨ä¼šç”¨å®ƒä»¬æ¥è§£å†³ä¸åŒçš„é—®é¢˜ã€‚</p>
<p>æ­£å¦‚æ‚¨å°†åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­çš„å„ç§ç¤ºä¾‹ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼Œå‡ ä¹æ€»æ˜¯æœ‰å¤šç§ä¸åŒçš„å®ç°å¯ä»¥é€‰æ‹©ã€‚</p>
<p><strong>è®¾è®¡æ¨¡å¼å¼•å…¥æŠ½è±¡</strong></p>
<p>è®¾è®¡æ¨¡å¼æ€»æ˜¯é€šè¿‡å¼•å…¥æŸç§å½¢å¼çš„æŠ½è±¡æ¥å‡å°‘ä¾èµ–ï¼Œè¿™æ„å‘³ç€è®¾è®¡æ¨¡å¼å§‹ç»ˆå…³æ³¨äºç®¡ç†è½¯ä»¶å®ä½“ä¹‹é—´çš„äº¤äº’å’Œè§£è€¦è½¯ä»¶çš„ä¸åŒéƒ¨åˆ†ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘GoFï¼ˆå››äººç»„ï¼‰æœ€åˆçš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ <strong>ç­–ç•¥è®¾è®¡æ¨¡å¼ ï¼ˆStrategyï¼‰</strong></p>
<p>ä¸æ·±å…¥ç»†èŠ‚ï¼Œç­–ç•¥è®¾è®¡æ¨¡å¼é€šè¿‡å¼•å…¥ä¸€ä¸ªåä¸ºâ€œStrategyâ€çš„åŸºç±»æ¥æä¾›æŠ½è±¡ã€‚<br/>è¿™ä¸ªåŸºç±»å°†ç­–ç•¥ç”¨æˆ·ï¼ˆæ¶æ„é«˜å±‚ä¸­çš„Contextç±»ï¼‰ä¸å…·ä½“ç­–ç•¥çš„å®ç°ç»†èŠ‚ï¼ˆæ¶æ„ä½å±‚ä¸­çš„ConcreteStrategyAå’ŒConcreteStrategyBï¼‰è§£è€¦ã€‚</p>
<p>å› æ­¤ï¼Œç­–ç•¥æ¨¡å¼ç¬¦åˆè®¾è®¡æ¨¡å¼çš„ç‰¹æ€§ã€‚</p>
<p>å¦ä¸€ä¸ªç±»ä¼¼çš„ä¾‹å­æ˜¯ <strong>å·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼</strong>ï¼Œå·¥å‚æ–¹æ³•çš„æ„å›¾æ˜¯è§£è€¦å¯¹è±¡åˆ›å»ºçš„å…·ä½“äº§å“ã€‚</p>
<p>ä¸ºæ­¤ï¼Œå®ƒå¼•å…¥äº†ä¸¤ä¸ªæŠ½è±¡ï¼šProductå’ŒCreatoråŸºç±»ï¼Œè¿™äº›åŸºç±»åœ¨æ¶æ„çš„é«˜å±‚ä¸­å­˜åœ¨ï¼Œå…·ä½“çš„å®ç°ç»†èŠ‚ç”±<strong>ConcreteProduct</strong> å’Œ <strong>ConcreteCreator</strong>ç±»æä¾›ï¼Œå®ƒä»¬ä½äºæ¶æ„çš„ä½å±‚ã€‚</p>
<p>é€šè¿‡è¿™ç§æ¶æ„ç»“æ„ï¼Œå·¥å‚æ–¹æ³•ä¹Ÿç¬¦åˆè®¾è®¡æ¨¡å¼çš„æ ‡å‡†ï¼šå®ƒæœ‰ä¸€ä¸ªåç§°ã€è§£è€¦çš„æ„å›¾ï¼Œå¹¶ä¸”å¼•å…¥äº†æŠ½è±¡ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè®¾è®¡æ¨¡å¼å¼•å…¥çš„æŠ½è±¡å¹¶ä¸ä¸€å®šæ˜¯é€šè¿‡åŸºç±»å®ç°çš„ï¼Œæ­£å¦‚æˆ‘åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†å’Œç« èŠ‚ä¸­ä¼šå±•ç¤ºçš„é‚£æ ·ï¼ŒæŠ½è±¡å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å¼•å…¥ï¼Œä¾‹å¦‚é€šè¿‡æ¨¡æ¿æˆ–ç®€å•çš„å‡½æ•°é‡è½½ã€‚</p>
<p>å†æ¬¡å¼ºè°ƒï¼Œè®¾è®¡æ¨¡å¼å¹¶ä¸æš—ç¤ºä»»ä½•ç‰¹å®šçš„å®ç°ã€‚</p>
<p>ä½œä¸ºåä¾‹ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹<code>std::make_unique()</code>å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="n">std</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">Args</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl">	<span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">make_unique</span><span class="p">(</span> <span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">args</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c1">// namespace std
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨C++ç¤¾åŒºä¸­ï¼Œæˆ‘ä»¬ç»å¸¸è°ˆè®º<code>std::make_unique()</code>å‡½æ•°ä½œä¸ºä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œé‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œå°½ç®¡æœ¯è¯­â€œå·¥å‚å‡½æ•°â€ç»™äººä¸€ç§<code>std::make_unique()</code>æ˜¯å·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼çš„ä¸€ä¸ªä¾‹å­çš„å°è±¡ï¼Œä½†è¿™ç§å°è±¡æ˜¯é”™è¯¯çš„ã€‚</p>
<p>è®¾è®¡æ¨¡å¼é€šè¿‡å¼•å…¥æŠ½è±¡æ¥å¸®åŠ©æ‚¨è§£è€¦ï¼Œè¿™å…è®¸æ‚¨è‡ªå®šä¹‰å¹¶æ¨è¿Ÿå®ç°ç»†èŠ‚ã€‚</p>
<p>ç‰¹åˆ«æ˜¯ï¼Œå·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼çš„æ„å›¾æ˜¯ä¸ºå¯¹è±¡å®ä¾‹åŒ–å¼•å…¥ä¸€ä¸ªè‡ªå®šä¹‰ç‚¹ï¼Œ<br/><code>std::make_unique()</code>å¹¶æ²¡æœ‰æä¾›è¿™æ ·çš„è‡ªå®šä¹‰ç‚¹ï¼Œå¦‚æœæ‚¨ä½¿ç”¨<code>std::make_unique()</code>ï¼Œä½ çŸ¥é“ä½ ä¼šå¾—åˆ°ä¸€ä¸ªæŒ‡å‘ä½ è¯·æ±‚ç±»å‹çš„<code>std::unique_ptr</code>ï¼Œå¹¶ä¸”å®ä¾‹å°†é€šè¿‡<code>new</code>ç”Ÿæˆï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// è¿™å°†é€šè¿‡è°ƒç”¨ &#39;new&#39; åˆ›å»ºä¸€ä¸ª &#39;Widget&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">auto</span> <span class="n">ptr</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Widget</span><span class="o">&gt;</span><span class="p">(</span> <span class="cm">/* ä¸€äº› Widget å‚æ•° */</span> <span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”±äº<code>std::make_unique()</code>æ²¡æœ‰ä¸ºæ‚¨æä¾›ä»»ä½•è‡ªå®šä¹‰è¡Œä¸ºçš„æ–¹å¼ï¼Œå®ƒæ— æ³•å¸®åŠ©å‡å°‘å®ä½“ä¹‹é—´çš„è€¦åˆï¼Œå› æ­¤ä¸èƒ½æ»¡è¶³è®¾è®¡æ¨¡å¼çš„ç›®çš„ã€‚</p>
<p>ç„¶è€Œï¼Œ<code>std::make_unique()</code>æ˜¯é’ˆå¯¹ç‰¹å®šé—®é¢˜çš„ä¸€ç§å¸¸è§è§£å†³æ–¹æ¡ˆï¼Œæ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯ä¸€ç§æ¨¡å¼ï¼Œä½†å®ƒä¸æ˜¯è®¾è®¡æ¨¡å¼ï¼Œè€Œæ˜¯å®ç°æ¨¡å¼ã€‚</p>
<p>å®ƒæ˜¯å°è£…å®ç°ç»†èŠ‚ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”Ÿæˆä¸€ä¸ªWidgetå®ä¾‹ï¼‰çš„æµè¡Œè§£å†³æ–¹æ¡ˆï¼Œä½†å®ƒå¹¶æœªä»æ‚¨è·å¾—çš„å†…å®¹æˆ–å¦‚ä½•åˆ›å»ºå®ƒè¿›è¡ŒæŠ½è±¡ã€‚</p>
<p>å› æ­¤ï¼Œå®ƒå±äºå®ç°ç»†èŠ‚çº§åˆ«ï¼Œè€Œä¸æ˜¯è½¯ä»¶è®¾è®¡çº§åˆ«ã€‚</p>
<p>æŠ½è±¡çš„å¼•å…¥æ˜¯è§£è€¦è½¯ä»¶å®ä½“ã€è®¾è®¡å˜æ›´å’Œæ‰©å±•çš„å…³é”®ï¼Œ<br/><code>std::make_unique()</code>å‡½æ•°æ¨¡æ¿ä¸­æ²¡æœ‰ä»»ä½•æŠ½è±¡ï¼Œå› æ­¤æ‚¨æ— æ³•æ‰©å±•å…¶åŠŸèƒ½ï¼ˆç”šè‡³æ— æ³•æ­£ç¡®åœ°é‡è½½æˆ–ç‰¹åŒ–ï¼‰ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œå·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼ç¡®å®æä¾›äº†å…³äºåˆ›å»ºä»€ä¹ˆä»¥åŠå¦‚ä½•åˆ›å»ºï¼ˆåŒ…æ‹¬å®ä¾‹åŒ–å‰åçš„è¡Œä¸ºï¼‰çš„æŠ½è±¡ã€‚<br/>ç”±äºè¿™ç§æŠ½è±¡ï¼Œä½ å¯ä»¥åœ¨ä»¥åç¼–å†™æ–°çš„å·¥å‚ï¼Œè€Œæ— éœ€æ›´æ”¹ç°æœ‰ä»£ç ã€‚</p>
<p>å› æ­¤ï¼Œè®¾è®¡æ¨¡å¼å¸®åŠ©ä½ è§£è€¦å’Œæ‰©å±•ä½ çš„è½¯ä»¶ï¼Œè€Œ<code>std::make_unique()</code>åªæ˜¯ä¸€ä¸ªå®ç°æ¨¡å¼ã€‚</p>
<p><strong>è®¾è®¡æ¨¡å¼å·²è¢«è¯æ˜æœ‰æ•ˆ</strong></p>
<p>æœ€åä½†åŒæ ·é‡è¦çš„æ˜¯ï¼Œè®¾è®¡æ¨¡å¼ç»è¿‡å¤šå¹´éªŒè¯ï¼Œå››äººç»„ï¼ˆGang of Fourï¼‰å¹¶æ²¡æœ‰æ”¶é›†æ‰€æœ‰å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼Œ</p>
<p>åªæœ‰é‚£äº›åœ¨ä¸åŒä»£ç åº“ä¸­å¸¸ç”¨ä»¥è§£å†³ç›¸åŒé—®é¢˜çš„æ–¹æ¡ˆï¼ˆå°½ç®¡å®ç°å¯èƒ½æœ‰æ‰€ä¸åŒï¼‰ï¼Œ</p>
<p>å› æ­¤ï¼Œä¸€ä¸ªè§£å†³æ–¹æ¡ˆå¿…é¡»å¤šæ¬¡è¯æ˜å…¶ä»·å€¼ï¼Œæ‰èƒ½è¢«è§†ä¸ºä¸€ç§æ¨¡å¼ã€‚</p>
<p><strong>æ€»ç»“ä¸€ä¸‹</strong>ï¼šè®¾è®¡æ¨¡å¼æ˜¯ä¸€ç§ç»è¿‡éªŒè¯ã€æœ‰åç§°çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒè¡¨è¾¾äº†ä¸€ä¸ªéå¸¸å…·ä½“çš„æ„å›¾ã€‚</p>
<p>å®ƒå¼•å…¥æŸç§å½¢å¼çš„æŠ½è±¡ï¼Œæœ‰åŠ©äºè§£è€¦è½¯ä»¶å®ä½“ï¼Œä»è€Œå¸®åŠ©ç®¡ç†è¿™äº›å®ä½“ä¹‹é—´çš„äº¤äº’ï¼Œæ­£å¦‚æˆ‘ä»¬åº”è¯¥ä½¿ç”¨â€œè®¾è®¡â€ä¸€è¯æ¥è¡¨ç¤ºç®¡ç†å’Œè§£è€¦ä¾èµ–å…³ç³»çš„è‰ºæœ¯ï¼ˆå‚è§â€œå‡†åˆ™1ï¼šç†è§£è½¯ä»¶è®¾è®¡çš„é‡è¦æ€§â€ï¼‰ï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥å‡†ç¡®ä¸”æœ‰ç›®çš„åœ°ä½¿ç”¨â€œè®¾è®¡æ¨¡å¼â€è¿™ä¸€æœ¯è¯­ã€‚</p>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>ç†è§£è®¾è®¡æ¨¡å¼æ˜¯ç»è¿‡éªŒè¯çš„ã€æœ‰åç§°çš„è§£å†³æ–¹æ¡ˆï¼Œå…¶æ„å›¾æ˜¯è§£è€¦ã€‚</li>
<li>è®¤è¯†åˆ°è®¾è®¡æ¨¡å¼å¼•å…¥æŸç§å½¢å¼çš„æŠ½è±¡ã€‚</li>
<li>è®°ä½è®¾è®¡æ¨¡å¼çš„ç›®æ ‡æ˜¯è½¯ä»¶è®¾è®¡ï¼Œå³å¸®åŠ©ç®¡ç†ä¾èµ–å…³ç³»ã€‚</li>
<li>æ³¨æ„åŒºåˆ†è®¾è®¡æ¨¡å¼å’Œå®ç°æ¨¡å¼ã€‚</li>
</ul>
<h3 id="å‡†åˆ™12è­¦æƒ•è®¾è®¡æ¨¡å¼çš„è¯¯è§£">å‡†åˆ™12ï¼šè­¦æƒ•è®¾è®¡æ¨¡å¼çš„è¯¯è§£
</h3><p>ä¸Šä¸€èŠ‚é‡ç‚¹è§£é‡Šäº†è®¾è®¡æ¨¡å¼çš„ç›®çš„ï¼šåç§°ã€æ„å›¾å’ŒæŸç§å½¢å¼çš„æŠ½è±¡ç›¸ç»“åˆï¼Œä»¥è§£è€¦è½¯ä»¶å®ä½“ã€‚ç„¶è€Œï¼Œæ­£å¦‚ç†è§£ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼å¾ˆé‡è¦ä¸€æ ·ï¼Œç†è§£ä»€ä¹ˆä¸æ˜¯è®¾è®¡æ¨¡å¼ä¹ŸåŒæ ·é‡è¦ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå…³äºè®¾è®¡æ¨¡å¼å­˜åœ¨ä¸€äº›å¸¸è§çš„è¯¯è§£ï¼š</p>
<ul>
<li>æœ‰äº›äººè®¤ä¸ºè®¾è®¡æ¨¡å¼æ˜¯ä¸€ç§ç›®æ ‡ï¼Œå¹¶ä¸”æ˜¯å®ç°è‰¯å¥½è½¯ä»¶è´¨é‡çš„ä¿è¯ã€‚</li>
<li>æœ‰äº›äººè®¤ä¸ºè®¾è®¡æ¨¡å¼åŸºäºç‰¹å®šçš„å®ç°ï¼Œå› æ­¤æ˜¯ç‰¹å®šè¯­è¨€çš„ä¹ æƒ¯ç”¨æ³•ã€‚</li>
<li>æœ‰äº›äººè¯´è®¾è®¡æ¨¡å¼ä»…é™äºé¢å‘å¯¹è±¡ç¼–ç¨‹å’ŒåŠ¨æ€å¤šæ€æ€§ã€‚</li>
<li>æœ‰äº›äººè®¤ä¸ºè®¾è®¡æ¨¡å¼å·²ç»è¿‡æ—¶ç”šè‡³è¢«æ·˜æ±°ã€‚</li>
</ul>
<p>è¿™äº›è¯¯è§£å¹¶ä¸ä»¤äººæƒŠè®¶ï¼Œå› ä¸ºæˆ‘ä»¬å¾ˆå°‘è°ˆè®ºè®¾è®¡ï¼Œè€Œæ˜¯æ›´å¤šåœ°å…³æ³¨åŠŸèƒ½å’Œè¯­è¨€æœºåˆ¶ï¼ˆå‚è§â€œå‡†åˆ™1ï¼šç†è§£è½¯ä»¶è®¾è®¡çš„é‡è¦æ€§â€ï¼‰ã€‚å› æ­¤ï¼Œåœ¨æœ¬å‡†åˆ™ä¸­ï¼Œæˆ‘å°†æ¾„æ¸…å‰ä¸‰ç§è¯¯è§£ï¼Œå¹¶åœ¨ä¸‹ä¸€èŠ‚ä¸­å¤„ç†ç¬¬å››ç§è¯¯è§£ã€‚</p>
<p><strong>è®¾è®¡æ¨¡å¼ä¸æ˜¯ç›®æ ‡</strong></p>
<p>ä¸€äº›å¼€å‘è€…éå¸¸å–œæ¬¢è®¾è®¡æ¨¡å¼ï¼Œä»–ä»¬å¯¹è®¾è®¡æ¨¡å¼å¦‚æ­¤ç€è¿·ï¼Œä»¥è‡³äºè¯•å›¾é€šè¿‡è®¾è®¡æ¨¡å¼è§£å†³æ‰€æœ‰é—®é¢˜ï¼Œæ— è®ºæ˜¯å¦åˆç†ã€‚</p>
<p>å½“ç„¶ï¼Œè¿™ç§æ€ç»´æ–¹å¼å¯èƒ½ä¼šå¢åŠ ä»£ç çš„å¤æ‚æ€§å¹¶é™ä½å…¶å¯ç†è§£æ€§ï¼Œè¿™æœ€ç»ˆå¯èƒ½é€‚å¾—å…¶åã€‚</p>
<p>å› æ­¤ï¼Œè¿‡åº¦ä½¿ç”¨è®¾è®¡æ¨¡å¼å¯èƒ½å¯¼è‡´å…¶ä»–å¼€å‘è€…çš„æŒ«è´¥æ„Ÿï¼ŒæŸå®³è®¾è®¡æ¨¡å¼çš„æ•´ä½“å£°èª‰ï¼Œç”šè‡³å¯¼è‡´å¯¹æ¨¡å¼æ¦‚å¿µçš„æ‹’ç»ã€‚</p>
<p>æ˜ç¡®åœ°è¯´ï¼šè®¾è®¡æ¨¡å¼ä¸æ˜¯ç›®æ ‡ï¼Œå®ƒä»¬æ˜¯å®ç°ç›®æ ‡çš„æ‰‹æ®µï¼Œå®ƒä»¬å¯èƒ½æ˜¯è§£å†³æ–¹æ¡ˆçš„ä¸€éƒ¨åˆ†ï¼Œä½†å®ƒä»¬ä¸æ˜¯ç›®æ ‡ã€‚</p>
<p>æ­£å¦‚Venkat Subramaniamæ‰€è¯´ï¼šå¦‚æœä½ æ—©ä¸Šèµ·åºŠæ—¶æƒ³ç€ â€œä»Šå¤©æˆ‘ä¼šç”¨å“ªç§è®¾è®¡æ¨¡å¼ï¼Ÿâ€ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ªæ˜æ˜¾çš„ä¿¡å·ï¼Œè¡¨æ˜ä½ è¯¯è§£äº†è®¾è®¡æ¨¡å¼çš„ç›®çš„ï¼Œæ²¡æœ‰å¥–åŠ±æˆ–å¥–ç« æ˜¯å› ä¸ºä½¿ç”¨å°½å¯èƒ½å¤šçš„è®¾è®¡æ¨¡å¼ã€‚</p>
<p>è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨ä¸åº”è¯¥å¢åŠ å¤æ‚æ€§ï¼Œè€Œåº”è¯¥ç›¸åï¼Œå‡å°‘å¤æ‚æ€§ï¼Œä»£ç åº”è¯¥å˜å¾—æ›´ç®€å•ã€æ›´æ˜“ç†è§£ï¼Œå¹¶ä¸”æ›´å®¹æ˜“æ›´æ”¹å’Œç»´æŠ¤ï¼Œå› ä¸ºè®¾è®¡æ¨¡å¼åº”è¯¥å¸®åŠ©è§£å†³ä¾èµ–å…³ç³»å¹¶åˆ›å»ºæ›´å¥½çš„ç»“æ„ã€‚</p>
<p>å¦‚æœä½¿ç”¨è®¾è®¡æ¨¡å¼å¯¼è‡´æ›´é«˜çš„å¤æ‚æ€§å¹¶ç»™å…¶ä»–å¼€å‘è€…å¸¦æ¥é—®é¢˜ï¼Œé‚£æ˜¾ç„¶ä¸æ˜¯æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>ä¸ºäº†æ¾„æ¸…ï¼šæˆ‘ä¸æ˜¯å‘Šè¯‰ä½ ä¸è¦ä½¿ç”¨è®¾è®¡æ¨¡å¼ï¼Œæˆ‘åªæ˜¯å‘Šè¯‰ä½ ä¸è¦è¿‡åº¦ä½¿ç”¨å®ƒä»¬ï¼Œå°±åƒæˆ‘ä¹Ÿä¼šå‘Šè¯‰ä½ ä¸è¦è¿‡åº¦ä½¿ç”¨ä»»ä½•å…¶ä»–å·¥å…·ä¸€æ ·ã€‚</p>
<p>è¿™æ€»æ˜¯å–å†³äºå…·ä½“çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼Œé”¤å­æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å·¥å…·ï¼Œåªè¦ä½ çš„é—®é¢˜æ˜¯é’‰å­ï¼Œä¸€æ—¦ä½ çš„é—®é¢˜å˜æˆäº†èºä¸ï¼Œé”¤å­å°±å˜æˆäº†ä¸€ç§ä¸å¤ªä¼˜é›…çš„å·¥å…·ï¼Œè¦æ­£ç¡®ä½¿ç”¨è®¾è®¡æ¨¡å¼ï¼Œäº†è§£ä½•æ—¶ä½¿ç”¨å®ƒä»¬ä»¥åŠä½•æ—¶ä¸ä½¿ç”¨å®ƒä»¬ï¼ŒæŒæ¡å®ƒä»¬çš„æ„å›¾å’Œç»“æ„ç‰¹æ€§ï¼Œå¹¶æ˜æ™ºåœ°åº”ç”¨å®ƒä»¬æ˜¯éå¸¸é‡è¦çš„ã€‚</p>
<p><strong>è®¾è®¡æ¨¡å¼ä¸å…³ä¹å®ç°ç»†èŠ‚</strong></p>
<p>å…³äºè®¾è®¡æ¨¡å¼æœ€å¸¸è§çš„è¯¯è§£ä¹‹ä¸€æ˜¯å®ƒä»¬åŸºäºç‰¹å®šçš„å®ç°ï¼Œè¿™åŒ…æ‹¬è®¤ä¸ºè®¾è®¡æ¨¡å¼æˆ–å¤šæˆ–å°‘æ˜¯ç‰¹å®šè¯­è¨€çš„ä¹ æƒ¯ç”¨æ³•ã€‚</p>
<p>è¿™ç§è¯¯è§£æ˜¯å¯ä»¥ç†è§£çš„ï¼Œå› ä¸ºè®¸å¤šè®¾è®¡æ¨¡å¼ï¼Œç‰¹åˆ«æ˜¯å››äººç»„ï¼ˆGoFï¼‰æ¨¡å¼ï¼Œé€šå¸¸åœ¨é¢å‘å¯¹è±¡çš„ç¯å¢ƒä¸­å‘ˆç°ï¼Œå¹¶é€šè¿‡é¢å‘å¯¹è±¡çš„ä¾‹å­è¿›è¡Œè§£é‡Šã€‚</p>
<p>åœ¨è¿™ç§èƒŒæ™¯ä¸‹ï¼Œå¾ˆå®¹æ˜“å°†å®ç°ç»†èŠ‚è¯¯è®¤ä¸ºæ˜¯ç‰¹å®šæ¨¡å¼ï¼Œå¹¶å‡è®¾ä¸¤è€…æ˜¯ç›¸åŒçš„ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œä¹Ÿå¾ˆå®¹æ˜“è¯æ˜è®¾è®¡æ¨¡å¼å¹¶ä¸å…³ä¹å®ç°ç»†èŠ‚ã€ä»»ä½•ç‰¹å®šçš„è¯­è¨€ç‰¹æ€§æˆ–ä»»ä½•C++æ ‡å‡†ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹åŒä¸€ä¸ªè®¾è®¡æ¨¡å¼çš„ä¸åŒå®ç°ï¼Œæ˜¯çš„ï¼Œæˆ‘ä»¬å°†ä»ç»å…¸ã€é¢å‘å¯¹è±¡çš„ç‰ˆæœ¬å¼€å§‹ã€‚</p>
<p>è€ƒè™‘ä»¥ä¸‹åœºæ™¯ï¼šæˆ‘ä»¬æƒ³è¦ç»˜åˆ¶ä¸€ä¸ªç»™å®šçš„å½¢çŠ¶ã€‚ä»£ç ç‰‡æ®µé€šè¿‡ä¸€ä¸ªåœ†æ¥æ¼”ç¤ºè¿™ä¸€ç‚¹ï¼Œå½“ç„¶å®ƒä¹Ÿå¯ä»¥æ˜¯ä»»ä½•å…¶ä»–å½¢çŠ¶ï¼Œå¦‚æ­£æ–¹å½¢æˆ–ä¸‰è§’å½¢ã€‚ä¸ºäº†ç»˜åˆ¶ï¼ŒCircleç±»æä¾›äº†draw()æˆå‘˜å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Circle</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">draw</span><span class="p">(</span> <span class="cm">/*...*/</span> <span class="p">);</span>  <span class="c1">// ä½¿ç”¨æŸç§å›¾å½¢åº“å®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ä¼¼ä¹å¾ˆæ˜æ˜¾ä½ éœ€è¦å®ç°<code>draw()</code>å‡½æ•°ã€‚æœªç»è¿›ä¸€æ­¥æ€è€ƒï¼Œä½ å¯èƒ½ä¼šé€šè¿‡å¸¸è§çš„å›¾å½¢åº“ï¼ˆå¦‚OpenGLã€Metalã€Vulkanæˆ–å…¶ä»–å›¾å½¢åº“ï¼‰æ¥å®ç°ã€‚</p>
<p>ç„¶è€Œï¼Œå¦‚æœ<code>Circle</code>ç±»è‡ªå·±å®ç°äº†<code>draw()</code>åŠŸèƒ½ï¼Œé‚£å°†æ˜¯ä¸€ä¸ªå¤§çš„è®¾è®¡ç¼ºé™·ï¼šç›´æ¥å®ç°<code>draw()</code>å‡½æ•°ä¼šå¼•å…¥å¯¹æ‰€é€‰å›¾å½¢åº“çš„å¼ºè€¦åˆã€‚è¿™ä¼šå¸¦æ¥ä¸€äº›ç¼ºç‚¹ï¼š</p>
<ul>
<li>å¯¹äº<code>Circle</code>çš„æ¯ä¸€ä¸ªå¯èƒ½åº”ç”¨ï¼Œä½ æ€»æ˜¯éœ€è¦å›¾å½¢åº“å¯ç”¨ï¼Œå³ä½¿ä½ å¯èƒ½åªå¯¹å‡ ä½•å›¾å…ƒæ„Ÿå…´è¶£è€Œä¸æ˜¯å›¾å½¢ã€‚</li>
<li>å›¾å½¢åº“çš„æ¯ä¸€æ¬¡æ›´æ”¹éƒ½å¯èƒ½å½±å“åˆ°<code>Circle</code>ç±»ï¼Œå¯¼è‡´å¿…è¦çš„ä¿®æ”¹ã€é‡æ–°æµ‹è¯•å’Œé‡æ–°éƒ¨ç½²ç­‰ã€‚</li>
<li>æœªæ¥åˆ‡æ¢åˆ°å¦ä¸€ä¸ªåº“å°†æ„å‘³ç€ä¸€åˆ‡éƒ½ä¸å†é¡ºåˆ©ã€‚</li>
</ul>
<p>è¿™äº›é—®é¢˜éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„æ ¹æºï¼šåœ¨<code>Circle</code>ç±»ä¸­ç›´æ¥å®ç°<code>draw()</code>å‡½æ•°è¿åäº†å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼›å‚è§â€œå‡†åˆ™2ï¼šä¸ºå˜æ›´è€Œè®¾è®¡â€ï¼‰ï¼Œè¯¥ç±»ä¸å†å› å•ä¸€åŸå› è€Œæ”¹å˜ï¼Œå¹¶ä¸”å¼ºçƒˆä¾èµ–äºé‚£ä¸ªè®¾è®¡å†³ç­–ã€‚</p>
<p>è¿™ä¸ªé—®é¢˜çš„ç»å…¸é¢å‘å¯¹è±¡è§£å†³æ–¹æ¡ˆæ˜¯æå–å¦‚ä½•ç»˜åˆ¶åœ†çš„å†³ç­–ï¼Œå¹¶é€šè¿‡åŸºç±»å¼•å…¥æŠ½è±¡ï¼Œå¼•å…¥è¿™æ ·çš„å˜åŒ–ç‚¹æ˜¯ç­–ç•¥è®¾è®¡æ¨¡å¼çš„æ•ˆæœã€‚</p>
<p><strong>åº”ç”¨äºç»˜åˆ¶åœ†çš„ç­–ç•¥è®¾è®¡æ¨¡å¼</strong></p>
<p>ç­–ç•¥è®¾è®¡æ¨¡å¼çš„æ„å›¾æ˜¯å®šä¹‰ä¸€ç»„ç®—æ³•å¹¶å°†æ¯ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œä»è€Œä½¿å®ƒä»¬å¯ä»¥äº’æ¢ã€‚</p>
<p>ç­–ç•¥ä½¿ç®—æ³•ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·ç«¯è€Œå˜åŒ–ï¼Œé€šè¿‡å¼•å…¥<code>DrawStrategy</code>åŸºç±»ï¼Œä½¿å¾—è½»æ¾æ”¹å˜ç»™å®š<code>Circle</code>çš„<code>draw()</code>å®ç°æˆä¸ºå¯èƒ½ã€‚</p>
<p>è¿™ä¹Ÿä½¿å¾—æ¯ä¸ªäººï¼Œè€Œä¸ä»…ä»…æ˜¯ä½ è‡ªå·±ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç å°±èƒ½å®ç°æ–°çš„ç»˜åˆ¶è¡Œä¸ºï¼Œå¹¶ä»å¤–éƒ¨æ³¨å…¥åˆ°<code>Circle</code>ä¸­ã€‚</p>
<p>è¿™å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ä¾èµ–æ³¨å…¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Circle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;OpenGLStrategy.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ›å»ºæ‰€éœ€çš„åœ†çš„ç»˜åˆ¶ç­–ç•¥ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">auto</span> <span class="n">strategy</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">OpenGLStrategy</span><span class="o">&gt;</span><span class="p">(</span> <span class="cm">/* OpenGL ç‰¹å®šå‚æ•° */</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// å°†ç­–ç•¥æ³¨å…¥åˆ°åœ†ä¸­ï¼›åœ†ä¸éœ€è¦çŸ¥é“å…·ä½“çš„ç­–ç•¥ç±»å‹ï¼Œä½†å¯ä»¥é€šè¿‡ &#39;DrawStrategy&#39; æŠ½è±¡æ„‰å¿«åœ°ä½¿ç”¨å®ƒã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Circle</span> <span class="n">circle</span><span class="p">(</span><span class="mf">4.2</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">strategy</span><span class="p">));</span> 
</span></span><span class="line"><span class="cl">    <span class="n">circle</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ç§æ–¹æ³•å¤§å¤§æé«˜äº†ä¸åŒç»˜åˆ¶è¡Œä¸ºçš„çµæ´»æ€§ï¼šå®ƒåˆ†ç¦»äº†å¯¹ç‰¹å®šåº“å’Œå…¶ä»–å®ç°ç»†èŠ‚çš„æ‰€æœ‰ä¾èµ–ï¼Œä»è€Œä½¿ä»£ç æ›´æ˜“äºæ›´æ”¹å’Œæ‰©å±•ã€‚</p>
<p>ä¾‹å¦‚ï¼Œç°åœ¨å¾ˆå®¹æ˜“æä¾›ä¸€ä¸ªä¸“é—¨ç”¨äºæµ‹è¯•ç›®çš„çš„å®ç°ï¼ˆå³<code>TestStrategy</code>ï¼‰ã€‚</p>
<p>è¿™è¡¨æ˜æ”¹è¿›çš„çµæ´»æ€§å¯¹è®¾è®¡çš„å¯æµ‹è¯•æ€§æœ‰éå¸¸ç§¯æçš„å½±å“ã€‚</p>
<p>ç­–ç•¥è®¾è®¡æ¨¡å¼æ˜¯ç»å…¸çš„GoFè®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚å› æ­¤ï¼Œå®ƒå¸¸è¢«ç§°ä¸ºé¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”é€šå¸¸è¢«è®¤ä¸ºéœ€è¦ä¸€ä¸ªåŸºç±»ã€‚</p>
<p>ç„¶è€Œï¼Œç­–ç•¥çš„æ„å›¾ä¸é™äºé¢å‘å¯¹è±¡ç¼–ç¨‹ã€‚å°±åƒå¯ä»¥ä½¿ç”¨åŸºç±»è¿›è¡ŒæŠ½è±¡ä¸€æ ·ï¼ŒåŒæ ·å¯ä»¥ä¾èµ–æ¨¡æ¿å‚æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">DrawStrategy</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Circle</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">draw</span><span class="p">(</span> <span class="cm">/*...*/</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™ç§å½¢å¼ä¸‹ï¼Œå†³å®šå¦‚ä½•ç»˜åˆ¶åœ†æ˜¯åœ¨ç¼–è¯‘æ—¶å‘ç”Ÿçš„ï¼šä¸æ˜¯ç¼–å†™ä¸€ä¸ªåŸºç±»<code>DrawStrategy</code>å¹¶åœ¨è¿è¡Œæ—¶ä¼ é€’ä¸€ä¸ªæŒ‡å‘<code>DrawStrategy</code>çš„æŒ‡é’ˆï¼Œè€Œæ˜¯é€šè¿‡<code>DrawStrategy</code>æ¨¡æ¿å‚æ•°æä¾›ç»˜åˆ¶çš„å®ç°ç»†èŠ‚ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œè™½ç„¶æ¨¡æ¿å‚æ•°å…è®¸ä½ ä»å¤–éƒ¨æ³¨å…¥å®ç°ç»†èŠ‚ï¼Œä½†<code>Circle</code>ä»ç„¶ä¸ä¾èµ–äºä»»ä½•å®ç°ç»†èŠ‚ã€‚</p>
<p>å› æ­¤ï¼Œä½ ä»ç„¶å°†<code>Circle</code>ç±»ä¸ä½¿ç”¨çš„å›¾å½¢åº“è§£è€¦ï¼Œç„¶è€Œï¼Œä¸è¿è¡Œæ—¶æ–¹æ³•ç›¸æ¯”ï¼Œæ¯æ¬¡<code>DrawStrategy</code>æ›´æ”¹æ—¶éƒ½éœ€è¦é‡æ–°ç¼–è¯‘ã€‚</p>
<p>è™½ç„¶åŸºäºæ¨¡æ¿çš„è§£å†³æ–¹æ¡ˆä»æ ¹æœ¬ä¸Šæ”¹å˜äº†ç¤ºä¾‹çš„å±æ€§<br/>ï¼ˆå³æ²¡æœ‰åŸºç±»å’Œè™šå‡½æ•°ï¼Œæ²¡æœ‰è¿è¡Œæ—¶å†³ç­–ï¼Œæ²¡æœ‰å•ä¸€çš„<code>Circle</code>ç±»ï¼Œè€Œæ˜¯æ¯ä¸ªå…·ä½“çš„<code>DrawStrategy</code>éƒ½æœ‰ä¸€ä¸ª<code>Circle</code>ç±»å‹ï¼‰ï¼Œä½†å®ƒä»ç„¶å®Œç¾åœ°å®ç°äº†ç­–ç•¥è®¾è®¡æ¨¡å¼çš„æ„å›¾ã€‚</p>
<p>å› æ­¤ï¼Œè¿™è¡¨æ˜è®¾è®¡æ¨¡å¼å¹¶ä¸å±€é™äºç‰¹å®šçš„å®ç°æˆ–æŠ½è±¡çš„å…·ä½“å½¢å¼ã€‚</p>
<p><strong>è®¾è®¡æ¨¡å¼ä¸ä»…é™äºé¢å‘å¯¹è±¡ç¼–ç¨‹æˆ–åŠ¨æ€å¤šæ€</strong></p>
<p>è®©æˆ‘ä»¬è€ƒè™‘ç­–ç•¥è®¾è®¡æ¨¡å¼çš„å¦ä¸€ä¸ªç”¨ä¾‹ï¼šæ¥è‡ª <code>&lt;numeric&gt;</code> å¤´æ–‡ä»¶çš„æ ‡å‡†åº“ <code>accumulate()</code> å‡½æ•°æ¨¡æ¿ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span> <span class="p">};</span> 
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="k">const</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">accumulate</span><span class="p">(</span><span class="n">begin</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="kt">int</span><span class="p">{</span><span class="mi">0</span><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>std::accumulate()</code> å°†ç»™å®šèŒƒå›´å†…çš„æ‰€æœ‰å…ƒç´ ç›¸åŠ ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡å®šæ€»å’Œçš„åˆå§‹å€¼ï¼Œç”±äº <code>std::accumulate()</code> ä½¿ç”¨è¯¥å‚æ•°çš„ç±»å‹ä½œä¸ºè¿”å›ç±»å‹ï¼Œå› æ­¤æ˜¾å¼åœ°å°†ç±»å‹æŒ‡å®šä¸º <code>int{0}</code> è€Œä¸æ˜¯ç®€å•çš„ <code>0</code>ï¼Œä»¥é˜²æ­¢å¾®å¦™çš„è¯¯è§£ã€‚</p>
<p>ç„¶è€Œï¼Œç´¯åŠ å…ƒç´ åªæ˜¯å†°å±±ä¸€è§’ï¼šå¦‚æœä½ éœ€è¦ï¼Œå¯ä»¥é€šè¿‡æä¾›ç¬¬å››ä¸ªå‚æ•°æ¥æŒ‡å®šå¦‚ä½•ç´¯åŠ å…ƒç´ ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>&lt;functional&gt;</code> å¤´æ–‡ä»¶ä¸­çš„ <code>std::plus</code> æˆ– <code>std::multiplies</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span> <span class="p">};</span> 
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="k">const</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">accumulate</span><span class="p">(</span><span class="n">begin</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="kt">int</span><span class="p">{</span><span class="mi">0</span><span class="p">},</span> <span class="n">std</span><span class="o">::</span><span class="n">plus</span><span class="o">&lt;&gt;</span><span class="p">{});</span> 
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="k">const</span> <span class="n">product</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">accumulate</span><span class="p">(</span><span class="n">begin</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="kt">int</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span> <span class="n">std</span><span class="o">::</span><span class="n">multiplies</span><span class="o">&lt;&gt;</span><span class="p">{});</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡ç¬¬å››ä¸ªå‚æ•°ï¼Œ<code>std::accumulate()</code> å¯ç”¨äºä»»ä½•ç±»å‹çš„å½’çº¦æ“ä½œï¼Œå› æ­¤ç¬¬å››ä¸ªå‚æ•°ä»£è¡¨äº†å½’çº¦æ“ä½œçš„å®ç°ã€‚</p>
<p>è¿™æ ·ï¼Œå®ƒå…è®¸æˆ‘ä»¬é€šè¿‡ä»å¤–éƒ¨æ³¨å…¥å½’çº¦æ“ä½œçš„ç»†èŠ‚æ¥æ”¹å˜å®ç°ã€‚</p>
<p>å› æ­¤ï¼Œ<code>std::accumulate()</code> ä¸ä¾èµ–äºå•ä¸€çš„å…·ä½“å®ç°ï¼Œè€Œæ˜¯å¯ä»¥æ ¹æ®ç‰¹å®šéœ€æ±‚è¿›è¡Œå®šåˆ¶ï¼Œ<br/>è¿™æ­£æ˜¯ç­–ç•¥è®¾è®¡æ¨¡å¼çš„æ„å›¾ã€‚</p>
<p><code>std::accumulate()</code> çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå…¶é€šç”¨å½¢å¼çš„ç­–ç•¥è®¾è®¡æ¨¡å¼ï¼Œå¦‚æœæ²¡æœ‰èƒ½åŠ›æ”¹å˜è¿™ç§è¡Œä¸ºï¼Œå®ƒçš„ç”¨å¤„å°†éå¸¸æœ‰é™ã€‚ç”±äºç­–ç•¥è®¾è®¡æ¨¡å¼ï¼Œå¯èƒ½çš„ç”¨é€”æ˜¯æ— é™çš„ã€‚</p>
<p><code>std::accumulate()</code> çš„ä¾‹å­è¡¨æ˜ï¼Œè®¾è®¡æ¨¡å¼ï¼Œå³ä½¿æ˜¯ç»å…¸çš„GoFæ¨¡å¼ï¼Œä¹Ÿä¸å±€é™äºä¸€ç§ç‰¹å®šçš„å®ç°ï¼Œå¹¶ä¸”ä¸é™äºé¢å‘å¯¹è±¡ç¼–ç¨‹ã€‚</p>
<p>æ˜¾ç„¶ï¼Œè®¸å¤šè¿™äº›æ¨¡å¼çš„æ„å›¾å¯¹äºå…¶ä»–èŒƒå¼ï¼ˆå¦‚å‡½æ•°å¼ç¼–ç¨‹æˆ–æ³›å‹ç¼–ç¨‹ï¼‰ä¹Ÿæ˜¯æœ‰ç”¨çš„ã€‚</p>
<p>å› æ­¤ï¼Œè®¾è®¡æ¨¡å¼ä¸ä»…é™äºåŠ¨æ€å¤šæ€æ€§ï¼Œç›¸åï¼Œå®ƒä»¬åŒæ ·é€‚ç”¨äºé™æ€å¤šæ€æ€§ï¼Œå¹¶ä¸”å¯ä»¥ä¸C++æ¨¡æ¿ç»“åˆä½¿ç”¨ã€‚</p>
<p>ä¸ºäº†è¿›ä¸€æ­¥å¼ºè°ƒè¿™ä¸€ç‚¹å¹¶å±•ç¤ºç­–ç•¥è®¾è®¡æ¨¡å¼çš„å¦ä¸€ä¸ªä¾‹å­ï¼Œè€ƒè™‘ <code>std::vector</code> å’Œ <code>std::set</code> ç±»æ¨¡æ¿çš„å£°æ˜ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="n">std</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">template</span><span class="o">&lt;</span> <span class="k">class</span> <span class="nc">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Allocator</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl">	<span class="k">class</span> <span class="nc">vector</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">template</span><span class="o">&lt;</span> <span class="k">class</span> <span class="nc">Key</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Compare</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">less</span><span class="o">&lt;</span><span class="n">Key</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Allocator</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="n">Key</span><span class="o">&gt;</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl">	<span class="k">class</span> <span class="nc">set</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c1">// namespace std
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ ‡å‡†åº“ä¸­çš„æ‰€æœ‰å®¹å™¨ï¼ˆé™¤äº† <code>std::array</code>ï¼‰éƒ½æä¾›äº†æŒ‡å®šè‡ªå®šä¹‰åˆ†é…å™¨çš„æœºä¼šã€‚</p>
<p>å¯¹äº <code>std::vector</code> æ¥è¯´ï¼Œå®ƒæ˜¯ç¬¬äºŒä¸ªæ¨¡æ¿å‚æ•°ï¼›<br/>å¯¹äº <code>std::set</code> æ¥è¯´ï¼Œå®ƒæ˜¯ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚</p>
<p>å®¹å™¨çš„æ‰€æœ‰å†…å­˜è¯·æ±‚éƒ½é€šè¿‡ç»™å®šçš„åˆ†é…å™¨å¤„ç†ã€‚</p>
<p>é€šè¿‡æš´éœ²ä¸€ä¸ªæ¨¡æ¿å‚æ•°ç”¨äºåˆ†é…å™¨ï¼Œæ ‡å‡†åº“å®¹å™¨ä¸ºä½ æä¾›äº†ä»å¤–éƒ¨è‡ªå®šä¹‰å†…å­˜åˆ†é…çš„æœºä¼šï¼Œå®ƒä»¬ä½¿ä½ èƒ½å¤Ÿå®šä¹‰ä¸€ç»„ç®—æ³•ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ˜¯ä¸€ä¸ªå†…å­˜è·å–ç®—æ³•ï¼‰ï¼Œå¹¶å°†æ¯ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œä»è€Œä½¿å®ƒä»¬å¯äº’æ¢ã€‚</p>
<p>å› æ­¤ï¼Œä½ å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨è¿™äº›ç®—æ³•çš„å®¢æˆ·ç«¯ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯å®¹å™¨ï¼‰æ¥æ›´æ”¹è¿™ä¸ªç®—æ³•ã€‚</p>
<p>é˜…è¯»äº†ä¸Šè¿°æè¿°åï¼Œä½ åº”è¯¥èƒ½è¯†åˆ«å‡ºç­–ç•¥è®¾è®¡æ¨¡å¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç­–ç•¥å†æ¬¡åŸºäºé™æ€å¤šæ€æ€§å¹¶é€šè¿‡æ¨¡æ¿å‚æ•°å®ç°ã€‚æ˜¾ç„¶ï¼Œç­–ç•¥ä¸é™äºåŠ¨æ€å¤šæ€æ€§ã€‚</p>
<p>è™½ç„¶å¾ˆæ˜æ˜¾è®¾è®¡æ¨¡å¼æ€»ä½“ä¸Šå¹¶ä¸å±€é™äºé¢å‘å¯¹è±¡ç¼–ç¨‹æˆ–åŠ¨æ€å¤šæ€æ€§ï¼Œä½†ä»ç„¶åº”è¯¥æ˜ç¡®æŒ‡å‡ºï¼Œæœ‰äº›è®¾è®¡æ¨¡å¼çš„æ„å›¾æ˜¯ä¸ºäº†ç¼“è§£é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„å¸¸è§é—®é¢˜ï¼ˆä¾‹å¦‚ï¼Œè®¿é—®è€…æ¨¡å¼å’ŒåŸå‹æ¨¡å¼ï¼‰ã€‚</p>
<p>å½“ç„¶ï¼Œä¹Ÿæœ‰ä¸€äº›ä¸“æ³¨äºå‡½æ•°å¼ç¼–ç¨‹æˆ–æ³›å‹ç¼–ç¨‹çš„è®¾è®¡æ¨¡å¼ï¼ˆä¾‹å¦‚ï¼Œé€’å½’æ¨¡æ¿æ¨¡å¼ [CRTP] å’Œè¡¨è¾¾å¼æ¨¡æ¿ï¼‰ã€‚</p>
<p>è™½ç„¶å¤§å¤šæ•°è®¾è®¡æ¨¡å¼å¹¶ä¸æ˜¯ç‰¹å®šäºæŸä¸ªèŒƒå¼çš„ï¼Œå…¶æ„å›¾å¯ä»¥åœ¨å¤šç§å®ç°ä¸­ä½¿ç”¨ï¼Œä½†æœ‰äº›æ¨¡å¼åˆ™æ›´åŠ å…·ä½“ã€‚</p>
<p>åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­ï¼Œä½ ä¼šçœ‹åˆ°è¿™ä¸¤ç±»çš„ä¾‹å­ï¼Œä½ ä¼šçœ‹åˆ°ä¸€äº›å…·æœ‰éå¸¸æ™®éæ„å›¾çš„è®¾è®¡æ¨¡å¼ï¼Œå› æ­¤å…·æœ‰å¹¿æ³›çš„å®ç”¨æ€§ã€‚</p>
<p>æ­¤å¤–ï¼Œä½ è¿˜ä¼šçœ‹åˆ°ä¸€äº›æ›´ç‰¹å®šäºæŸç§èŒƒå¼çš„æ¨¡å¼ï¼Œç”±äºå…¶ç‰¹æ€§ï¼Œå®ƒä»¬åœ¨ç›®æ ‡é¢†åŸŸä¹‹å¤–å¯èƒ½æ²¡æœ‰ç”¨å¤„ã€‚</p>
<p>å°½ç®¡å¦‚æ­¤ï¼Œå®ƒä»¬éƒ½å…·æœ‰è®¾è®¡æ¨¡å¼çš„ä¸»è¦ç‰¹å¾ï¼šåç§°ã€æ„å›¾å’ŒæŸç§å½¢å¼çš„æŠ½è±¡ã€‚</p>
<p>æ€»ç»“æ¥è¯´ï¼šè®¾è®¡æ¨¡å¼ä¸ä»…é™äºé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œä¹Ÿä¸é™äºåŠ¨æ€å¤šæ€æ€§ï¼Œæ›´å…·ä½“åœ°è¯´ï¼Œè®¾è®¡æ¨¡å¼ä¸å…³ä¹ç‰¹å®šçš„å®ç°ï¼Œä¹Ÿä¸æ˜¯ç‰¹å®šè¯­è¨€çš„ä¹ æƒ¯ç”¨æ³•ã€‚ç›¸åï¼Œå®ƒä»¬å®Œå…¨å…³æ³¨ä»¥ç‰¹å®šæ–¹å¼è§£è€¦è½¯ä»¶å®ä½“çš„æ„å›¾ã€‚</p>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>å°†è®¾è®¡æ¨¡å¼è§†ä¸ºè§£å†³è®¾è®¡é—®é¢˜çš„å·¥å…·ï¼Œè€Œä¸æ˜¯ç›®æ ‡ã€‚</li>
<li>è¯·æ³¨æ„ï¼Œè®¾è®¡æ¨¡å¼ä¸ä»…é™äºé¢å‘å¯¹è±¡ç¼–ç¨‹ã€‚</li>
<li>è®°ä½ï¼Œè®¾è®¡æ¨¡å¼ä¸ä»…é™äºåŠ¨æ€å¤šæ€æ€§ã€‚</li>
<li>ç†è§£è®¾è®¡æ¨¡å¼ä¸æ˜¯ç‰¹å®šäºæŸç§è¯­è¨€çš„ä¹ æƒ¯ç”¨æ³•ã€‚</li>
</ul>
<h3 id="å‡†åˆ™13è®¾è®¡æ¨¡å¼æ— å¤„ä¸åœ¨">å‡†åˆ™13ï¼šè®¾è®¡æ¨¡å¼æ— å¤„ä¸åœ¨
</h3><p>ä¸Šä¸€èŠ‚å·²ç»è¡¨æ˜ï¼Œè®¾è®¡æ¨¡å¼ä¸ä»…é™äºé¢å‘å¯¹è±¡ç¼–ç¨‹æˆ–åŠ¨æ€å¤šæ€æ€§ï¼Œå®ƒä»¬ä¹Ÿä¸æ˜¯ç‰¹å®šè¯­è¨€çš„ä¹ æƒ¯ç”¨æ³•ï¼Œå¹¶ä¸”ä¸å±€é™äºæŸç§ç‰¹å®šçš„å®ç°ã€‚</p>
<p>ç„¶è€Œï¼Œç”±äºè¿™äº›å¸¸è§çš„è¯¯è§£ä»¥åŠæˆ‘ä»¬ä¸å†å°†C++è§†ä¸ºçº¯ç²¹çš„é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ï¼Œæœ‰äº›äººç”šè‡³å£°ç§°è®¾è®¡æ¨¡å¼å·²ç»è¿‡æ—¶æˆ–è¢«æ·˜æ±°ã€‚</p>
<p>æˆ‘æƒ³è±¡ä½ ç°åœ¨å¯èƒ½æœ‰äº›æ€€ç–‘ã€‚â€œè¿‡æ—¶ï¼Ÿè¿™éš¾é“ä¸æ˜¯æœ‰ç‚¹å¤¸å¼ å—ï¼Ÿâ€ä½ å¯èƒ½ä¼šé—®ã€‚å¥½å§ï¼Œä¸å¹¸çš„æ˜¯å¹¶éå¦‚æ­¤ã€‚</p>
<p>è®©æˆ‘è®²ä¸€ä¸ªå°æ•…äº‹ï¼Œåœ¨2021å¹´åˆï¼Œæˆ‘æœ‰å¹¸åœ¨ä¸€ä¸ªå¾·å›½C++ç”¨æˆ·ç»„ä¸­åšäº†ä¸€æ¬¡å…³äºè®¾è®¡æ¨¡å¼çš„è™šæ‹Ÿæ¼”è®²ï¼Œæˆ‘çš„ä¸»è¦ç›®æ ‡æ˜¯è§£é‡Šä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Œå¹¶è¯´æ˜å®ƒä»¬åœ¨ä»Šå¤©ä»ç„¶éå¸¸æœ‰ç”¨ã€‚</p>
<p>åœ¨æ¼”è®²è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ„Ÿåˆ°å¾ˆå¥½ï¼Œå……æ»¡åŠ¨åŠ›ï¼Œå¸Œæœ›èƒ½å¸®åŠ©äººä»¬çœ‹åˆ°è®¾è®¡æ¨¡å¼å¸¦æ¥çš„æ‰€æœ‰å¥½å¤„ã€‚</p>
<p>ç„¶è€Œï¼Œå‡ å¤©åï¼Œå½“æ¼”è®²åœ¨YouTubeä¸Šå‘å¸ƒåï¼Œæœ‰ä¸€ä½ç”¨æˆ·è¯„è®ºè¯´ï¼šâ€œçœŸçš„å—ï¼Ÿ2021å¹´çš„è®¾è®¡æ¨¡å¼ï¼Ÿâ€</p>
<p>æˆ‘éå¸¸å¸Œæœ›ä½ ç°åœ¨æ­£åœ¨æ‘‡å¤´è¡¨ç¤ºä¸ç›¸ä¿¡ï¼Œæ˜¯çš„ï¼Œæˆ‘ä¹Ÿæ— æ³•ç›¸ä¿¡è¿™ä¸€ç‚¹ï¼Œå°¤å…¶æ˜¯åœ¨å±•ç¤ºäº†C++æ ‡å‡†åº“ä¸­æœ‰æ•°ç™¾ä¸ªè®¾è®¡æ¨¡å¼çš„ä¾‹å­ä¹‹åã€‚ä¸ï¼Œè®¾è®¡æ¨¡å¼æ—¢ä¸è¿‡æ—¶ä¹Ÿä¸æ·˜æ±°ï¼Œäº‹å®è¿œéå¦‚æ­¤ã€‚</p>
<p>ä¸ºäº†è¯æ˜è®¾è®¡æ¨¡å¼ä»ç„¶éå¸¸æ´»è·ƒå’Œç›¸å…³ï¼Œè®©æˆ‘ä»¬è€ƒè™‘C++æ ‡å‡†åº“ä¸­æ›´æ–°çš„åˆ†é…å™¨è®¾æ–½ã€‚</p>
<p>è¯·çœ‹ä¸‹é¢ä½¿ç”¨æ¥è‡ª <code>std::pmr</code>ï¼ˆå¤šæ€å†…å­˜èµ„æºï¼‰å‘½åç©ºé—´çš„åˆ†é…å™¨çš„ä»£ç ç¤ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;array&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstddef&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory_resource&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">byte</span><span class="p">,</span> <span class="mi">1000</span><span class="o">&gt;</span> <span class="n">raw</span><span class="p">;</span>  <span class="c1">// æ³¨æ„ï¼šæœªåˆå§‹åŒ–ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">pmr</span><span class="o">::</span><span class="n">monotonic_buffer_resource</span> <span class="n">buffer</span><span class="p">{</span><span class="n">raw</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">raw</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">std</span><span class="o">::</span><span class="n">pmr</span><span class="o">::</span><span class="n">null_memory_resource</span><span class="p">()};</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">pmr</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pmr</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">strings</span><span class="p">{</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">strings</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="s">&#34;String longer than what SSO can handle&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">strings</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="s">&#34;Another long string that goes beyond SSO&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">strings</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="s">&#34;A third long string that cannot be handled by SSO&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>std::pmr::monotonic_buffer_resource</code> ä½œä¸ºåˆ†é…å™¨ï¼Œå°†æ‰€æœ‰çš„å†…å­˜åˆ†é…é‡å®šå‘åˆ°ä¸€ä¸ªé¢„å®šä¹‰çš„å­—èŠ‚ç¼“å†²åŒºã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå¤§å°ä¸º1000å­—èŠ‚çš„ç¼“å†²åŒºï¼Œå½¢å¼æ˜¯ä¸€ä¸ª <code>std::array</code>ï¼ˆæ³¨æ„ï¼šæœªåˆå§‹åŒ–ï¼‰ã€‚<br/>è¯¥ç¼“å†²åŒºé€šè¿‡ä¼ é€’ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆï¼ˆé€šè¿‡ <code>raw.data()</code>ï¼‰å’Œç¼“å†²åŒºçš„å¤§å°ï¼ˆé€šè¿‡ <code>raw.size()</code>ï¼‰æä¾›ç»™ <code>std::pmr::monotonic_buffer_resource</code> ä½œä¸ºå†…å­˜æºã€‚<br/><code>monotonic_buffer_resource</code> çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä»£è¡¨ä¸€ä¸ªå¤‡ä»½åˆ†é…å™¨ï¼Œå½“ <code>monotonic_buffer_resource</code> è€—å°½å†…å­˜æ—¶ä½¿ç”¨ã€‚<br/>å› ä¸ºæˆ‘ä»¬åœ¨è¿™ä¸ªä¾‹å­ä¸­ä¸éœ€è¦é¢å¤–çš„å†…å­˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ <code>std::pmr::null_memory_resource()</code> å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªæ€»æ˜¯åˆ†é…å¤±è´¥çš„æ ‡å‡†åˆ†é…å™¨çš„æŒ‡é’ˆã€‚<br/>è¿™æ„å‘³ç€æ— è®ºä½ æ€ä¹ˆè¯·æ±‚å†…å­˜ï¼Œç”± <code>std::pmr::null_memory_resource()</code> è¿”å›çš„åˆ†é…å™¨éƒ½ä¼šåœ¨è¯·æ±‚å†…å­˜æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚<br/>åˆ›å»ºçš„ç¼“å†²åŒºä½œä¸ºåˆ†é…å™¨ä¼ é€’ç»™å­—ç¬¦ä¸²å‘é‡ï¼Œè¯¥å‘é‡ç°åœ¨å°†ä»åˆå§‹å­—èŠ‚ç¼“å†²åŒºè·å–æ‰€æœ‰å†…å­˜ã€‚</p>
<p>æ­¤å¤–ï¼Œç”±äºå‘é‡å°†å…¶åˆ†é…å™¨è½¬å‘ç»™å…¶å…ƒç´ ï¼Œå³ä½¿æˆ‘ä»¬é€šè¿‡ <code>emplace_back()</code> å‡½æ•°æ·»åŠ çš„ä¸‰ä¸ªå­—ç¬¦ä¸²éƒ½å¤ªé•¿è€Œä¸èƒ½ä¾èµ–å°å­—ç¬¦ä¸²ä¼˜åŒ–ï¼ˆSSOï¼‰ï¼Œå®ƒä»¬ä¹Ÿå°†ä»å­—èŠ‚æ•°ç»„ä¸­è·å–æ‰€æœ‰å†…å­˜ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨æ•´ä¸ªç¤ºä¾‹ä¸­æ²¡æœ‰ä½¿ç”¨åŠ¨æ€å†…å­˜ï¼›æ‰€æœ‰å†…å­˜éƒ½å°†ä»å­—èŠ‚æ•°ç»„ä¸­è·å–ã€‚</p>
<p>ä¹ä¸€çœ‹ï¼Œè¿™ä¸ªä¾‹å­ä¼¼ä¹ä¸éœ€è¦ä»»ä½•è®¾è®¡æ¨¡å¼å°±èƒ½å·¥ä½œã€‚ç„¶è€Œï¼Œè¿™ä¸ªä¾‹å­ä¸­ä½¿ç”¨çš„åˆ†é…å™¨åŠŸèƒ½è‡³å°‘ä½¿ç”¨äº†å››ç§ä¸åŒçš„è®¾è®¡æ¨¡å¼ï¼šæ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ã€è£…é¥°å™¨è®¾è®¡æ¨¡å¼ã€é€‚é…å™¨è®¾è®¡æ¨¡å¼å’Œï¼ˆå†æ¬¡ï¼‰ç­–ç•¥è®¾è®¡æ¨¡å¼ã€‚</p>
<p>å¦‚æœä½ è®¡ç®—å•ä¾‹æ¨¡å¼ï¼Œç”šè‡³æœ‰äº”ç§è®¾è®¡æ¨¡å¼ï¼š<code>null_memory_resource()</code> å‡½æ•°æ˜¯åŸºäºå•ä¾‹æ¨¡å¼å®ç°çš„ï¼šå®ƒè¿”å›ä¸€ä¸ªé™æ€å­˜å‚¨æŒç»­æ—¶é—´å¯¹è±¡çš„æŒ‡é’ˆï¼Œç”¨äºä¿è¯æœ€å¤šåªæœ‰ä¸€ä¸ªæ­¤ç±»åˆ†é…å™¨å®ä¾‹ã€‚</p>
<p>æ‰€æœ‰æ¥è‡ª <code>pmr</code> å‘½åç©ºé—´çš„C++åˆ†é…å™¨ï¼ŒåŒ…æ‹¬ç”± <code>null_memory_resource()</code> å’Œ <code>monotonic_buffer_resource</code> è¿”å›çš„åˆ†é…å™¨ï¼Œéƒ½æ˜¯ä» <code>std::pmr::memory_resource</code> åŸºç±»æ´¾ç”Ÿçš„ã€‚</p>
<p>å¦‚æœä½ æŸ¥çœ‹ <code>memory_resource</code> ç±»çš„å®šä¹‰ï¼Œç¬¬ä¸€ä¸ªè®¾è®¡æ¨¡å¼å°±å˜å¾—å¯è§äº†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="n">std</span><span class="o">::</span><span class="n">pmr</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">memory_resource</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ... è™šææ„å‡½æ•°ã€ä¸€äº›æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="na">[[nodiscard]]</span> <span class="kt">void</span><span class="o">*</span> <span class="n">allocate</span><span class="p">(</span><span class="n">size_t</span> <span class="n">bytes</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">alignment</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">deallocate</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">p</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">bytes</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">alignment</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">bool</span> <span class="nf">is_equal</span><span class="p">(</span><span class="n">memory_resource</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="k">const</span> <span class="k">noexcept</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span><span class="o">*</span> <span class="n">do_allocate</span><span class="p">(</span><span class="n">size_t</span> <span class="n">bytes</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">alignment</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">do_deallocate</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">p</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">bytes</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">alignment</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">do_is_equal</span><span class="p">(</span><span class="n">memory_resource</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="k">const</span> <span class="k">noexcept</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c1">// namespace std::pmr
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œç±»çš„å…¬å…±éƒ¨åˆ†ä¸­çš„ä¸‰ä¸ªå‡½æ•°åœ¨ç±»çš„ç§æœ‰éƒ¨åˆ†ä¸­æœ‰ä¸€ä¸ªå¯¹åº”çš„è™šå‡½æ•°ã€‚</p>
<p>è™½ç„¶å…¬å…±çš„ <code>allocate()</code>ã€<code>deallocate()</code> å’Œ <code>is_equal()</code> å‡½æ•°ä»£è¡¨äº†ç±»çš„ç”¨æˆ·æ¥å£ï¼Œä½† <code>do_allocate()</code>ã€<code>do_deallocate()</code> å’Œ <code>do_is_equal()</code> å‡½æ•°ä»£è¡¨äº†æ´¾ç”Ÿç±»çš„æ¥å£ã€‚</p>
<p>è¿™ç§å…³æ³¨ç‚¹åˆ†ç¦»æ˜¯ <strong>éè™šæ‹Ÿæ¥å£ï¼ˆNVIï¼‰</strong> æ¨¡å¼çš„ä¾‹å­ï¼Œå®ƒæœ¬èº«ä¹Ÿæ˜¯ <strong>æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼</strong> çš„ä¸€ä¸ªä¾‹å­ã€‚</p>
<p><strong>ç¬¬äºŒä¸ªè®¾è®¡æ¨¡å¼ï¼šè£…é¥°å™¨è®¾è®¡æ¨¡å¼</strong></p>
<p>æˆ‘ä»¬éšå¼ä½¿ç”¨çš„ç¬¬äºŒä¸ªè®¾è®¡æ¨¡å¼æ˜¯ <strong>è£…é¥°å™¨è®¾è®¡æ¨¡å¼</strong>ã€‚è£…é¥°å™¨å¸®åŠ©ä½ æ„å»ºåˆ†é…å™¨çš„å±‚æ¬¡ç»“æ„ï¼Œå¹¶å°†ä¸€ä¸ªåˆ†é…å™¨çš„åŠŸèƒ½æ‰©å±•åˆ°å¦ä¸€ä¸ªåˆ†é…å™¨ã€‚è¿™ä¸ªæƒ³æ³•åœ¨è¿™è¡Œä»£ç ä¸­å˜å¾—æ›´åŠ æ¸…æ™°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">pmr</span><span class="o">::</span><span class="n">monotonic_buffer_resource</span> <span class="n">buffer</span><span class="p">{</span> <span class="n">raw</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">raw</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">std</span><span class="o">::</span><span class="n">pmr</span><span class="o">::</span><span class="n">null_memory_resource</span><span class="p">()</span> <span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡å°† <code>null_memory_resource()</code> å‡½æ•°è¿”å›çš„åˆ†é…å™¨ä¼ é€’ç»™ <code>monotonic_buffer_resource</code>ï¼Œæˆ‘ä»¬å¢å¼ºäº†å®ƒçš„åŠŸèƒ½ã€‚</p>
<p>æ¯å½“æˆ‘ä»¬é€šè¿‡ <code>allocate()</code> å‡½æ•°è¯·æ±‚ <code>monotonic_buffer_resource</code> åˆ†é…å†…å­˜æ—¶ï¼Œå®ƒå¯èƒ½ä¼šå°†è°ƒç”¨è½¬å‘ç»™å…¶å¤‡ä»½åˆ†é…å™¨ã€‚</p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°è®¸å¤šä¸åŒç±»å‹çš„åˆ†é…å™¨ï¼Œè¿™äº›åˆ†é…å™¨å¯ä»¥è½»æ¾ç»„åˆå½¢æˆä¸€ä¸ªå…·æœ‰ä¸åŒåˆ†é…ç­–ç•¥å±‚çš„å®Œæ•´å†…å­˜å­ç³»ç»Ÿã€‚è¿™ç§ç»“åˆå’Œé‡ç”¨åŠŸèƒ½çš„æ–¹å¼æ­£æ˜¯ <strong>è£…é¥°å™¨è®¾è®¡æ¨¡å¼</strong> çš„ä¼˜åŠ¿æ‰€åœ¨ã€‚</p>
<p><strong>ç¬¬ä¸‰ä¸ªè®¾è®¡æ¨¡å¼ï¼šé€‚é…å™¨è®¾è®¡æ¨¡å¼</strong></p>
<p>ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œåœ¨ç¤ºä¾‹ä»£ç ä¸­æˆ‘ä»¬ä½¿ç”¨äº† <code>std::pmr::vector</code> å’Œ <code>std::pmr::string</code>ã€‚</p>
<p>æˆ‘å‡è®¾ä½ è¿˜è®°å¾— <code>std::string</code> åªæ˜¯ <code>std::basic_string&lt;char&gt;</code> çš„ç±»å‹åˆ«åã€‚çŸ¥é“è¿™ä¸€ç‚¹åï¼Œä¸‹é¢çš„å†…å®¹åº”è¯¥ä¸ä¼šè®©ä½ æ„Ÿåˆ°æ„å¤–ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="n">std</span><span class="o">::</span><span class="n">pmr</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">CharT</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Traits</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="n">CharT</span><span class="o">&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">basic_string</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="n">CharT</span><span class="p">,</span> <span class="n">Traits</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">pmr</span><span class="o">::</span><span class="n">polymorphic_allocator</span><span class="o">&lt;</span><span class="n">CharT</span><span class="o">&gt;&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">vector</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">pmr</span><span class="o">::</span><span class="n">polymorphic_allocator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c1">// namespace std::pmr
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™äº›ç±»å‹åˆ«åä»ç„¶æŒ‡å‘å¸¸è§„çš„ <code>std::vector</code> å’Œ <code>std::basic_string</code> ç±»ï¼Œä½†ä¸å†æš´éœ²åˆ†é…å™¨çš„æ¨¡æ¿å‚æ•°ã€‚</p>
<p>ç›¸åï¼Œå®ƒä»¬ä½¿ç”¨ <code>std::pmr::polymorphic_allocator</code> ä½œä¸ºåˆ†é…å™¨ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ª <strong>é€‚é…å™¨è®¾è®¡æ¨¡å¼</strong> çš„ä¾‹å­ï¼Œé€‚é…å™¨çš„ç›®çš„æ˜¯å¸®åŠ©ä½ å°†ä¸¤ä¸ªä¸åŒ¹é…çš„æ¥å£ç²˜åˆåœ¨ä¸€èµ·ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>polymorphic_allocator</code> å¸®åŠ©åœ¨ç»å…¸é™æ€æ¥å£ï¼ˆä¼ ç»ŸC++åˆ†é…å™¨æ‰€éœ€ï¼‰å’Œæ–°çš„åŠ¨æ€åˆ†é…å™¨æ¥å£ï¼ˆ<code>std::pmr::memory_resource</code> æ‰€éœ€ï¼‰ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</p>
<p><strong>ç¬¬å››ä¸ªè®¾è®¡æ¨¡å¼ï¼šç­–ç•¥è®¾è®¡æ¨¡å¼</strong></p>
<p>æˆ‘ä»¬ç¤ºä¾‹ä¸­ä½¿ç”¨çš„ç¬¬å››ä¸ªä¹Ÿæ˜¯æœ€åä¸€ä¸ªè®¾è®¡æ¨¡å¼ï¼Œå†æ¬¡æ˜¯ <strong>ç­–ç•¥è®¾è®¡æ¨¡å¼</strong>ã€‚</p>
<p>é€šè¿‡å…¬å¼€åˆ†é…å™¨çš„æ¨¡æ¿å‚æ•°ï¼Œæ ‡å‡†åº“å®¹å™¨å¦‚ <code>std::vector</code> å’Œ <code>std::string</code> è®©ä½ å¯ä»¥ä»å¤–éƒ¨è‡ªå®šä¹‰å†…å­˜åˆ†é…ã€‚</p>
<p>è¿™æ˜¯ <strong>ç­–ç•¥è®¾è®¡æ¨¡å¼</strong> çš„é™æ€å½¢å¼ï¼Œä¸è‡ªå®šä¹‰ç®—æ³•çš„ç›®çš„ç›¸åŒï¼ˆå‚è§â€œå‡†åˆ™12ï¼šæ³¨æ„è®¾è®¡æ¨¡å¼çš„è¯¯è§£â€ï¼‰ã€‚</p>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>ç†è§£ä»»ä½•ç±»å‹çš„æŠ½è±¡å’Œä»»ä½•è§£è€¦å°è¯•å¾ˆå¯èƒ½ä»£è¡¨äº†ä¸€ç§å·²çŸ¥çš„è®¾è®¡æ¨¡å¼ã€‚</li>
<li>äº†è§£ä¸åŒçš„è®¾è®¡æ¨¡å¼åŠå…¶è§£è€¦çš„æ„å›¾ã€‚</li>
<li>æ ¹æ®è®¾è®¡æ¨¡å¼çš„æ„å›¾ï¼Œåœ¨å¿…è¦æ—¶åº”ç”¨å®ƒä»¬ã€‚</li>
</ul>
<h3 id="å‡†åˆ™14ä½¿ç”¨è®¾è®¡æ¨¡å¼çš„åç§°æ¥ä¼ è¾¾æ„å›¾">å‡†åˆ™14ï¼šä½¿ç”¨è®¾è®¡æ¨¡å¼çš„åç§°æ¥ä¼ è¾¾æ„å›¾
</h3><p>åœ¨å‰ä¸¤èŠ‚ä¸­ï¼Œä½ äº†è§£äº†ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Œå®ƒä¸æ˜¯ä»€ä¹ˆï¼Œä»¥åŠè®¾è®¡æ¨¡å¼æ— å¤„ä¸åœ¨ã€‚</p>
<p>ä½ è¿˜äº†è§£åˆ°æ¯ä¸ªè®¾è®¡æ¨¡å¼éƒ½æœ‰ä¸€ä¸ªåç§°ï¼Œè¿™ä¸ªåç§°è¡¨è¾¾äº†æ¸…æ™°ã€ç®€æ´ä¸”æ˜ç¡®çš„æ„å›¾ã€‚å› æ­¤ï¼Œåç§°æ‰¿è½½ç€æ„ä¹‰ã€‚é€šè¿‡ä½¿ç”¨è®¾è®¡æ¨¡å¼çš„åç§°ï¼Œä½ å¯ä»¥è¡¨è¾¾é—®é¢˜æ˜¯ä»€ä¹ˆï¼Œé€‰æ‹©äº†å“ªç§è§£å†³æ–¹æ¡ˆæ¥è§£å†³é—®é¢˜ï¼Œå¹¶æè¿°ä»£ç é¢„æœŸå¦‚ä½•æ¼”å˜ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘æ ‡å‡†åº“ä¸­çš„ <code>accumulate()</code> å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">class</span> <span class="nc">InputIt</span><span class="p">,</span> <span class="k">class</span> <span class="nc">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">BinaryOperation</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">constexpr</span> <span class="n">T</span> <span class="n">accumulate</span><span class="p">(</span> <span class="n">InputIt</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIt</span> <span class="n">last</span><span class="p">,</span> <span class="n">T</span> <span class="n">init</span><span class="p">,</span> <span class="n">BinaryOperation</span> <span class="n">op</span> <span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬ä¸‰ä¸ªæ¨¡æ¿å‚æ•°åä¸º <code>BinaryOperation</code>ï¼Œè™½ç„¶è¿™ç¡®å®ä¼ è¾¾äº†ä¼ é€’çš„å¯è°ƒç”¨å¯¹è±¡éœ€è¦æ¥å—ä¸¤ä¸ªå‚æ•°çš„äº‹å®ï¼Œä½†åç§°å¹¶æ²¡æœ‰ä¼ è¾¾å‚æ•°çš„æ„å›¾ã€‚</p>
<p>ä¸ºäº†æ›´æ¸…æ™°åœ°è¡¨è¾¾æ„å›¾ï¼Œå¯ä»¥å°†å…¶å‘½åä¸º <code>BinaryReductionStrategy</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">class</span> <span class="nc">InputIt</span><span class="p">,</span> <span class="k">class</span> <span class="nc">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">BinaryReductionStrategy</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">constexpr</span> <span class="n">T</span> <span class="n">accumulate</span><span class="p">(</span> <span class="n">InputIt</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIt</span> <span class="n">last</span><span class="p">,</span> <span class="n">T</span> <span class="n">init</span><span class="p">,</span> <span class="n">BinaryReductionStrategy</span> <span class="n">op</span> <span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ¯è¯­â€œReductionâ€å’Œåç§°â€œStrategyâ€å¯¹æ¯ä¸ªC++ç¨‹åºå‘˜æ¥è¯´éƒ½å…·æœ‰æ„ä¹‰ï¼Œå› æ­¤ï¼Œä½ ç°åœ¨æ›´æ¸…æ™°åœ°æ•æ‰å¹¶è¡¨è¾¾äº†ä½ çš„æ„å›¾ï¼šè¯¥å‚æ•°å…è®¸ä¾èµ–æ³¨å…¥ä¸€ä¸ªäºŒå…ƒæ“ä½œï¼Œä»è€Œå…è®¸ä½ æŒ‡å®šå½’çº¦æ“ä½œçš„å·¥ä½œæ–¹å¼ã€‚å› æ­¤ï¼Œè¯¥å‚æ•°è§£å†³äº†è‡ªå®šä¹‰çš„é—®é¢˜ã€‚</p>
<p>ç„¶è€Œï¼Œæ­£å¦‚ä½ å°†åœ¨ç¬¬5ç« çœ‹åˆ°çš„ï¼Œç­–ç•¥è®¾è®¡æ¨¡å¼ä¼ è¾¾äº†å¯¹è¯¥æ“ä½œæœ‰ä¸€å®šçš„æœŸæœ›ï¼Œä½ åªèƒ½æŒ‡å®šå½’çº¦æ“ä½œçš„å·¥ä½œæ–¹å¼ï¼›ä¸èƒ½é‡æ–°å®šä¹‰ <code>accumulate()</code> çš„åŠŸèƒ½ã€‚</p>
<p>å¦‚æœä½ æƒ³è¡¨è¾¾è¿™ä¸€ç‚¹ï¼Œä½ åº”è¯¥ä½¿ç”¨å‘½ä»¤è®¾è®¡æ¨¡å¼çš„åç§°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">class</span> <span class="nc">InputIt</span><span class="p">,</span> <span class="k">class</span> <span class="nc">UnaryCommand</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">constexpr</span> <span class="n">UnaryCommand</span> <span class="n">for_each</span><span class="p">(</span> <span class="n">InputIt</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIt</span> <span class="n">last</span><span class="p">,</span> <span class="n">UnaryCommand</span> <span class="n">f</span> <span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>std::for_each()</code> ç®—æ³•å…è®¸ä½ å°†ä»»ä½•ä¸€å…ƒæ“ä½œåº”ç”¨äºä¸€ç³»åˆ—å…ƒç´ ï¼Œä¸ºäº†è¡¨è¾¾è¿™ä¸€æ„å›¾ï¼Œç¬¬äºŒä¸ªæ¨¡æ¿å‚æ•°å¯ä»¥å‘½åä¸º <code>UnaryCommand</code>ï¼Œè¿™æ˜ç¡®è¡¨ç¤ºå¯¹è¯¥æ“ä½œå‡ ä¹æ²¡æœ‰é¢„æœŸçš„è¦æ±‚ã€‚</p>
<p>å¦ä¸€ä¸ªæ¥è‡ªæ ‡å‡†åº“çš„ä¾‹å­å±•ç¤ºäº†è®¾è®¡æ¨¡å¼åç§°èƒ½ä¸ºä¸€æ®µä»£ç å¸¦æ¥å¤šå°‘ä»·å€¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;variant&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Print</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;int: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="kt">double</span> <span class="n">d</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;double: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">d</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;string: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">s</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">{};</span>  
</span></span><span class="line"><span class="cl">    <span class="n">v</span> <span class="o">=</span> <span class="s">&#34;C++ Variant example&#34;</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">Print</span><span class="p">{},</span> <span class="n">v</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ <code>main()</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªé€‰é¡¹ï¼ˆ<code>int</code>ã€<code>double</code> å’Œ <code>std::string</code>ï¼‰çš„ <code>std::variant</code>ã€‚</p>
<p>æ¥ä¸‹æ¥ä¸€è¡Œï¼Œæˆ‘ä»¬åˆ†é…äº†ä¸€ä¸ªCé£æ ¼å­—ç¬¦ä¸²å­—é¢é‡ï¼Œå®ƒä¼šåœ¨å˜ä½“å†…éƒ¨è½¬æ¢ä¸º <code>std::string</code>ã€‚</p>
<p>ç„¶åæˆ‘ä»¬é€šè¿‡ <code>std::visit()</code> å‡½æ•°å’Œ <code>Print</code> å‡½æ•°å¯¹è±¡æ‰“å°å˜ä½“çš„å†…å®¹ã€‚</p>
<p>æ³¨æ„ <code>std::visit()</code> å‡½æ•°çš„åç§°ï¼Œè¯¥åç§°ç›´æ¥å¼•ç”¨äº†è®¿é—®è€…è®¾è®¡æ¨¡å¼ï¼Œå› æ­¤æ˜ç¡®è¡¨è¾¾äº†å…¶æ„å›¾ï¼šä½ å¯ä»¥å¯¹å˜ä½“å®ä¾‹ä¸­åŒ…å«çš„å°é—­ç±»å‹é›†åº”ç”¨ä»»ä½•æ“ä½œã€‚æ­¤å¤–ï¼Œä½ å¯ä»¥éä¾µå…¥å¼åœ°æ‰©å±•æ“ä½œé›†ã€‚</p>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>ä½¿ç”¨è®¾è®¡æ¨¡å¼çš„åç§°æ¥ä¼ è¾¾è§£å†³æ–¹æ¡ˆçš„æ„å›¾ã€‚</li>
<li>ä½¿ç”¨è®¾è®¡æ¨¡å¼çš„åç§°æ¥æé«˜å¯è¯»æ€§ã€‚</li>
</ul>
<h2 id="ç¬¬å››ç« è®¿é—®è€…è®¾è®¡æ¨¡å¼">ç¬¬å››ç« ï¼šè®¿é—®è€…è®¾è®¡æ¨¡å¼
</h2><p>æœ¬ç« å®Œå…¨ä¸“æ³¨äºè®¿é—®è€…è®¾è®¡æ¨¡å¼ï¼Œå¦‚æœä½ å·²ç»å¬è¯´è¿‡è®¿é—®è€…è®¾è®¡æ¨¡å¼ï¼Œç”šè‡³åœ¨è‡ªå·±çš„è®¾è®¡ä¸­ä½¿ç”¨è¿‡å®ƒï¼Œä½ å¯èƒ½ä¼šå¥½å¥‡ä¸ºä»€ä¹ˆæˆ‘é€‰æ‹©è®¿é—®è€…ä½œä¸ºç¬¬ä¸€ä¸ªè¯¦ç»†è§£é‡Šçš„è®¾è®¡æ¨¡å¼ã€‚</p>
<p>æ˜¯çš„ï¼Œè®¿é—®è€…è‚¯å®šä¸æ˜¯æœ€è€€çœ¼çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ï¼Œç„¶è€Œï¼Œå®ƒç»å¯¹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œå¯ä»¥å±•ç¤ºä½ åœ¨å®ç°è®¾è®¡æ¨¡å¼æ—¶æ‹¥æœ‰çš„å¤šç§é€‰æ‹©ï¼Œä»¥åŠè¿™äº›å®ç°æ–¹å¼å¯ä»¥æœ‰å¤šä¹ˆä¸åŒã€‚</p>
<p>å®ƒè¿˜å°†ä½œä¸ºä¸€ä¸ªæœ‰æ•ˆçš„ä¾‹å­ï¼Œå±•ç¤ºç°ä»£C++çš„ä¼˜åŠ¿ã€‚</p>
<p><strong>å‡†åˆ™15ï¼šä¸ºæ·»åŠ ç±»å‹æˆ–æ“ä½œè¿›è¡Œè®¾è®¡</strong></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨â€œå‡†åˆ™15ï¼šä¸ºæ·»åŠ ç±»å‹æˆ–æ“ä½œè¿›è¡Œè®¾è®¡â€ä¸­è®¨è®ºå½“ä½ æ¶‰è¶³åŠ¨æ€å¤šæ€æ€§é¢†åŸŸæ—¶éœ€è¦åšå‡ºçš„åŸºæœ¬è®¾è®¡å†³ç­–ï¼šå…³æ³¨ç±»å‹è¿˜æ˜¯æ“ä½œã€‚åœ¨è¿™ä¸ªå‡†åˆ™ä¸­ï¼Œæˆ‘ä»¬è¿˜ä¼šè®¨è®ºç¼–ç¨‹èŒƒå¼çš„å†…åœ¨ä¼˜åŠ¿å’ŒåŠ£åŠ¿ã€‚</p>
<p><strong>å‡†åˆ™16ï¼šä½¿ç”¨è®¿é—®è€…æ‰©å±•æ“ä½œ</strong></p>
<p>åœ¨â€œå‡†åˆ™16ï¼šä½¿ç”¨è®¿é—®è€…æ‰©å±•æ“ä½œâ€ä¸­ï¼Œæˆ‘ä¼šå‘ä½ ä»‹ç»è®¿é—®è€…è®¾è®¡æ¨¡å¼ã€‚æˆ‘å°†è§£é‡Šå®ƒçš„æ„å›¾æ˜¯æ‰©å±•æ“ä½œè€Œä¸æ˜¯ç±»å‹ï¼Œå¹¶å‘ä½ å±•ç¤ºç»å…¸è®¿é—®è€…æ¨¡å¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚</p>
<p><strong>å‡†åˆ™17ï¼šè€ƒè™‘ä½¿ç”¨ <code>std::variant</code> å®ç°è®¿é—®è€…</strong></p>
<p>åœ¨â€œå‡†åˆ™17ï¼šè€ƒè™‘ä½¿ç”¨ <code>std::variant</code> å®ç°è®¿é—®è€…â€ä¸­ï¼Œä½ ä¼šäº†è§£åˆ°è®¿é—®è€…è®¾è®¡æ¨¡å¼çš„ç°ä»£å®ç°ã€‚æˆ‘å°†å‘ä½ ä»‹ç» <code>std::variant</code> å¹¶è§£é‡Šè¿™ç§ç‰¹å®šå®ç°çš„è®¸å¤šä¼˜ç‚¹ã€‚</p>
<p><strong>å‡†åˆ™18ï¼šè­¦æƒ•æ— ç¯è®¿é—®è€…çš„æ€§èƒ½é—®é¢˜</strong></p>
<p>åœ¨â€œå‡†åˆ™18ï¼šè­¦æƒ•æ— ç¯è®¿é—®è€…çš„æ€§èƒ½é—®é¢˜â€ä¸­ï¼Œæˆ‘ä¼šå‘ä½ ä»‹ç»æ— ç¯è®¿é—®è€…ã€‚ä¹ä¸€çœ‹ï¼Œè¿™ç§æ–¹æ³•ä¼¼ä¹è§£å†³äº†è®¿é—®è€…æ¨¡å¼çš„ä¸€äº›åŸºæœ¬é—®é¢˜ï¼Œä½†ä»”ç»†è§‚å¯Ÿåæˆ‘ä»¬ä¼šå‘ç°ï¼Œè¿è¡Œæ—¶å¼€é”€å¯èƒ½ä½¿è¿™ç§å®ç°ä¸é€‚ç”¨ã€‚</p>
<h3 id="å‡†åˆ™15ä¸ºæ·»åŠ ç±»å‹æˆ–æ“ä½œè¿›è¡Œè®¾è®¡">å‡†åˆ™15ï¼šä¸ºæ·»åŠ ç±»å‹æˆ–æ“ä½œè¿›è¡Œè®¾è®¡
</h3><p>å¯¹äºä½ æ¥è¯´ï¼ŒåŠ¨æ€å¤šæ€æ€§è¿™ä¸ªæœ¯è¯­å¯èƒ½å¬èµ·æ¥åƒæ˜¯æœ‰å¾ˆå¤šè‡ªç”±ï¼Œå®ƒå¯èƒ½è®©ä½ æ„Ÿè§‰åƒå°æ—¶å€™ä¸€æ ·ï¼šæœ‰æ— å°½çš„å¯èƒ½æ€§ï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶ï¼</p>
<p>ç„¶è€Œï¼Œä½ å·²ç»é•¿å¤§äº†å¹¶é¢å¯¹ç°å®ï¼šä½ ä¸å¯èƒ½æ‹¥æœ‰ä¸€åˆ‡ï¼Œæ€»æ˜¯éœ€è¦åšå‡ºé€‰æ‹©ã€‚</p>
<p>ä¸å¹¸çš„æ˜¯ï¼ŒåŠ¨æ€å¤šæ€æ€§ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå°½ç®¡å¬èµ·æ¥åƒæ˜¯å®Œå…¨çš„è‡ªç”±ï¼Œä½†ä»ç„¶æœ‰ä¸€ä¸ªé™åˆ¶æ€§çš„é€‰æ‹©ï¼šä½ æ˜¯æƒ³æ‰©å±•ç±»å‹è¿˜æ˜¯æ“ä½œï¼Ÿ</p>
<p>ä¸ºäº†æ›´å¥½åœ°ç†è§£æˆ‘çš„æ„æ€ï¼Œè®©æˆ‘ä»¬å›åˆ°ç¬¬ä¸‰ç« ä¸­çš„åœºæ™¯ï¼šæˆ‘ä»¬å¸Œæœ›ç»˜åˆ¶ä¸€ä¸ªç»™å®šçš„å½¢çŠ¶ï¼Œæˆ‘ä»¬åšæŒä½¿ç”¨åŠ¨æ€å¤šæ€æ€§ï¼Œå¹¶ä¸”åœ¨åˆæ¬¡å°è¯•ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¼ ç»Ÿçš„è¿‡ç¨‹å¼ç¼–ç¨‹æ¥å®ç°è¿™ä¸ªé—®é¢˜ã€‚</p>
<p><strong>è¿‡ç¨‹å¼è§£å†³æ–¹æ¡ˆ</strong></p>
<p>ç¬¬ä¸€ä¸ªå¤´æ–‡ä»¶ <code>Point.h</code> æä¾›äº†ä¸€ä¸ªç›¸å½“ç®€å•çš„ <code>Point</code> ç±»ï¼Œè¿™ä¸»è¦æ˜¯ä¸ºäº†ä½¿ä»£ç å®Œæ•´ï¼Œä½†ä¹Ÿç»™äº†æˆ‘ä»¬ä¸€ä¸ªæç¤ºï¼Œå³æˆ‘ä»¬æ­£åœ¨å¤„ç†äºŒç»´å½¢çŠ¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Point.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">struct</span> <span class="nc">Point</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">x</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒä¸ªæ¦‚å¿µæ€§çš„å¤´æ–‡ä»¶ <code>Shape.h</code> æ˜¾å¾—æ›´åŠ æœ‰è¶£ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Shape.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">enum</span> <span class="nc">ShapeType</span>  
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">circle</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">square</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Shape</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"> <span class="k">protected</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">explicit</span> <span class="n">Shape</span><span class="p">(</span> <span class="n">ShapeType</span> <span class="n">type</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">      <span class="o">:</span> <span class="n">type_</span><span class="p">(</span> <span class="n">type</span> <span class="p">)</span>   
</span></span><span class="line"><span class="cl">   <span class="p">{}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="o">~</span><span class="n">Shape</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="n">ShapeType</span> <span class="nf">getType</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">type_</span><span class="p">;</span> <span class="p">}</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">ShapeType</span> <span class="n">type_</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¼•å…¥äº†æšä¸¾ <code>ShapeType</code>ï¼Œå®ƒç›®å‰åˆ—å‡ºäº†ä¸¤ä¸ªæšä¸¾å€¼ï¼š<code>circle</code> å’Œ <code>square</code>ï¼Œæ˜¾ç„¶ï¼Œæˆ‘ä»¬æœ€åˆåªå¤„ç†åœ†å½¢å’Œæ–¹å½¢ã€‚</p>
<p>å…¶æ¬¡ï¼Œæˆ‘ä»¬å¼•å…¥äº†ç±» <code>Shape</code>ã€‚è€ƒè™‘åˆ°ä¿æŠ¤æ„é€ å‡½æ•°å’Œè™šææ„å‡½æ•°ï¼Œä½ å¯ä»¥é¢„è§ <code>Shape</code> æ˜¯ä½œä¸ºåŸºç±»ä½¿ç”¨çš„ã€‚<br/>ä½†è¿™å¹¶ä¸æ˜¯ <code>Shape</code> æœ€ä»¤äººæƒŠè®¶çš„ç»†èŠ‚ï¼š<code>Shape</code> æœ‰ä¸€ä¸ªç±»å‹ä¸º <code>ShapeType</code> çš„æ•°æ®æˆå‘˜ï¼Œè¿™ä¸ªæ•°æ®æˆå‘˜é€šè¿‡æ„é€ å‡½æ•°åˆå§‹åŒ–ï¼Œå¹¶å¯ä»¥é€šè¿‡ <code>getType()</code> æˆå‘˜å‡½æ•°æŸ¥è¯¢ã€‚</p>
<p>æ˜¾ç„¶ï¼Œ<code>Shape</code> å°†å…¶ç±»å‹ä»¥ <code>ShapeType</code> æšä¸¾çš„å½¢å¼å­˜å‚¨ã€‚</p>
<p><code>Shape</code> åŸºç±»çš„ä¸€ä¸ªä½¿ç”¨ç¤ºä¾‹æ˜¯ <code>Circle</code> ç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Circle.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Point.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Circle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"> <span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">explicit</span> <span class="n">Circle</span><span class="p">(</span> <span class="kt">double</span> <span class="n">radius</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">      <span class="o">:</span> <span class="n">Shape</span><span class="p">(</span> <span class="n">circle</span> <span class="p">)</span>   
</span></span><span class="line"><span class="cl">      <span class="p">,</span> <span class="n">radius_</span><span class="p">(</span> <span class="n">radius</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="cm">/* Checking that the given radius is valid */</span> 
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">double</span> <span class="nf">radius</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">radius_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Point</span> <span class="nf">center</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">center_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl"> <span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">double</span> <span class="n">radius_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Point</span> <span class="n">center_</span><span class="p">{};</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Circle</code> å…¬å¼€ç»§æ‰¿è‡ª <code>Shape</code>ï¼Œå› æ­¤ç”±äº <code>Shape</code> ç¼ºå°‘é»˜è®¤æ„é€ å‡½æ•°ï¼Œéœ€è¦åˆå§‹åŒ–åŸºç±»ã€‚<br/>å› ä¸ºå®ƒæ˜¯åœ†å½¢ï¼Œæ‰€ä»¥å®ƒä½¿ç”¨ <code>circle</code> æšä¸¾å€¼ä½œä¸ºåŸºç±»æ„é€ å‡½æ•°çš„å‚æ•°ã€‚</p>
<p>æ­£å¦‚ä¹‹å‰æ‰€è¿°ï¼Œæˆ‘ä»¬å¸Œæœ›ç»˜åˆ¶å½¢çŠ¶ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¼•å…¥äº†ç”¨äºåœ†å½¢çš„ <code>draw()</code> å‡½æ•°ã€‚<br/>ä¸ºäº†é¿å…ä¸ä»»ä½•ç»˜å›¾å®ç°ç»†èŠ‚ç´§å¯†è€¦åˆï¼Œ<code>draw()</code> å‡½æ•°åœ¨æ¦‚å¿µæ€§å¤´æ–‡ä»¶ <code>DrawCircle.h</code> ä¸­å£°æ˜ï¼Œåœ¨å¯¹åº”çš„æºæ–‡ä»¶ä¸­å®šä¹‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;DrawCircle.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Circle</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span> <span class="n">Circle</span> <span class="k">const</span><span class="o">&amp;</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;DrawCircle.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;DrawCircle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Circle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include </span><span class="cm">/* some graphics library */</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span> <span class="n">Circle</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">c</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... Implementing the logic for drawing a circle 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“ç„¶ï¼Œä¸ä»…ä»…æ˜¯åœ†å½¢ï¼Œå¦‚ square æšä¸¾æ‰€ç¤ºï¼Œè¿˜æœ‰ä¸€ä¸ª Square ç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Square.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Point.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Square</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"> <span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">explicit</span> <span class="n">Square</span><span class="p">(</span> <span class="kt">double</span> <span class="n">side</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">      <span class="o">:</span> <span class="n">Shape</span><span class="p">(</span> <span class="n">square</span> <span class="p">)</span>   
</span></span><span class="line"><span class="cl">      <span class="p">,</span> <span class="n">side_</span><span class="p">(</span> <span class="n">side</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="cm">/* Checking that the given side length is valid */</span> 
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="kt">double</span> <span class="nf">side</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">side_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Point</span> <span class="nf">center</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">center_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">double</span> <span class="n">side_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Point</span> <span class="n">center_</span><span class="p">{};</span>  <span class="c1">// Or any corner, if you prefer 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;DrawSquare.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Square</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span> <span class="n">Square</span> <span class="k">const</span><span class="o">&amp;</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;DrawSquare.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;DrawSquare.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Square.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include </span><span class="cm">/* some graphics library */</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span> <span class="n">Square</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">s</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... Implementing the logic for drawing a square 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Square</code> ç±»ä¸ <code>Circle</code> ç±»éå¸¸ç›¸ä¼¼ã€‚ä¸»è¦åŒºåˆ«åœ¨äº <code>Square</code> ä½¿ç”¨ <code>square</code> æšä¸¾å€¼åˆå§‹åŒ–å…¶åŸºç±»ã€‚</p>
<p>ç°åœ¨æœ‰äº†åœ†å½¢å’Œæ–¹å½¢ï¼Œæˆ‘ä»¬å¸Œæœ›ç»˜åˆ¶æ•´ä¸ªä¸åŒå½¢çŠ¶çš„å‘é‡ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¼•å…¥äº† <code>drawAllShapes()</code> å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;DrawAllShapes.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">Shape</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">drawAllShapes</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Shape</span><span class="o">&gt;&gt;</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">shapes</span> <span class="p">);</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;DrawAllShapes.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;DrawAllShapes.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Circle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Square.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">drawAllShapes</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Shape</span><span class="o">&gt;&gt;</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">shapes</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="k">for</span><span class="p">(</span> <span class="k">auto</span> <span class="k">const</span><span class="o">&amp;</span> <span class="nl">shape</span> <span class="p">:</span> <span class="n">shapes</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="k">switch</span><span class="p">(</span> <span class="n">shape</span><span class="o">-&gt;</span><span class="n">getType</span><span class="p">()</span> <span class="p">)</span>   
</span></span><span class="line"><span class="cl">      <span class="p">{</span> 
</span></span><span class="line"><span class="cl">         <span class="k">case</span> <span class="nl">circle</span><span class="p">:</span> 
</span></span><span class="line"><span class="cl">            <span class="n">draw</span><span class="p">(</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Circle</span> <span class="k">const</span><span class="o">&amp;&gt;</span><span class="p">(</span> <span class="o">*</span><span class="n">shape</span> <span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">         <span class="k">case</span> <span class="nl">square</span><span class="p">:</span> 
</span></span><span class="line"><span class="cl">            <span class="n">draw</span><span class="p">(</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Square</span> <span class="k">const</span><span class="o">&amp;&gt;</span><span class="p">(</span> <span class="o">*</span><span class="n">shape</span> <span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">      <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>drawAllShapes()</code>  æ¥å—ä¸€ä¸ª <code>std::unique_ptr&lt;Shape&gt; </code> å½¢å¼çš„å½¢çŠ¶å‘é‡ï¼ŒæŒ‡å‘åŸºç±»çš„æŒ‡é’ˆæ˜¯ä¸ºäº†å®¹çº³ä¸åŒç§ç±»çš„å…·ä½“å½¢çŠ¶ï¼Œè€Œ std::unique_ptr åˆ™ç”¨äºé€šè¿‡ RAII æƒ¯ç”¨æ³•è‡ªåŠ¨ç®¡ç†è¿™äº›å½¢çŠ¶ã€‚</p>
<p>åœ¨å‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬å¼€å§‹éå†å‘é‡ä»¥ç»˜åˆ¶æ¯ä¸ªå½¢çŠ¶ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæ­¤æ—¶æˆ‘ä»¬åªæœ‰ Shape æŒ‡é’ˆã€‚<br/>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ getType() å‡½æ•°è¯¢é—®æ¯ä¸ªå½¢çŠ¶ï¼šä½ æ˜¯ä»€ä¹ˆç±»å‹çš„å½¢çŠ¶ï¼Ÿå¦‚æœå½¢çŠ¶å›å¤ circleï¼Œæˆ‘ä»¬çŸ¥é“å¿…é¡»å°†å…¶ç»˜åˆ¶ä¸º Circle å¹¶æ‰§è¡Œç›¸åº”çš„ static_castã€‚å¦‚æœå½¢çŠ¶å›å¤ squareï¼Œæˆ‘ä»¬å°†å…¶ç»˜åˆ¶ä¸º Squareã€‚</p>
<p>æˆ‘æ„Ÿè§‰ä½ å¯¹è¿™ä¸ªè§£å†³æ–¹æ¡ˆä¸å¤ªæ»¡æ„ã€‚ä½†åœ¨è®¨è®ºå…¶ä¸è¶³ä¹‹å¤„ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆçœ‹çœ‹ main() å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Main.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Circle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Square.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;DrawAllShapes.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">using</span> <span class="n">Shapes</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Shape</span><span class="o">&gt;&gt;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// Creating some shapes 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Shapes</span> <span class="n">shapes</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">shapes</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Circle</span><span class="o">&gt;</span><span class="p">(</span> <span class="mf">2.3</span> <span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="n">shapes</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Square</span><span class="o">&gt;</span><span class="p">(</span> <span class="mf">1.2</span> <span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="n">shapes</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Circle</span><span class="o">&gt;</span><span class="p">(</span> <span class="mf">4.1</span> <span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// Drawing all shapes 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">drawAllShapes</span><span class="p">(</span> <span class="n">shapes</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®ƒç¡®å®å¯ä»¥å·¥ä½œï¼ä½¿ç”¨è¿™ä¸ª main() å‡½æ•°ï¼Œä»£ç ç¼–è¯‘å¹¶ç»˜åˆ¶ä¸‰ä¸ªå½¢çŠ¶ï¼ˆä¸¤ä¸ªåœ†å½¢å’Œä¸€ä¸ªæ–¹å½¢ï¼‰ã€‚<br/>è¿™ä¸æ˜¯å¾ˆå¥½å—ï¼Ÿæ˜¯çš„ï¼Œä½†å®ƒä¸ä¼šé˜»æ­¢ä½ å¯¹æ­¤æ–¹æ¡ˆè¿›è¡ŒæŠ±æ€¨ï¼šâ€œå¤šä¹ˆåŸå§‹çš„è§£å†³æ–¹æ¡ˆï¼ä¸ä»…ä½¿ç”¨ switch æ¥åŒºåˆ†ä¸åŒç§ç±»çš„å½¢çŠ¶æ˜¯ä¸ªç³Ÿç³•çš„é€‰æ‹©ï¼Œè€Œä¸”è¿˜æ²¡æœ‰é»˜è®¤æƒ…å†µï¼è¿˜æœ‰è°æœ‰è¿™ä¸ªç–¯ç‹‚çš„æƒ³æ³•ï¼Œé€šè¿‡æœªé™å®šèŒƒå›´çš„æšä¸¾æ¥ç¼–ç å½¢çŠ¶çš„ç±»å‹ï¼Ÿâ€</p>
<p>ä½ æ€€ç–‘åœ°çœ‹å‘æˆ‘çš„æ–¹å‘â€¦â€¦</p>
<p>å¥½å§ï¼Œæˆ‘èƒ½ç†è§£ä½ çš„ååº”ã€‚ä½†è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°åˆ†æè¿™ä¸ªé—®é¢˜ã€‚<br/>è®©æˆ‘çŒœä¸€ä¸‹ï¼šä½ è®°å¾—â€œå‡†åˆ™5ï¼šè®¾è®¡æ‰©å±•â€ï¼Œä½ ç°åœ¨æƒ³è±¡æ·»åŠ ç¬¬ä¸‰ç§å½¢çŠ¶éœ€è¦åšä»€ä¹ˆã€‚<br/>é¦–å…ˆï¼Œä½ éœ€è¦æ‰©å±•æšä¸¾ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ æ–°çš„æšä¸¾å€¼ triangleï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">enum</span> <span class="nc">ShapeType</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">circle</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">square</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">triangle</span>   
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯·æ³¨æ„ï¼Œè¿™ç§æ·»åŠ ä¸ä»…ä¼šå½±å“ drawAllShapes() å‡½æ•°ä¸­çš„ switch è¯­å¥ï¼ˆç°åœ¨çœŸæ­£ä¸å®Œæ•´ï¼‰ï¼Œè¿˜ä¼šå½±å“æ‰€æœ‰ä» Shape ç»§æ‰¿çš„ç±»ï¼ˆCircle å’Œ Squareï¼‰ã€‚<br/>è¿™äº›ç±»ä¾èµ–äºæšä¸¾ï¼Œå› ä¸ºå®ƒä»¬ä¾èµ–äº Shape åŸºç±»å¹¶ä¸”ç›´æ¥ä½¿ç”¨è¯¥æšä¸¾ã€‚<br/>å› æ­¤ï¼Œæ›´æ”¹æšä¸¾å°†å¯¼è‡´æ‰€æœ‰ç›¸å…³æºæ–‡ä»¶é‡æ–°ç¼–è¯‘ï¼Œä½ åº”è¯¥è®¤è¯†åˆ°è¿™æ˜¯ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ã€‚</p>
<p>äº‹å®ä¸Šï¼Œé—®é¢˜çš„æ ¸å¿ƒæ˜¯æ‰€æœ‰å½¢çŠ¶ç±»å’Œå‡½æ•°å¯¹æšä¸¾çš„ç›´æ¥ä¾èµ–ï¼Œä»»ä½•å¯¹æšä¸¾çš„æ›´æ”¹éƒ½ä¼šå¼•å‘è¿é”ååº”ï¼Œè¦æ±‚ä¾èµ–æ–‡ä»¶é‡æ–°ç¼–è¯‘ã€‚<br/>æ˜¾ç„¶ï¼Œè¿™ç›´æ¥è¿åäº†å¼€æ”¾å°é—­åŸåˆ™ï¼ˆOCPï¼‰ï¼ˆè§â€œå‡†åˆ™5ï¼šè®¾è®¡æ‰©å±•â€ï¼‰ã€‚<br/>è¿™çœ‹èµ·æ¥ä¸å¯¹ï¼šæ·»åŠ ä¸€ä¸ª Triangle ä¸åº”è¯¥å¯¼è‡´ Circle å’Œ Square ç±»é‡æ–°ç¼–è¯‘ã€‚</p>
<p>è¿˜æœ‰æ›´å¤šé—®é¢˜ã€‚é™¤äº†å®é™…ç¼–å†™ä¸€ä¸ª Triangle ç±»ï¼ˆè¿™ä¸ªç•™ç»™ä½ è‡ªå·±æƒ³è±¡ï¼‰ï¼Œä½ è¿˜éœ€è¦æ›´æ–° switch è¯­å¥ä»¥å¤„ç†ä¸‰è§’å½¢ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">drawAllShapes</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Shape</span><span class="o">&gt;&gt;</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">shapes</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="k">for</span><span class="p">(</span> <span class="k">auto</span> <span class="k">const</span><span class="o">&amp;</span> <span class="nl">shape</span> <span class="p">:</span> <span class="n">shapes</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="k">switch</span><span class="p">(</span> <span class="n">shape</span><span class="o">-&gt;</span><span class="n">getType</span><span class="p">()</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">      <span class="p">{</span> 
</span></span><span class="line"><span class="cl">         <span class="k">case</span> <span class="nl">circle</span><span class="p">:</span> 
</span></span><span class="line"><span class="cl">            <span class="n">draw</span><span class="p">(</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Circle</span> <span class="k">const</span><span class="o">&amp;&gt;</span><span class="p">(</span> <span class="o">*</span><span class="n">shape</span> <span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">         <span class="k">case</span> <span class="nl">square</span><span class="p">:</span> 
</span></span><span class="line"><span class="cl">            <span class="n">draw</span><span class="p">(</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Square</span> <span class="k">const</span><span class="o">&amp;&gt;</span><span class="p">(</span> <span class="o">*</span><span class="n">shape</span> <span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">         <span class="k">case</span> <span class="nl">triangle</span><span class="p">:</span>   
</span></span><span class="line"><span class="cl">            <span class="n">draw</span><span class="p">(</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Triangle</span> <span class="k">const</span><span class="o">&amp;&gt;</span><span class="p">(</span> <span class="o">*</span><span class="n">shape</span> <span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">      <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘å¯ä»¥æƒ³è±¡ä½ çš„æŠ—è®®ï¼šâ€œå¤åˆ¶ç²˜è´´ï¼é‡å¤ï¼â€æ˜¯çš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¼€å‘è€…å¾ˆå¯èƒ½ä¼šä½¿ç”¨å¤åˆ¶ç²˜è´´æ¥å®ç°æ–°é€»è¾‘ï¼Œè¿™æ ·åšå¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºæ–°æƒ…å†µä¸å‰ä¸¤ç§æƒ…å†µéå¸¸ç›¸ä¼¼ã€‚</p>
<p>å®é™…ä¸Šï¼Œè¿™è¡¨æ˜è®¾è®¡å¯ä»¥æ”¹è¿›ã€‚ç„¶è€Œï¼Œæˆ‘çœ‹åˆ°ä¸€ä¸ªæ›´ä¸ºä¸¥é‡çš„ç¼ºé™·ï¼šåœ¨ä¸€ä¸ªæ›´å¤§çš„ä»£ç åº“ä¸­ï¼Œè¿™ä¸ä¼šæ˜¯å”¯ä¸€çš„ <code>switch</code> è¯­å¥ã€‚ç›¸åï¼Œä¼šæœ‰å…¶ä»–éœ€è¦æ›´æ–°çš„ <code>switch</code> è¯­å¥ã€‚<br/>æœ‰å¤šå°‘ä¸ªï¼Ÿåå‡ ä¸ªï¼Ÿäº”åä¸ªï¼Ÿè¶…è¿‡ä¸€ç™¾ä¸ªï¼Ÿä½ å¦‚ä½•æ‰¾åˆ°æ‰€æœ‰è¿™äº›ï¼Ÿå¥½å§ï¼Œä½ å¯èƒ½ä¼šäº‰è¾©è¯´ç¼–è¯‘å™¨ä¼šå¸®åŠ©ä½ å®Œæˆè¿™é¡¹ä»»åŠ¡ã€‚å¯¹äº <code>switch</code> è¯­å¥å¯èƒ½æ˜¯è¿™æ ·ï¼Œä½†å¦‚æœä¹Ÿæœ‰ <code>if-else-if</code> çº§è”å‘¢ï¼Ÿ<br/>ç„¶åï¼Œåœ¨æ›´æ–°é©¬æ‹‰æ¾ç»“æŸåï¼Œå½“ä½ è®¤ä¸ºå·²ç»å®Œæˆæ—¶ï¼Œå¦‚ä½•ä¿è¯ä½ çœŸæ­£æ›´æ–°äº†æ‰€æœ‰å¿…è¦çš„éƒ¨åˆ†ï¼Ÿ</p>
<p>æ˜¯çš„ï¼Œæˆ‘èƒ½ç†è§£ä½ çš„ååº”ä»¥åŠä¸ºä»€ä¹ˆä½ ä¸å–œæ¬¢è¿™ç§ä»£ç ï¼šè¿™ç§æ˜¾å¼å¤„ç†ç±»å‹çš„æ–¹å¼æ˜¯ä¸€ä¸ªç»´æŠ¤å™©æ¢¦ã€‚<br/>å¼•ç”¨ Scott Meyers çš„è¯ï¼š</p>
<p><strong>è¿™ç§åŸºäºç±»å‹çš„ç¼–ç¨‹åœ¨ C è¯­è¨€ä¸­æœ‰å¾ˆé•¿çš„å†å²ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒä¼šå¯¼è‡´åŸºæœ¬ä¸Šä¸å¯ç»´æŠ¤çš„ç¨‹åºã€‚</strong></p>
<p><strong>é¢å‘å¯¹è±¡è§£å†³æ–¹æ¡ˆ</strong></p>
<p>é‚£ä¹ˆè®©æˆ‘é—®ä¸€ä¸‹ï¼šä½ ä¼šæ€ä¹ˆåšï¼Ÿä½ ä¼šå¦‚ä½•å®ç°å½¢çŠ¶çš„ç»˜åˆ¶ï¼Ÿæˆ‘çŒœä½ å¯èƒ½ä¼šä½¿ç”¨é¢å‘å¯¹è±¡çš„æ–¹æ³•ï¼Œè¿™æ„å‘³ç€ä½ ä¼šæŠ›å¼ƒæšä¸¾ï¼Œå¹¶åœ¨ <code>Shape</code> åŸºç±»ä¸­æ·»åŠ ä¸€ä¸ªçº¯è™šå‡½æ•° <code>draw()</code>ã€‚<br/>è¿™æ ·ï¼Œ<code>Shape</code> å°±ä¸å†éœ€è¦è®°ä½å®ƒçš„ç±»å‹äº†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Shape.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"> <span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Shape</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="o">~</span><span class="n">Shape</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰äº†è¿™ä¸ªåŸºç±»ï¼Œæ´¾ç”Ÿç±»ç°åœ¨åªéœ€è¦å®ç° <code>draw()</code> æˆå‘˜å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Circle.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Point.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Circle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"> <span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">explicit</span> <span class="n">Circle</span><span class="p">(</span> <span class="kt">double</span> <span class="n">radius</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">      <span class="o">:</span> <span class="n">radius_</span><span class="p">(</span> <span class="n">radius</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="cm">/* Checking that the given radius is valid */</span> 
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="kt">double</span> <span class="nf">radius</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">radius_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Point</span> <span class="nf">center</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">center_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="nf">draw</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">double</span> <span class="n">radius_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Point</span> <span class="n">center_</span><span class="p">{};</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Circle.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Circle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include </span><span class="cm">/* some graphics library */</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Circle</span><span class="o">::</span><span class="n">draw</span><span class="p">()</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... Implementing the logic for drawing a circle 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Square.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Point.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Square</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"> <span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">explicit</span> <span class="n">Square</span><span class="p">(</span> <span class="kt">double</span> <span class="n">side</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">      <span class="o">:</span> <span class="n">side_</span><span class="p">(</span> <span class="n">side</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="cm">/* Checking that the given side length is valid */</span> 
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="kt">double</span> <span class="nf">side</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">side_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Point</span> <span class="nf">center</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">center_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="nf">draw</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">double</span> <span class="n">side_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Point</span> <span class="n">center_</span><span class="p">{};</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Square.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Square.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include </span><span class="cm">/* some graphics library */</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Square</span><span class="o">::</span><span class="n">draw</span><span class="p">()</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... Implementing the logic for drawing a square 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸€æ—¦  <code>virtual draw()</code> å‡½æ•°åˆ°ä½å¹¶ç”±æ‰€æœ‰æ´¾ç”Ÿç±»å®ç°ï¼Œå°±å¯ä»¥ç”¨å®ƒæ¥é‡æ„ <code>drawAllShapes()</code> å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;DrawAllShapes.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">Shape</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">drawAllShapes</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Shape</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">shapes</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;DrawAllShapes.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;DrawAllShapes.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="nf">drawAllShapes</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Shape</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">shapes</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span> <span class="k">auto</span> <span class="k">const</span><span class="o">&amp;</span> <span class="nl">shape</span> <span class="p">:</span> <span class="n">shapes</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">shape</span><span class="o">-&gt;</span><span class="n">draw</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘å¯ä»¥çœ‹è§ä½ æ”¾æ¾ä¸‹æ¥ï¼Œå¼€å§‹å¾®ç¬‘ï¼Œè¿™çœ‹èµ·æ¥å¥½å¤šäº†ï¼Œæ›´åŠ ç®€æ´ã€‚<br/>è™½ç„¶æˆ‘çŸ¥é“ä½ å–œæ¬¢è¿™ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå¹¶å¸Œæœ›åœ¨è¿™ä¸ªèˆ’é€‚åŒºå¤šå¾…ä¸€ä¼šå„¿ï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘å¿…é¡»æŒ‡å‡ºå…¶ä¸­çš„ä¸€ä¸ªç¼ºé™·ã€‚æ˜¯çš„ï¼Œè¿™ä¸ªè§£å†³æ–¹æ¡ˆä¹Ÿå¯èƒ½æœ‰ç¼ºç‚¹ã€‚</p>
<p>æ­£å¦‚æœ¬èŠ‚å¼€å¤´æ‰€æåˆ°çš„ï¼Œé€šè¿‡é¢å‘å¯¹è±¡çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥éå¸¸å®¹æ˜“åœ°æ·»åŠ æ–°ç±»å‹ï¼Œæˆ‘ä»¬åªéœ€è¦ç¼–å†™ä¸€ä¸ªæ–°çš„æ´¾ç”Ÿç±»å³å¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¿®æ”¹æˆ–é‡æ–°ç¼–è¯‘ä»»ä½•ç°æœ‰ä»£ç (é™¤äº† main() å‡½æ•°),è¿™å®Œç¾åœ°æ»¡è¶³äº†<strong>å¼€æ”¾å°é—­åŸåˆ™(OCP)</strong>ã€‚</p>
<p>ç„¶è€Œï¼Œä½ æ˜¯å¦æ³¨æ„åˆ°æˆ‘ä»¬ä¸èƒ½å†è½»æ¾åœ°æ·»åŠ æ“ä½œäº†ï¼Ÿ<br/>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦ä¸€ä¸ª <strong>virtual serialize() å‡½æ•°</strong> å°† Shape è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œ<br/>æˆ‘ä»¬å¦‚ä½•åœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹æ·»åŠ è¿™ä¸ªåŠŸèƒ½ï¼Ÿä»»ä½•äººå¦‚ä½•åœ¨ä¸ä¿®æ”¹ Shape åŸºç±»çš„æƒ…å†µä¸‹è½»æ¾æ·»åŠ è¿™ä¸ªæ“ä½œï¼Ÿ</p>
<p>ä¸å¹¸çš„æ˜¯ï¼Œè¿™å·²ç»ä¸å¯èƒ½äº†ï¼Œæˆ‘ä»¬ç°åœ¨å¤„ç†çš„æ˜¯ä¸€ä¸ªå°é—­çš„æ“ä½œé›†ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åœ¨æ·»åŠ æ“ä½œæ—¶è¿åäº† OCPã€‚<br/>è¦æ·»åŠ è™šæ‹Ÿå‡½æ•°ï¼ŒåŸºç±»éœ€è¦è¢«ä¿®æ”¹ï¼Œæ‰€æœ‰æ´¾ç”Ÿç±»ï¼ˆåœ†å½¢ã€æ–¹å½¢ç­‰ï¼‰éƒ½éœ€è¦å®ç°æ–°çš„å‡½æ•°ï¼Œå³ä½¿è¯¥å‡½æ•°å¯èƒ½æ°¸è¿œä¸ä¼šè¢«è°ƒç”¨ã€‚<br/>æ€»ä¹‹ï¼Œé¢å‘å¯¹è±¡è§£å†³æ–¹æ¡ˆåœ¨æ·»åŠ ç±»å‹æ–¹é¢ç¬¦åˆ OCPï¼Œä½†åœ¨æ·»åŠ æ“ä½œæ–¹é¢è¿åäº†å®ƒã€‚</p>
<p>æˆ‘çŸ¥é“ä½ ä»¥ä¸ºæˆ‘ä»¬å·²ç»å½»åº•å‘Šåˆ«äº†è¿‡ç¨‹å¼è§£å†³æ–¹æ¡ˆï¼Œä½†è®©æˆ‘ä»¬å†çœ‹ä¸€çœ¼ï¼Œåœ¨è¿‡ç¨‹å¼æ–¹æ³•ä¸­ï¼Œæ·»åŠ æ–°æ“ä½œå®é™…ä¸Šéå¸¸ç®€å•ã€‚<br/>æ–°æ“ä½œå¯ä»¥é€šè¿‡è‡ªç”±å‡½æ•°æˆ–ç‹¬ç«‹ç±»çš„å½¢å¼æ·»åŠ ï¼Œä¸éœ€è¦ä¿®æ”¹ Shape åŸºç±»æˆ–ä»»ä½•æ´¾ç”Ÿç±»ã€‚<br/>å› æ­¤ï¼Œåœ¨è¿‡ç¨‹å¼è§£å†³æ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬åœ¨æ·»åŠ æ“ä½œæ–¹é¢ç¬¦åˆ OCPï¼Œä½†æ˜¯å¦‚æˆ‘ä»¬æ‰€è§ï¼Œè¿‡ç¨‹å¼è§£å†³æ–¹æ¡ˆåœ¨æ·»åŠ ç±»å‹æ—¶è¿åäº† OCPã€‚</p>
<p>å› æ­¤ï¼Œå®ƒä¼¼ä¹æ˜¯é¢å‘å¯¹è±¡è§£å†³æ–¹æ¡ˆçš„å€’ç½®ï¼Œåä¹‹äº¦ç„¶ã€‚</p>
<p><strong>æ³¨æ„åŠ¨æ€å¤šæ€æ€§ä¸­çš„è®¾è®¡é€‰æ‹©</strong></p>
<p>è¿™ä¸ªä¾‹å­çš„å…³é”®åœ¨äºä½¿ç”¨åŠ¨æ€å¤šæ€æ€§æ—¶å­˜åœ¨ä¸€ä¸ªè®¾è®¡é€‰æ‹©ï¼šè¦ä¹ˆä½ å¯ä»¥é€šè¿‡å›ºå®šæ“ä½œçš„æ•°é‡æ¥è½»æ¾æ·»åŠ ç±»å‹ï¼Œè¦ä¹ˆä½ å¯ä»¥é€šè¿‡å›ºå®šç±»å‹çš„æ•°é‡æ¥è½»æ¾æ·»åŠ æ“ä½œã€‚</p>
<p>å› æ­¤ï¼Œå¼€æ”¾å°é—­åŸåˆ™ï¼ˆOCPï¼‰æœ‰ä¸¤ä¸ªç»´åº¦ï¼šåœ¨è®¾è®¡è½¯ä»¶æ—¶ï¼Œä½ å¿…é¡»æœ‰æ„è¯†åœ°å†³å®šä½ æœŸæœ›å“ªç§æ‰©å±•ã€‚</p>
<p>é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¼˜åŠ¿åœ¨äºå¯ä»¥è½»æ¾æ·»åŠ æ–°çš„ç±»å‹ï¼Œä½†å…¶å¼±ç‚¹æ˜¯æ·»åŠ æ“ä½œå˜å¾—æ›´åŠ å›°éš¾ã€‚</p>
<p>è¿‡ç¨‹å¼ç¼–ç¨‹çš„ä¼˜åŠ¿åœ¨äºå¯ä»¥è½»æ¾æ·»åŠ æ“ä½œï¼Œä½†æ·»åŠ ç±»å‹åˆ™éå¸¸éº»çƒ¦ï¼ˆè§è¡¨4-1ï¼‰ã€‚</p>
<p><strong>è¿™å–å†³äºä½ çš„é¡¹ç›®</strong>ï¼š<br/>å¦‚æœä½ é¢„è®¡ä¼šé¢‘ç¹æ·»åŠ æ–°ç±»å‹è€Œä¸æ˜¯æ“ä½œï¼Œä½ åº”è¯¥åŠªåŠ›å®ç°ä¸€ç§å°†æ“ä½œè§†ä¸ºå°é—­é›†ã€ç±»å‹è§†ä¸ºå¼€æ”¾é›†çš„OCPè§£å†³æ–¹æ¡ˆã€‚<br/>å¦‚æœä½ é¢„è®¡ä¼šæ·»åŠ æ“ä½œï¼Œä½ åº”è¯¥åŠªåŠ›å®ç°ä¸€ç§å°†ç±»å‹è§†ä¸ºå°é—­é›†ã€æ“ä½œè§†ä¸ºå¼€æ”¾é›†çš„è¿‡ç¨‹å¼è§£å†³æ–¹æ¡ˆã€‚å¦‚æœåšå‡ºäº†æ­£ç¡®çš„é€‰æ‹©ï¼Œä½ å°†èŠ‚çœè‡ªå·±å’ŒåŒäº‹çš„æ—¶é—´ï¼Œå¹¶ä¸”æ‰©å±•å°†ä¼šå˜å¾—è‡ªç„¶å’Œå®¹æ˜“ã€‚</p>
<p><strong>è¡¨4-1. ä¸åŒç¼–ç¨‹èŒƒå¼çš„ä¼˜ç¼ºç‚¹</strong></p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>ç¼–ç¨‹èŒƒå¼</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>è¿‡ç¨‹å¼ç¼–ç¨‹</td>
<td>æ·»åŠ æ“ä½œ</td>
<td>æ·»åŠ ï¼ˆå¤šæ€ï¼‰ç±»å‹</td>
</tr>
<tr>
<td>é¢å‘å¯¹è±¡ç¼–ç¨‹</td>
<td>æ·»åŠ ï¼ˆå¤šæ€ï¼‰ç±»å‹</td>
<td>æ·»åŠ æ“ä½œ</td>
</tr>
</tbody>
</table></div>
<p>æ³¨æ„è¿™äº›ä¼˜åŠ¿ï¼šåŸºäºä½ å¯¹ä»£ç åº“å¦‚ä½•æ¼”åŒ–çš„é¢„æœŸï¼Œé€‰æ‹©åˆé€‚çš„è®¾è®¡æ–¹æ³•ä»¥æ”¯æŒæ‰©å±•ã€‚ä¸è¦å¿½è§†è¿™äº›å¼±ç‚¹ï¼Œä¹Ÿä¸è¦è®©è‡ªå·±é™·å…¥ä¸å¹¸çš„ç»´æŠ¤å™©æ¢¦ã€‚</p>
<p>æˆ‘çŒœä½ ç°åœ¨å¯èƒ½åœ¨æƒ³æ˜¯å¦æœ‰å¯èƒ½åŒæ—¶æ‹¥æœ‰ä¸¤ä¸ªå¼€æ”¾é›†ï¼Œæ®æˆ‘æ‰€çŸ¥ï¼Œè¿™ä¸æ˜¯ä¸å¯èƒ½çš„ï¼Œä½†é€šå¸¸ä¸åˆ‡å®é™…ã€‚<br/>ä¾‹å¦‚ï¼Œåœ¨â€œå‡†åˆ™18ï¼šè­¦æƒ•æ— ç¯è®¿é—®è€…çš„æ€§èƒ½â€ä¸­ï¼Œæˆ‘ä¼šå±•ç¤ºæ€§èƒ½å¯èƒ½ä¼šå—åˆ°æ˜¾è‘—å½±å“ã€‚</p>
<p>ç”±äºä½ å¯èƒ½æ˜¯åŸºäºæ¨¡æ¿çš„ç¼–ç¨‹å’Œç±»ä¼¼çš„ç¼–è¯‘æ—¶å·¥ä½œçš„ç²‰ä¸ï¼Œæˆ‘ä¹Ÿåº”è¯¥æ˜ç¡®æŒ‡å‡ºé™æ€å¤šæ€æ€§å¹¶æ²¡æœ‰ç›¸åŒçš„é™åˆ¶ã€‚<br/>è™½ç„¶åœ¨åŠ¨æ€å¤šæ€æ€§ä¸­ï¼Œè®¾è®¡è½´ä¹‹ä¸€ï¼ˆç±»å‹å’Œæ“ä½œï¼‰éœ€è¦å›ºå®šï¼Œä½†åœ¨é™æ€å¤šæ€æ€§ä¸­ï¼Œè¿™ä¸¤ç±»ä¿¡æ¯åœ¨ç¼–è¯‘æ—¶éƒ½æ˜¯å¯ç”¨çš„ã€‚å› æ­¤ï¼Œä¸¤æ–¹é¢éƒ½å¯ä»¥è½»æ¾æ‰©å±•ï¼ˆå¦‚æœä½ åšå¾—æ­£ç¡®ï¼‰ã€‚</p>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>
<p>æ³¨æ„ä¸åŒç¼–ç¨‹èŒƒå¼çš„ä¼˜ç¼ºç‚¹ã€‚</p>
</li>
<li>
<p>åˆ©ç”¨èŒƒå¼çš„ä¼˜åŠ¿ï¼Œä½†é¿å…å…¶å¼±ç‚¹ã€‚</p>
</li>
<li>
<p>ç†è§£åŠ¨æ€å¤šæ€æ€§ä¸­ç±»å‹æˆ–æ“ä½œçš„æ·»åŠ é€‰æ‹©ã€‚</p>
</li>
<li>
<p>å½“ä½ ä¸»è¦æƒ³æ·»åŠ ç±»å‹æ—¶ï¼Œä¼˜å…ˆé€‰æ‹©é¢å‘å¯¹è±¡è§£å†³æ–¹æ¡ˆã€‚</p>
</li>
<li>
<p>å½“ä½ ä¸»è¦æƒ³æ·»åŠ æ“ä½œæ—¶ï¼Œä¼˜å…ˆé€‰æ‹©è¿‡ç¨‹å¼/å‡½æ•°å¼è§£å†³æ–¹æ¡ˆã€‚</p>
</li>
</ul>
<h3 id="å‡†åˆ™16ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ‰©å±•æ“ä½œ">å‡†åˆ™16ï¼šä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ‰©å±•æ“ä½œ
</h3><p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œä½ çœ‹åˆ°é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰çš„ä¼˜åŠ¿åœ¨äºå¯ä»¥è½»æ¾æ·»åŠ ç±»å‹ï¼Œè€Œå…¶å¼±ç‚¹åœ¨äºéš¾ä»¥æ·»åŠ æ“ä½œã€‚å½“ç„¶ï¼ŒOOPå¯¹æ­¤æœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼šè®¿é—®è€…è®¾è®¡æ¨¡å¼ã€‚</p>
<p>è®¿é—®è€…è®¾è®¡æ¨¡å¼æ˜¯Gang of Fourï¼ˆGoFï¼‰æ‰€æè¿°çš„ç»å…¸è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚å®ƒçš„é‡ç‚¹åœ¨äºå…è®¸ä½ é¢‘ç¹åœ°æ·»åŠ æ“ä½œè€Œä¸æ˜¯ç±»å‹ã€‚è®©æˆ‘é€šè¿‡å‰é¢çš„ç¤ºä¾‹ï¼ˆå½¢çŠ¶ç»˜åˆ¶ï¼‰æ¥è§£é‡Šè®¿é—®è€…è®¾è®¡æ¨¡å¼ã€‚</p>
<p>åœ¨å›¾4-1ä¸­ï¼Œä½ çœ‹åˆ°äº†å½¢çŠ¶å±‚æ¬¡ç»“æ„ã€‚<code>Shape</code>ç±»å†æ¬¡ä½œä¸ºå¤šä¸ªå…·ä½“å½¢çŠ¶çš„åŸºç±»ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåªæœ‰ä¸¤ä¸ªç±»ï¼š<code>Circle</code>å’Œ<code>Square</code>ï¼Œä½†å½“ç„¶ä¹Ÿå¯ä»¥æœ‰æ›´å¤šçš„å½¢çŠ¶ç±»ï¼Œä¾‹å¦‚<code>Triangle</code>ã€<code>Rectangle</code>æˆ–<code>Ellipse</code>ç±»ã€‚</p>
<p><strong>åˆ†æè®¾è®¡é—®é¢˜</strong></p>
<p>å‡è®¾ä½ ç¡®å®šå·²ç»æ‹¥æœ‰äº†æ‰€æœ‰ä½ éœ€è¦çš„å½¢çŠ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ è®¤ä¸ºå½¢çŠ¶é›†åˆæ˜¯ä¸€ä¸ªå°é—­é›†ã€‚<br/>ç„¶è€Œï¼Œä½ ç¼ºå°‘çš„æ˜¯é¢å¤–çš„æ“ä½œï¼Œä¾‹å¦‚ï¼Œä½ ç¼ºå°‘ä¸€ä¸ªæ—‹è½¬å½¢çŠ¶çš„æ“ä½œï¼Œä½ ä¹Ÿå¸Œæœ›åºåˆ—åŒ–å½¢çŠ¶ï¼Œå³å°†å½¢çŠ¶å®ä¾‹è½¬æ¢ä¸ºå­—èŠ‚æµã€‚<br/>å½“ç„¶ï¼Œä½ è¿˜å¸Œæœ›ç»˜åˆ¶å½¢çŠ¶ã€‚æ­¤å¤–ï¼Œä½ å¸Œæœ›ä»»ä½•äººèƒ½å¤Ÿæ·»åŠ æ–°çš„æ“ä½œã€‚</p>
<p>å› æ­¤ï¼Œä½ æœŸæœ›æœ‰ä¸€ä¸ªå¼€æ”¾çš„æ“ä½œé›†ï¼Œæ¯ä¸€ä¸ªæ–°çš„æ“ä½œç°åœ¨éƒ½éœ€è¦ä½ åœ¨åŸºç±»ä¸­æ’å…¥ä¸€ä¸ªæ–°çš„è™šå‡½æ•°ã€‚<br/>ä¸å¹¸çš„æ˜¯ï¼Œè¿™åœ¨ä¸åŒçš„æ–¹é¢å¯èƒ½ä¼šå¸¦æ¥éº»çƒ¦ï¼Œæœ€æ˜æ˜¾çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªäººéƒ½èƒ½åœ¨ <code>Shape</code> åŸºç±»ä¸­æ·»åŠ ä¸€ä¸ªè™šå‡½æ•°ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä¸èƒ½ç®€å•åœ°å»ä¿®æ”¹ä½ çš„ä»£ç ã€‚å› æ­¤ï¼Œè¿™ç§æ–¹æ³•æ— æ³•æ»¡è¶³ä»»ä½•äººéƒ½èƒ½æ·»åŠ æ“ä½œçš„æœŸæœ›ï¼Œè™½ç„¶ä½ å¯èƒ½å·²ç»å°†æ­¤è§†ä¸ºæœ€ç»ˆçš„è´Ÿé¢ç»“è®ºï¼Œä½†è®©æˆ‘ä»¬è¯¦ç»†åˆ†æä¸€ä¸‹è™šå‡½æ•°çš„é—®é¢˜ã€‚</p>
<p>å¦‚æœä½ å†³å®šä½¿ç”¨çº¯è™šå‡½æ•°ï¼Œä½ å°†ä¸å¾—ä¸åœ¨æ¯ä¸ªæ´¾ç”Ÿç±»ä¸­å®ç°è¯¥å‡½æ•°ã€‚å¯¹äºä½ è‡ªå·±å®šä¹‰çš„æ´¾ç”Ÿç±»å‹æ¥è¯´ï¼Œè¿™å¯èƒ½åªæ˜¯å¤šäº†ä¸€äº›å·¥ä½œé‡ã€‚ä½†å¯¹äºå…¶ä»–äººé€šè¿‡ç»§æ‰¿ <code>Shape</code> åŸºç±»åˆ›å»ºçš„æ–°å½¢çŠ¶æ¥è¯´ï¼Œè¿™å¯èƒ½ä¼šå¢åŠ é¢å¤–çš„å·¥ä½œé‡ã€‚<br/>è€Œè¿™æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¼˜åŠ¿ä¹‹ä¸€ï¼šä»»ä½•äººéƒ½å¯ä»¥è½»æ¾æ·»åŠ æ–°ç±»å‹ã€‚ç”±äºè¿™ç§æƒ…å†µæ˜¯å¯ä»¥é¢„æœŸçš„ï¼Œå› æ­¤è¿™å¯èƒ½æ˜¯ä¸ä½¿ç”¨çº¯è™šå‡½æ•°çš„ä¸€ä¸ªåŸå› ã€‚</p>
<p>ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆï¼Œä½ å¯ä»¥å¼•å…¥ä¸€ä¸ªæ™®é€šçš„è™šå‡½æ•°ï¼Œå³å¸¦æœ‰é»˜è®¤å®ç°çš„è™šå‡½æ•°ã€‚<br/>è™½ç„¶ <code>rotate()</code> å‡½æ•°çš„é»˜è®¤è¡Œä¸ºå¬èµ·æ¥åƒæ˜¯ä¸€ä¸ªéå¸¸åˆç†çš„æƒ³æ³•ï¼Œä½† <code>serialize()</code> å‡½æ•°çš„é»˜è®¤å®ç°å¬èµ·æ¥å¹¶ä¸å®¹æ˜“ã€‚</p>
<p>æˆ‘æ‰¿è®¤æˆ‘å¿…é¡»ä»”ç»†è€ƒè™‘å¦‚ä½•å®ç°è¿™æ ·çš„å‡½æ•°ï¼Œä½ ç°åœ¨å¯èƒ½ä¼šå»ºè®®é»˜è®¤æƒ…å†µä¸‹æŠ›å‡ºå¼‚å¸¸ï¼Œä½†è¿™æ„å‘³ç€æ´¾ç”Ÿç±»å¿…é¡»å†æ¬¡å®ç°ç¼ºå¤±çš„è¡Œä¸ºï¼Œè¿™å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªä¼ªè£…çš„çº¯è™šå‡½æ•°ï¼Œæˆ–è€…æ˜ç¡®è¿åäº†é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆè§â€œå‡†åˆ™6ï¼šéµå¾ªæŠ½è±¡çš„é¢„æœŸè¡Œä¸ºâ€ï¼‰ã€‚</p>
<p>æ— è®ºå“ªç§æ–¹å¼ï¼Œåœ¨ <code>Shape</code> åŸºç±»ä¸­æ·»åŠ æ–°æ“ä½œéƒ½æ˜¯å›°éš¾çš„ï¼Œç”šè‡³æ ¹æœ¬ä¸å¯èƒ½ã€‚</p>
<p>å…¶æ ¹æœ¬åŸå› æ˜¯æ·»åŠ è™šå‡½æ•°è¿åäº†å¼€æ”¾å°é—­åŸåˆ™ï¼ˆOCPï¼‰ï¼Œå¦‚æœä½ ç¡®å®éœ€è¦é¢‘ç¹æ·»åŠ æ–°æ“ä½œï¼Œé‚£ä¹ˆä½ åº”è¯¥è®¾è®¡ä¸€ç§ä½¿å¾—æ“ä½œæ‰©å±•å˜å¾—å®¹æ˜“çš„æ–¹å¼ã€‚è¿™å°±æ˜¯è®¿é—®è€…è®¾è®¡æ¨¡å¼è¯•å›¾å®ç°çš„ç›®æ ‡ã€‚</p>
<p><strong>è®¿é—®è€…è®¾è®¡æ¨¡å¼è§£é‡Š</strong></p>
<p>è®¿é—®è€…è®¾è®¡æ¨¡å¼çš„æ„å›¾æ˜¯å…è®¸æ·»åŠ æ“ä½œã€‚</p>
<p>é™¤äº† <code>Shape</code> å±‚æ¬¡ç»“æ„å¤–ï¼Œæˆ‘ç°åœ¨åœ¨å›¾4-2çš„å·¦ä¾§å¼•å…¥äº† <code>ShapeVisitor</code> å±‚æ¬¡ç»“æ„ã€‚</p>
<p><code>ShapeVisitor</code> åŸºç±»ä»£è¡¨å½¢çŠ¶æ“ä½œçš„æŠ½è±¡ï¼Œå› æ­¤ï¼Œä½ å¯ä»¥è®¤ä¸º <code>ShapeOperation</code> å¯èƒ½æ˜¯è¿™ä¸ªç±»æ›´å¥½çš„åå­—ã€‚ç„¶è€Œï¼Œåº”ç”¨â€œå‡†åˆ™14ï¼šä½¿ç”¨è®¾è®¡æ¨¡å¼çš„åå­—æ¥ä¼ è¾¾æ„å›¾â€æ˜¯æœ‰ç›Šçš„ï¼Œåå­— <code>Visitor</code> å°†å¸®åŠ©å…¶ä»–äººç†è§£è®¾è®¡ã€‚</p>
<p><code>ShapeVisitor</code> åŸºç±»ä¸º <code>Shape</code> å±‚æ¬¡ç»“æ„ä¸­çš„æ¯ä¸ªå…·ä½“å½¢çŠ¶æä¾›ä¸€ä¸ªçº¯è™šå‡½æ•° <code>visit()</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ShapeVisitor</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">ShapeVisitor</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">visit</span><span class="p">(</span><span class="n">Circle</span> <span class="k">const</span><span class="o">&amp;</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">visit</span><span class="p">(</span><span class="n">Square</span> <span class="k">const</span><span class="o">&amp;</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">    <span class="c1">// å¯èƒ½æœ‰æ›´å¤šçš„ visit() å‡½æ•°ï¼Œæ¯ä¸ªå…·ä½“å½¢çŠ¶ä¸€ä¸ª 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ‰ä¸€ä¸ªç”¨äº <code>Circle</code> çš„ <code>visit()</code> å‡½æ•°å’Œä¸€ä¸ªç”¨äº <code>Square</code> çš„ <code>visit()</code> å‡½æ•°ã€‚<br/>å½“ç„¶ï¼Œå¯èƒ½æœ‰æ›´å¤š <code>visit()</code> å‡½æ•°â€”â€”ä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨äº <code>Triangle</code>ï¼Œä¸€ä¸ªç”¨äº <code>Rectangle</code>ï¼Œä¸€ä¸ªç”¨äº <code>Ellipse</code>â€”â€”å‡è®¾è¿™äº›ä¹Ÿæ˜¯ä» <code>Shape</code> åŸºç±»æ´¾ç”Ÿçš„ç±»ã€‚</p>
<p>æœ‰äº† <code>ShapeVisitor</code> åŸºç±»åï¼Œä½ ç°åœ¨å¯ä»¥è½»æ¾åœ°æ·»åŠ æ–°æ“ä½œï¼Œè¦æ·»åŠ ä¸€ä¸ªæ“ä½œï¼Œåªéœ€æ·»åŠ ä¸€ä¸ªæ–°çš„æ´¾ç”Ÿç±»ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸ºäº†å¯ç”¨æ—‹è½¬å½¢çŠ¶ï¼Œä½ å¯ä»¥å¼•å…¥ <code>Rotate</code> ç±»å¹¶å®ç°æ‰€æœ‰ <code>visit()</code> å‡½æ•°ã€‚<br/>ä¸ºäº†å¯ç”¨ç»˜åˆ¶å½¢çŠ¶ï¼Œä½ åªéœ€è¦å¼•å…¥ä¸€ä¸ª <code>Draw</code> ç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Draw</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ShapeVisitor</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">visit</span><span class="p">(</span><span class="n">Circle</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">c</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">visit</span><span class="p">(</span><span class="n">Square</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// å¯èƒ½æœ‰æ›´å¤šçš„ visit() å‡½æ•°ï¼Œæ¯ä¸ªå…·ä½“å½¢çŠ¶ä¸€ä¸ª 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½ å¯ä»¥è€ƒè™‘å¼•å…¥å¤šä¸ª <code>Draw</code> ç±»ï¼Œæ¯ä¸ªå›¾å½¢åº“ä¸€ä¸ªã€‚ä½ å¯ä»¥è½»æ¾åšåˆ°è¿™ä¸€ç‚¹ï¼Œå› ä¸ºä½ ä¸éœ€è¦ä¿®æ”¹ä»»ä½•ç°æœ‰ä»£ç ã€‚<br/>åªéœ€é€šè¿‡æ·»åŠ æ–°ä»£ç æ‰©å±• <code>ShapeVisitor</code> å±‚æ¬¡ç»“æ„å³å¯ã€‚</p>
<p>å› æ­¤ï¼Œè¿™ç§è®¾è®¡åœ¨æ·»åŠ æ“ä½œæ–¹é¢ç¬¦åˆå¼€æ”¾å°é—­åŸåˆ™ï¼ˆOCPï¼‰ã€‚</p>
<p>è¦å®Œå…¨ç†è§£è®¿é—®è€…çš„è®¾è®¡ç‰¹æ€§ï¼Œé‡è¦çš„æ˜¯ç†è§£ä¸ºä»€ä¹ˆè®¿é—®è€…è®¾è®¡æ¨¡å¼èƒ½å¤Ÿæ»¡è¶³ OCPã€‚</p>
<p>æœ€åˆçš„é—®é¢˜æ˜¯æ¯æ¬¡æ·»åŠ æ–°æ“ä½œéƒ½éœ€è¦ä¿®æ”¹ <code>Shape</code> åŸºç±»ï¼Œè®¿é—®è€…å°†æ“ä½œçš„æ·»åŠ è¯†åˆ«ä¸ºå˜åŒ–ç‚¹ï¼Œ<br/>é€šè¿‡æå–è¿™ä¸ªå˜åŒ–ç‚¹ï¼Œå³å°†å…¶ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„ç±»ï¼Œä½ éµå¾ªäº†å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰ï¼š<code>Shape</code> ä¸éœ€è¦ä¸ºæ¯ä¸ªæ–°æ“ä½œè€Œæ”¹å˜ã€‚</p>
<p>è¿™é¿å…äº†é¢‘ç¹ä¿®æ”¹ <code>Shape</code> å±‚æ¬¡ç»“æ„ï¼Œå¹¶ä½¿å¾—æ·»åŠ æ–°æ“ä½œå˜å¾—å®¹æ˜“ã€‚</p>
<p>å› æ­¤ï¼ŒSRP æˆä¸ºäº† OCP çš„æ¨åŠ¨è€…ã€‚</p>
<p>è¦åœ¨å½¢çŠ¶ä¸Šä½¿ç”¨è®¿é—®è€…ï¼ˆä» <code>ShapeVisitor</code> åŸºç±»æ´¾ç”Ÿçš„ç±»ï¼‰ï¼Œä½ ç°åœ¨å¿…é¡»åœ¨ <code>Shape</code> å±‚æ¬¡ç»“æ„ä¸­æ·»åŠ æœ€åä¸€ä¸ªå‡½æ•°ï¼š<code>accept()</code> å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">Shape</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">accept</span><span class="p">(</span><span class="n">ShapeVisitor</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Circle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Circle</span><span class="p">(</span><span class="kt">double</span> <span class="n">radius</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">radius_</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* æ£€æŸ¥ç»™å®šåŠå¾„çš„æœ‰æ•ˆæ€§ */</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">accept</span><span class="p">(</span><span class="n">ShapeVisitor</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span> <span class="n">v</span><span class="p">.</span><span class="n">visit</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span> <span class="p">}</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">radius</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">radius_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">radius_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Square</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Square</span><span class="p">(</span><span class="kt">double</span> <span class="n">side</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">side_</span><span class="p">(</span><span class="n">side</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* æ£€æŸ¥ç»™å®šè¾¹é•¿çš„æœ‰æ•ˆæ€§ */</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">accept</span><span class="p">(</span><span class="n">ShapeVisitor</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span> <span class="n">v</span><span class="p">.</span><span class="n">visit</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span> <span class="p">}</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">side</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">side_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">side_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>accept()</code> å‡½æ•°çš„å®ç°å¾ˆç®€å•ï¼Œå®ƒåªæ˜¯æ ¹æ®å…·ä½“ <code>Shape</code> çš„ç±»å‹è°ƒç”¨ç»™å®šè®¿é—®è€…çš„ç›¸åº” <code>visit()</code> å‡½æ•°ã€‚</p>
<p>è¿™æ˜¯é€šè¿‡å°† <code>this</code> æŒ‡é’ˆä½œä¸ºå‚æ•°ä¼ é€’ç»™ <code>visit()</code> æ¥å®ç°çš„ï¼Œå› æ­¤ï¼Œæ¯ä¸ªæ´¾ç”Ÿç±»ä¸­çš„ <code>accept()</code> å®ç°ç›¸åŒï¼Œä½†ç”±äºä¸åŒç±»å‹çš„ <code>this</code> æŒ‡é’ˆï¼Œå®ƒä¼šè§¦å‘ç»™å®šè®¿é—®è€…ä¸­ <code>visit()</code> å‡½æ•°çš„ä¸åŒé‡è½½ã€‚</p>
<p>å› æ­¤ï¼Œ<code>Shape</code> åŸºç±»ä¸èƒ½æä¾›é»˜è®¤å®ç°ã€‚</p>
<p>ç°åœ¨å¯ä»¥åœ¨éœ€è¦æ‰§è¡Œæ“ä½œçš„åœ°æ–¹ä½¿ç”¨è¿™ä¸ª <code>accept()</code> å‡½æ•°ã€‚</p>
<p>ä¾‹å¦‚ï¼Œ<code>drawAllShapes()</code> å‡½æ•°ä½¿ç”¨ <code>accept()</code> æ¥ç»˜åˆ¶ç»™å®šå½¢çŠ¶å‘é‡ä¸­çš„æ‰€æœ‰å½¢çŠ¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">drawAllShapes</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Shape</span><span class="o">&gt;&gt;</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">shapes</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="k">const</span><span class="o">&amp;</span> <span class="nl">shape</span> <span class="p">:</span> <span class="n">shapes</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">shape</span><span class="o">-&gt;</span><span class="n">accept</span><span class="p">(</span><span class="n">Draw</span><span class="p">{});</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡æ·»åŠ  <code>accept()</code> å‡½æ•°ï¼Œä½ ç°åœ¨å¯ä»¥è½»æ¾åœ°æ‰©å±• <code>Shape</code> å±‚æ¬¡ç»“æ„ä»¥æ”¯æŒæ›´å¤šçš„æ“ä½œã€‚</p>
<p>ä½ ç°åœ¨è®¾è®¡äº†ä¸€ä¸ªå¼€æ”¾çš„æ“ä½œé›†ï¼Œå¤ªæ£’äº†ï¼<br/>ç„¶è€Œï¼Œæ²¡æœ‰ä¸‡èƒ½è¯ï¼Œä¹Ÿæ²¡æœ‰æ€»æ˜¯æœ‰æ•ˆçš„è®¾è®¡ï¼Œæ¯ç§è®¾è®¡éƒ½æœ‰ä¼˜ç‚¹ï¼Œä½†ä¹Ÿæœ‰ç¼ºç‚¹ã€‚</p>
<p>æ‰€ä»¥åœ¨ä½ å¼€å§‹åº†ç¥ä¹‹å‰ï¼Œæˆ‘åº”è¯¥å‘Šè¯‰ä½ è®¿é—®è€…è®¾è®¡æ¨¡å¼çš„ä¸è¶³ä¹‹å¤„ï¼Œä»¥ä¾¿è®©ä½ å…¨é¢äº†è§£ã€‚</p>
<p><strong>åˆ†æè®¿é—®è€…è®¾è®¡æ¨¡å¼çš„ä¸è¶³</strong></p>
<p>è®¿é—®è€…è®¾è®¡æ¨¡å¼è¿œéå®Œç¾ã€‚è€ƒè™‘åˆ°è®¿é—®è€…å®é™…ä¸Šæ˜¯ä¸ºäº†å¼¥è¡¥é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰å†…åœ¨çš„å¼±ç‚¹è€Œè®¾è®¡çš„ä¸€ç§å˜é€šæ–¹æ¡ˆï¼Œè€Œä¸æ˜¯åŸºäºOOPçš„ä¼˜åŠ¿æ„å»ºçš„ï¼Œè¿™ä¸€ç‚¹æ˜¯å¯ä»¥é¢„æ–™åˆ°çš„ã€‚</p>
<p><strong>ç¬¬ä¸€ä¸ªç¼ºç‚¹ï¼šä½å®ç°çµæ´»æ€§</strong></p>
<p>ç¬¬ä¸€ä¸ªç¼ºç‚¹æ˜¯å®ç°çµæ´»æ€§è¾ƒä½ã€‚</p>
<p>å¦‚æœä½ è€ƒè™‘å®ç°ä¸€ä¸ª <code>Translate</code> è®¿é—®è€…ï¼Œè¿™ç§ç¼ºç‚¹å°±å˜å¾—å¾ˆæ˜æ˜¾ï¼Œ<code>Translate</code> è®¿é—®è€…éœ€è¦é€šè¿‡ç»™å®šçš„åç§»é‡ç§»åŠ¨æ¯ä¸ªå½¢çŠ¶çš„ä¸­å¿ƒç‚¹ã€‚ä¸ºæ­¤ï¼Œ<code>Translate</code> éœ€è¦ä¸ºæ¯ä¸ªå…·ä½“å½¢çŠ¶å®ç°ä¸€ä¸ª <code>visit()</code> å‡½æ•°ã€‚</p>
<p>ç‰¹åˆ«æ˜¯å¯¹äº <code>Translate</code>ï¼Œä½ å¯ä»¥æƒ³è±¡è¿™äº› <code>visit()</code> å‡½æ•°çš„å®ç°ä¼šéå¸¸ç›¸ä¼¼ï¼Œç”šè‡³å®Œå…¨ç›¸åŒï¼šæ—‹è½¬ä¸€ä¸ªåœ†å½¢å’Œæ—‹è½¬ä¸€ä¸ªæ–¹å½¢æ²¡æœ‰ä»€ä¹ˆä¸åŒã€‚</p>
<p>ç„¶è€Œï¼Œä½ ä»ç„¶éœ€è¦ç¼–å†™æ‰€æœ‰çš„ <code>visit()</code> å‡½æ•°ï¼Œå½“ç„¶ï¼Œä½ å¯ä»¥æ ¹æ®DRYåŸåˆ™å°†é€»è¾‘ä» <code>visit()</code> å‡½æ•°ä¸­æå–å‡ºæ¥ï¼Œå¹¶åœ¨ç¬¬ä¸‰ä¸ªç‹¬ç«‹å‡½æ•°ä¸­å®ç°ä»¥å‡å°‘é‡å¤ä»£ç ã€‚</p>
<p>ä½†ä¸å¹¸çš„æ˜¯ï¼ŒåŸºç±»çš„ä¸¥æ ¼è¦æ±‚ä¸å…è®¸ä½ å°†è¿™äº› <code>visit()</code> å‡½æ•°å®ç°ä¸ºä¸€ä¸ªç»Ÿä¸€çš„å‡½æ•°ã€‚ç»“æœæ˜¯ä¸€äº›æ ·æ¿ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Translate</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ShapeVisitor</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ç§»åŠ¨åœ†å½¢å’Œæ–¹å½¢æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä½ ä»ç„¶éœ€è¦å®ç°æ‰€æœ‰è™šå‡½æ•°...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="n">visit</span><span class="p">(</span><span class="n">Circle</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">c</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">visit</span><span class="p">(</span><span class="n">Square</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// å¯èƒ½æœ‰æ›´å¤šçš„ visit() å‡½æ•°ï¼Œæ¯ä¸ªå…·ä½“å½¢çŠ¶ä¸€ä¸ª 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç±»ä¼¼çš„å®ç°ä¸çµæ´»è¿˜åŒ…æ‹¬ <code>visit()</code> å‡½æ•°çš„è¿”å›ç±»å‹ï¼Œè¿”å›ç±»å‹çš„å†³å®šæ˜¯åœ¨ <code>ShapeVisitor</code> åŸºç±»ä¸­åšå‡ºçš„ï¼Œæ´¾ç”Ÿç±»æ— æ³•æ›´æ”¹ã€‚é€šå¸¸çš„åšæ³•æ˜¯å°†ç»“æœå­˜å‚¨åœ¨è®¿é—®è€…ä¸­å¹¶åœ¨ç¨åè®¿é—®å®ƒã€‚</p>
<p><strong>ç¬¬äºŒä¸ªç¼ºç‚¹ï¼šéš¾ä»¥æ·»åŠ æ–°ç±»å‹</strong></p>
<p>ç¬¬äºŒä¸ªç¼ºç‚¹æ˜¯ä½¿ç”¨è®¿é—®è€…è®¾è®¡æ¨¡å¼åï¼Œæ·»åŠ æ–°ç±»å‹å˜å¾—å›°éš¾ã€‚</p>
<p>ä¹‹å‰æˆ‘ä»¬å‡è®¾ä½ ç¡®å®šå·²ç»æ‹¥æœ‰äº†æ‰€æœ‰ä½ éœ€è¦çš„å½¢çŠ¶ï¼Œè¿™ä¸ªå‡è®¾ç°åœ¨å˜æˆäº†é™åˆ¶ã€‚</p>
<p>åœ¨ <code>Shape</code> å±‚æ¬¡ç»“æ„ä¸­æ·»åŠ æ–°çš„å½¢çŠ¶éœ€è¦æ›´æ–°æ•´ä¸ª <code>ShapeVisitor</code> å±‚æ¬¡ç»“æ„ï¼šä½ å¿…é¡»åœ¨ <code>ShapeVisitor</code> åŸºç±»ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„çº¯è™šå‡½æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªè™šå‡½æ•°éœ€è¦ç”±æ‰€æœ‰æ´¾ç”Ÿç±»å®ç°ã€‚</p>
<p>å½“ç„¶ï¼Œè¿™å¸¦æ¥äº†æˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„æ‰€æœ‰ç¼ºç‚¹ï¼Œç‰¹åˆ«æ˜¯ï¼Œä½ ä¼šè¿«ä½¿å…¶ä»–å¼€å‘äººå‘˜æ›´æ–°ä»–ä»¬çš„æ“ä½œã€‚</p>
<p>å› æ­¤ï¼Œè®¿é—®è€…è®¾è®¡æ¨¡å¼è¦æ±‚æœ‰ä¸€ä¸ªå°é—­çš„ç±»å‹é›†ï¼Œå¹¶ä»¥æ­¤äº¤æ¢å¼€æ”¾çš„æ“ä½œé›†ã€‚</p>
<p>åº•å±‚çš„åŸå› æ˜¯ <code>ShapeVisitor</code> åŸºç±»ã€å…·ä½“å½¢çŠ¶ï¼ˆå¦‚ <code>Circle</code> å’Œ <code>Square</code> ç­‰ï¼‰ä»¥åŠ <code>Shape</code> åŸºç±»ä¹‹é—´å­˜åœ¨å¾ªç¯ä¾èµ–ã€‚</p>
<p><strong>ç¬¬ä¸‰ä¸ªç¼ºç‚¹ï¼šä¾µå…¥æ€§</strong></p>
<p>ç¬¬ä¸‰ä¸ªç¼ºç‚¹æ˜¯è®¿é—®è€…çš„ä¾µå…¥æ€§ï¼Œè¦åœ¨ç°æœ‰å±‚æ¬¡ç»“æ„ä¸­æ·»åŠ è®¿é—®è€…ï¼Œä½ éœ€è¦åœ¨è¯¥å±‚æ¬¡ç»“æ„çš„åŸºç±»ä¸­æ·»åŠ <code>virtual accept()</code> å‡½æ•°ã€‚</p>
<p>è™½ç„¶è¿™é€šå¸¸æ˜¯å¯èƒ½çš„ï¼Œä½†å®ƒä»ç„¶å­˜åœ¨å‘ç°æœ‰å±‚æ¬¡ç»“æ„æ·»åŠ çº¯è™šå‡½æ•°çš„å¸¸è§é—®é¢˜ï¼ˆè§â€œå‡†åˆ™15ï¼šè®¾è®¡ä»¥æ”¯æŒç±»å‹æˆ–æ“ä½œçš„æ·»åŠ â€ï¼‰ã€‚</p>
<p>ç„¶è€Œï¼Œå¦‚æœä¸èƒ½æ·»åŠ  <code>accept()</code> å‡½æ•°ï¼Œåˆ™è¿™ç§å½¢å¼çš„è®¿é—®è€…ä¸å¯è¡Œã€‚<br/>å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œä¸è¦æ‹…å¿ƒï¼šæˆ‘ä»¬å°†åœ¨â€œå‡†åˆ™17ï¼šè€ƒè™‘ä½¿ç”¨ std::variant å®ç°è®¿é—®è€…â€ä¸­çœ‹åˆ°å¦ä¸€ç§éä¾µå…¥æ€§çš„è®¿é—®è€…è®¾è®¡æ¨¡å¼ã€‚</p>
<p><strong>ç¬¬å››ä¸ªç¼ºç‚¹ï¼šç»§æ‰¿çš„ accept() å‡½æ•°</strong></p>
<p>ç¬¬å››ä¸ªç¼ºç‚¹ï¼ˆå°½ç®¡è¾ƒä¸ºéšè”½ï¼‰æ˜¯ <code>accept()</code> å‡½æ•°æ˜¯ç”±æ´¾ç”Ÿç±»ç»§æ‰¿çš„ã€‚</p>
<p>å¦‚æœæœ‰äººåæ¥æ·»åŠ äº†å¦ä¸€å±‚æ´¾ç”Ÿç±»ï¼ˆå¯èƒ½æ˜¯ä½ è‡ªå·±ï¼‰å¹¶å¿˜è®°é‡å†™ <code>accept()</code> å‡½æ•°ï¼Œè®¿é—®è€…å°†è¢«åº”ç”¨åˆ°é”™è¯¯çš„ç±»å‹ä¸Šã€‚ä¸å¹¸çš„æ˜¯ï¼Œä½ ä¸ä¼šå¾—åˆ°ä»»ä½•è­¦å‘Šã€‚</p>
<p>è¿™åªæ˜¯è¿›ä¸€æ­¥è¯æ˜æ·»åŠ æ–°ç±»å‹å˜å¾—æ›´åŠ å›°éš¾ã€‚ä¸€ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯å°† <code>Circle</code> å’Œ <code>Square</code> ç±»å£°æ˜ä¸º <code>final</code>ï¼Œä½†è¿™å°†é™åˆ¶æœªæ¥çš„æ‰©å±•ã€‚</p>
<p><strong>ç¬¬äº”ä¸ªç¼ºç‚¹ï¼šåŒé‡åˆ†æ´¾æ€§èƒ½å¼€é”€</strong></p>
<p>ç¬¬äº”ä¸ªç¼ºç‚¹åœ¨æˆ‘ä»¬è€ƒè™‘æ¯æ¬¡æ“ä½œéƒ½éœ€è¦è°ƒç”¨ä¸¤ä¸ªè™šå‡½æ•°æ—¶å˜å¾—æ˜æ˜¾ã€‚</p>
<p>æœ€åˆï¼Œæˆ‘ä»¬æ—¢ä¸çŸ¥é“æ“ä½œçš„ç±»å‹ä¹Ÿä¸çŸ¥é“å½¢çŠ¶çš„ç±»å‹ã€‚</p>
<p>ç¬¬ä¸€ä¸ªè™šå‡½æ•°æ˜¯ <code>accept()</code> å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªæŠ½è±¡çš„ <code>ShapeVisitor</code>ã€‚<code>accept()</code> å‡½æ•°ç°åœ¨è§£æå…·ä½“çš„å½¢çŠ¶ç±»å‹ã€‚</p>
<p>ç¬¬äºŒä¸ªè™šæ‹Ÿå‡½æ•°æ˜¯ <code>visit()</code> å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå…·ä½“çš„ <code>Shape</code> ç±»å‹ã€‚<code>visit()</code> å‡½æ•°ç°åœ¨è§£æå…·ä½“çš„æ“ä½œç±»å‹ã€‚</p>
<p>è¿™ç§æ‰€è°“çš„åŒé‡åˆ†æ´¾ä¸å¹¸å¹¶ä¸æ˜¯å…è´¹çš„ã€‚ç›¸åï¼Œåœ¨æ€§èƒ½æ–¹é¢ï¼Œä½ åº”è¯¥è®¤ä¸ºè®¿é—®è€…è®¾è®¡æ¨¡å¼ç›¸å¯¹è¾ƒæ…¢ã€‚æˆ‘å°†åœ¨ä¸‹ä¸€ä¸ªå‡†åˆ™ä¸­æä¾›ä¸€äº›æ€§èƒ½æ•°æ®ã€‚</p>
<p>åœ¨è°ˆè®ºæ€§èƒ½æ—¶ï¼Œæˆ‘è¿˜åº”è¯¥æåˆ°å¦å¤–ä¸¤ä¸ªå¯¹æ€§èƒ½æœ‰è´Ÿé¢å½±å“çš„æ–¹é¢ï¼š</p>
<p><strong>é¢‘ç¹çš„å°å†…å­˜åˆ†é…</strong>ï¼šæˆ‘ä»¬é€šå¸¸å•ç‹¬åˆ†é…æ¯ä¸ªå½¢çŠ¶å’Œè®¿é—®è€…ã€‚è€ƒè™‘ä»¥ä¸‹ <code>main()</code> å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">using</span> <span class="n">Shapes</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Shape</span><span class="o">&gt;&gt;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">Shapes</span> <span class="n">shapes</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">shapes</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Circle</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">2.3</span><span class="p">));</span>  
</span></span><span class="line"><span class="cl">    <span class="n">shapes</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Square</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">1.2</span><span class="p">));</span>   
</span></span><span class="line"><span class="cl">    <span class="n">shapes</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Circle</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">4.1</span><span class="p">));</span>   
</span></span><span class="line"><span class="cl">    <span class="n">drawAllShapes</span><span class="p">(</span><span class="n">shapes</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™ä¸ª <code>main()</code> å‡½æ•°ä¸­ï¼Œæ‰€æœ‰åˆ†é…éƒ½æ˜¯é€šè¿‡ <code>std::make_unique()</code> è¿›è¡Œçš„</p>
<p>ï¼ˆä¾‹å¦‚ <code>shapes.emplace_back(std::make_unique&lt;Circle&gt;(2.3))</code>ï¼‰ã€‚</p>
<p>è¿™äº›è®¸å¤šå°çš„åˆ†é…æœ¬èº«å°±ä¼šæ¶ˆè€—è¿è¡Œæ—¶é—´ï¼Œå¹¶ä¸”æœ€ç»ˆä¼šå¯¼è‡´å†…å­˜ç¢ç‰‡åŒ–ã€‚</p>
<p>æ­¤å¤–ï¼Œå†…å­˜å¸ƒå±€å¯èƒ½ä¸åˆ©äºç¼“å­˜å‹å¥½ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨æŒ‡é’ˆæ¥å¤„ç†ç”Ÿæˆçš„å½¢çŠ¶å’Œè®¿é—®è€…ã€‚</p>
<p>ç”±æ­¤äº§ç”Ÿçš„é—´æ¥æ€§ä½¿å¾—ç¼–è¯‘å™¨æ›´éš¾è¿›è¡Œä»»ä½•å½¢å¼çš„ä¼˜åŒ–ï¼Œå¹¶ä¼šåœ¨æ€§èƒ½åŸºå‡†æµ‹è¯•ä¸­æ˜¾ç°å‡ºæ¥ã€‚</p>
<p>ç„¶è€Œï¼Œè€å®è¯´ï¼Œè¿™ä¸æ˜¯è®¿é—®è€…ç‰¹æœ‰çš„é—®é¢˜ï¼Œè€Œæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­å¸¸è§çš„ä¸¤ä¸ªæ–¹é¢ã€‚</p>
<p><strong>æœ€åçš„ç¼ºç‚¹ï¼šå¤æ‚æ€§å’Œç»´æŠ¤éš¾åº¦</strong></p>
<p>æœ€åçš„ç¼ºç‚¹æ˜¯ç»éªŒè¡¨æ˜ï¼Œè¿™ç§è®¾è®¡æ¨¡å¼ç›¸å½“éš¾ä»¥å®Œå…¨ç†è§£å’Œç»´æŠ¤ã€‚è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒä¸»è§‚çš„ç¼ºç‚¹ï¼Œä½†ä¸¤ä¸ªå±‚æ¬¡ç»“æ„ä¹‹é—´å¤æ‚çš„ç›¸äº’ä½œç”¨å¾€å¾€è®©äººæ„Ÿè§‰æ›´åƒæ˜¯è´Ÿæ‹…è€Œä¸æ˜¯çœŸæ­£çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p><strong>æ€»ç»“</strong></p>
<ul>
<li>
<p>è¯·è®°ä½ï¼Œåœ¨ç°æœ‰ç»§æ‰¿å±‚æ¬¡ç»“æ„ä¸­æ·»åŠ æ–°æ“ä½œæ˜¯å›°éš¾çš„ã€‚</p>
</li>
<li>
<p>åº”ç”¨è®¿é—®è€…è®¾è®¡æ¨¡å¼çš„æ„å›¾æ˜¯å…è®¸è½»æ¾æ·»åŠ æ“ä½œã€‚</p>
</li>
<li>
<p>è¦æ³¨æ„è®¿é—®è€…è®¾è®¡æ¨¡å¼çš„ä¸è¶³ã€‚</p>
</li>
</ul>
<h3 id="å‡†åˆ™17è€ƒè™‘ä½¿ç”¨-stdvariant-å®ç°è®¿é—®è€…">å‡†åˆ™17ï¼šè€ƒè™‘ä½¿ç”¨ std::variant å®ç°è®¿é—®è€…
</h3><p>åœ¨â€œå‡†åˆ™16ï¼šä½¿ç”¨è®¿é—®è€…æ‰©å±•æ“ä½œâ€ä¸­ï¼Œæˆ‘å‘ä½ ä»‹ç»äº†è®¿é—®è€…è®¾è®¡æ¨¡å¼ã€‚</p>
<p>æˆ‘æƒ³ä½ å¹¶ä¸ä¼šç«‹åˆ»çˆ±ä¸Šå®ƒï¼šå°½ç®¡è®¿é—®è€…ç¡®å®å…·æœ‰ä¸€äº›ç‹¬ç‰¹çš„ç‰¹æ€§ï¼Œä½†å®ƒä¹Ÿæ˜¯ä¸€ä¸ªç›¸å½“å¤æ‚çš„è®¾è®¡æ¨¡å¼ï¼Œå…·æœ‰è¾ƒå¼ºçš„å†…éƒ¨è€¦åˆå’Œæ€§èƒ½ç¼ºé™·ã€‚</p>
<p>ä¸ï¼Œç»å¯¹ä¸æ˜¯çˆ±ï¼ç„¶è€Œï¼Œä¸ç”¨æ‹…å¿ƒï¼Œç»å…¸å½¢å¼å¹¶ä¸æ˜¯å®ç°è®¿é—®è€…è®¾è®¡æ¨¡å¼çš„å”¯ä¸€æ–¹å¼ã€‚</p>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘æƒ³å‘ä½ ä»‹ç»ä¸€ç§ä¸åŒçš„å®ç°è®¿é—®è€…çš„æ–¹å¼ã€‚æˆ‘ç›¸ä¿¡è¿™ç§æ–¹æ³•ä¼šæ›´ç¬¦åˆä½ çš„å–œå¥½ã€‚</p>
<p><strong>std::variant ç®€ä»‹</strong></p>
<p>åœ¨æœ¬ç« çš„å¼€å¤´ï¼Œæˆ‘ä»¬è®¨è®ºäº†ä¸åŒèŒƒå¼ï¼ˆé¢å‘å¯¹è±¡ç¼–ç¨‹ä¸è¿‡ç¨‹å¼ç¼–ç¨‹ï¼‰çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚</p>
<p>ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬è°ˆåˆ°äº†è¿‡ç¨‹å¼ç¼–ç¨‹åœ¨ä¸ºç°æœ‰ç±»å‹é›†æ·»åŠ æ–°æ“ä½œæ–¹é¢ç‰¹åˆ«æ“…é•¿ã€‚</p>
<p>é‚£ä¹ˆï¼Œä¸å…¶è¯•å›¾åœ¨OOPä¸­å¯»æ‰¾å˜é€šæ–¹æ³•ï¼Œä¸ºä»€ä¹ˆä¸åˆ©ç”¨è¿‡ç¨‹å¼ç¼–ç¨‹çš„ä¼˜åŠ¿å‘¢ï¼Ÿ</p>
<p>ä¸ï¼Œä¸ç”¨æ‹…å¿ƒï¼›å½“ç„¶æˆ‘ä¸æ˜¯å»ºè®®å›åˆ°æœ€åˆçš„è§£å†³æ–¹æ¡ˆã€‚é‚£ç§æ–¹æ³•å¤ªå®¹æ˜“å‡ºé”™ã€‚ç›¸åï¼Œæˆ‘æŒ‡çš„æ˜¯ <strong>std::variantï¼š</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;variant&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Print</span>  
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="kt">int</span> <span class="n">value</span><span class="p">)</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;int: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="kt">double</span> <span class="n">value</span><span class="p">)</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;double: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">)</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;string: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ›å»ºä¸€ä¸ªé»˜è®¤åŒ…å« &#39;int&#39; åˆå§‹åŒ–ä¸º 0 çš„ variant
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">{};</span>  
</span></span><span class="line"><span class="cl">    <span class="n">v</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>        <span class="c1">// åˆ†é…æ•´æ•° 42 ç»™ variant   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">v</span> <span class="o">=</span> <span class="mf">3.14</span><span class="p">;</span>      <span class="c1">// åˆ†é…åŒç²¾åº¦æµ®ç‚¹æ•° 3.14 ç»™ variant   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">v</span> <span class="o">=</span> <span class="mf">2.71F</span><span class="p">;</span>     <span class="c1">// åˆ†é…æµ®ç‚¹æ•°ï¼Œä¼šè¢«æå‡ä¸ºåŒç²¾åº¦æµ®ç‚¹æ•°   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">v</span> <span class="o">=</span> <span class="s">&#34;Bjarne&#34;</span><span class="p">;</span>  <span class="c1">// åˆ†é…å­—ç¬¦ä¸²å­—é¢é‡ &#39;Bjarne&#39; ç»™ variant   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">v</span> <span class="o">=</span> <span class="mi">43</span><span class="p">;</span>        <span class="c1">// åˆ†é…æ•´æ•° 43 ç»™ variant   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="k">const</span> <span class="n">i</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>  <span class="c1">// ç›´æ¥è®¿é—®å€¼   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span><span class="o">*</span> <span class="k">const</span> <span class="n">pi</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">get_if</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v</span><span class="p">);</span>  <span class="c1">// ç›´æ¥è®¿é—®å€¼   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">Print</span><span class="p">{},</span> <span class="n">v</span><span class="p">);</span>  <span class="c1">// åº”ç”¨ Print è®¿é—®è€…   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”±äºä½ å¯èƒ½è¿˜æ²¡æœ‰æœºä¼šæ¥è§¦ C++17 çš„ <strong>std::variant</strong>ï¼Œè¯·å…è®¸æˆ‘ç®€è¦ä»‹ç»ä¸€ä¸‹ã€‚</p>
<p>ä¸€ä¸ª variant è¡¨ç¤ºå‡ ç§å¤‡é€‰æ–¹æ¡ˆä¸­çš„ä¸€ç§ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨ä¸Šè¿°ä»£ç ç¤ºä¾‹ä¸­çš„ <strong>main()</strong> å‡½æ•°å¼€å§‹æ—¶ï¼Œ<strong>variant</strong> å¯ä»¥åŒ…å«ä¸€ä¸ª <strong>int</strong>ã€ä¸€ä¸ª <strong>double</strong> æˆ–ä¸€ä¸ª <strong>std::string</strong>ã€‚è¯·æ³¨æ„æˆ‘è¯´çš„æ˜¯ <strong>â€œæˆ–â€</strong> ï¼šä¸€ä¸ª variant åªèƒ½åŒ…å«è¿™ä¸‰ç§å¤‡é€‰æ–¹æ¡ˆä¸­çš„ä¸€ç§ï¼Œå®ƒæ°¸è¿œä¸ä¼šåŒæ—¶åŒ…å«å¤šä¸ªï¼Œé€šå¸¸æƒ…å†µä¸‹ä¹Ÿä¸åº”è¯¥ä¸ºç©ºã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å°† variant ç§°ä¸ºä¸€ç§ <strong>â€œæ€»å’Œç±»å‹â€</strong> ï¼šå¯èƒ½çŠ¶æ€çš„é›†åˆæ˜¯å„å¤‡é€‰æ–¹æ¡ˆå¯èƒ½çŠ¶æ€çš„æ€»å’Œã€‚</p>
<p>é»˜è®¤çš„ variant ä¹Ÿä¸æ˜¯ç©ºçš„ã€‚å®ƒè¢«åˆå§‹åŒ–ä¸ºç¬¬ä¸€ä¸ªå¤‡é€‰æ–¹æ¡ˆçš„é»˜è®¤å€¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé»˜è®¤çš„ <strong>variant</strong> åŒ…å«ä¸€ä¸ªå€¼ä¸º <strong>0</strong> çš„<strong>æ•´æ•°</strong>ã€‚</p>
<p>æ”¹å˜ variant çš„å€¼å¾ˆç®€å•ï¼šä½ å¯ä»¥ç›´æ¥åˆ†é…æ–°å€¼ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†é…å€¼ 42ï¼Œè¿™æ„å‘³ç€ variant å­˜å‚¨äº†ä¸€ä¸ªå€¼ä¸º 42 çš„æ•´æ•°ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬éšååˆ†é…åŒç²¾åº¦æµ®ç‚¹æ•° <strong>3.14</strong>ï¼Œåˆ™ <strong>variant</strong> å°†å­˜å‚¨ä¸€ä¸ªå€¼ä¸º <strong>3.14</strong> çš„åŒç²¾åº¦æµ®ç‚¹æ•°ã€‚</p>
<p>å¦‚æœä½ æƒ³åˆ†é…ä¸€ä¸ªä¸å±äºè¿™äº›å¤‡é€‰æ–¹æ¡ˆä¹‹ä¸€çš„ç±»å‹çš„å€¼ï¼Œåˆ™åº”ç”¨å¸¸è§„è½¬æ¢è§„åˆ™ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³åˆ†é…ä¸€ä¸ªæµ®ç‚¹æ•°ï¼ŒåŸºäºå¸¸è§„è½¬æ¢è§„åˆ™ï¼Œå®ƒä¼šè¢«æå‡ä¸ºåŒç²¾åº¦æµ®ç‚¹æ•°ã€‚</p>
<p>ä¸ºäº†å­˜å‚¨å¤‡é€‰æ–¹æ¡ˆï¼Œ<strong>variant</strong> æä¾›äº†åˆšå¥½è¶³å¤Ÿçš„å†…éƒ¨ç¼“å†²åŒºæ¥å®¹çº³æœ€å¤§çš„å¤‡é€‰æ–¹æ¡ˆã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæœ€å¤§çš„å¤‡é€‰æ–¹æ¡ˆæ˜¯ <strong>std::string</strong>ï¼Œé€šå¸¸æ˜¯ 24 åˆ° 32 å­—èŠ‚ï¼ˆå–å†³äºæ ‡å‡†åº“çš„å…·ä½“å®ç°ï¼‰ã€‚</p>
<p>å› æ­¤ï¼Œå½“ä½ åˆ†é…å­—ç¬¦ä¸²å­—é¢é‡ <strong>&ldquo;Bjarne&rdquo;</strong> æ—¶ï¼Œ<strong>variant</strong> é¦–å…ˆæ¸…ç†ä¹‹å‰çš„å€¼ï¼ˆè¿™é‡Œæ²¡ä»€ä¹ˆéœ€è¦åšçš„ï¼Œåªæ˜¯ä¸€ä¸ªåŒç²¾åº¦æµ®ç‚¹æ•°ï¼‰ï¼Œ</p>
<p>ç„¶å <strong>æ„é€  std::string</strong> å¹¶å°†å…¶æ”¾ç½®åœ¨å…¶è‡ªèº«çš„<strong>ç¼“å†²åŒº</strong>å†…ã€‚</p>
<p>å½“ä½ æ”¹å˜ä¸»æ„å¹¶åˆ†é…æ•´æ•° <strong>43</strong> æ—¶ï¼Œ<strong>variant</strong> ä¼šé€šè¿‡å…¶ <strong>ææ„å‡½æ•°</strong> æ­£ç¡®é”€æ¯ <strong>std::string</strong> å¹¶é‡ç”¨å†…éƒ¨ç¼“å†²åŒºç”¨äºæ•´æ•°ã€‚</p>
<p>æ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ï¼Ÿ<strong>variant</strong> æ˜¯ç±»å‹å®‰å…¨ä¸”å§‹ç»ˆæ­£ç¡®åˆå§‹åŒ–çš„ã€‚æˆ‘ä»¬è¿˜èƒ½è¦æ±‚ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>å½“ç„¶ï¼Œä½ æƒ³è¦å¯¹ variant ä¸­çš„å€¼è¿›è¡Œä¸€äº›æ“ä½œï¼Œå¦‚æœåªæ˜¯å­˜å‚¨å€¼è€Œä¸åšä»»ä½•äº‹æƒ…ï¼Œé‚£å°†æ¯«æ— æ„ä¹‰ã€‚</p>
<p>ä¸å¹¸çš„æ˜¯ï¼Œä½ ä¸èƒ½ç®€å•åœ°å°† <strong>variant</strong> èµ‹å€¼ç»™å…¶ä»–ä»»ä½•å€¼ï¼Œä¾‹å¦‚ intï¼Œä»¥è·å–å›ä½ çš„å€¼ã€‚ä¸ï¼Œè®¿é—®å€¼æœ‰ç‚¹å¤æ‚ã€‚</p>
<p>æœ‰å‡ ç§è®¿é—®å­˜å‚¨å€¼çš„æ–¹æ³•ï¼Œæœ€ç›´æ¥çš„æ–¹æ³•æ˜¯ä½¿ç”¨ <strong>std::get()</strong>ã€‚é€šè¿‡ <strong>std::get()</strong>ï¼Œä½ å¯ä»¥æŸ¥è¯¢ç‰¹å®šç±»å‹çš„å€¼ã€‚</p>
<p>å¦‚æœ <strong>variant</strong> åŒ…å«è¯¥ç±»å‹çš„å€¼ï¼Œå®ƒå°†è¿”å›å¯¹è¯¥å€¼çš„<strong>å¼•ç”¨</strong>ã€‚</p>
<p>å¦‚æœä¸åŒ…å«ï¼Œåˆ™æŠ›å‡º <strong>std::bad_variant_exception</strong>ã€‚</p>
<p>è¿™çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªç›¸å½“ç²—é²çš„å“åº”ï¼Œæ¯•ç«Ÿä½ æ˜¯ç¤¼è²Œåœ°è¯·æ±‚çš„ï¼Œä½†æˆ‘ä»¬åº”è¯¥æ„Ÿåˆ°é«˜å…´çš„æ˜¯ï¼Œå½“ variant ç¡®å®ä¸åŒ…å«æŸä¸ªå€¼æ—¶ï¼Œå®ƒä¸ä¼šå‡è£…æŒæœ‰è¯¥å€¼ã€‚è‡³å°‘å®ƒæ˜¯è¯šå®çš„ã€‚</p>
<p>è¿˜æœ‰ä¸€ç§æ›´å‹å¥½çš„æ–¹å¼æ˜¯ <strong>std::get_if()</strong>ã€‚ä¸ <strong>std::get()</strong> ä¸åŒï¼Œ<strong>std::get_if()</strong> <strong>è¿”å›ä¸€ä¸ªæŒ‡é’ˆ</strong>è€Œä¸æ˜¯å¼•ç”¨ã€‚</p>
<p>å¦‚æœä½ è¯·æ±‚çš„ç±»å‹æ˜¯ <strong>std::variant</strong> å½“å‰<strong>æœªæŒæœ‰çš„ç±»å‹</strong>ï¼Œå®ƒä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯<strong>è¿”å› nullptr</strong>ã€‚</p>
<p>ç„¶è€Œï¼Œè¿˜æœ‰ç¬¬ä¸‰ç§æ–¹å¼ï¼Œè¿™ç§æ–¹å¼å¯¹æˆ‘ä»¬æ¥è¯´ç‰¹åˆ«æœ‰è¶£ï¼š<strong>std::visit()</strong>ã€‚</p>
<p><strong>std::visit()</strong> å…è®¸ä½ åœ¨å­˜å‚¨çš„å€¼ä¸Šæ‰§è¡Œä»»ä½•æ“ä½œï¼Œæ›´å‡†ç¡®åœ°è¯´ï¼Œå®ƒå…è®¸ä½ ä¼ é€’ä¸€ä¸ªè‡ªå®šä¹‰è®¿é—®è€…æ¥å¯¹å°é—­ç±»å‹é›†çš„å­˜å‚¨å€¼æ‰§è¡Œä»»ä½•æ“ä½œã€‚å¬èµ·æ¥ç†Ÿæ‚‰å—ï¼Ÿ</p>
<p>æˆ‘ä»¬ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’çš„ <strong>Print</strong> è®¿é—®è€…å¿…é¡»ä¸ºæ¯ä¸ªå¯èƒ½çš„å¤‡é€‰æ–¹æ¡ˆæä¾›ä¸€ä¸ªå‡½æ•°è°ƒç”¨è¿ç®—ç¬¦ï¼ˆoperator()ï¼‰ã€‚</p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¿™æ˜¯é€šè¿‡æä¾›ä¸‰ä¸ª <strong>operator()</strong> æ¥å®ç°çš„ï¼šä¸€ä¸ªç”¨äº <strong>int</strong>ï¼Œä¸€ä¸ªç”¨äº <strong>double</strong>ï¼Œä¸€ä¸ªç”¨äº <strong>std::string</strong>ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<strong>Print</strong> ä¸å¿…ç»§æ‰¿è‡ªä»»ä½•åŸºç±»ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•è™šå‡½æ•°ã€‚å› æ­¤ï¼Œæ²¡æœ‰å¼ºè€¦åˆåˆ°ä»»ä½•è¦æ±‚ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æ„¿æ„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°† <strong>int</strong> å’Œ <strong>double</strong> çš„å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦åˆå¹¶ä¸ºä¸€ä¸ªï¼Œå› ä¸º int å¯ä»¥è½¬æ¢ä¸º doubleï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Print</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="kt">double</span> <span class="n">value</span><span class="p">)</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;int or double: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">)</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;string: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è™½ç„¶å…³äºå“ªä¸ªç‰ˆæœ¬æ˜¯æˆ‘ä»¬åº”è¯¥é¦–é€‰çš„é—®é¢˜ç›®å‰å¯¹æˆ‘ä»¬æ¥è¯´å¹¶ä¸ç‰¹åˆ«é‡è¦ï¼Œä½†ä½ ä¼šæ³¨æ„åˆ°æˆ‘ä»¬æœ‰å¾ˆå¤šå®ç°çµæ´»æ€§ã€‚</p>
<p>åªæœ‰éå¸¸æ¾æ•£çš„è€¦åˆï¼ŒåŸºäºè¿™æ ·ä¸€ä¸ªçº¦å®šï¼šå¯¹äºæ¯ä¸€ä¸ªå¤‡é€‰æ–¹æ¡ˆï¼Œéƒ½éœ€è¦æœ‰ä¸€ä¸ª <code>operator()</code>ï¼Œè€Œä¸è®ºå…¶ç¡®åˆ‡å½¢å¼å¦‚ä½•ã€‚</p>
<p>æˆ‘ä»¬ä¸å†æœ‰ä¸€ä¸ªå¼ºåˆ¶æˆ‘ä»¬ä»¥éå¸¸å…·ä½“æ–¹å¼åšäº‹çš„è®¿é—®è€…åŸºç±»ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰ä»»ä½•å¤‡é€‰æ–¹æ¡ˆçš„åŸºç±»ï¼šæˆ‘ä»¬å¯ä»¥è‡ªç”±ä½¿ç”¨åŸºæœ¬ç±»å‹å¦‚ <code>int</code> å’Œ <code>double</code>ï¼Œä»¥åŠä»»æ„ç±»ç±»å‹å¦‚ <code>std::string</code>ã€‚</p>
<p>ä¹Ÿè®¸æœ€é‡è¦çš„æ˜¯ï¼Œä»»ä½•äººéƒ½å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„æ“ä½œï¼Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¿™æ˜¯ä¸€ç§è¿‡ç¨‹å¼è§£å†³æ–¹æ¡ˆï¼Œåªä¸è¿‡æ¯”æœ€åˆçš„åŸºäºæšä¸¾çš„è§£å†³æ–¹æ¡ˆæ›´åŠ ä¼˜é›…ï¼Œåè€…ä½¿ç”¨åŸºç±»æ¥ä¿å­˜åŒºåˆ†å™¨ã€‚</p>
<p><strong>é‡æ„å½¢çŠ¶ç»˜åˆ¶ä¸ºåŸºäºå€¼çš„éä¾µå…¥å¼è§£å†³æ–¹æ¡ˆ</strong></p>
<p>å‡­å€Ÿè¿™äº›ç‰¹æ€§ï¼Œstd::variant éå¸¸é€‚åˆæˆ‘ä»¬çš„ç»˜å›¾ç¤ºä¾‹ã€‚è®©æˆ‘ä»¬ä½¿ç”¨ std::variant é‡æ–°å®ç°å½¢çŠ¶çš„ç»˜åˆ¶ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬é‡æ„ Circle å’Œ Square ç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Circle.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Point.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Circle</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"> <span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">explicit</span> <span class="n">Circle</span><span class="p">(</span><span class="kt">double</span> <span class="n">radius</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">      <span class="o">:</span> <span class="n">radius_</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="cm">/* æ£€æŸ¥ç»™å®šåŠå¾„æ˜¯å¦æœ‰æ•ˆ */</span> 
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="kt">double</span> <span class="nf">radius</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">radius_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Point</span> <span class="nf">center</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">center_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">double</span> <span class="n">radius_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Point</span> <span class="n">center_</span><span class="p">{};</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Square.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Point.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Square</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"> <span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">explicit</span> <span class="n">Square</span><span class="p">(</span><span class="kt">double</span> <span class="n">side</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">      <span class="o">:</span> <span class="n">side_</span><span class="p">(</span><span class="n">side</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="cm">/* æ£€æŸ¥ç»™å®šè¾¹é•¿æ˜¯å¦æœ‰æ•ˆ */</span> 
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="kt">double</span> <span class="nf">side</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">side_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Point</span> <span class="nf">center</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">center_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">double</span> <span class="n">side_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Point</span> <span class="n">center_</span><span class="p">{};</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Circle</code> å’Œ <code>Square</code> ç±»éƒ½è¢«å¤§å¤§ç®€åŒ–äº†ï¼šä¸å†éœ€è¦ <code>Shape</code> åŸºç±»ï¼Œä¹Ÿä¸å†éœ€è¦å®ç°ä»»ä½•è™šå‡½æ•°â€”â€”ç‰¹åˆ«æ˜¯ <code>accept()</code> å‡½æ•°ã€‚</p>
<p>å› æ­¤ï¼Œè¿™ç§è®¿é—®è€…æ–¹æ³•æ˜¯éä¾µå…¥å¼çš„ï¼šè¿™ç§å½¢å¼çš„è®¿é—®è€…å¯ä»¥è½»æ¾æ·»åŠ åˆ°ç°æœ‰ç±»å‹ä¸­ï¼è€Œä¸”ä¸éœ€è¦ä¸ºè¿™äº›ç±»å‡†å¤‡ä»»ä½•å³å°†è¿›è¡Œçš„æ“ä½œã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å®Œå…¨ä¸“æ³¨äºå°†è¿™ä¸¤ä¸ªç±»å®ç°ä¸ºå®ƒä»¬æœ¬æ¥çš„æ ·å­ï¼šå‡ ä½•åŸºæœ¬ä½“ã€‚</p>
<p>ç„¶è€Œï¼Œé‡æ„ä¸­æœ€ç²¾å½©çš„éƒ¨åˆ†æ˜¯å®é™…ä½¿ç”¨ <code>std::variant</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Shape.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;variant&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Circle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Square.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="n">Shape</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">Circle</span><span class="p">,</span> <span class="n">Square</span><span class="o">&gt;</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Shapes.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="n">Shapes</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Shape</span><span class="o">&gt;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”±äºæˆ‘ä»¬çš„å°é—­ç±»å‹é›†æ˜¯ä¸€ç»„å½¢çŠ¶ï¼Œ<strong>variant</strong> ç°åœ¨åŒ…å«ä¸€ä¸ª <strong>Circle</strong> æˆ– <strong>Square</strong>ã€‚</p>
<p>é‚£ä¹ˆä»£è¡¨å½¢çŠ¶ç±»å‹çš„æŠ½è±¡é›†åˆçš„å¥½åå­—æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå—¯â€¦â€¦<strong>Shape</strong>ã€‚ä»£æ›¿æŠ½è±¡å‡ºå…·ä½“å½¢çŠ¶ç±»å‹çš„åŸºç±»ï¼Œ<strong>std::variant</strong> ç°åœ¨æ‰¿æ‹…äº†è¿™ä¸€ä»»åŠ¡ã€‚å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ä¸€ç‚¹ï¼Œä½ å¯èƒ½ä¼šæ„Ÿåˆ°éå¸¸æƒŠè®¶ã€‚</p>
<p>ä½†è¯·ç¨ç­‰ï¼Œè¿˜æœ‰æ›´å¤šï¼šè¿™ä¹Ÿæ„å‘³ç€æˆ‘ä»¬ç°åœ¨å¯ä»¥æ”¾å¼ƒ <strong>std::unique_ptr</strong>ã€‚<br/>è®°ä½ï¼šæˆ‘ä»¬ä½¿ç”¨ï¼ˆæ™ºèƒ½ï¼‰æŒ‡é’ˆçš„å”¯ä¸€åŸå› æ˜¯èƒ½å¤Ÿå°†ä¸åŒç§ç±»çš„å½¢çŠ¶å­˜å‚¨åœ¨åŒä¸€ä¸ªå‘é‡ä¸­ã€‚<br/>ä½†ç°åœ¨ <strong>std::variant</strong> ä½¿æˆ‘ä»¬èƒ½å¤Ÿåšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°† <strong>variant</strong> å¯¹è±¡å­˜å‚¨åœ¨ä¸€ä¸ªå•ä¸€çš„å‘é‡ä¸­ã€‚</p>
<p>æœ‰äº†è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™è‡ªå®šä¹‰æ“ä½œæ¥å¤„ç†å½¢çŠ¶ã€‚æˆ‘ä»¬ä»ç„¶å¯¹ç»˜åˆ¶å½¢çŠ¶æ„Ÿå…´è¶£ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬ç°åœ¨å®ç° Draw è®¿é—®è€…ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Draw.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include </span><span class="cm">/* ä¸€äº›å›¾å½¢åº“ */</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">struct</span> <span class="nc">Draw</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Circle</span><span class="o">&amp;</span> <span class="n">c</span><span class="p">)</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="cm">/* å®ç°ç»˜åˆ¶åœ†çš„é€»è¾‘ */</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Square</span><span class="o">&amp;</span> <span class="n">s</span><span class="p">)</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="cm">/* å®ç°ç»˜åˆ¶æ­£æ–¹å½¢çš„é€»è¾‘ */</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†æ¬¡ï¼Œæˆ‘ä»¬éµå¾ªæœŸæœ›ä¸ºæ¯ä¸ªå¤‡é€‰æ–¹æ¡ˆå®ç°ä¸€ä¸ª <code>operator()</code>ï¼šä¸€ä¸ªæ˜¯ <code>Circle</code>ï¼Œå¦ä¸€ä¸ªæ˜¯ <code>Square</code>ã€‚</p>
<p>ä½†è¿™æ¬¡æˆ‘ä»¬æœ‰é€‰æ‹©ï¼Œä¸éœ€è¦å®ç°ä»»ä½•åŸºç±»ï¼Œä¹Ÿä¸éœ€è¦é‡å†™ä»»ä½•è™šå‡½æ•°ã€‚<br/>å› æ­¤ï¼Œä¸éœ€è¦ä¸ºæ¯ä¸ªå¤‡é€‰æ–¹æ¡ˆç²¾ç¡®å®ç°ä¸€ä¸ª <code>operator()</code>ã€‚</p>
<p>è™½ç„¶åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ‹¥æœ‰ä¸¤ä¸ªå‡½æ•°ä¼¼ä¹æ˜¯åˆç†çš„ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©å°†ä¸¤ä¸ª <code>operator()</code> åˆå¹¶ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€‰æ‹©æ“ä½œçš„è¿”å›ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥æœ¬åœ°å†³å®šåº”è¯¥è¿”å›ä»€ä¹ˆï¼Œå¹¶ä¸”ä¸æ˜¯ç”±åŸºç±»ç‹¬ç«‹äºç‰¹å®šæ“ä½œåšå‡ºå…¨å±€å†³ç­–ã€‚å®ç°äº†çµæ´»æ€§ã€‚æ¾æ•£è€¦åˆï¼Œä»¤äººæƒŠå¹ï¼</p>
<p>æœ€åä¸€å—æ‹¼å›¾æ˜¯ <code>drawAllShapes()</code> å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;DrawAllShapes.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Shapes.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="nf">drawAllShapes</span><span class="p">(</span><span class="k">const</span> <span class="n">Shapes</span><span class="o">&amp;</span> <span class="n">shapes</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;DrawAllShapes.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;DrawAllShapes.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="nf">drawAllShapes</span><span class="p">(</span><span class="k">const</span> <span class="n">Shapes</span><span class="o">&amp;</span> <span class="n">shapes</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="k">const</span><span class="o">&amp;</span> <span class="nl">shape</span> <span class="p">:</span> <span class="n">shapes</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="n">std</span><span class="o">::</span><span class="n">visit</span><span class="p">(</span><span class="n">Draw</span><span class="p">{},</span> <span class="n">shape</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>drawAllShapes()</code> å‡½æ•°è¢«é‡æ„ä»¥åˆ©ç”¨ <code>std::visit()</code>ã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ç°åœ¨å°† <code>Draw</code> è®¿é—®è€…åº”ç”¨äºå­˜å‚¨åœ¨å‘é‡ä¸­çš„æ‰€æœ‰ <code>variant</code>ã€‚</p>
<p><code>std::visit()</code> çš„å·¥ä½œæ˜¯ä¸ºä½ æ‰§è¡Œå¿…è¦çš„ç±»å‹è°ƒåº¦ï¼Œå¦‚æœç»™å®šçš„ <code>std::variant</code> åŒ…å«ä¸€ä¸ª <code>Circle</code>ï¼Œå®ƒå°†è°ƒç”¨ <code>Draw::operator()</code> æ¥ç»˜åˆ¶åœ†ã€‚å¦åˆ™ï¼Œå®ƒä¼šè°ƒç”¨ <code>Draw::operator()</code> æ¥ç»˜åˆ¶æ­£æ–¹å½¢ã€‚</p>
<p>å¦‚æœä½ æƒ³çš„è¯ï¼Œä½ å¯ä»¥æ‰‹åŠ¨å®ç°ç›¸åŒçš„è°ƒåº¦ï¼Œä½¿ç”¨ <code>std::get_if()</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">drawAllShapes</span><span class="p">(</span><span class="k">const</span> <span class="n">Shapes</span><span class="o">&amp;</span> <span class="n">shapes</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="k">const</span><span class="o">&amp;</span> <span class="nl">shape</span> <span class="p">:</span> <span class="n">shapes</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="k">if</span><span class="p">(</span><span class="n">Circle</span><span class="o">*</span> <span class="n">circle</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">get_if</span><span class="o">&lt;</span><span class="n">Circle</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">shape</span><span class="p">))</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">         <span class="c1">// ... ç»˜åˆ¶ä¸€ä¸ªåœ† 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">}</span> 
</span></span><span class="line"><span class="cl">      <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">Square</span><span class="o">*</span> <span class="n">square</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">get_if</span><span class="o">&lt;</span><span class="n">Square</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">shape</span><span class="p">))</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">         <span class="c1">// ... ç»˜åˆ¶ä¸€ä¸ªæ­£æ–¹å½¢ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘çŸ¥é“ä½ åœ¨æƒ³ä»€ä¹ˆï¼šâ€œè’è°¬ï¼ä¸ºä»€ä¹ˆæˆ‘ä¼šæƒ³è¦è¿™æ ·åšï¼Ÿè¿™ä¼šå¯¼è‡´ä¸åŸºäºæšä¸¾çš„è§£å†³æ–¹æ¡ˆç›¸åŒçš„ç»´æŠ¤å™©æ¢¦ã€‚â€</p>
<p>æˆ‘å®Œå…¨åŒæ„ä½ çš„è§‚ç‚¹ï¼šä»è½¯ä»¶è®¾è®¡çš„è§’åº¦æ¥çœ‹ï¼Œè¿™å°†æ˜¯ä¸€ä¸ªç³Ÿç³•çš„æƒ³æ³•ã€‚<br/>å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä¸å¾—ä¸è¯´ï¼Œåœ¨è¿™æœ¬ä¹¦çš„ä¸Šä¸‹æ–‡ä¸­æ‰¿è®¤è¿™ä¸€ç‚¹æœ‰äº›å›°éš¾ï¼Œæœ‰æ—¶å¯èƒ½æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç†ç”±è¿™æ ·åšï¼š<strong>æ€§èƒ½</strong>ã€‚</p>
<p>æˆ‘çŸ¥é“ï¼Œç°åœ¨æˆ‘å·²ç»å¼•èµ·äº†ä½ çš„å…´è¶£ï¼Œä½†ç”±äºæˆ‘ä»¬å‡ ä¹å‡†å¤‡å¥½è®¨è®ºæ€§èƒ½é—®é¢˜ï¼Œå…è®¸æˆ‘æš‚æ—¶æ¨è¿Ÿè¿™ä¸ªè®¨è®ºå‡ æ®µæ–‡å­—ã€‚æˆ‘ä¿è¯ä¼šå›åˆ°è¿™ä¸ªé—®é¢˜ï¼</p>
<p>æœ‰äº†æ‰€æœ‰è¿™äº›ç»†èŠ‚ï¼Œæˆ‘ä»¬ç»ˆäºå¯ä»¥é‡æ„ <code>main()</code> å‡½æ•°äº†ï¼Œ<br/>ä½†è¿™ä¸éœ€è¦åšå¤ªå¤šå·¥ä½œï¼šä¸å†é€šè¿‡ <code>std::make_unique()</code> åˆ›å»ºåœ†å’Œæ­£æ–¹å½¢ï¼Œè€Œæ˜¯ç›´æ¥åˆ›å»ºåœ†å’Œæ­£æ–¹å½¢ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°å‘é‡ä¸­ã€‚</p>
<p>è¿™å¾—ç›Šäº <code>variant</code> çš„éæ˜¾å¼æ„é€ å‡½æ•°ï¼Œå®ƒå…è®¸éšå¼è½¬æ¢ä»»ä½•å¤‡é€‰æ–¹æ¡ˆï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Main.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Circle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Square.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Shapes.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;DrawAllShapes.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">Shapes</span> <span class="n">shapes</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">shapes</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">Circle</span><span class="p">{</span><span class="mf">2.3</span><span class="p">});</span> 
</span></span><span class="line"><span class="cl">    <span class="n">shapes</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">Square</span><span class="p">{</span><span class="mf">1.2</span><span class="p">});</span> 
</span></span><span class="line"><span class="cl">    <span class="n">shapes</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">Circle</span><span class="p">{</span><span class="mf">4.1</span><span class="p">});</span> 
</span></span><span class="line"><span class="cl">    <span class="n">drawAllShapes</span><span class="p">(</span><span class="n">shapes</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ç§åŸºäºå€¼çš„è§£å†³æ–¹æ¡ˆçš„æœ€ç»ˆç»“æœä»¤äººæƒŠå¹ï¼šæ²¡æœ‰ä»»ä½•åŸºç±»ã€‚æ²¡æœ‰è™šå‡½æ•°ï¼Œæ²¡æœ‰æŒ‡é’ˆã€‚æ²¡æœ‰æ‰‹åŠ¨å†…å­˜åˆ†é…ã€‚</p>
<p>äº‹æƒ…å°½å¯èƒ½åœ°ç›´æ¥ï¼Œå‡ ä¹æ²¡æœ‰æ ·æ¿ä»£ç ã€‚æ­¤å¤–ï¼Œå°½ç®¡ä»£ç çœ‹èµ·æ¥ä¸ä¹‹å‰çš„è§£å†³æ–¹æ¡ˆéå¸¸ä¸åŒï¼Œä½†æ¶æ„å±æ€§æ˜¯ç›¸åŒçš„ï¼šæ¯ä¸ªäººéƒ½å¯ä»¥åœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹æ·»åŠ æ–°æ“ä½œï¼ˆå‚è§å›¾ 4-4ï¼‰ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æ·»åŠ æ“ä½œæ–¹é¢ä»ç„¶æ»¡è¶³ OCPï¼ˆå¼€é—­åŸåˆ™ï¼‰ã€‚</p>
<p>å¦‚å‰æ‰€è¿°ï¼Œè¿™ç§æ–¹æ³•æ˜¯éä¾µå…¥å¼çš„ã€‚ä»æ¶æ„è§’åº¦æ¥çœ‹ï¼Œè¿™ç»™ä½ å¸¦æ¥äº†å¦ä¸€ä¸ªæ˜¾è‘—çš„ä¼˜åŠ¿ï¼Œç›¸æ¯”äºç»å…¸çš„è®¿é—®è€…æ¨¡å¼ã€‚</p>
<p>å¦‚æœä½ æ¯”è¾ƒ<strong>ç»å…¸è®¿é—®è€…</strong>çš„ä¾èµ–å…³ç³»å›¾ï¼ˆè§å›¾ 4-3ï¼‰å’Œ <code>std::variant</code> è§£å†³æ–¹æ¡ˆçš„ä¾èµ–å…³ç³»å›¾ï¼ˆè§å›¾ 4-4ï¼‰ï¼Œä½ ä¼šçœ‹åˆ° <code>std::variant</code> è§£å†³æ–¹æ¡ˆçš„ä¾èµ–å…³ç³»å›¾æœ‰ä¸€ä¸ªé¢å¤–çš„æ¶æ„è¾¹ç•Œã€‚</p>
<p>è¿™æ„å‘³ç€ <code>std::variant</code> åŠå…¶å¤‡é€‰æ–¹æ¡ˆä¹‹é—´æ²¡æœ‰å¾ªç¯ä¾èµ–ï¼Œæˆ‘åº”è¯¥é‡å¤ä¸€éä»¥å¼ºè°ƒå…¶é‡è¦æ€§ï¼š<code>std::variant</code> åŠå…¶å¤‡é€‰æ–¹æ¡ˆä¹‹é—´æ²¡æœ‰å¾ªç¯ä¾èµ–ï¼è¿™çœ‹ä¼¼ä¸€ä¸ªå°ç»†èŠ‚ï¼Œä½†å®é™…ä¸Šæ˜¯ä¸€ä¸ªå·¨å¤§çš„æ¶æ„ä¼˜åŠ¿ï¼Œå·¨å¤§ï¼ä¾‹å¦‚ï¼Œä½ å¯ä»¥å³æ—¶åˆ›å»ºåŸºäº <code>std::variant</code> çš„æŠ½è±¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Shape.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;variant&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Circle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Square.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="n">Shape</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">Circle</span><span class="p">,</span> <span class="n">Square</span><span class="o">&gt;</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;SomeHeader.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Circle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Ellipse.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;variant&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="n">RoundShapes</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">Circle</span><span class="p">,</span> <span class="n">Ellipse</span><span class="o">&gt;</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;SomeOtherHeader.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Square.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Rectangle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;variant&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="n">AngularShapes</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">variant</span><span class="o">&lt;</span><span class="n">Square</span><span class="p">,</span> <span class="n">Rectangle</span><span class="o">&gt;</span><span class="p">;</span>   
</span></span></code></pre></td></tr></table>
</div>
</div><p>é™¤äº†æˆ‘ä»¬å·²ç»åˆ›å»ºçš„ <code>Shape</code> æŠ½è±¡å¤–ï¼Œä½ è¿˜å¯ä»¥åˆ›å»ºæ‰€æœ‰åœ†å½¢çš„ <code>std::variant</code>ï¼Œä»¥åŠæ‰€æœ‰è§’åº¦å½¢çŠ¶çš„ <code>std::variant</code>ï¼Œè¿™ä¸¤è€…éƒ½å¯èƒ½è¿œç¦» <code>Shape</code> æŠ½è±¡ã€‚</p>
<p>ä½ å¯ä»¥è½»æ¾åšåˆ°è¿™ä¸€ç‚¹ï¼Œå› ä¸ºä¸éœ€è¦ä»å¤šä¸ªè®¿é—®è€…åŸºç±»æ´¾ç”Ÿã€‚ç›¸åï¼Œå½¢çŠ¶ç±»ä¸ä¼šå—åˆ°å½±å“ã€‚å› æ­¤ï¼Œ<code>std::variant</code> è§£å†³æ–¹æ¡ˆçš„éä¾µå…¥æ€§å…·æœ‰æœ€é«˜çš„æ¶æ„ä»·å€¼ã€‚</p>
<p><strong>æ€§èƒ½åŸºå‡†æµ‹è¯•</strong></p>
<p>æˆ‘çŸ¥é“ä½ ç°åœ¨çš„æ„Ÿè§‰ï¼Œæ˜¯çš„ï¼Œè¿™å°±æ˜¯ä¸€è§é’Ÿæƒ…çš„æ„Ÿè§‰ã€‚ä½†ä¿¡ä¸ä¿¡ç”±ä½ ï¼Œè¿˜æœ‰æ›´å¤šå†…å®¹ã€‚æœ‰ä¸€ä¸ªæˆ‘ä»¬è¿˜æ²¡æœ‰è®¨è®ºçš„è¯é¢˜ï¼Œè¿™æ˜¯æ¯ä¸ªC++å¼€å‘è€…éƒ½å…³å¿ƒçš„ï¼Œé‚£å°±æ˜¯æ€§èƒ½ã€‚</p>
<p>è™½ç„¶è¿™æœ¬ä¹¦å¹¶ä¸æ˜¯ä¸“é—¨è®¨è®ºæ€§èƒ½çš„ï¼Œä½†ä»ç„¶å€¼å¾—ä¸€æçš„æ˜¯ï¼Œä½ ä¸éœ€è¦æ‹…å¿ƒ <strong>std::variant</strong> çš„æ€§èƒ½ã€‚æˆ‘å¯ä»¥å‘ä½ ä¿è¯å®ƒéå¸¸å¿«ã€‚</p>
<p>ç„¶è€Œï¼Œåœ¨æˆ‘å‘ä½ å±•ç¤ºåŸºå‡†æµ‹è¯•ç»“æœä¹‹å‰ï¼Œè¯·å…è®¸æˆ‘å¯¹è¿™äº›åŸºå‡†æµ‹è¯•åšä¸€äº›è¯„è®ºã€‚æ€§èƒ½â€”â€”å”‰ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæ€§èƒ½æ€»æ˜¯ä¸€ä¸ªæ£˜æ‰‹çš„è¯é¢˜ã€‚æ€»æœ‰äººæŠ±æ€¨æ€§èƒ½é—®é¢˜ã€‚å› æ­¤ï¼Œæˆ‘å¾ˆä¹æ„å®Œå…¨è·³è¿‡è¿™ä¸ªè¯é¢˜ã€‚</p>
<p>ä½†å¦ä¸€æ–¹é¢ï¼Œä¹Ÿæœ‰äººæŠ±æ€¨ç¼ºå°‘æ€§èƒ½æ•°æ®ã€‚å”‰ï¼Œæ—¢ç„¶æ— è®ºå¦‚ä½•æ€»ä¼šæœ‰ä¸€äº›æŠ±æ€¨ï¼Œå¹¶ä¸”ç»“æœå®åœ¨å¤ªå¥½äº†ä¸å®¹é”™è¿‡ï¼Œæˆ‘ä¼šå‘ä½ å±•ç¤ºä¸€äº›åŸºå‡†æµ‹è¯•çš„ç»“æœã€‚</p>
<p>ä½†æœ‰ä¸¤ä¸ªæ¡ä»¶ï¼šé¦–å…ˆï¼Œä½ ä¸åº”å°†è¿™äº›ç»“æœè§†ä¸ºä»£è¡¨ç»å¯¹çœŸç†çš„å®šé‡å€¼ï¼Œè€Œåªæ˜¯æŒ‡å‘æ­£ç¡®æ–¹å‘çš„å®šæ€§å€¼ã€‚å…¶æ¬¡ï¼Œä½ ä¸ä¼šå› ä¸ºæˆ‘æ²¡æœ‰ä½¿ç”¨ä½ æœ€å–œæ¬¢çš„ç¼–è¯‘å™¨ã€ç¼–è¯‘æ ‡å¿—æˆ–IDEè€Œåœ¨æˆ‘çš„æˆ¿å­å‰æŠ—è®®ã€‚ç­”åº”å—ï¼Ÿ</p>
<p><strong>ä½ </strong>ï¼šç‚¹å¤´å¹¶æ‰¿è¯ºä¸ä¼šæŠ±æ€¨çç¢çš„äº‹æƒ…ï¼</p>
<p>å¥½çš„ï¼Œå¤ªæ£’äº†ï¼Œé‚£ä¹ˆè¡¨4-2ç»™å‡ºäº†åŸºå‡†æµ‹è¯•çš„ç»“æœã€‚</p>
<p><strong>è¡¨4-2 ä¸åŒè®¿é—®è€…å®ç°çš„åŸºå‡†æµ‹è¯•ç»“æœ</strong></p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>è®¿é—®è€…å®ç°</th>
<th>GCC 11.1</th>
<th>Clang 11.1</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç»å…¸è®¿é—®è€…è®¾è®¡æ¨¡å¼</td>
<td>1.6161 s</td>
<td>1.8015 s</td>
</tr>
<tr>
<td>é¢å‘å¯¹è±¡è§£å†³æ–¹æ¡ˆ</td>
<td>1.5205 s</td>
<td>1.1480 s</td>
</tr>
<tr>
<td>æšä¸¾è§£å†³æ–¹æ¡ˆ</td>
<td>1.2179 s</td>
<td>1.1200 s</td>
</tr>
<tr>
<td><code>std::variant</code>ï¼ˆä½¿ç”¨ <code>std::visit()</code>ï¼‰</td>
<td>1.1992 s</td>
<td>1.2279 s</td>
</tr>
<tr>
<td><code>std::variant</code>ï¼ˆä½¿ç”¨ <code>std::get_if()</code>ï¼‰</td>
<td>1.0252 s</td>
<td>0.6998 s</td>
</tr>
</tbody>
</table></div>
<p>ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™äº›æ•°å­—ï¼Œæˆ‘åº”è¯¥ç»™ä½ ä¸€äº›èƒŒæ™¯ä¿¡æ¯ã€‚ä¸ºäº†è®©åœºæ™¯æ›´åŠ ç°å®ï¼Œæˆ‘ä¸ä»…ä½¿ç”¨äº†åœ†å’Œæ­£æ–¹å½¢ï¼Œè¿˜ä½¿ç”¨äº†çŸ©å½¢å’Œæ¤­åœ†ã€‚</p>
<p>ç„¶ååœ¨10,000ä¸ªéšæœºåˆ›å»ºçš„å½¢çŠ¶ä¸Šè¿è¡Œäº†25,000æ¬¡æ“ä½œï¼Œæˆ‘æ²¡æœ‰ç»˜åˆ¶è¿™äº›å½¢çŠ¶ï¼Œè€Œæ˜¯é€šè¿‡éšæœºå‘é‡æ›´æ–°ä¸­å¿ƒç‚¹ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºè¿™ç§å¹³ç§»æ“ä½œéå¸¸ä¾¿å®œï¼Œå¯ä»¥è®©æˆ‘æ›´å¥½åœ°å±•ç¤ºæ‰€æœ‰è¿™äº›è§£å†³æ–¹æ¡ˆçš„å†…åœ¨å¼€é”€ï¼ˆå¦‚é—´æ¥å¯»å€å’Œè™šå‡½æ•°è°ƒç”¨çš„å¼€é”€ï¼‰ã€‚</p>
<p>ä¸€ä¸ªæ˜‚è´µçš„æ“ä½œï¼Œå¦‚ draw()ï¼Œä¼šæ©ç›–è¿™äº›ç»†èŠ‚ï¼Œå¹¶å¯èƒ½ç»™äººä»¥æ‰€æœ‰æ–¹æ³•éƒ½éå¸¸ç›¸ä¼¼çš„å°è±¡ã€‚</p>
<p>æˆ‘ä½¿ç”¨äº†<strong>GCC 11.1</strong>å’Œ<strong>Clang 11.1</strong>ï¼Œå¹¶ä¸ºè¿™ä¸¤ç§ç¼–è¯‘å™¨ä»…æ·»åŠ äº† <strong>-O3</strong> å’Œ <strong>-DNDEBUG</strong> ç¼–è¯‘æ ‡å¿—ã€‚ä½¿ç”¨çš„å¹³å°æ˜¯macOS Big Surï¼ˆç‰ˆæœ¬11.4ï¼‰ï¼Œæ­è½½8æ ¸Intel Core i7å¤„ç†å™¨ï¼Œä¸»é¢‘3.8 GHzï¼Œå†…å­˜64 GBã€‚</p>
<p>ä»åŸºå‡†æµ‹è¯•ç»“æœä¸­æœ€æ˜æ˜¾çš„ç»“è®ºæ˜¯ï¼Œ<strong>variant</strong> è§£å†³æ–¹æ¡ˆæ¯” <strong>ç»å…¸è®¿é—®è€…</strong> è§£å†³æ–¹æ¡ˆæ›´<strong>é«˜æ•ˆ</strong>ã€‚è¿™å¹¶ä¸ä»¤äººæƒŠè®¶ï¼šç”±äºåŒé‡åˆ†æ´¾ï¼Œ<strong>ç»å…¸è®¿é—®è€…</strong>å®ç°åŒ…å«äº†<strong>å¾ˆå¤šé—´æ¥å¯»å€</strong>ï¼Œå› æ­¤ä¹Ÿ<strong>å¾ˆéš¾ä¼˜åŒ–</strong>ã€‚</p>
<p>æ­¤å¤–ï¼Œå½¢çŠ¶å¯¹è±¡çš„å†…å­˜å¸ƒå±€éå¸¸å®Œç¾ï¼šä¸å…¶ä»–æ‰€æœ‰è§£å†³æ–¹æ¡ˆï¼ˆåŒ…æ‹¬åŸºäºæšä¸¾çš„è§£å†³æ–¹æ¡ˆï¼‰ç›¸æ¯”ï¼Œæ‰€æœ‰å½¢çŠ¶éƒ½åœ¨å†…å­˜ä¸­è¿ç»­å­˜å‚¨ï¼Œè¿™æ˜¯ä½ å¯ä»¥é€‰æ‹©çš„æœ€<strong>æœ‰åˆ©äºç¼“å­˜çš„å¸ƒå±€</strong>ã€‚</p>
<p>ç¬¬äºŒä¸ªç»“è®ºæ˜¯ï¼Œ<strong>std::variant</strong> ç¡®å®éå¸¸é«˜æ•ˆï¼Œç”šè‡³å¯ä»¥è¯´æ˜¯å‡ºä¹æ„æ–™åœ°é«˜æ•ˆã€‚</p>
<p>ç„¶è€Œï¼Œä»¤äººæƒŠè®¶çš„æ˜¯æ•ˆç‡é«˜åº¦ä¾èµ–äºæˆ‘ä»¬æ˜¯å¦ä½¿ç”¨ <strong>std::get_if()</strong> æˆ– <strong>std::visit()</strong>ï¼ˆæˆ‘ç­”åº”ä¼šå›åˆ°è¿™ä¸€ç‚¹ï¼‰ã€‚</p>
<p>æ— è®ºæ˜¯<strong>GCC</strong>è¿˜æ˜¯<strong>Clang</strong>ï¼Œåœ¨ä½¿ç”¨ <strong>std::visit()</strong> æ—¶ç”Ÿæˆçš„ä»£ç éƒ½è¦<strong>æ…¢</strong>å¾—å¤šã€‚æˆ‘å‡è®¾ <strong>std::visit()</strong> åœ¨è¿™ä¸€ç‚¹ä¸Šå¹¶æ²¡æœ‰è¢«å®Œç¾å®ç°å’Œä¼˜åŒ–ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æˆ‘ä¹‹å‰æ‰€è¯´ï¼Œæ€§èƒ½æ€»æ˜¯å¾ˆå¤æ‚ï¼Œæˆ‘ä¸æ‰“ç®—æ·±å…¥æ¢è®¨è¿™ä¸ªè°œé¢˜ã€‚</p>
<p>æœ€é‡è¦çš„æ˜¯ï¼Œ<strong>std::variant</strong> çš„ç¾ä¸½å¹¶æ²¡æœ‰å› ä¸ºç³Ÿç³•çš„æ€§èƒ½æ•°æ®è€Œå—åˆ°ç ´åã€‚</p>
<p>ç›¸åï¼šæ€§èƒ½ç»“æœæœ‰åŠ©äºåŠ æ·±ä½ ä¸ <strong>std::variant</strong> æ–°å»ºç«‹çš„å…³ç³»ã€‚</p>
<p><strong>åˆ†æ std::variant è§£å†³æ–¹æ¡ˆçš„ä¸è¶³ä¹‹å¤„</strong></p>
<p>è™½ç„¶æˆ‘ä¸æƒ³å±åŠè¿™ç§å…³ç³»ï¼Œä½†æˆ‘è®¤ä¸ºæŒ‡å‡ºä¸€äº›ç¼ºç‚¹æ˜¯æˆ‘çš„è´£ä»»ï¼Œå¦‚æœä½ ä½¿ç”¨åŸºäº <strong>std::variant</strong> çš„è§£å†³æ–¹æ¡ˆï¼Œä½ å°†ä¸å¾—ä¸é¢å¯¹è¿™äº›é—®é¢˜ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘åº”è¯¥å†æ¬¡æŒ‡å‡ºæ˜¾è€Œæ˜“è§çš„äº‹å®ï¼šä½œä¸ºä¸€ç§ç±»ä¼¼äºè®¿é—®è€…è®¾è®¡æ¨¡å¼ä¸”åŸºäºè¿‡ç¨‹ç¼–ç¨‹çš„è§£å†³æ–¹æ¡ˆï¼Œ<br/><strong>std::variant</strong> ä¹Ÿä¸“æ³¨äºæä¾›ä¸€ç»„å¼€æ”¾çš„æ“ä½œï¼Œå…¶ç¼ºç‚¹æ˜¯ä½ å¿…é¡»å¤„ç†ä¸€ä¸ªå°é—­çš„ç±»å‹é›†ã€‚</p>
<p>æ·»åŠ æ–°ç±»å‹ä¼šå¼•å‘ä¸æˆ‘ä»¬åœ¨ â€œå‡†åˆ™15ï¼šä¸ºç±»å‹æˆ–æ“ä½œçš„æ·»åŠ è¿›è¡Œè®¾è®¡â€ ä¸­æåˆ°çš„<strong>åŸºäºæšä¸¾</strong>çš„è§£å†³æ–¹æ¡ˆç±»ä¼¼çš„é—®é¢˜ã€‚<br/>é¦–å…ˆï¼Œä½ å¿…é¡»æ›´æ–° <strong>variant</strong> æœ¬èº«ï¼Œè¿™å¯èƒ½ä¼šè§¦å‘æ‰€æœ‰ä½¿ç”¨è¯¥ <strong>variant</strong> ç±»å‹çš„ä»£ç é‡æ–°ç¼–è¯‘ï¼ˆè¿˜è®°å¾—æ›´æ–°æšä¸¾å—ï¼Ÿï¼‰ã€‚<br/>æ­¤å¤–ï¼Œä½ è¿˜å¿…é¡»<strong>æ›´æ–°æ‰€æœ‰æ“ä½œ</strong>ï¼Œå¹¶ä¸ºæ–°çš„å¤‡é€‰æ–¹æ¡ˆæ·»åŠ å¯èƒ½ç¼ºå¤±çš„ <strong>operator()</strong>ã€‚<br/>å¥½çš„ä¸€é¢æ˜¯ï¼Œå¦‚æœç¼ºå°‘è¿™äº›æ“ä½œç¬¦ä¹‹ä¸€ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚åçš„ä¸€é¢æ˜¯ï¼Œç¼–è¯‘å™¨ä¸ä¼šç”Ÿæˆä¸€æ¡å‹å¥½ã€æ˜“è¯»çš„é”™è¯¯ä¿¡æ¯ï¼Œè€Œæ˜¯ç”Ÿæˆæ¥è¿‘æ‰€æœ‰æ¨¡æ¿ç›¸å…³é”™è¯¯æ¶ˆæ¯ä¹‹æ¯çš„ä¸œè¥¿ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œè¿™çœŸçš„éå¸¸åƒæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨<strong>åŸºäºæšä¸¾</strong>çš„è§£å†³æ–¹æ¡ˆæ—¶çš„ç»å†ã€‚</p>
<p><strong>ç¬¬äºŒä¸ªæ½œåœ¨é—®é¢˜</strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½ åº”è¯¥<strong>é¿å…</strong>åœ¨ <strong>variant</strong> ä¸­æ”¾ç½®<strong>å¤§å°å·®å¼‚å¾ˆå¤§</strong>çš„ç±»å‹ã€‚</p>
<p>å¦‚æœè‡³å°‘æœ‰ä¸€ä¸ªå¤‡é€‰æ–¹æ¡ˆæ¯”å…¶ä»–çš„å¤§å¾—å¤šï¼Œ<strong>å­˜å‚¨è®¸å¤šè¾ƒå°çš„å¤‡é€‰æ–¹æ¡ˆå¯èƒ½ä¼šæµªè´¹å¤§é‡ç©ºé—´</strong>ã€‚<br/>è¿™ä¼šå¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯ä¸ç›´æ¥å­˜å‚¨è¾ƒå¤§çš„å¤‡é€‰æ–¹æ¡ˆï¼Œè€Œæ˜¯<strong>é€šè¿‡ä»£ç†å¯¹è±¡</strong>æˆ–<strong>ä½¿ç”¨æ¡¥æ¥è®¾è®¡æ¨¡å¼</strong>æ¥å­˜å‚¨å®ƒä»¬ã€‚</p>
<p>å½“ç„¶ï¼Œè¿™ä¼š<strong>å¼•å…¥é—´æ¥å¯»å€</strong>ï¼Œè¿™ä¹Ÿä¼š<strong>å½±å“æ€§èƒ½</strong>ã€‚ä¸å­˜å‚¨ä¸åŒå¤§å°çš„å€¼ç›¸æ¯”ï¼Œè¿™ç§æ–¹æ³•åœ¨æ€§èƒ½ä¸Šçš„åŠ£åŠ¿ä¸å¦éœ€è¦ä½ è‡ªå·±è¿›è¡ŒåŸºå‡†æµ‹è¯•ã€‚</p>
<p>æœ€åä½†åŒæ ·é‡è¦çš„æ˜¯ï¼Œä½ åº”è¯¥å§‹ç»ˆæ„è¯†åˆ° <strong>variant</strong> å¯ä»¥æ­ç¤ºå¾ˆå¤šä¿¡æ¯ã€‚<br/>è™½ç„¶å®ƒä»£è¡¨äº†ä¸€ç§è¿è¡Œæ—¶æŠ½è±¡ï¼Œä½†åŒ…å«çš„ç±»å‹ä»ç„¶æ¸…æ™°å¯è§ã€‚è¿™å¯èƒ½ä¼šåˆ›å»ºå¯¹ <strong>variant</strong> çš„ç‰©ç†ä¾èµ–ï¼Œå³å½“ä½ ä¿®æ”¹å…¶ä¸­ä¸€ä¸ªå¤‡é€‰ç±»å‹æ—¶ï¼Œå¯èƒ½éœ€è¦é‡æ–°ç¼–è¯‘ä»»ä½•ä¾èµ–å®ƒçš„ä»£ç ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆåŒæ ·æ˜¯å­˜å‚¨<strong>æŒ‡é’ˆ</strong>æˆ–<strong>ä»£ç†å¯¹è±¡</strong>ï¼Œè¿™æ ·å¯ä»¥éšè—å®ç°ç»†èŠ‚ã€‚<br/>ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¹Ÿä¼šå¯¹æ€§èƒ½äº§ç”Ÿå½±å“ï¼Œå› ä¸ºå¾ˆå¤šæ€§èƒ½æå‡æ¥è‡ªäºç¼–è¯‘å™¨äº†è§£è¿™äº›ç»†èŠ‚å¹¶ç›¸åº”åœ°ä¼˜åŒ–å®ƒä»¬ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨æ€§èƒ½å’Œå°è£…ä¹‹é—´æ€»æ˜¯å­˜åœ¨æƒè¡¡ã€‚</p>
<p>å°½ç®¡å­˜åœ¨è¿™äº›ä¸è¶³ï¼Œæ€»ä½“è€Œè¨€ï¼Œ<strong>std::variant</strong> è¢«è¯æ˜æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ›¿ä»£<strong>é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰<strong>çš„</strong>è®¿é—®è€…è®¾è®¡æ¨¡å¼</strong>ã€‚<br/>å®ƒå¤§å¤§ç®€åŒ–äº†ä»£ç ï¼Œå‡ ä¹æ¶ˆé™¤äº†æ‰€æœ‰çš„æ ·æ¿ä»£ç ï¼Œå¹¶å°è£…äº†ä¸‘é™‹ä¸”ç»´æŠ¤å¯†é›†çš„éƒ¨åˆ†ï¼ŒåŒæ—¶å¸¦æ¥äº†å“è¶Šçš„æ€§èƒ½ã€‚</p>
<p>æ­¤å¤–ï¼Œ<strong>std::variant</strong> è¿˜è¯æ˜äº†ä¸€ä¸ªäº‹å®ï¼Œå³è®¾è®¡æ¨¡å¼å…³æ³¨çš„æ˜¯æ„å›¾ï¼Œè€Œä¸æ˜¯å®ç°ç»†èŠ‚ã€‚</p>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>ç†è§£ç»å…¸<strong>Visitor</strong>å’Œ<strong>std::variant</strong>ä¹‹é—´çš„æ¶æ„ç›¸ä¼¼æ€§ã€‚</li>
<li>æ³¨æ„<strong>std::variant</strong>ä¸é¢å‘å¯¹è±¡è®¿é—®è€…è§£å†³æ–¹æ¡ˆç›¸æ¯”çš„ä¼˜åŠ¿ã€‚</li>
<li>ä½¿ç”¨<strong>std::variant</strong>çš„éä¾µå…¥æ€§æ¥åŠ¨æ€åˆ›å»ºæŠ½è±¡ã€‚</li>
<li>è®°ä½<strong>std::variant</strong>çš„ç¼ºç‚¹ï¼Œå¹¶åœ¨ä¸åˆé€‚çš„æ—¶å€™é¿å…ä½¿ç”¨å®ƒ</li>
</ul>
<h3 id="å‡†åˆ™18è­¦æƒ•æ— ç¯è®¿é—®è€…çš„æ€§èƒ½">å‡†åˆ™18ï¼šè­¦æƒ•æ— ç¯è®¿é—®è€…çš„æ€§èƒ½
</h3><p>æ­£å¦‚ä½ åœ¨â€œå‡†åˆ™15ï¼šä¸ºç±»å‹æˆ–æ“ä½œçš„æ·»åŠ è¿›è¡Œè®¾è®¡â€ä¸­çœ‹åˆ°çš„ï¼Œå½“ä½ ä½¿ç”¨åŠ¨æ€å¤šæ€æ€§æ—¶ï¼Œä½ å¿…é¡»åšå‡ºä¸€ä¸ªå†³å®šï¼šä½ å¯ä»¥æ”¯æŒå¼€æ”¾çš„ç±»å‹é›†æˆ–å¼€æ”¾çš„æ“ä½œé›†ã€‚</p>
<p>ä½ ä¸èƒ½ä¸¤è€…å…¼å¾—ï¼Œå¥½å§ï¼Œæˆ‘ç‰¹åˆ«æåˆ°è¿‡ï¼Œæ®æˆ‘æ‰€çŸ¥ï¼ŒåŒæ—¶æ‹¥æœ‰ä¸¤è€…å¹¶ä¸æ˜¯ä¸å¯èƒ½çš„ï¼Œä½†é€šå¸¸ä¸åˆ‡å®é™…ã€‚</p>
<p>ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘å‘ä½ ä»‹ç»è®¿é—®è€…è®¾è®¡æ¨¡å¼çš„å¦ä¸€ç§å˜ä½“ï¼š<strong>æ— ç¯è®¿é—®è€…</strong>ï¼ˆAcyclic Visitorï¼‰ã€‚</p>
<p>åœ¨ â€œå‡†åˆ™16ï¼šä½¿ç”¨è®¿é—®è€…æ‰©å±•æ“ä½œâ€ä¸­ï¼Œä½ çœ‹åˆ°äº†<strong>è®¿é—®è€…è®¾è®¡æ¨¡å¼çš„å…³é”®å‚ä¸è€…ä¹‹é—´å­˜åœ¨å¾ªç¯ä¾èµ–</strong>ï¼š<br/><strong>è®¿é—®è€…åŸºç±»ä¾èµ–äºå½¢çŠ¶çš„å…·ä½“ç±»å‹ï¼ˆå¦‚ Circleã€Square ç­‰ï¼‰ï¼Œå…·ä½“ç±»å‹çš„å½¢çŠ¶ä¾èµ–äº Shape åŸºç±»ï¼Œè€Œ Shape åŸºç±»åˆä¾èµ–äºè®¿é—®è€…åŸºç±»ã€‚</strong></p>
<p>ç”±äºè¿™ç§å¾ªç¯ä¾èµ–ï¼Œå°†æ‰€æœ‰è¿™äº›å…³é”®è§’è‰²é”å®šåœ¨ä¸€ä¸ªæ¶æ„å±‚æ¬¡ä¸Šï¼Œä½¿å¾—å‘è®¿é—®è€…æ·»åŠ æ–°ç±»å‹å˜å¾—å›°éš¾ã€‚</p>
<p><strong>æ— ç¯è®¿é—®è€…çš„æƒ³æ³•æ˜¯æ‰“ç ´è¿™ç§ä¾èµ–å…³ç³»ã€‚</strong></p>
<p>å›¾4-5 æ˜¾ç¤ºäº†æ— ç¯è®¿é—®è€…çš„UMLå›¾ã€‚</p>
<p>ä¸GoFè®¿é—®è€…ç›¸æ¯”ï¼Œè™½ç„¶å›¾ç‰‡å³ä¾§åªæœ‰å¾ˆå°çš„åŒºåˆ«ï¼Œä½†åœ¨å·¦ä¾§æœ‰ä¸€äº›æ ¹æœ¬æ€§çš„å˜åŒ–ã€‚</p>
<p>æœ€é‡è¦çš„æ˜¯ï¼Œè®¿é—®è€…åŸºç±»è¢«æ‹†åˆ†æˆäº†å¤šä¸ªåŸºç±»ï¼š<strong>AbstractVisitor</strong> åŸºç±»å’Œæ¯ä¸ªå…·ä½“å½¢çŠ¶ç±»å‹çš„ä¸€ä¸ªåŸºç±»ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ <strong>CircleVisitor</strong> å’Œ <strong>SquareVisitor</strong>ï¼‰ã€‚</p>
<p>æ‰€æœ‰è®¿é—®è€…éƒ½å¿…é¡»ç»§æ‰¿è‡ª <strong>AbstractVisitor</strong> åŸºç±»ï¼Œä½†ç°åœ¨ä¹Ÿæœ‰é€‰æ‹©å¯ä»¥ç»§æ‰¿è‡ªå…·ä½“çš„å½¢çŠ¶è®¿é—®è€…åŸºç±»ã€‚</p>
<p>å¦‚æœä¸€ä¸ªæ“ä½œæƒ³è¦æ”¯æŒ<strong>åœ†å½¢</strong>ï¼Œå®ƒå°±ç»§æ‰¿è‡ª <strong>CircleVisitor</strong> åŸºç±»å¹¶å®ç°é’ˆå¯¹ <strong>Circle</strong> çš„ <strong>visit() å‡½æ•°</strong>ã€‚</p>
<p>å¦‚æœå®ƒä¸æƒ³æ”¯æŒåœ†å½¢ï¼Œåˆ™åªéœ€ä¸ç»§æ‰¿ CircleVisitorã€‚</p>
<p>ä»¥ä¸‹ä»£ç ç‰‡æ®µå±•ç¤ºäº†è®¿é—®è€…åŸºç±»çš„ä¸€ç§å¯èƒ½å®ç°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;AbstractVisitor.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">AbstractVisitor</span>  
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">AbstractVisitor</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Visitor.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Visitor</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">protected</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="o">~</span><span class="n">Visitor</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">visit</span><span class="p">(</span> <span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>AbstractVisitor åŸºç±»åªæ˜¯ä¸€ä¸ªå¸¦æœ‰è™šææ„å‡½æ•°çš„ç©ºåŸºç±»ã€‚ä¸éœ€è¦å…¶ä»–ä»»ä½•å‡½æ•°ã€‚æ­£å¦‚ä½ å°†çœ‹åˆ°çš„ï¼ŒAbstractVisitor ä»…ä½œä¸ºä¸€ä¸ªé€šç”¨æ ‡è®°æ¥è¯†åˆ«è®¿é—®è€…ï¼Œå¹¶ä¸éœ€è¦æä¾›ä»»ä½•æ“ä½œã€‚åœ¨C++ä¸­ï¼Œæˆ‘ä»¬å€¾å‘äºä»¥ç±»æ¨¡æ¿çš„å½¢å¼å®ç°å…·ä½“çš„å½¢çŠ¶è®¿é—®è€…åŸºç±»ã€‚Visitor ç±»æ¨¡æ¿æ ¹æ®ç‰¹å®šçš„å½¢çŠ¶ç±»å‹è¿›è¡Œå‚æ•°åŒ–ï¼Œå¹¶ä¸ºè¯¥ç‰¹å®šå½¢çŠ¶å¼•å…¥çº¯è™šå‡½æ•° visit()ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„ Draw è®¿é—®è€…çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬ç°åœ¨å°†ç»§æ‰¿è‡ªä¸‰ä¸ªåŸºç±»ï¼š</p>
<p><code>AbstractVisitorã€Visitor&lt;Circle&gt; </code> å’Œ <code>Visitor&lt;Square&gt;</code> ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›æ”¯æŒ Circle å’Œ Squareï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Draw</span> <span class="o">:</span> <span class="k">public</span> <span class="n">AbstractVisitor</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">             <span class="k">public</span> <span class="n">Visitor</span><span class="o">&lt;</span><span class="n">Circle</span><span class="o">&gt;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">             <span class="k">public</span> <span class="n">Visitor</span><span class="o">&lt;</span><span class="n">Square</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">visit</span><span class="p">(</span> <span class="n">Circle</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">c</span> <span class="p">)</span> <span class="k">const</span> <span class="k">override</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="cm">/* ... å®ç°ç»˜åˆ¶åœ†çš„é€»è¾‘ ... */</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">visit</span><span class="p">(</span> <span class="n">Square</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">s</span> <span class="p">)</span> <span class="k">const</span> <span class="k">override</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="cm">/* ... å®ç°ç»˜åˆ¶æ­£æ–¹å½¢çš„é€»è¾‘ ... */</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ç§å®ç°é€‰æ‹©æ‰“ç ´äº†å¾ªç¯ä¾èµ–ã€‚å¦‚å›¾4-6æ‰€ç¤ºï¼Œæ¶æ„çš„é«˜å±‚ä¸å†ä¾èµ–äºå…·ä½“çš„å½¢çŠ¶ç±»å‹ã€‚æ— è®ºæ˜¯å½¢çŠ¶ï¼ˆ<code>Circle</code> å’Œ <code>Square</code>ï¼‰è¿˜æ˜¯æ“ä½œç°åœ¨éƒ½ä½äºæ¶æ„è¾¹ç•Œçš„ä½å±‚ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥åŒæ—¶æ·»åŠ ç±»å‹å’Œæ“ä½œã€‚</p>
<p>æ­¤åˆ»ï¼Œä½ çœ‹èµ·æ¥éå¸¸æ€€ç–‘ï¼Œå‡ ä¹æ˜¯è´£å¤‡åœ°çœ‹å‘æˆ‘ã€‚æˆ‘ä¸æ˜¯è¯´è¿‡ä¸¤è€…å…¼å¾—æ˜¯ä¸å¯èƒ½çš„å—ï¼Ÿæ˜¾ç„¶ï¼Œè¿™æ˜¯å¯èƒ½çš„ï¼Œå¯¹å§ï¼Ÿå¥½å§ï¼Œå†ä¸€æ¬¡å¼ºè°ƒï¼Œæˆ‘æ²¡æœ‰å£°ç§°è¿™æ˜¯ä¸å¯èƒ½çš„ã€‚æˆ‘æ›´å€¾å‘äºè¯´è¿™å¯èƒ½æ˜¯ä¸åˆ‡å®é™…çš„ã€‚ç°åœ¨ä½ å·²ç»çœ‹åˆ°äº†æ— ç¯è®¿é—®è€…çš„ä¼˜åŠ¿ï¼Œè®©æˆ‘å‘ä½ å±•ç¤ºè¿™ç§æ–¹æ³•çš„ç¼ºç‚¹ã€‚</p>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ <strong>Circle</strong> ä¸­ <strong>accept()</strong> å‡½æ•°çš„å®ç°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Circle.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Circle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Circle</span><span class="p">(</span><span class="kt">double</span> <span class="n">radius</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">radius_</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* æ£€æŸ¥ç»™å®šçš„åŠå¾„æ˜¯å¦æœ‰æ•ˆ */</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">accept</span><span class="p">(</span><span class="n">AbstractVisitor</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">v</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>   
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">auto</span> <span class="k">const</span><span class="o">*</span> <span class="n">cv</span> <span class="o">=</span> <span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">Visitor</span><span class="o">&lt;</span><span class="n">Circle</span><span class="o">&gt;</span> <span class="k">const</span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v</span><span class="p">))</span> <span class="p">{</span>   
</span></span><span class="line"><span class="cl">            <span class="n">cv</span><span class="o">-&gt;</span><span class="n">visit</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">        <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">radius</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">radius_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="n">Point</span> <span class="nf">center</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">center_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">radius_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">Point</span> <span class="n">center_</span><span class="p">{};</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ° <strong>Shape</strong> å±‚æ¬¡ç»“æ„ä¸­çš„ä¸€ä¸ªå°å˜åŒ–ï¼šè™šå‡½æ•° accept() ç°åœ¨æ¥å—ä¸€ä¸ª <strong>AbstractVisitor</strong>ã€‚</p>
<p>ä½ è¿˜è®°å¾— <strong>AbstractVisitor</strong> æœ¬èº«å¹¶ä¸å®ç°ä»»ä½•æ“ä½œã€‚å› æ­¤ï¼Œ<strong>Circle</strong> ä¸æ˜¯åœ¨ <strong>AbstractVisitor</strong> ä¸Šè°ƒç”¨ <strong>visit()</strong> å‡½æ•°ï¼Œè€Œæ˜¯é€šè¿‡æ‰§è¡Œ <strong>dynamic_cast</strong> æ¥ç¡®å®šç»™å®šçš„è®¿é—®è€…æ˜¯å¦æ”¯æŒåœ†å½¢ï¼ˆ<code>Visitor&lt;Circle&gt;</code> ï¼‰ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œå®ƒæ‰§è¡Œçš„æ˜¯æŒ‡é’ˆè½¬æ¢ï¼Œè¿™æ„å‘³ç€ <strong>dynamic_cast</strong> å°†è¿”å›ä¸€ä¸ªæœ‰æ•ˆçš„ <code>Visitor&lt;Circle&gt;</code>  æŒ‡é’ˆæˆ– nullptrã€‚<br/>å¦‚æœè¿”å›ä¸€ä¸ªæœ‰æ•ˆçš„ <code>Visitor&lt;Circle&gt;</code>  æŒ‡é’ˆï¼Œå®ƒå°†è°ƒç”¨ç›¸åº”çš„ <strong>visit()</strong> å‡½æ•°ã€‚</p>
<p>è™½ç„¶è¿™ç§æ–¹æ³•ç¡®å®æœ‰æ•ˆï¼Œå¹¶ä¸”æ˜¯æ‰“ç ´è®¿é—®è€…è®¾è®¡æ¨¡å¼å¾ªç¯ä¾èµ–çš„ä¸€éƒ¨åˆ†ï¼Œä½†ä½¿ç”¨ <strong>dynamic_cast</strong> æ€»ä¼šè®©äººæ„Ÿåˆ°ä¸å®‰ã€‚</p>
<p><strong>dynamic_cast</strong> åº”è¯¥æ€»æ˜¯è®©äººæœ‰ç‚¹æ€€ç–‘ï¼Œå› ä¸ºå¦‚æœä½¿ç”¨ä¸å½“ï¼Œå®ƒå¯èƒ½ä¼šç ´åæ¶æ„ã€‚<br/>è¿™ç§æƒ…å†µå‘ç”Ÿåœ¨æˆ‘ä»¬ä»æ¶æ„çš„é«˜å±‚å¯¹ä½äºæ¶æ„ä½å±‚çš„ä¸œè¥¿è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢æ—¶ã€‚<br/>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®é™…ä¸Šæ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯åœ¨æ¶æ„çš„ä½å±‚ä½¿ç”¨å®ƒã€‚å› æ­¤ï¼Œé€šè¿‡å°†ä½å±‚çš„çŸ¥è¯†æ’å…¥åˆ°é«˜å±‚å¹¶ä¸ä¼šç ´åæ¶æ„ã€‚</p>
<p>çœŸæ­£çš„ç¼ºé™·åœ¨äºè¿è¡Œæ—¶çš„å¼€é”€ã€‚å½“æˆ‘ä»¬è¿è¡Œä¸â€œå‡†åˆ™17ï¼šè€ƒè™‘ä½¿ç”¨ std::variant å®ç°è®¿é—®è€…â€ç›¸åŒçš„åŸºå‡†æµ‹è¯•æ—¶ï¼Œä½ ä¼šå‘ç°æ— ç¯è®¿é—®è€…çš„è¿è¡Œæ—¶é—´å‡ ä¹æ¯”å¾ªç¯è®¿é—®è€…é«˜å‡ºä¸€ä¸ªæ•°é‡çº§ï¼ˆè§è¡¨4-3ï¼‰ã€‚</p>
<p>åŸå› æ˜¯ <strong>dynamic_cast</strong> å¾ˆæ…¢ï¼Œéå¸¸æ…¢ã€‚å¯¹äºè¿™ä¸ªåº”ç”¨å°¤å…¶å¦‚æ­¤ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œè¿›è¡Œçš„æ˜¯äº¤å‰è½¬æ¢ï¼ˆcross-castï¼‰ã€‚<br/>æˆ‘ä»¬ä¸ä»…ä»…æ˜¯åœ¨å‘ä¸‹è½¬æ¢åˆ°ç‰¹å®šçš„æ´¾ç”Ÿç±»ï¼Œè€Œæ˜¯åœ¨ç»§æ‰¿å±‚æ¬¡ç»“æ„çš„å¦ä¸€ä¸ªåˆ†æ”¯ä¸Šè¿›è¡Œè½¬æ¢ã€‚è¿™ç§äº¤å‰è½¬æ¢ï¼Œå†åŠ ä¸Šè™šæ‹Ÿå‡½æ•°è°ƒç”¨ï¼Œæ¯”ç®€å•çš„å‘ä¸‹è½¬æ¢è¦æ˜‚è´µå¾—å¤šã€‚</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>è®¿é—®è€…å®ç°</th>
<th>GCC 11.1</th>
<th>Clang 11.1</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ— ç¯è®¿é—®è€…</td>
<td>14.3423 s</td>
<td>7.3445 s</td>
</tr>
<tr>
<td>å¾ªç¯è®¿é—®è€…</td>
<td>1.6161 s</td>
<td>1.8015 s</td>
</tr>
<tr>
<td>é¢å‘å¯¹è±¡è§£å†³æ–¹æ¡ˆ</td>
<td>1.5205 s</td>
<td>1.1480 s</td>
</tr>
<tr>
<td>æšä¸¾è§£å†³æ–¹æ¡ˆ</td>
<td>1.2179 s</td>
<td>1.1200 s</td>
</tr>
<tr>
<td><code>std::variant</code>ï¼ˆä½¿ç”¨ <code>std::visit()</code>ï¼‰</td>
<td>1.1992 s</td>
<td>1.2279 s</td>
</tr>
<tr>
<td><code>std::variant</code>ï¼ˆä½¿ç”¨ <code>std::get_if()</code>ï¼‰</td>
<td>1.0252 s</td>
<td>0.6998 s</td>
</tr>
</tbody>
</table></div>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>äº†è§£æ— å¾ªç¯è®¿é—®å™¨çš„æ¶æ„ä¼˜åŠ¿ã€‚</li>
<li>è¯·æ³¨æ„è¯¥è§£å†³æ–¹æ¡ˆçš„æ˜¾è‘—æ€§èƒ½ç¼ºç‚¹ã€‚</li>
</ul>
<h2 id="ç¬¬äº”ç« -ç­–ç•¥å’Œå‘½ä»¤è®¾è®¡æ¨¡å¼">ç¬¬äº”ç«  ç­–ç•¥å’Œå‘½ä»¤è®¾è®¡æ¨¡å¼
</h2><p>æœ¬ç« ä¸“é—¨è®¨è®ºä¸¤ç§æœ€å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼š<strong>ç­–ç•¥è®¾è®¡æ¨¡å¼</strong> å’Œ <strong>å‘½ä»¤è®¾è®¡æ¨¡å¼</strong>ã€‚äº‹å®ä¸Šï¼Œå®ƒä»¬æ˜¯éå¸¸å¸¸ç”¨çš„ï¼šC++ æ ‡å‡†åº“æœ¬èº«å°±ä½¿ç”¨äº†è¿™ä¸¤ç§æ¨¡å¼æ•°åæ¬¡ï¼Œè€Œä¸”å¾ˆæœ‰å¯èƒ½ä½ è‡ªå·±ä¹Ÿå¤šæ¬¡ä½¿ç”¨è¿‡å®ƒä»¬ã€‚è¿™ä¸¤ç§æ¨¡å¼å¯ä»¥è¢«è§†ä¸ºæ¯ä¸ªå¼€å‘è€…çš„åŸºçŸ³å·¥å…·ã€‚</p>
<p>åœ¨â€œ<strong>å‡†åˆ™19ï¼šä½¿ç”¨ç­–ç•¥éš”ç¦»äº‹ç‰©çš„å®ç°æ–¹å¼</strong>â€ä¸­ï¼Œæˆ‘å°†å‘ä½ ä»‹ç»ç­–ç•¥è®¾è®¡æ¨¡å¼ã€‚æˆ‘å°†å±•ç¤ºä¸ºä»€ä¹ˆå®ƒæ˜¯æœ€æœ‰ç”¨å’Œæœ€é‡è¦çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ï¼Œå¹¶è§£é‡Šä¸ºä»€ä¹ˆä½ ä¼šåœ¨è®¸å¤šåœºæ™¯ä¸­å‘ç°å®ƒéå¸¸æœ‰ç”¨ã€‚</p>
<p>åœ¨â€œ<strong>å‡†åˆ™20ï¼šä¼˜å…ˆä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿</strong>â€ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ç»§æ‰¿ä»¥åŠä¸ºä»€ä¹ˆè®¸å¤šäººå¯¹å®ƒæœ‰æŠ±æ€¨ã€‚ä½ ä¼šå‘ç°ç»§æ‰¿æœ¬èº«å¹¶ä¸æ˜¯åçš„ï¼Œä½†å’Œå…¶ä»–ä»»ä½•ä¸œè¥¿ä¸€æ ·ï¼Œå®ƒæœ‰å…¶ä¼˜ç‚¹å’Œå±€é™æ€§ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œæˆ‘å°†è§£é‡Šè®¸å¤šç»å…¸è®¾è®¡æ¨¡å¼çš„åŠ›é‡å¹¶éæ¥æºäºç»§æ‰¿ï¼Œè€Œæ˜¯æ¥æºäºç»„åˆã€‚</p>
<p>åœ¨â€œ<strong>å‡†åˆ™21ï¼šä½¿ç”¨å‘½ä»¤éš”ç¦»äº‹ç‰©çš„æ“ä½œå†…å®¹</strong>â€ä¸­ï¼Œæˆ‘å°†å‘ä½ ä»‹ç»å‘½ä»¤è®¾è®¡æ¨¡å¼ã€‚æˆ‘å°†å±•ç¤ºå¦‚ä½•é«˜æ•ˆåœ°ä½¿ç”¨è¯¥è®¾è®¡æ¨¡å¼ï¼Œå¹¶ç»™ä½ ä¸€ä¸ªå…³äºå‘½ä»¤ä¸ç­–ç•¥ä¹‹é—´æ¯”è¾ƒçš„æ¦‚å¿µã€‚</p>
<p>åœ¨â€œ<strong>å‡†åˆ™22ï¼šä¼˜å…ˆä½¿ç”¨å€¼è¯­ä¹‰è€Œéå¼•ç”¨è¯­ä¹‰</strong>â€ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨å¼•ç”¨è¯­ä¹‰çš„é¢†åŸŸã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿™ä¸ªé¢†åŸŸå¹¶ä¸ç‰¹åˆ«å‹å¥½å’Œå¥½å®¢ï¼Œå¹¶ä¸”ä¼šè®©æˆ‘ä»¬æ‹…å¿ƒä»£ç çš„è´¨é‡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†è¿ç§»åˆ°å€¼è¯­ä¹‰çš„é¢†åŸŸï¼Œè¿™å°†ä¸ºæˆ‘ä»¬æä¾›è®¸å¤šå¯¹ä»£ç åº“æœ‰ç›Šçš„åŠŸèƒ½ã€‚</p>
<p>åœ¨â€œ<strong>å‡†åˆ™23ï¼šä¼˜å…ˆä½¿ç”¨åŸºäºå€¼çš„ç­–ç•¥å’Œå‘½ä»¤å®ç°</strong>â€ä¸­ï¼Œæˆ‘ä»¬å°†å†æ¬¡å›é¡¾ç­–ç•¥å’Œå‘½ä»¤æ¨¡å¼ã€‚æˆ‘å°†å±•ç¤ºå¦‚ä½•åº”ç”¨æˆ‘ä»¬åœ¨å€¼è¯­ä¹‰é¢†åŸŸè·å¾—çš„è§è§£ï¼Œå¹¶åŸºäº <strong>std::function</strong> å®ç°è¿™ä¸¤ç§è®¾è®¡æ¨¡å¼ã€‚</p>
<p>é€šè¿‡è¿™äº›æŒ‡å—ï¼Œä½ å°†æ›´å¥½åœ°ç†è§£å¦‚ä½•åœ¨å®é™…é¡¹ç›®ä¸­æœ‰æ•ˆä½¿ç”¨ç­–ç•¥å’Œå‘½ä»¤è®¾è®¡æ¨¡å¼ï¼Œå¹¶å­¦ä¼šå¦‚ä½•é€‰æ‹©é€‚å½“çš„å®ç°æ–¹å¼ä»¥ä¼˜åŒ–ä»£ç è´¨é‡å’Œæ€§èƒ½ã€‚å¸Œæœ›è¿™äº›å†…å®¹å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼</p>
<h3 id="å‡†åˆ™19ä½¿ç”¨ç­–ç•¥éš”ç¦»äº‹ç‰©çš„å®ç°æ–¹å¼">å‡†åˆ™19ï¼šä½¿ç”¨ç­–ç•¥éš”ç¦»äº‹ç‰©çš„å®ç°æ–¹å¼
</h3><p>è®©æˆ‘ä»¬å‡è®¾ä½ å’Œä½ çš„å›¢é˜Ÿå³å°†å®ç°ä¸€ä¸ªæ–°çš„2Då›¾å½¢å·¥å…·ã€‚é™¤äº†å…¶ä»–éœ€æ±‚å¤–ï¼Œå®ƒéœ€è¦å¤„ç†ç®€å•çš„å‡ ä½•å›¾å…ƒï¼Œå¦‚åœ†å½¢ã€æ­£æ–¹å½¢ç­‰ï¼Œå¹¶ä¸”è¿™äº›å›¾å…ƒéœ€è¦è¢«ç»˜åˆ¶ï¼ˆè§å›¾5-1ï¼‰ã€‚</p>
<p>å›¾5-1. åˆå§‹çš„Shapeç»§æ‰¿å±‚æ¬¡ç»“æ„</p>
<p>ä¸€äº›ç±»å·²ç»å®ç°äº†ï¼Œä¾‹å¦‚ä¸€ä¸ª Shape åŸºç±»ã€ä¸€ä¸ª Circle ç±»å’Œä¸€ä¸ª Square ç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Shape.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">Shape</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Circle.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Point.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Circle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Circle</span><span class="p">(</span><span class="kt">double</span> <span class="n">radius</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">radius_</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* æ£€æŸ¥ç»™å®šçš„åŠå¾„æ˜¯å¦æœ‰æ•ˆ */</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">radius</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">radius_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="n">Point</span> <span class="nf">center</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">center_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">radius_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">Point</span> <span class="n">center_</span><span class="p">{};</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Circle.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Circle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include </span><span class="cm">/* ä¸€äº›å›¾å½¢åº“ */</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Circle</span><span class="o">::</span><span class="n">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... å®ç°ç»˜åˆ¶åœ†çš„é€»è¾‘ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Square.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Point.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Square</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Square</span><span class="p">(</span><span class="kt">double</span> <span class="n">side</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">side_</span><span class="p">(</span><span class="n">side</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* æ£€æŸ¥ç»™å®šçš„è¾¹é•¿æ˜¯å¦æœ‰æ•ˆ */</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">side</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">side_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="n">Point</span> <span class="nf">center</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">center_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">side_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">Point</span> <span class="n">center_</span><span class="p">{};</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Square.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Square.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include </span><span class="cm">/* ä¸€äº›å›¾å½¢åº“ */</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Square</span><span class="o">::</span><span class="n">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... å®ç°ç»˜åˆ¶æ­£æ–¹å½¢çš„é€»è¾‘ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€é‡è¦çš„æ–¹é¢æ˜¯ <code>Shape</code> åŸºç±»ä¸­çš„çº¯è™šå‡½æ•° <code>draw()</code>ï¼ˆï¼‰ã€‚</p>
<p>åœ¨ä½ ä¼‘å‡æœŸé—´ï¼Œä½ çš„å›¢é˜Ÿæˆå‘˜å·²ç»ä¸º <code>Circle</code> å’Œ <code>Square</code> ç±»å®ç°äº†è¿™ä¸ª <code>draw()</code> æˆå‘˜å‡½æ•°ï¼Œä½¿ç”¨çš„æ˜¯OpenGLï¼ˆå’Œï¼‰ã€‚</p>
<p>è¯¥å·¥å…·å·²ç»èƒ½å¤Ÿç»˜åˆ¶åœ†å½¢å’Œæ­£æ–¹å½¢ï¼Œå¹¶ä¸”æ•´ä¸ªå›¢é˜Ÿä¸€è‡´è®¤ä¸ºç”Ÿæˆçš„å›¾å½¢çœ‹èµ·æ¥éå¸¸æ•´æ´ã€‚æ¯ä¸ªäººéƒ½æ„Ÿåˆ°æ»¡æ„ï¼</p>
<p><strong>åˆ†æè®¾è®¡é—®é¢˜</strong>
é™¤äº†ä½ ä¹‹å¤–çš„æ¯ä¸ªäººï¼Œä»å‡æœŸå›æ¥åï¼Œä½ å½“ç„¶ç«‹å³æ„è¯†åˆ°å·²å®ç°çš„è§£å†³æ–¹æ¡ˆè¿åäº†å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰ã€‚</p>
<p>ç›®å‰æ¥çœ‹ï¼Œ<strong>Shape</strong> å±‚æ¬¡ç»“æ„å¹¶æ²¡æœ‰<strong>ä¸ºå˜åŒ–è€Œè®¾è®¡</strong>ã€‚</p>
<p>é¦–å…ˆï¼Œæ”¹å˜å½¢çŠ¶çš„ç»˜åˆ¶æ–¹å¼å¹¶ä¸å®¹æ˜“ï¼Œåœ¨å½“å‰å®ç°ä¸­ï¼Œåªæœ‰ä¸€ç§å›ºå®šçš„ç»˜åˆ¶å½¢çŠ¶çš„æ–¹å¼ï¼Œå¹¶ä¸”æ— æ³•éä¾µå…¥æ€§åœ°æ›´æ”¹è¿™äº›ç»†èŠ‚ã€‚å› ä¸ºä½ å·²ç»é¢„æµ‹åˆ°è¯¥å·¥å…·å°†éœ€è¦æ”¯æŒå¤šä¸ªå›¾å½¢åº“ï¼Œè¿™ç»å¯¹æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚å…¶æ¬¡ï¼Œå¦‚æœä½ æœ€ç»ˆè¿›è¡Œæ›´æ”¹ï¼Œåˆ™éœ€è¦åœ¨å¤šä¸ªä¸ç›¸å…³çš„åœ°ç‚¹ä¿®æ”¹è¡Œä¸ºã€‚</p>
<p>ä½†è¿˜æœ‰æ›´å¤šé—®é¢˜ã€‚ç”±äºç»˜åˆ¶åŠŸèƒ½æ˜¯åœ¨ <strong>Circle</strong> å’Œ <strong>Square</strong> ç±»ä¸­å®ç°çš„ï¼Œå› æ­¤ <strong>Circle</strong> å’Œ <strong>Square</strong> ç±»ä¾èµ–äº <strong>draw()</strong> çš„å®ç°ç»†èŠ‚ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¾èµ–äº OpenGLã€‚</p>
<p>å°½ç®¡åœ†å’Œæ­£æ–¹å½¢åº”è¯¥ä¸»è¦æ˜¯ç®€å•çš„å‡ ä½•å›¾å…ƒï¼Œä½†ç°åœ¨è¿™ä¸¤ä¸ªç±»åœ¨æ‰€æœ‰ä½¿ç”¨çš„åœ°æ–¹éƒ½å¿…é¡»æ‰¿æ‹…ä½¿ç”¨ <strong>OpenGL</strong> çš„è´Ÿæ‹…ã€‚</p>
<p>å½“ä½ å‘åŒäº‹ä»¬æŒ‡å‡ºè¿™äº›é—®é¢˜æ—¶ï¼Œä»–ä»¬ä¸€å¼€å§‹æœ‰äº›ä¸çŸ¥æ‰€æªã€‚åŒæ—¶ä¹Ÿæœ‰ç‚¹æ¼ç«ï¼Œå› ä¸ºä»–ä»¬æ²¡æœ‰é¢„æ–™åˆ°ä½ ä¼šæŒ‡å‡ºä»–ä»¬ç¾ä¸½è§£å†³æ–¹æ¡ˆä¸­çš„ä»»ä½•ç¼ºé™·ã€‚ç„¶è€Œï¼Œä½ æœ‰ä¸€ä¸ªéå¸¸å¥½çš„è§£é‡Šé—®é¢˜çš„æ–¹æ³•ï¼Œæœ€ç»ˆä»–ä»¬åŒæ„äº†ä½ çš„è§‚ç‚¹å¹¶å¼€å§‹æ€è€ƒæ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æ²¡è¿‡å¤šä¹…ï¼Œä»–ä»¬å°±æƒ³å‡ºäº†ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•ã€‚å‡ å¤©åçš„ä¸‹ä¸€æ¬¡å›¢é˜Ÿä¼šè®®ä¸Šï¼Œä»–ä»¬å±•ç¤ºäº†ä»–ä»¬çš„æ–°æƒ³æ³•ï¼šåœ¨ç»§æ‰¿å±‚æ¬¡ç»“æ„ä¸­å¢åŠ ä¸€å±‚ï¼ˆè§å›¾5-2ï¼‰ã€‚</p>
<p>ä¸ºäº†æ¼”ç¤ºè¿™ä¸ªæƒ³æ³•ï¼Œä»–ä»¬å·²ç»å®ç°äº† <strong>OpenGLCircle</strong> å’Œ <strong>OpenGLSquare</strong> ç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Circle.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">Circle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... ä¸å†å®ç° draw() æˆå‘˜å‡½æ•° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;OpenGLCircle.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Circle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">OpenGLCircle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Circle</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">OpenGLCircle</span><span class="p">(</span><span class="kt">double</span> <span class="n">radius</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">Circle</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{}</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;OpenGLCircle.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;OpenGLCircle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include </span><span class="cm">/* OpenGL å›¾å½¢åº“å¤´æ–‡ä»¶ */</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="n">OpenGLCircle</span><span class="o">::</span><span class="n">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... ä½¿ç”¨ OpenGL å®ç°ç»˜åˆ¶åœ†çš„é€»è¾‘ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Square.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">Square</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... ä¸å†å®ç° draw() æˆå‘˜å‡½æ•° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;OpenGLSquare.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Square.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">OpenGLSquare</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Square</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">OpenGLSquare</span><span class="p">(</span><span class="kt">double</span> <span class="n">side</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">Square</span><span class="p">(</span><span class="n">side</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{}</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;OpenGLSquare.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;OpenGLSquare.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include </span><span class="cm">/* OpenGL å›¾å½¢åº“å¤´æ–‡ä»¶ */</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="n">OpenGLSquare</span><span class="o">::</span><span class="n">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... ä½¿ç”¨ OpenGL å®ç°ç»˜åˆ¶æ­£æ–¹å½¢çš„é€»è¾‘ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»§æ‰¿ï¼å½“ç„¶ï¼é€šè¿‡ç®€å•åœ°ä» <strong>Circle</strong> å’Œ <strong>Square</strong> æ´¾ç”Ÿï¼Œå¹¶å°† <strong>draw()</strong> å‡½æ•°çš„å®ç°è¿›ä¸€æ­¥ä¸‹ç§»åˆ°å±‚æ¬¡ç»“æ„ä¸­ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°ä»¥ä¸åŒçš„æ–¹å¼å®ç°ç»˜åˆ¶ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¯èƒ½ä¼šæœ‰ <strong>MetalCircle</strong> å’Œ <strong>VulkanCircle</strong>ï¼Œå‡è®¾éœ€è¦æ”¯æŒ <strong>Metal</strong> å’Œ <strong>Vulkan</strong> åº“ã€‚çªç„¶ä¹‹é—´ï¼Œæ”¹å˜å˜å¾—å®¹æ˜“äº†ï¼Œå¯¹å§ï¼Ÿ</p>
<p>è™½ç„¶ä½ çš„åŒäº‹ä»¬ä»ç„¶ä¸ºä»–ä»¬çš„æ–°è§£å†³æ–¹æ¡ˆæ„Ÿåˆ°éå¸¸è‡ªè±ªï¼Œä½†ä½ å·²ç»æ„è¯†åˆ°è¿™ç§æ–¹æ³•ä¸ä¼šé•¿æœŸæœ‰æ•ˆã€‚å¹¶ä¸”å¾ˆå®¹æ˜“å±•ç¤ºå…¶ç¼ºç‚¹ï¼šä½ åªéœ€è¦è€ƒè™‘å¦ä¸€ä¸ªéœ€æ±‚ï¼Œä¾‹å¦‚ä¸€ä¸ª <strong>serialize()</strong> æˆå‘˜å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">Shape</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">serialize</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>serialize()</strong> æˆå‘˜å‡½æ•°æ—¨åœ¨å°†å½¢çŠ¶è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—ï¼Œå¯ä»¥å­˜å‚¨åœ¨æ–‡ä»¶æˆ–æ•°æ®åº“ä¸­ï¼Œç„¶åå¯ä»¥ä»å­—èŠ‚åºåˆ—ååºåˆ—åŒ–ä»¥é‡æ–°åˆ›å»ºå®Œå…¨ç›¸åŒçš„å½¢çŠ¶ã€‚å°±åƒ <strong>draw()</strong> æˆå‘˜å‡½æ•°ä¸€æ ·ï¼Œ<strong>serialize()</strong> æˆå‘˜å‡½æ•°ä¹Ÿå¯ä»¥ä»¥å¤šç§æ–¹å¼å®ç°ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ <strong>protobuf</strong> æˆ– <strong>Boost.serialization</strong> åº“ã€‚</p>
<p>ä½¿ç”¨å°†å®ç°ç»†èŠ‚å‘ä¸‹ç§»åŠ¨åˆ°ç»§æ‰¿å±‚æ¬¡ç»“æ„çš„ç›¸åŒç­–ç•¥ï¼Œè¿™å°†å¾ˆå¿«å¯¼è‡´ä¸€ä¸ªç›¸å½“å¤æ‚ä¸”ç›¸å½“äººä¸ºçš„å±‚æ¬¡ç»“æ„ï¼ˆè§å›¾5-3ï¼‰ã€‚è€ƒè™‘ä»¥ä¸‹ç±»åï¼š<strong>OpenGLProtobufCircle</strong>ã€<strong>MetalBoostSerialSquare</strong> ç­‰ç­‰ã€‚</p>
<p>å¯ç¬‘å§ï¼Ÿæˆ‘ä»¬è¯¥å¦‚ä½•ç»„ç»‡è¿™ç§ç»“æ„å‘¢ï¼Ÿæˆ‘ä»¬åº”è¯¥åœ¨å±‚æ¬¡ç»“æ„ä¸­æ·»åŠ å¦ä¸€å±‚ï¼ˆå¦‚ <strong>Square</strong> åˆ†æ”¯æ‰€ç¤ºï¼‰å—ï¼Ÿ</p>
<p>è¿™ç§æ–¹æ³•ä¼šè¿…é€Ÿå¯¼è‡´ä¸€ä¸ªæ·±å±‚æ¬¡ä¸”å¤æ‚çš„å±‚æ¬¡ç»“æ„ï¼Œæˆ–è€…æˆ‘ä»¬æ˜¯å¦åº”è¯¥æ›´å¹³å¦åœ°å±•å¼€å±‚æ¬¡ç»“æ„ï¼ˆå¦‚ Circle åˆ†æ”¯æ‰€ç¤ºï¼‰ï¼Ÿå…³äºé‡ç”¨å®ç°ç»†èŠ‚åˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿä¾‹å¦‚ï¼Œå¦‚ä½•åœ¨ <strong>OpenGLProtobufCircle</strong> å’Œ <strong>OpenGLBoostSerialCircle</strong> ç±»ä¹‹é—´é‡ç”¨ <strong>OpenGL</strong> ä»£ç ï¼Ÿ</p>
<p><strong>ç­–ç•¥è®¾è®¡æ¨¡å¼è§£é‡Š</strong></p>
<p>ä½ æ„è¯†åˆ°ä½ çš„åŒäº‹ä»¬è¿‡äºè¿·æ‹ç»§æ‰¿ï¼Œè€Œä½ éœ€è¦æ‹¯æ•‘è¿™ä¸€å¤©ã€‚</p>
<p>ä»–ä»¬ä¼¼ä¹éœ€è¦æœ‰äººå‘ä»–ä»¬å±•ç¤ºå¦‚ä½•ä¸ºè¿™ç§å˜åŒ–è¿›è¡Œæ­£ç¡®çš„è®¾è®¡ï¼Œå¹¶ä¸ºä»–ä»¬æä¾›ä¸€ä¸ªé€‚å½“çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æ­£å¦‚ä¸¤ä½åŠ¡å®çš„ç¨‹åºå‘˜æ‰€è¨€ï¼š<strong>â€œç»§æ‰¿å¾ˆå°‘æ˜¯ç­”æ¡ˆã€‚â€</strong> é—®é¢˜ä»ç„¶æ˜¯è¿åäº†å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰ï¼Œå› ä¸ºä½ éœ€è¦è®¡åˆ’å¦‚ä½•æ”¹å˜ä¸åŒå½¢çŠ¶çš„ç»˜åˆ¶æ–¹å¼ï¼Œä½ åº”è¯¥å°†ç»˜åˆ¶æ–¹é¢è¯†åˆ«ä¸ºä¸€ä¸ªå˜åŒ–ç‚¹ã€‚</p>
<p>æœ‰äº†è¿™ä¸ªè®¤è¯†ï¼Œæ­£ç¡®çš„åšæ³•æ˜¯ä¸ºå˜åŒ–è®¾è®¡ï¼Œéµå¾ªSRPï¼Œå¹¶æå–å˜åŒ–ç‚¹ã€‚è¿™å°±æ˜¯ç­–ç•¥è®¾è®¡æ¨¡å¼çš„æ„å›¾ï¼Œå®ƒæ˜¯ç»å…¸GoFè®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚</p>
<p>æ„å›¾ï¼šâ€œ<strong>å®šä¹‰ä¸€ç»„ç®—æ³•ï¼Œå°è£…æ¯ä¸ªç®—æ³•ï¼Œå¹¶ä½¿å®ƒä»¬å¯ä»¥äº’æ¢ã€‚ç­–ç•¥æ¨¡å¼å…è®¸ç®—æ³•ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·ç«¯è¿›è¡Œå˜åŒ–ã€‚</strong>â€ è€Œä¸æ˜¯åœ¨æ´¾ç”Ÿç±»ä¸­å®ç°è™šå‡½æ•° <strong>draw()</strong>ï¼Œä½ å¯ä»¥å¼•å…¥å¦ä¸€ä¸ªç±»æ¥ä¸“é—¨ç”¨äºç»˜åˆ¶å½¢çŠ¶ã€‚</p>
<p>åœ¨ç»å…¸çš„<strong>é¢å‘å¯¹è±¡</strong>ï¼ˆOOï¼‰å½¢å¼çš„<strong>ç­–ç•¥è®¾è®¡æ¨¡å¼</strong>ä¸­ï¼Œè¿™æ˜¯é€šè¿‡å¼•å…¥ <strong>DrawStrategy åŸºç±»</strong>æ¥å®ç°çš„ï¼ˆè§å›¾5-4ï¼‰ã€‚</p>
<p>ç°åœ¨å°†ç»˜åˆ¶æ–¹é¢éš”ç¦»å‡ºæ¥ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ä¸ä¿®æ”¹å½¢çŠ¶ç±»çš„æƒ…å†µä¸‹æ›´æ”¹ç»˜åˆ¶çš„å®ç°ã€‚è¿™å®ç°äº†<strong>SRP</strong>çš„æ€æƒ³ã€‚ä½ ç°åœ¨ä¹Ÿå¯ä»¥åœ¨ä¸ä¿®æ”¹ä»»ä½•å…¶ä»–ä»£ç çš„æƒ…å†µä¸‹å¼•å…¥æ–°çš„ <strong>draw()</strong> å®ç°ã€‚è¿™æ»¡è¶³äº†<strong>å¼€æ”¾å°é—­åŸåˆ™</strong>ï¼ˆOCPï¼‰ã€‚å†ä¸€æ¬¡ï¼Œåœ¨è¿™ç§é¢å‘å¯¹è±¡è®¾ç½®ä¸­ï¼Œ<strong>SRP</strong>æ˜¯<strong>OCP</strong>çš„æ¨åŠ¨è€…ã€‚</p>
<p>ä»¥ä¸‹ä»£ç ç‰‡æ®µå±•ç¤ºäº† <strong>DrawStrategy</strong> åŸºç±»çš„ä¸€ä¸ªç®€å•å®ç°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;DrawStrategy.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Circle</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Square</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DrawStrategy</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">DrawStrategy</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="n">Circle</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">circle</span><span class="p">,</span> <span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="n">Square</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">square</span><span class="p">,</span> <span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>DrawStrategy</strong> ç±»å¸¦æœ‰è™šæ‹Ÿææ„å‡½æ•°å’Œä¸¤ä¸ªçº¯è™šå‡½æ•° <strong>draw()</strong>ï¼Œä¸€ä¸ªç”¨äºåœ†å½¢ï¼Œä¸€ä¸ªç”¨äºæ­£æ–¹å½¢ã€‚</p>
<p>ä¸ºäº†ç¼–è¯‘è¿™ä¸ªåŸºç±»ï¼Œä½ éœ€è¦å‰å‘å£°æ˜ <strong>Circle</strong> å’Œ <strong>Square</strong> ç±»ã€‚</p>
<p>ç”±äºç­–ç•¥è®¾è®¡æ¨¡å¼ï¼Œ<strong>Shape</strong> åŸºç±»æ²¡æœ‰å˜åŒ–ã€‚å®ƒä»ç„¶ä»£è¡¨æ‰€æœ‰å½¢çŠ¶çš„æŠ½è±¡ï¼Œå¹¶å› æ­¤æä¾›äº†ä¸€ä¸ªçº¯è™šå‡½æ•° <strong>draw()</strong>ã€‚ç­–ç•¥æ¨¡å¼æ—¨åœ¨æå–å®ç°ç»†èŠ‚ï¼Œå› æ­¤åªå½±å“æ´¾ç”Ÿç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Shape.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">Shape</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... å¯èƒ½è¿˜æœ‰å…¶ä»–å‡½æ•°ï¼Œä¾‹å¦‚ &#39;serialize()&#39; æˆå‘˜å‡½æ•° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è™½ç„¶ç”±äºç­–ç•¥æ¨¡å¼ <code>Shape</code> åŸºç±»æ²¡æœ‰å˜åŒ–ï¼Œä½† <code>Circle</code> å’Œ <code>Square</code> ç±»å—åˆ°äº†å½±å“ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Circle.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;DrawStrategy.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Circle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Circle</span><span class="p">(</span><span class="kt">double</span> <span class="n">radius</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">DrawStrategy</span><span class="o">&gt;</span> <span class="n">drawer</span><span class="p">)</span>   
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">radius_</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="p">,</span> <span class="n">drawer_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">drawer</span><span class="p">))</span>   
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* æ£€æŸ¥ç»™å®šçš„åŠå¾„æ˜¯å¦æœ‰æ•ˆä¸”ç»™å®šçš„ std::unique_ptr å®ä¾‹ä¸æ˜¯ nullptr */</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">drawer_</span><span class="o">-&gt;</span><span class="n">draw</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="cm">/* some arguments */</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">radius</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">radius_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">radius_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">DrawStrategy</span><span class="o">&gt;</span> <span class="n">drawer_</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Square.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;DrawStrategy.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Square</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Square</span><span class="p">(</span><span class="kt">double</span> <span class="n">side</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">DrawStrategy</span><span class="o">&gt;</span> <span class="n">drawer</span><span class="p">)</span>   
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">side_</span><span class="p">(</span><span class="n">side</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="p">,</span> <span class="n">drawer_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">drawer</span><span class="p">))</span>   
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* æ£€æŸ¥ç»™å®šçš„è¾¹é•¿æ˜¯å¦æœ‰æ•ˆä¸”ç»™å®šçš„ std::unique_ptr å®ä¾‹ä¸æ˜¯ nullptr */</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">drawer_</span><span class="o">-&gt;</span><span class="n">draw</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="cm">/* some arguments */</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">side</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">side_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">side_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">DrawStrategy</span><span class="o">&gt;</span> <span class="n">drawer_</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ï¼Œ<code>Circle</code> å’Œ <code>Square</code> éƒ½æœŸæœ›åœ¨å…¶æ„é€ å‡½æ•°ä¸­æ¥æ”¶ä¸€ä¸ªæŒ‡å‘ <code>DrawStrategy</code> çš„ <code>unique_ptr</code>ã€‚</p>
<p>è¿™å…è®¸æˆ‘ä»¬ä»å¤–éƒ¨é…ç½®ç»˜åˆ¶è¡Œä¸ºï¼Œé€šå¸¸ç§°ä¸ºä¾èµ–æ³¨å…¥ã€‚<code>unique_ptr</code> è¢«ç§»åŠ¨åˆ°ç›¸åŒç±»å‹çš„æ–°çš„æ•°æ®æˆå‘˜ä¸­ã€‚</p>
<p>è¿˜å¯ä»¥æä¾›ç›¸åº”çš„ setter å‡½æ•°ï¼Œè¿™å°†å…è®¸ä½ åœ¨ç¨åçš„æ—¶é—´ç‚¹æ›´æ”¹ç»˜åˆ¶è¡Œä¸ºã€‚<code>draw()</code> æˆå‘˜å‡½æ•°ç°åœ¨ä¸éœ€è¦è‡ªå·±å®ç°ç»˜åˆ¶é€»è¾‘ï¼Œåªéœ€è°ƒç”¨ç»™å®š <code>DrawStrategy</code> çš„ <code>draw()</code> å‡½æ•°ã€‚</p>
<p><strong>åˆ†ææœ´ç´ è§£å†³æ–¹æ¡ˆçš„ä¸è¶³</strong></p>
<p>å¤ªæ£’äº†ï¼æœ‰äº†è¿™ä¸ªå®ç°ï¼Œä½ ç°åœ¨å¯ä»¥åœ¨æœ¬åœ°ã€éš”ç¦»åœ°æ”¹å˜å½¢çŠ¶ç»˜åˆ¶çš„è¡Œä¸ºï¼Œå¹¶è®©æ¯ä¸ªäººéƒ½èƒ½å®ç°æ–°çš„ç»˜åˆ¶è¡Œä¸ºã€‚ç„¶è€Œï¼Œç›®å‰æˆ‘ä»¬çš„ç­–ç•¥å®ç°æœ‰ä¸€ä¸ªä¸¥é‡çš„è®¾è®¡ç¼ºé™·ã€‚</p>
<p>ä¸ºäº†åˆ†æè¿™ä¸ªç¼ºé™·ï¼Œå‡è®¾ä½ éœ€è¦æ·»åŠ ä¸€ç§æ–°çš„å½¢çŠ¶ï¼Œæ¯”å¦‚ä¸‰è§’å½¢ã€‚è¿™åº”è¯¥å¾ˆå®¹æ˜“ï¼Œå› ä¸ºæ­£å¦‚æˆ‘ä»¬åœ¨â€œ<strong>å‡†åˆ™15ï¼šè®¾è®¡ä»¥å¢åŠ ç±»å‹æˆ–æ“ä½œ</strong>â€ä¸­è®¨è®ºçš„é‚£æ ·ï¼Œ<strong>é¢å‘å¯¹è±¡ç¼–ç¨‹</strong>ï¼ˆOOPï¼‰çš„ä¼˜åŠ¿åœ¨äºèƒ½å¤Ÿè½»æ¾æ·»åŠ æ–°ç±»å‹ã€‚</p>
<p>å½“ä½ å¼€å§‹å¼•å…¥ä¸‰è§’å½¢æ—¶ï¼Œä½ ä¼šå‘ç°æ·»åŠ æ–°ç±»å‹çš„å½¢çŠ¶å¹¶ä¸åƒé¢„æœŸçš„é‚£ä¹ˆç®€å•ã€‚</p>
<p>é¦–å…ˆï¼Œä½ éœ€è¦ç¼–å†™æ–°ç±»ã€‚è¿™æ˜¯å¯ä»¥é¢„æ–™çš„ï¼Œä¹Ÿä¸æ˜¯é—®é¢˜ã€‚ä½†éšåä½ å¿…é¡»æ›´æ–° <strong>DrawStrategy</strong> åŸºç±»ï¼Œä»¥ä¾¿ä¹Ÿèƒ½ç»˜åˆ¶ä¸‰è§’å½¢ã€‚åè¿‡æ¥ï¼Œè¿™ä¼šå¯¹åœ†å½¢å’Œæ­£æ–¹å½¢äº§ç”Ÿä¸å¹¸çš„å½±å“ï¼š<strong>Circle</strong> å’Œ <strong>Square</strong> ç±»éƒ½éœ€è¦é‡æ–°ç¼–è¯‘ã€é‡æ–°æµ‹è¯•å¹¶å¯èƒ½é‡æ–°éƒ¨ç½²ã€‚æ›´å¹¿æ³›åœ°è¯´ï¼Œæ‰€æœ‰å½¢çŠ¶éƒ½ä¼šå—åˆ°å½±å“ã€‚è€Œè¿™ç§æƒ…å†µåº”è¯¥æ˜¯æœ‰é—®é¢˜çš„ã€‚ä¸ºä»€ä¹ˆåœ¨æ·»åŠ ä¸€ä¸ª <strong>Triangle</strong> ç±»æ—¶ï¼Œåœ†å½¢å’Œæ­£æ–¹å½¢éœ€è¦é‡æ–°ç¼–è¯‘ï¼Ÿ</p>
<p>æŠ€æœ¯ä¸Šçš„åŸå› æ˜¯é€šè¿‡ <strong>DrawStrategy</strong> åŸºç±»ï¼Œæ‰€æœ‰å½¢çŠ¶éšå¼åœ°çŸ¥é“å½¼æ­¤ã€‚</p>
<p>å› æ­¤ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„å½¢çŠ¶ä¼šå½±å“æ‰€æœ‰å…¶ä»–å½¢çŠ¶ã€‚æ ¹æœ¬çš„è®¾è®¡åŸå› æ˜¯<strong>è¿åäº†æ¥å£åˆ†ç¦»åŸåˆ™</strong>ï¼ˆISPï¼‰ï¼ˆè§â€œ<strong>å‡†åˆ™3ï¼šåˆ†ç¦»æ¥å£ä»¥é¿å…äººä¸ºè€¦åˆ</strong>â€ï¼‰ã€‚</p>
<p>é€šè¿‡å®šä¹‰å•ä¸€çš„ <strong>DrawStrategy</strong> åŸºç±»ï¼Œä½ äººä¸ºåœ°å°†åœ†å½¢ã€æ­£æ–¹å½¢å’Œä¸‰è§’å½¢è€¦åˆåœ¨ä¸€èµ·ã€‚ç”±äºè¿™ç§è€¦åˆï¼Œä½ ä½¿å¾—æ·»åŠ æ–°ç±»å‹å˜å¾—æ›´åŠ å›°éš¾ï¼Œä»è€Œé™åˆ¶äº†<strong>OOP</strong>çš„ä¼˜åŠ¿ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œä½ åˆ›é€ äº†ä¸€ç§ä¸æˆ‘ä»¬è®¨è®ºè¿‡ç¨‹åŒ–è§£å†³æ–¹æ¡ˆæ—¶éå¸¸ç›¸ä¼¼çš„æƒ…å†µï¼ˆè§â€œ<strong>å‡†åˆ™15ï¼šè®¾è®¡ä»¥å¢åŠ ç±»å‹æˆ–æ“ä½œ</strong>â€ï¼‰ã€‚</p>
<p>â€œ<strong>éš¾é“æˆ‘ä»¬æ— æ„ä¸­é‡æ–°å®ç°äº†è®¿é—®è€…è®¾è®¡æ¨¡å¼å—ï¼Ÿ</strong>â€ä½ å¯èƒ½ä¼šé—®ã€‚</p>
<p>æˆ‘æ˜ç™½ä½ çš„æ„æ€ï¼š<strong>DrawStrategy</strong> ç¡®å®çœ‹èµ·æ¥å¾ˆåƒè®¿é—®è€…ã€‚ä½†ä¸å¹¸çš„æ˜¯ï¼Œå®ƒå¹¶ä¸èƒ½æ»¡è¶³è®¿é—®è€…çš„æ„å›¾ï¼Œå› ä¸ºä½ ä¸èƒ½è½»æ˜“åœ°æ·»åŠ å…¶ä»–æ“ä½œã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ éœ€è¦<strong>ä¾µå…¥æ€§</strong>åœ°åœ¨ <strong>Shape</strong> å±‚æ¬¡ç»“æ„ä¸­æ·»åŠ ä¸€ä¸ªè™šæ‹Ÿæˆå‘˜å‡½æ•°ã€‚â€œè€Œä¸”å®ƒä¹Ÿä¸æ˜¯ç­–ç•¥æ¨¡å¼ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•æ·»åŠ ç±»å‹ï¼Œå¯¹å§ï¼Ÿâ€æ˜¯çš„ï¼Œæ­£ç¡®ã€‚ä»è®¾è®¡çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ˜¯æœ€ç³Ÿç³•çš„æƒ…å†µã€‚</p>
<p>è¦æ­£ç¡®å®ç°<strong>ç­–ç•¥è®¾è®¡æ¨¡å¼</strong>ï¼Œä½ å¿…é¡»åˆ†åˆ«æå–æ¯ä¸ªå½¢çŠ¶çš„å®ç°ç»†èŠ‚ã€‚ä½ éœ€è¦ä¸ºæ¯ç§å½¢çŠ¶å¼•å…¥ä¸€ä¸ª <strong>DrawStrategy</strong> ç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;DrawCircleStrategy.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Circle</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DrawCircleStrategy</span>  
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">DrawCircleStrategy</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="n">Circle</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">circle</span><span class="p">,</span> <span class="cm">/*some arguments*/</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Circle.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;DrawCircleStrategy.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Circle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Circle</span><span class="p">(</span><span class="kt">double</span> <span class="n">radius</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">DrawCircleStrategy</span><span class="o">&gt;</span> <span class="n">drawer</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">radius_</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="p">,</span> <span class="n">drawer_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">drawer</span><span class="p">))</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* æ£€æŸ¥ç»™å®šçš„åŠå¾„æ˜¯å¦æœ‰æ•ˆä¸”ç»™å®šçš„ &#39;std::unique_ptr&#39; ä¸æ˜¯ nullptr */</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/*some arguments*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">drawer_</span><span class="o">-&gt;</span><span class="n">draw</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="cm">/*some arguments*/</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">radius</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">radius_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">radius_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">DrawCircleStrategy</span><span class="o">&gt;</span> <span class="n">drawer_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;DrawSquareStrategy.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Square</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DrawSquareStrategy</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">DrawSquareStrategy</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="n">Square</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">square</span><span class="p">,</span> <span class="cm">/*some arguments*/</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Square.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;DrawSquareStrategy.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Square</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Square</span><span class="p">(</span><span class="kt">double</span> <span class="n">side</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">DrawSquareStrategy</span><span class="o">&gt;</span> <span class="n">drawer</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">side_</span><span class="p">(</span><span class="n">side</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="p">,</span> <span class="n">drawer_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">drawer</span><span class="p">))</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* æ£€æŸ¥ç»™å®šçš„è¾¹é•¿æ˜¯å¦æœ‰æ•ˆä¸”ç»™å®šçš„ &#39;std::unique_ptr&#39; ä¸æ˜¯ nullptr */</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/*some arguments*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">drawer_</span><span class="o">-&gt;</span><span class="n">draw</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="cm">/*some arguments*/</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">side</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">side_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">side_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">DrawSquareStrategy</span><span class="o">&gt;</span> <span class="n">drawer_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äº <strong>Circle</strong> ç±»ï¼Œä½ éœ€è¦å¼•å…¥ <strong>DrawCircleStrategy</strong> åŸºç±»ï¼Œè€Œå¯¹äº <strong>Square</strong> ç±»ï¼Œåˆ™æ˜¯ <strong>DrawSquareStrategy</strong> åŸºç±»ã€‚</p>
<p>éšç€ <strong>Triangle</strong> ç±»çš„æ·»åŠ ï¼Œä½ ä¹Ÿéœ€è¦æ·»åŠ ä¸€ä¸ª <strong>DrawTriangleStrategy</strong> åŸºç±»ã€‚åªæœ‰è¿™æ ·ï¼Œä½ æ‰èƒ½æ­£ç¡®åˆ†ç¦»å…³æ³¨ç‚¹ï¼Œå¹¶ä»ç„¶å…è®¸æ¯ä¸ªäººæ·»åŠ æ–°ç±»å‹å’Œå½¢çŠ¶ç»˜åˆ¶çš„æ–°å®ç°ã€‚</p>
<p>æœ‰äº†è¿™äº›åŠŸèƒ½ï¼Œä½ å¯ä»¥è½»æ¾å®ç°ç”¨äºç»˜åˆ¶åœ†å½¢ã€æ­£æ–¹å½¢ç”šè‡³ä¸‰è§’å½¢çš„æ–°ç­–ç•¥ç±»ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘å®ç° <strong>DrawCircleStrategy</strong> æ¥å£çš„ <strong>OpenGLCircleStrategy</strong>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;OpenGLCircleStrategy.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Circle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;DrawCircleStrategy.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include </span><span class="cm">/* OpenGL å›¾å½¢åº“ */</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OpenGLCircleStrategy</span> <span class="o">:</span> <span class="k">public</span> <span class="n">DrawCircleStrategy</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">OpenGLCircleStrategy</span><span class="p">(</span><span class="cm">/* ç»˜åˆ¶ç›¸å…³çš„å‚æ•° */</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="n">Circle</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">circle</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="cm">/* ç»˜åˆ¶ç›¸å…³çš„æ•°æ®æˆå‘˜ï¼Œä¾‹å¦‚é¢œè‰²ã€çº¹ç†ç­‰ */</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯·æ³¨æ„ï¼Œ<strong>Circle</strong> å’Œ <strong>DrawCircleStrategy</strong> ç±»ä½äºç›¸åŒçš„æ¶æ„çº§åˆ«ã€‚</p>
<p>æ›´å€¼å¾—æ³¨æ„çš„æ˜¯å®ƒä»¬ä¹‹é—´çš„å¾ªç¯ä¾èµ–å…³ç³»ï¼š<strong>Circle</strong> ä¾èµ–äº <strong>DrawCircleStrategy</strong>ï¼Œä½† <strong>DrawCircleStrategy</strong> ä¹Ÿä¾èµ–äº <strong>Circle</strong>ã€‚ä½†æ˜¯ä¸è¦æ‹…å¿ƒï¼šè™½ç„¶ä¹ä¸€çœ‹è¿™ä¼¼ä¹æ˜¯ä¸ªé—®é¢˜ï¼Œä½†å®é™…ä¸Šå¹¶ä¸æ˜¯ã€‚è¿™æ˜¯ä¸€ä¸ªå¿…è¦çš„å…³ç³»ï¼Œè¡¨æ˜ <strong>Circle</strong> çœŸæ­£æ‹¥æœ‰ <strong>DrawCircleStrategy</strong> å¹¶ç”±æ­¤åˆ›å»ºäº†æ‰€éœ€ä¾èµ–å€’ç½®ï¼Œå¦‚â€œ<strong>å‡†åˆ™9ï¼šæ³¨æ„æŠ½è±¡çš„æ‰€æœ‰æƒ</strong>â€ä¸­æ‰€è®¨è®ºçš„é‚£æ ·ã€‚</p>
<p>â€œä½¿ç”¨ç±»æ¨¡æ¿å®ç°ä¸åŒçš„ <strong>draw</strong> ç­–ç•¥ç±»æ˜¯å¦å¯è¡Œï¼Ÿæˆ‘æƒ³è±¡ä¸­çš„ç±»ä¼¼äºç”¨äºæ— ç¯è®¿é—®è€…çš„è®¿é—®è€…ç±»â€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;DrawStrategy.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DrawStrategy</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">DrawStrategy</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œä¹Ÿæ­£æ˜¯ä½ åº”è¯¥åšçš„ã€‚é€šè¿‡æ­¤ç±»æ¨¡æ¿ï¼Œä½ å¯ä»¥å°† <strong>DrawStrategy</strong> æå‡åˆ°æ›´é«˜çš„æ¶æ„çº§åˆ«ï¼Œé‡ç”¨ä»£ç ï¼Œå¹¶éµå¾ª<strong>DRYåŸåˆ™</strong>ï¼ˆè§å›¾5-6ï¼‰ã€‚æ­¤å¤–ï¼Œå¦‚æœä»ä¸€å¼€å§‹å°±é‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å°†ä¸ä¼šé™·å…¥äººä¸ºè€¦åˆä¸åŒç±»å‹çš„é—®é¢˜ã€‚æ˜¯çš„ï¼Œæˆ‘çœŸçš„å–œæ¬¢è¿™ä¸ªï¼</p>
<p>å°½ç®¡è¿™æ˜¯æˆ‘ä»¬å¦‚ä½•å®ç°è¿™æ ·ä¸€ä¸ªç­–ç•¥ç±»çš„æ–¹å¼ï¼Œä½†ä½ ä»ç„¶ä¸åº”è¯¥æœŸæœ›è¿™ä¼šå‡å°‘åŸºç±»çš„æ•°é‡ï¼ˆä»ç„¶æ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯ç”Ÿæˆçš„ï¼‰ï¼Œæˆ–è€…è¿™ä¼šä¸ºä½ èŠ‚çœå¾ˆå¤šå·¥ä½œã€‚</p>
<p><strong>DrawStrategy</strong> çš„å®ç°ï¼Œä¾‹å¦‚ <strong>OpenGLCircleStrategy</strong> ç±»ï¼Œä»£è¡¨äº†å¤§éƒ¨åˆ†çš„å·¥ä½œï¼Œå¹¶ä¸”å‡ ä¹ä¸ä¼šæ”¹å˜ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;OpenGLCircleStrategy.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Circle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;DrawStrategy.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include </span><span class="cm">/* OpenGL å›¾å½¢åº“ */</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">OpenGLCircleStrategy</span> <span class="o">:</span> <span class="k">public</span> <span class="n">DrawStrategy</span><span class="o">&lt;</span><span class="n">Circle</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‡è®¾ç±»ä¼¼å®ç°çš„ <code>OpenGLSquareStrategy</code>ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å°†æ‰€æœ‰å†…å®¹æ”¾åœ¨ä¸€èµ·ï¼Œå¹¶å†æ¬¡ç»˜åˆ¶å½¢çŠ¶ï¼Œè¿™æ¬¡æ˜¯ä½¿ç”¨ç­–ç•¥è®¾è®¡æ¨¡å¼æ­£ç¡®è§£è€¦çš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Circle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Square.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;OpenGLCircleStrategy.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;OpenGLSquareStrategy.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">using</span> <span class="n">Shapes</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Shape</span><span class="o">&gt;&gt;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Shapes</span> <span class="n">shapes</span><span class="p">{};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ›å»ºä¸€äº›å½¢çŠ¶ï¼Œæ¯ä¸ªå½¢çŠ¶éƒ½é…å¤‡äº†ç›¸åº”çš„OpenGLç»˜åˆ¶ç­–ç•¥ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">shapes</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span> 
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Circle</span><span class="o">&gt;</span><span class="p">(</span> 
</span></span><span class="line"><span class="cl">            <span class="mf">2.3</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">OpenGLCircleStrategy</span><span class="o">&gt;</span><span class="p">(</span><span class="cm">/*...çº¢è‰²...*/</span><span class="p">)</span> <span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="n">shapes</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span> 
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Square</span><span class="o">&gt;</span><span class="p">(</span> 
</span></span><span class="line"><span class="cl">            <span class="mf">1.2</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">OpenGLSquareStrategy</span><span class="o">&gt;</span><span class="p">(</span><span class="cm">/*...ç»¿è‰²...*/</span><span class="p">)</span> <span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="n">shapes</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span> 
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Circle</span><span class="o">&gt;</span><span class="p">(</span> 
</span></span><span class="line"><span class="cl">            <span class="mf">4.1</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">OpenGLCircleStrategy</span><span class="o">&gt;</span><span class="p">(</span><span class="cm">/*...è“è‰²...*/</span><span class="p">)</span> <span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ç»˜åˆ¶æ‰€æœ‰å½¢çŠ¶ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="k">const</span><span class="o">&amp;</span> <span class="nl">shape</span> <span class="p">:</span> <span class="n">shapes</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">shape</span><span class="o">-&gt;</span><span class="n">draw</span><span class="p">(</span><span class="cm">/*some arguments*/</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>è®¿é—®è€…æ¨¡å¼ä¸ç­–ç•¥æ¨¡å¼çš„æ¯”è¾ƒ</strong></p>
<p>æ—¢ç„¶ä½ å·²ç»äº†è§£äº†è®¿é—®è€…è®¾è®¡æ¨¡å¼å’Œç­–ç•¥è®¾è®¡æ¨¡å¼ï¼Œä½ å¯èƒ½ä¼šç–‘æƒ‘è¿™ä¸¤è€…çš„åŒºåˆ«æ˜¯ä»€ä¹ˆã€‚æ¯•ç«Ÿï¼Œå®ƒä»¬çš„å®ç°çœ‹èµ·æ¥ç›¸å½“ç›¸ä¼¼ã€‚ç„¶è€Œï¼Œå°½ç®¡åœ¨å®ç°ä¸Šæœ‰ä¸€äº›ç›¸ä¼¼ä¹‹å¤„ï¼Œè¿™ä¸¤ç§è®¾è®¡æ¨¡å¼çš„ç‰¹æ€§æ˜¯éå¸¸ä¸åŒçš„ã€‚</p>
<p>ä½¿ç”¨è®¿é—®è€…è®¾è®¡æ¨¡å¼æ—¶ï¼Œæˆ‘ä»¬å°†ä¸€èˆ¬æ“ä½œçš„æ·»åŠ è§†ä¸ºå˜åŒ–ç‚¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸ºæ“ä½œåˆ›å»ºäº†ä¸€ä¸ªæŠ½è±¡ï¼Œè¿™åè¿‡æ¥å…è®¸æ¯ä¸ªäººæ·»åŠ æ“ä½œã€‚ä¸å¹¸çš„å‰¯ä½œç”¨æ˜¯ï¼Œæ·»åŠ æ–°çš„å½¢çŠ¶ç±»å‹å˜å¾—ä¸å†å®¹æ˜“ã€‚</p>
<p>ä½¿ç”¨ç­–ç•¥è®¾è®¡æ¨¡å¼æ—¶ï¼Œæˆ‘ä»¬å°†å•ä¸ªå‡½æ•°çš„å®ç°ç»†èŠ‚è§†ä¸ºå˜åŒ–ç‚¹ã€‚å¼•å…¥è¿™äº›å®ç°ç»†èŠ‚çš„æŠ½è±¡åï¼Œæˆ‘ä»¬ä»ç„¶èƒ½å¤Ÿè½»æ¾åœ°æ·»åŠ æ–°çš„å½¢çŠ¶ç±»å‹ï¼Œä½†æ— æ³•è½»æ¾åœ°æ·»åŠ æ–°æ“ä½œã€‚æ·»åŠ ä¸€ä¸ªæ“ä½œä»ç„¶éœ€è¦ä¾µå…¥æ€§åœ°æ·»åŠ ä¸€ä¸ªè™šæ‹Ÿæˆå‘˜å‡½æ•°ã€‚å› æ­¤ï¼Œç­–ç•¥è®¾è®¡æ¨¡å¼çš„æ„å›¾ä¸è®¿é—®è€…è®¾è®¡æ¨¡å¼çš„æ„å›¾æ­£å¥½ç›¸åã€‚</p>
<p>å°†è¿™ä¸¤ç§è®¾è®¡æ¨¡å¼ç»“åˆèµ·æ¥ä»¥è·å¾—ä¸¤è€…çš„ä¼˜ç‚¹ï¼ˆä½¿æ·»åŠ ç±»å‹å’Œæ“ä½œéƒ½å˜å¾—å®¹æ˜“ï¼‰å¬èµ·æ¥å¾ˆæœ‰å‰æ™¯ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™ç§æ–¹æ³•è¡Œä¸é€šï¼šæ— è®ºä½ å…ˆåº”ç”¨å“ªç§è®¾è®¡æ¨¡å¼ï¼Œéƒ½ä¼šå›ºå®šä¸¤ä¸ªè‡ªç”±è½´ä¸­çš„ä¸€ä¸ªã€‚å› æ­¤ï¼Œä½ åº”è¯¥è®°ä½è¿™ä¸¤ç§è®¾è®¡æ¨¡å¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œå¹¶æ ¹æ®ä½ å¯¹ä»£ç åº“æ¼”åŒ–çš„é¢„æœŸæ¥åº”ç”¨å®ƒä»¬ã€‚</p>
<p><strong>åˆ†æç­–ç•¥è®¾è®¡æ¨¡å¼çš„ä¸è¶³</strong></p>
<p>æˆ‘å·²ç»å‘ä½ å±•ç¤ºäº†ç­–ç•¥è®¾è®¡æ¨¡å¼çš„ä¼˜åŠ¿ï¼šå®ƒé€šè¿‡å¼•å…¥ä¸€ä¸ªæŠ½è±¡æ¥å‡å°‘å¯¹ç‰¹å®šå®ç°ç»†èŠ‚çš„ä¾èµ–ã€‚ç„¶è€Œï¼Œåœ¨è½¯ä»¶è®¾è®¡ä¸­æ²¡æœ‰ä¸‡èƒ½è¯ï¼Œæ¯ç§è®¾è®¡éƒ½æœ‰å…¶ä¸€ç³»åˆ—çš„ç¼ºç‚¹ã€‚ç­–ç•¥è®¾è®¡æ¨¡å¼ä¹Ÿä¸ä¾‹å¤–ï¼Œè€ƒè™‘æ½œåœ¨çš„ç¼ºç‚¹åŒæ ·é‡è¦ã€‚</p>
<p>é¦–å…ˆï¼Œè™½ç„¶æŸä¸ªæ“ä½œçš„å®ç°ç»†èŠ‚å·²ç»è¢«æå–å’Œéš”ç¦»ï¼Œä½†è¯¥æ“ä½œæœ¬èº«ä»ç„¶æ˜¯å…·ä½“ç±»å‹çš„ä¸€éƒ¨åˆ†ã€‚è¿™ä¸€äº‹å®è¯æ˜äº†ä¸Šè¿°é™åˆ¶ï¼Œå³æˆ‘ä»¬ä»ç„¶ä¸èƒ½è½»æ˜“åœ°æ·»åŠ æ“ä½œã€‚ä¸è®¿é—®è€…ä¸åŒï¼Œç­–ç•¥ä¿ç•™äº†OOPçš„ä¼˜åŠ¿ï¼Œä½¿ä½ å¯ä»¥è½»æ¾æ·»åŠ æ–°ç±»å‹ã€‚</p>
<p>å…¶æ¬¡ï¼Œå°½æ—©è¯†åˆ«è¿™äº›å˜åŒ–ç‚¹æ˜¯æœ‰å›æŠ¥çš„ã€‚å¦åˆ™éœ€è¦è¿›è¡Œå¤§è§„æ¨¡é‡æ„ã€‚å½“ç„¶ï¼Œè¿™å¹¶ä¸æ„å‘³ç€ä½ åº”è¯¥ä¸€å¼€å§‹å°±ç”¨ç­–ç•¥æ¨¡å¼å®ç°ä¸€åˆ‡ä»¥é˜²æœªæ¥éœ€è¦é‡æ„ã€‚è¿™æ ·åšå¯èƒ½ä¼šå¯¼è‡´è¿‡åº¦è®¾è®¡ã€‚ä½†åœ¨æœ‰è¿¹è±¡è¡¨æ˜å®ç°ç»†èŠ‚å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼Œæˆ–è€…æœ‰å¤šé‡å®ç°çš„éœ€æ±‚æ—¶ï¼Œåº”è¯¥å°½å¿«å®æ–½å¿…è¦çš„ä¿®æ”¹ã€‚æœ€å¥½çš„å»ºè®®ï¼Œè™½ç„¶æ˜¯æœ‰ç‚¹ä¸å…·ä½“çš„ï¼Œå°±æ˜¯ä¿æŒäº‹æƒ…å°½å¯èƒ½ç®€å•ï¼ˆKISSåŸåˆ™ï¼›ä¿æŒç®€å•ï¼Œæ„šè ¢ï¼‰ã€‚</p>
<p>ç¬¬ä¸‰ï¼Œå¦‚æœä½ é€šè¿‡åŸºç±»å®ç°ç­–ç•¥æ¨¡å¼ï¼Œæ€§èƒ½è‚¯å®šä¼šå› ä¸ºé¢å¤–çš„è¿è¡Œæ—¶é—´æ¥è°ƒç”¨è€Œå—åˆ°å½±å“ã€‚æ€§èƒ½è¿˜å—åˆ°è®¸å¤šæ‰‹åŠ¨åˆ†é…ï¼ˆ<code>std::make_unique()</code> è°ƒç”¨ï¼‰ã€ç”±æ­¤äº§ç”Ÿçš„å†…å­˜ç¢ç‰‡ä»¥åŠç”±äºä¼—å¤šæŒ‡é’ˆé€ æˆçš„å„ç§é—´æ¥è°ƒç”¨çš„å½±å“ã€‚è¿™æ˜¯å¯ä»¥é¢„æ–™çš„ï¼Œä½†ä½ çš„å®ç°çš„çµæ´»æ€§ä»¥åŠæ¯ä¸ªäººéƒ½å¯ä»¥æ·»åŠ æ–°å®ç°çš„æœºä¼šå¯èƒ½ä¼šè¶…è¿‡è¿™ç§æ€§èƒ½æŸå¤±ã€‚å½“ç„¶ï¼Œè¿™å–å†³äºå…·ä½“æƒ…å†µï¼Œä½ éœ€è¦é€æ¡ˆå†³å®šã€‚å¦‚æœä½ ä½¿ç”¨æ¨¡æ¿å®ç°ç­–ç•¥æ¨¡å¼ï¼ˆè§â€œåŸºäºç­–ç•¥çš„è®¾è®¡â€è®¨è®ºï¼‰ï¼Œè¿™ç§ç¼ºç‚¹å°±ä¸æˆé—®é¢˜ã€‚</p>
<p>æœ€åä½†å¹¶éæœ€ä¸é‡è¦çš„ï¼Œç­–ç•¥è®¾è®¡æ¨¡å¼çš„ä¸»è¦ç¼ºç‚¹æ˜¯å•ä¸€ç­–ç•¥åº”å¤„ç†å•ä¸€æ“ä½œæˆ–ä¸€ç»„ç´§å¯†ç›¸å…³çš„å‡½æ•°ã€‚å¦åˆ™ï¼Œä½ åˆä¼šè¿åå•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰ã€‚å¦‚æœéœ€è¦æå–å¤šä¸ªæ“ä½œçš„å®ç°ç»†èŠ‚ï¼Œåˆ™éœ€è¦æœ‰å¤šä¸ªç­–ç•¥åŸºç±»å’Œå¤šä¸ªæ•°æ®æˆå‘˜ï¼Œå¯ä»¥é€šè¿‡ä¾èµ–æ³¨å…¥è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘æœ‰ä¸€ä¸ªé¢å¤–çš„ <code>serialize()</code> æˆå‘˜å‡½æ•°çš„æƒ…å†µï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;DrawCircleStrategy.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Circle</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DrawCircleStrategy</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">DrawCircleStrategy</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="n">Circle</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">circle</span><span class="p">,</span> <span class="cm">/*some arguments*/</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;SerializeCircleStrategy.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Circle</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SerializeCircleStrategy</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">SerializeCircleStrategy</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">Circle</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">circle</span><span class="p">,</span> <span class="cm">/*some arguments*/</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Circle.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;DrawCircleStrategy.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;SerializeCircleStrategy.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Circle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Circle</span><span class="p">(</span><span class="kt">double</span> <span class="n">radius</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">DrawCircleStrategy</span><span class="o">&gt;</span> <span class="n">drawer</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">SerializeCircleStrategy</span><span class="o">&gt;</span> <span class="n">serializer</span> 
</span></span><span class="line"><span class="cl">                    <span class="cm">/* å¯èƒ½è¿˜æœ‰æ›´å¤šä¸ç­–ç•¥ç›¸å…³çš„å‚æ•° */</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">radius_</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="p">,</span> <span class="n">drawer_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">drawer</span><span class="p">))</span> 
</span></span><span class="line"><span class="cl">        <span class="p">,</span> <span class="n">serializer_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">serializer</span><span class="p">))</span> 
</span></span><span class="line"><span class="cl">        <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* æ£€æŸ¥ç»™å®šçš„åŠå¾„æ˜¯å¦æœ‰æ•ˆä¸”ç»™å®šçš„ std::unique_ptrs ä¸æ˜¯ nullptrs */</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/*some arguments*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">drawer_</span><span class="o">-&gt;</span><span class="n">draw</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="cm">/*some arguments*/</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">serialize</span><span class="p">(</span><span class="cm">/*some arguments*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">serializer_</span><span class="o">-&gt;</span><span class="n">serialize</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="cm">/*some arguments*/</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">radius</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">radius_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">radius_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">DrawCircleStrategy</span><span class="o">&gt;</span> <span class="n">drawer_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">SerializeCircleStrategy</span><span class="o">&gt;</span> <span class="n">serializer_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... å¯èƒ½è¿˜æœ‰æ›´å¤šä¸ç­–ç•¥ç›¸å…³çš„æ•°æ®æˆå‘˜ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è™½ç„¶è¿™ä¼šå¯¼è‡´åŸºç±»çš„å¤§é‡å¢åŠ ä»¥åŠç”±äºå¤šä¸ªæŒ‡é’ˆè€Œå¯¼è‡´å®ä¾‹å˜å¤§ï¼Œä½†ä¹Ÿæå‡ºäº†å¦‚ä½•è®¾è®¡ç±»ä»¥ä¾¿æ–¹ä¾¿åœ°åˆ†é…å¤šä¸ªä¸åŒç­–ç•¥çš„é—®é¢˜ã€‚å› æ­¤ï¼Œç­–ç•¥è®¾è®¡æ¨¡å¼åœ¨éœ€è¦éš”ç¦»å°‘é‡å®ç°ç»†èŠ‚çš„æƒ…å†µä¸‹æœ€ä¸ºå¼ºå¤§ã€‚å¦‚æœä½ é‡åˆ°éœ€è¦æå–è®¸å¤šæ“ä½œç»†èŠ‚çš„æƒ…å†µï¼Œæœ€å¥½è€ƒè™‘å…¶ä»–æ–¹æ³•ï¼ˆä¾‹å¦‚ç¬¬7ç« çš„å¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼æˆ–ç¬¬8ç« çš„ç±»å‹æ“¦é™¤è®¾è®¡æ¨¡å¼ï¼‰ã€‚</p>
<p><strong>åŸºäºç­–ç•¥çš„è®¾è®¡</strong></p>
<p>æ­£å¦‚å‰é¢ç« èŠ‚æ‰€å±•ç¤ºçš„ï¼Œç­–ç•¥è®¾è®¡æ¨¡å¼ä¸ä»…é™äºåŠ¨æ€å¤šæ€æ€§ã€‚ç›¸åï¼Œç­–ç•¥çš„æ„å›¾å¯ä»¥é€šè¿‡ä½¿ç”¨æ¨¡æ¿åœ¨é™æ€å¤šæ€æ€§ä¸­å®Œç¾å®ç°ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘æ ‡å‡†åº“ä¸­çš„ä»¥ä¸‹ä¸¤ä¸ªç®—æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="n">std</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">ForwardIt</span><span class="p">,</span> <span class="k">typename</span> <span class="n">UnaryPredicate</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">constexpr</span> <span class="n">ForwardIt</span> <span class="n">partition</span><span class="p">(</span><span class="n">ForwardIt</span> <span class="n">first</span><span class="p">,</span> <span class="n">ForwardIt</span> <span class="n">last</span><span class="p">,</span> <span class="n">UnaryPredicate</span> <span class="n">p</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">RandomIt</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Compare</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">constexpr</span> <span class="kt">void</span> <span class="n">sort</span><span class="p">(</span><span class="n">RandomIt</span> <span class="n">first</span><span class="p">,</span> <span class="n">RandomIt</span> <span class="n">last</span><span class="p">,</span> <span class="n">Compare</span> <span class="n">comp</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c1">// namespace std 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>std::partition()</code> å’Œ <code>std::sort()</code> ç®—æ³•éƒ½ä½¿ç”¨äº†ç­–ç•¥è®¾è®¡æ¨¡å¼ã€‚<code>std::partition()</code> çš„ <code>UnaryPredicate</code> å‚æ•°å’Œ <code>std::sort()</code> çš„ <code>Compare</code> å‚æ•°ä»£è¡¨äº†ä¸€ç§ä»å¤–éƒ¨æ³¨å…¥éƒ¨åˆ†è¡Œä¸ºçš„æ–¹æ³•ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œè¿™ä¸¤ä¸ªå‚æ•°å…è®¸ä½ æŒ‡å®šå…ƒç´ å¦‚ä½•æ’åºã€‚å› æ­¤ï¼Œè¿™ä¸¤ä¸ªç®—æ³•æå–äº†å…¶ç‰¹å®šè¡Œä¸ºçš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä»¥æ¦‚å¿µçš„å½¢å¼ä¸ºè¿™äº›è¡Œä¸ºæä¾›äº†æŠ½è±¡ï¼ˆè§â€œæŒ‡å—7ï¼šç†è§£åŸºç±»ä¸æ¦‚å¿µä¹‹é—´çš„ç›¸ä¼¼æ€§â€ï¼‰ã€‚è¿™ä¸é¢å‘å¯¹è±¡å½¢å¼çš„ç­–ç•¥ä¸åŒï¼Œä¸ä¼šäº§ç”Ÿä»»ä½•è¿è¡Œæ—¶æ€§èƒ½æŸå¤±ã€‚</p>
<p>ç±»ä¼¼çš„æ€è·¯ä¹Ÿå¯ä»¥åœ¨ <code>std::unique_ptr</code> ç±»æ¨¡æ¿ä¸­çœ‹åˆ°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="n">std</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Deleter</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">default_delete</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span>   
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">unique_ptr</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Deleter</span><span class="o">&gt;</span>   
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">unique_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="p">[],</span> <span class="n">Deleter</span><span class="o">&gt;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c1">// namespace std 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹äºåŸºç¡€æ¨¡æ¿å’Œæ•°ç»„ä¸“ç”¨æ¨¡æ¿ï¼Œéƒ½å¯ä»¥æŒ‡å®šç¬¬äºŒä¸ªæ¨¡æ¿å‚æ•°ä¸ºæ˜¾å¼çš„ <code>Deleter</code>ã€‚é€šè¿‡è¿™ä¸ªå‚æ•°ï¼Œä½ å¯ä»¥å†³å®šæ˜¯å¦è¦é€šè¿‡ <code>delete</code>ã€<code>free()</code> æˆ–å…¶ä»–é‡Šæ”¾å‡½æ•°æ¥é‡Šæ”¾èµ„æºã€‚ç”šè‡³å¯ä»¥â€œæ»¥ç”¨â€ <code>std::unique_ptr</code> æ¥æ‰§è¡Œå®Œå…¨ä¸åŒçš„æ¸…ç†æ“ä½œã€‚</p>
<p>è¿™ç§çµæ´»æ€§ä¹Ÿæ˜¯ç­–ç•¥è®¾è®¡æ¨¡å¼çš„è¯æ®ã€‚æ¨¡æ¿å‚æ•°å…è®¸ä½ å°†ä¸€äº›æ¸…ç†è¡Œä¸ºæ³¨å…¥åˆ°ç±»ä¸­ã€‚è¿™ç§å½¢å¼çš„ç­–ç•¥ä¹Ÿè¢«ç§°ä¸ºåŸºäºç­–ç•¥çš„è®¾è®¡ï¼Œè¿™æ˜¯å®‰å¾·çƒˆÂ·äºšå†å±±å¾·é›·æ–¯åº“åœ¨2001å¹´æå‡ºçš„ä¸€ç§è®¾è®¡ç†å¿µã€‚å…¶æ€æƒ³ç›¸åŒï¼šæå–å¹¶éš”ç¦»ç±»æ¨¡æ¿çš„å…·ä½“è¡Œä¸ºï¼Œä»¥æé«˜å¯å˜æ€§ã€å¯æ‰©å±•æ€§ã€å¯æµ‹è¯•æ€§å’Œå¯é‡ç”¨æ€§ã€‚å› æ­¤ï¼ŒåŸºäºç­–ç•¥çš„è®¾è®¡å¯ä»¥è¢«è§†ä¸ºç­–ç•¥è®¾è®¡æ¨¡å¼çš„é™æ€å¤šæ€å½¢å¼ã€‚æ˜¾ç„¶ï¼Œè¿™ç§è®¾è®¡éå¸¸æœ‰æ•ˆï¼Œå¦‚æ ‡å‡†åº“ä¸­ä¼—å¤šåº”ç”¨æ‰€å±•ç¤ºçš„é‚£æ ·ã€‚</p>
<p>ä½ è¿˜å¯ä»¥å°†åŸºäºç­–ç•¥çš„è®¾è®¡åº”ç”¨äºå½¢çŠ¶ç»˜åˆ¶çš„ä¾‹å­ã€‚è€ƒè™‘ä»¥ä¸‹ <code>Circle</code> ç±»çš„å®ç°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Circle.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;DrawCircleStrategy.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DrawCircleStrategy</span><span class="o">&gt;</span>   
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Circle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Circle</span><span class="p">(</span><span class="kt">double</span> <span class="n">radius</span><span class="p">,</span> <span class="n">DrawCircleStrategy</span> <span class="n">drawer</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">radius_</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="p">,</span> <span class="n">drawer_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">drawer</span><span class="p">))</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* æ£€æŸ¥ç»™å®šçš„åŠå¾„æ˜¯å¦æœ‰æ•ˆ */</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/*some arguments*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">drawer_</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="cm">/*some arguments*/</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">radius</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">radius_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">radius_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">DrawCircleStrategy</span> <span class="n">drawer_</span><span class="p">;</span>  <span class="c1">// å¦‚æœå‡å®šç»™å®šçš„ç­–ç•¥æ˜¯æ— çŠ¶æ€çš„ï¼Œåˆ™å¯èƒ½å¯ä»¥çœç•¥ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸å…¶åœ¨æ„é€ å‡½æ•°ä¸­ä¼ é€’ <code>std::unique_ptr</code> åˆ° <code>DrawCircleStrategy</code> åŸºç±»ï¼Œä¸å¦‚é€šè¿‡æ¨¡æ¿å‚æ•°æŒ‡å®šç­–ç•¥ã€‚æœ€å¤§çš„ä¼˜åŠ¿æ˜¯ç”±äºè¾ƒå°‘çš„æŒ‡é’ˆé—´æ¥è°ƒç”¨è€Œå¸¦æ¥çš„æ€§èƒ½æå‡ï¼šä½ å¯ä»¥ç›´æ¥è°ƒç”¨ç”± <code>DrawCircleStrategy</code> æä¾›çš„å…·ä½“å®ç°ï¼Œè€Œä¸æ˜¯é€šè¿‡ <code>std::unique_ptr</code> è°ƒç”¨ã€‚ç¼ºç‚¹æ˜¯ä½ ä¼šå¤±å»åœ¨è¿è¡Œæ—¶è°ƒæ•´ç‰¹å®š <code>Circle</code> å®ä¾‹ç»˜åˆ¶ç­–ç•¥çš„çµæ´»æ€§ã€‚æ­¤å¤–ï¼Œä½ ä¸ä¼šå†æœ‰ä¸€ä¸ªå•ä¸€çš„ <code>Circle</code> ç±»ã€‚ä½ ä¼šä¸ºæ¯ä¸ªç»˜åˆ¶ç­–ç•¥æœ‰ä¸€ä¸ª <code>Circle</code> çš„å®ä¾‹åŒ–ã€‚æœ€åä½†å¹¶éæœ€ä¸é‡è¦çš„æ˜¯ï¼Œä½ åº”è¯¥è®°ä½ç±»æ¨¡æ¿é€šå¸¸å®Œå…¨ä½äºå¤´æ–‡ä»¶ä¸­ã€‚å› æ­¤ï¼Œä½ å¯èƒ½ä¼šå¤±å»åœ¨æºæ–‡ä»¶ä¸­éšè—å®ç°ç»†èŠ‚çš„æœºä¼šã€‚ä¸€å¦‚æ—¢å¾€ï¼Œæ²¡æœ‰å®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼Œé€‰æ‹©â€œæ­£ç¡®â€çš„è§£å†³æ–¹æ¡ˆå–å†³äºå®é™…ä¸Šä¸‹æ–‡ã€‚</p>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>è¦æ˜ç™½ï¼Œç»§æ‰¿å¾ˆå°‘èƒ½è§£å†³é—®é¢˜ã€‚</li>
<li>åº”ç”¨Strategyè®¾è®¡æ¨¡å¼çš„ç›®çš„æ˜¯æå–ä¸€ç»„å†…èšåŠŸèƒ½çš„å®ç°ç»†èŠ‚ã€‚</li>
<li>ä¸ºæ¯ä¸ªæ“ä½œå®ç°ä¸€ä¸ªç­–ç•¥ï¼Œä»¥é¿å…äººä¸ºè€¦åˆã€‚</li>
<li>å°†åŸºäºç­–ç•¥çš„è®¾è®¡è§†ä¸ºç­–ç•¥è®¾è®¡æ¨¡å¼çš„ç¼–è¯‘æ—¶å½¢å¼ã€‚</li>
</ul>
<h3 id="å‡†åˆ™20ä¼˜å…ˆä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿">å‡†åˆ™20ï¼šä¼˜å…ˆä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿
</h3><p>åœ¨90å¹´ä»£å’Œ21ä¸–çºªåˆé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰çƒ­æ½®ä¹‹åï¼Œå¦‚ä»Šçš„OOPå¤„äºå®ˆåŠ¿ã€‚åå¯¹OOPå¹¶å¼ºè°ƒå…¶ç¼ºç‚¹çš„å£°éŸ³è¶Šæ¥è¶Šå¼ºçƒˆã€‚è¿™ä¸ä»…é™äºC++ç¤¾åŒºï¼Œä¹ŸåŒ…æ‹¬å…¶ä»–ç¼–ç¨‹è¯­è¨€ç¤¾åŒºã€‚è™½ç„¶OOPæ•´ä½“ç¡®å®æœ‰ä¸€äº›å±€é™æ€§ï¼Œä½†è®©æˆ‘ä»¬èšç„¦äºå¼•èµ·æœ€å¤šäº‰è®®çš„ä¸€ä¸ªç‰¹æ€§ï¼šç»§æ‰¿ã€‚æ­£å¦‚Sean Parentæ‰€è¯´ï¼š</p>
<p><strong>â€œç»§æ‰¿æ˜¯ä¸‡æ¶ä¹‹æºã€‚â€</strong></p>
<p>è™½ç„¶ç»§æ‰¿è¢«å®£ä¼ ä¸ºä¸€ç§éå¸¸è‡ªç„¶ä¸”ç›´è§‚çš„æ–¹å¼å»æ¨¡æ‹Ÿç°å®ä¸–ç•Œçš„å…³ç³»ï¼Œä½†å®é™…ä¸Šå®ƒæ¯”æ‰¿è¯ºçš„è¦éš¾ç”¨å¾—å¤šã€‚å½“ä½ æˆ‘ä»¬åœ¨è®¨è®ºLiskovæ›¿æ¢åŸåˆ™ï¼ˆLSPï¼‰æ—¶å·²ç»çœ‹åˆ°äº†ç»§æ‰¿çš„å¾®å¦™å¤±è´¥ï¼ˆè§â€œæŒ‡å—6ï¼šéµå¾ªæŠ½è±¡çš„é¢„æœŸè¡Œä¸ºâ€ï¼‰ã€‚ä½†ç»§æ‰¿è¿˜æœ‰å…¶ä»–æ–¹é¢å¸¸å¸¸è¢«è¯¯è§£ã€‚</p>
<p>é¦–å…ˆï¼Œç»§æ‰¿æ€»æ˜¯è¢«è®¤ä¸ºç®€åŒ–äº†å¯é‡ç”¨æ€§ã€‚è¿™ä¼¼ä¹æ˜¯ç›´è§‚çš„ï¼Œå› ä¸ºä»å¦ä¸€ä¸ªç±»ç»§æ‰¿ä»£ç çœ‹èµ·æ¥å¾ˆå®¹æ˜“é‡ç”¨ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™ç§é‡ç”¨å¹¶ä¸æ˜¯ç»§æ‰¿å¸¦æ¥çš„é‚£ç§é‡ç”¨ã€‚ç»§æ‰¿ä¸æ˜¯å…³äºé‡ç”¨åŸºç±»ä¸­çš„ä»£ç ï¼›ç›¸åï¼Œå®ƒæ˜¯å…³äºé€šè¿‡ä½¿ç”¨åŸºç±»å¤šæ€åœ°é‡ç”¨å…¶ä»–ä»£ç ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ªç¨å¾®æ‰©å±•çš„ <code>Shape</code> åŸºç±»ï¼Œä»¥ä¸‹å‡½æ•°é€‚ç”¨äºæ‰€æœ‰ç±»å‹çš„å½¢çŠ¶ï¼Œå¹¶å› æ­¤å¯ä»¥è¢« <code>Shape</code> åŸºç±»çš„æ‰€æœ‰å®ç°é‡ç”¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">Shape</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">translate</span><span class="p">(</span><span class="cm">/*some arguments*/</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">rotate</span><span class="p">(</span><span class="cm">/*some arguments*/</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/*some arguments*/</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">serialize</span><span class="p">(</span><span class="cm">/*some arguments*/</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... å¯èƒ½æœ‰å…¶ä»–æˆå‘˜å‡½æ•° ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">rotateAroundPoint</span><span class="p">(</span><span class="n">Shape</span><span class="o">&amp;</span> <span class="n">shape</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">mergeShapes</span><span class="p">(</span><span class="n">Shape</span><span class="o">&amp;</span> <span class="n">s1</span><span class="p">,</span> <span class="n">Shape</span><span class="o">&amp;</span> <span class="n">s2</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">writeToFile</span><span class="p">(</span><span class="n">Shape</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">shape</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">sendViaRPC</span><span class="p">(</span><span class="n">Shape</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">shape</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰€æœ‰å››ä¸ªå‡½æ•°ï¼ˆ<code>rotateAroundPoint</code>ã€<code>mergeShapes</code>ã€<code>writeToFile</code> å’Œ <code>sendViaRPC</code>ï¼‰éƒ½æ˜¯åŸºäº <code>Shape</code> æŠ½è±¡æ„å»ºçš„ã€‚æ‰€æœ‰è¿™äº›å‡½æ•°ä»…è€¦åˆåˆ°æ‰€æœ‰ç±»å‹å½¢çŠ¶çš„å…¬å…±æ¥å£ï¼Œè€Œä¸æ˜¯ä»»ä½•ç‰¹å®šçš„å½¢çŠ¶ã€‚æ‰€æœ‰ç±»å‹çš„å½¢çŠ¶éƒ½å¯ä»¥å›´ç»•ä¸€ä¸ªç‚¹æ—‹è½¬ã€åˆå¹¶ã€å†™å…¥æ–‡ä»¶å¹¶é€šè¿‡RPCå‘é€ã€‚æ¯ç§å½¢çŠ¶éƒ½â€œé‡ç”¨â€äº†æ­¤åŠŸèƒ½ã€‚</p>
<p>æ­£æ˜¯é€šè¿‡æŠ½è±¡è¡¨è¾¾åŠŸèƒ½çš„èƒ½åŠ›åˆ›é€ äº†ä»£ç é‡ç”¨çš„æœºä¼šã€‚ä¸åŸºç±»ä¸­åŒ…å«çš„å°é‡ä»£ç ç›¸æ¯”ï¼Œè¿™ç§åŠŸèƒ½é¢„è®¡ä¼šäº§ç”Ÿå¤§é‡çš„ä»£ç ã€‚å› æ­¤ï¼ŒçœŸæ­£çš„å¯é‡ç”¨æ€§æ˜¯ç”±ç±»å‹çš„å¤šæ€ä½¿ç”¨åˆ›å»ºçš„ï¼Œè€Œä¸æ˜¯ç”±å¤šæ€ç±»å‹åˆ›å»ºçš„ã€‚</p>
<p>å…¶æ¬¡ï¼Œç»§æ‰¿è¢«è®¤ä¸ºæœ‰åŠ©äºè§£è€¦è½¯ä»¶å®ä½“ã€‚è™½ç„¶è¿™ç»å¯¹æ˜¯æ­£ç¡®çš„ï¼ˆä¾‹å¦‚ï¼Œå›æƒ³ä¸€ä¸‹â€œæŒ‡å—9ï¼šæ³¨æ„æŠ½è±¡çš„æ‰€æœ‰æƒâ€ä¸­å…³äºä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDIPï¼‰çš„è®¨è®ºï¼‰ï¼Œä½†å¾€å¾€æ²¡æœ‰è§£é‡Šç»§æ‰¿ä¹Ÿä¼šäº§ç”Ÿè€¦åˆã€‚ä½ ä¹‹å‰å·²ç»çœ‹åˆ°è¿‡è¿™ä¸€ç‚¹ã€‚åœ¨å®ç°è®¿é—®è€…è®¾è®¡æ¨¡å¼æ—¶ï¼Œä½ ä½“éªŒåˆ°äº†ç»§æ‰¿å¦‚ä½•å¼ºåˆ¶æŸäº›å®ç°ç»†èŠ‚ç»™ä½ ã€‚åœ¨ä¸€ä¸ªç»å…¸çš„è®¿é—®è€…æ¨¡å¼ä¸­ï¼Œä½ å¿…é¡»å®ç°è®¿é—®è€…åŸºç±»çš„çº¯è™šå‡½æ•°ï¼Œå³ä½¿è¿™å¯¹ä½ çš„åº”ç”¨ç¨‹åºæ¥è¯´å¹¶ä¸ç†æƒ³ã€‚ä½ å¯¹å‡½æ•°å‚æ•°æˆ–è¿”å›ç±»å‹ä¹Ÿæ²¡æœ‰å¤ªå¤šé€‰æ‹©ã€‚è¿™äº›éƒ½æ˜¯å›ºå®šçš„ã€‚</p>
<p>ä½ åœ¨è®¨è®ºç­–ç•¥è®¾è®¡æ¨¡å¼å¼€å§‹æ—¶ä¹Ÿä½“éªŒåˆ°äº†è¿™ç§è€¦åˆã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç»§æ‰¿å¼ºåˆ¶äº†ä¸€ç§ç»“æ„è€¦åˆï¼Œå¯¼è‡´äº†æ›´æ·±çš„ç»§æ‰¿å±‚æ¬¡ç»“æ„ï¼Œå¯¼è‡´äº†å¯ç–‘çš„ç±»å‘½åï¼Œå¹¶æŸå®³äº†é‡ç”¨æ€§ã€‚</p>
<p>åœ¨æ­¤æ—¶ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—æˆ‘åœ¨è¯•å›¾å®Œå…¨è¯‹æ¯ç»§æ‰¿ã€‚å¥½å§ï¼Œè¯´å®è¯ï¼Œæˆ‘åªæ˜¯æƒ³è®©å®ƒçœ‹èµ·æ¥æœ‰ç‚¹ä¸å¥½ï¼Œä½†åªæ˜¯å¿…è¦çš„ç¨‹åº¦ã€‚æ˜ç¡®åœ°è¯´ï¼šç»§æ‰¿å¹¶ä¸åï¼Œä¹Ÿä¸æ„å‘³ç€ä¸åº”è¯¥ä½¿ç”¨å®ƒã€‚ç›¸åï¼šç»§æ‰¿æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ç‰¹æ€§ï¼Œå¦‚æœä½¿ç”¨å¾—å½“ï¼Œä½ å¯ä»¥ç”¨å®ƒåšä»¤äººéš¾ä»¥ç½®ä¿¡çš„äº‹æƒ…ã€‚ç„¶è€Œï¼Œâ€œå¦‚æœä½¿ç”¨å¾—å½“â€è¿™éƒ¨åˆ†æ˜¯ä¸ªé—®é¢˜ã€‚ç»§æ‰¿å·²ç»è¢«è¯æ˜å¾ˆéš¾æ­£ç¡®ä½¿ç”¨ï¼ˆè‚¯å®šæ¯”æˆ‘ä»¬è¢«å‘ŠçŸ¥çš„è¦éš¾å¾—å¤šï¼›å‚è§æˆ‘ä¹‹å‰çš„ç†ç”±ï¼‰ï¼Œå› æ­¤ç»å¸¸è¢«æ— æ„ä¸­è¯¯ç”¨ã€‚å®ƒä¹Ÿè¢«è¿‡åº¦ä½¿ç”¨ï¼Œå› ä¸ºè®¸å¤šå¼€å‘äººå‘˜ä¹ æƒ¯äºç”¨å®ƒæ¥è§£å†³å„ç§é—®é¢˜ã€‚è¿™ç§è¿‡åº¦ä½¿ç”¨ä¼¼ä¹æ˜¯è®¸å¤šé—®é¢˜çš„æ ¹æºï¼Œæ­£å¦‚Michael Feathersæ‰€è¨€ï¼š</p>
<p>â€œ[ç¼–ç¨‹å·®å¼‚]åœ¨1990å¹´ä»£å¤±å® ï¼Œå½“æ—¶è®¸å¤šäººæ³¨æ„åˆ°å¦‚æœè¿‡åº¦ä½¿ç”¨ç»§æ‰¿ä¼šç›¸å½“éº»çƒ¦ã€‚â€</p>
<p>åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œç»§æ‰¿æ—¢ä¸æ˜¯æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆä¹Ÿä¸æ˜¯æ­£ç¡®çš„å·¥å…·ã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œä½¿ç”¨ç»„åˆæ›´ä¸ºå¯å–ã€‚ä½ åº”è¯¥ä¸ä¼šå¯¹æ­¤æ„Ÿåˆ°æƒŠè®¶ï¼Œå› ä¸ºä½ å·²ç»çœ‹åˆ°è¿™æ˜¯äº‹å®ã€‚ç»„åˆæ˜¯OOå½¢å¼çš„ç­–ç•¥è®¾è®¡æ¨¡å¼å¦‚æ­¤æœ‰æ•ˆçš„æ ¹æœ¬åŸå› ï¼Œè€Œä¸æ˜¯ç»§æ‰¿ã€‚å¼•å…¥æŠ½è±¡å’Œèšåˆç›¸åº”çš„æ•°æ®æˆå‘˜ä½¿ç­–ç•¥è®¾è®¡æ¨¡å¼å¦‚æ­¤å¼ºå¤§ï¼Œè€Œä¸æ˜¯åŸºäºç»§æ‰¿çš„ä¸åŒç­–ç•¥å®ç°ã€‚å®é™…ä¸Šï¼Œä½ ä¼šå‘ç°è®¸å¤šè®¾è®¡æ¨¡å¼åšå®åœ°åŸºäºç»„åˆï¼Œè€Œä¸æ˜¯ç»§æ‰¿ã€‚æ‰€æœ‰è¿™äº›æ¨¡å¼éƒ½èƒ½é€šè¿‡ç»§æ‰¿è¿›è¡Œæ‰©å±•ï¼Œä½†å®ƒä»¬æœ¬èº«æ˜¯é€šè¿‡ç»„åˆå®ç°çš„ã€‚</p>
<p><strong>å§”æ‰˜ç»™æœåŠ¡ï¼šæ‹¥æœ‰ä¼˜äºæ˜¯ã€‚</strong> â€”â€”Andrew Huntå’ŒDavid Thomasï¼Œã€Šå®ç”¨ç¨‹åºå‘˜ã€‹</p>
<p>è¿™æ˜¯è®¸å¤šè®¾è®¡æ¨¡å¼çš„ä¸€èˆ¬è¦ç‚¹ã€‚æˆ‘å»ºè®®ä½ å°†è¿™ä¸€è§è§£ç‰¢è®°åœ¨å¿ƒï¼Œå› ä¸ºå®ƒå°†å¯¹ä½ ç†è§£æœ¬ä¹¦å‰©ä½™éƒ¨åˆ†ä¸­çœ‹åˆ°çš„è®¾è®¡æ¨¡å¼éå¸¸æœ‰ç”¨ï¼Œå¹¶å°†æé«˜ä½ å®ç°çš„è´¨é‡ã€‚</p>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>è¦æ˜ç™½ç»§æ‰¿ç»å¸¸è¢«è¿‡åº¦ä½¿ç”¨ï¼Œæœ‰æ—¶ç”šè‡³è¢«è¯¯ç”¨ã€‚</li>
<li>è¯·è®°ä½ï¼Œç»§æ‰¿åˆ›å»ºäº†ç´§å¯†è€¦åˆã€‚</li>
<li>è¦è®¤è¯†åˆ°è®¸å¤šè®¾è®¡æ¨¡å¼æ˜¯é€šè¿‡ç»„åˆè€Œä¸æ˜¯ç»§æ‰¿æ¥å®ç°çš„ã€‚</li>
</ul>
<h3 id="å‡†åˆ™21ä½¿ç”¨å‘½ä»¤æ¨¡å¼éš”ç¦»æ“ä½œå†…å®¹">å‡†åˆ™21ï¼šä½¿ç”¨å‘½ä»¤æ¨¡å¼éš”ç¦»æ“ä½œå†…å®¹
</h3><p>åœ¨æˆ‘ä»¬å¼€å§‹è¿™æ¡æŒ‡å—ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆåšä¸€ä¸ªå®éªŒã€‚</p>
<p>æ‰“å¼€ä½ å–œæ¬¢çš„ç”µå­é‚®ä»¶å®¢æˆ·ç«¯ï¼Œç»™æˆ‘å†™ä¸€å°ç”µå­é‚®ä»¶ã€‚æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼šâ€œæˆ‘çˆ±æ‚¨çš„ä¹¦ï¼å®ƒè®©æˆ‘æ•´æ™šéƒ½ç¡ä¸ç€ï¼Œå¹¶ä¸”è®©æˆ‘å¿˜è®°äº†æ‰€æœ‰çš„çƒ¦æ¼ã€‚â€ å¥½çš„ï¼Œå¾ˆå¥½ã€‚ç°åœ¨ç‚¹å‡»å‘é€ã€‚</p>
<p>å¹²å¾—ä¸é”™ï¼ç»™æˆ‘å‡ ç§’é’Ÿæ£€æŸ¥æˆ‘çš„é‚®ç®±â€¦â€¦è¿˜æ²¡æœ‰æ”¶åˆ°â€¦â€¦è¿˜æ˜¯æ²¡æœ‰â€¦â€¦è®©æˆ‘ä»¬å†è¯•ä¸€æ¬¡ï¼šç‚¹å‡»é‡æ–°å‘é€ã€‚è¿˜æ˜¯æ²¡æœ‰ã€‚</p>
<p>å—¯ï¼Œæˆ‘çŒœæœ‰äº›æœåŠ¡å™¨å¯èƒ½å‡ºäº†é—®é¢˜ã€‚æˆ–è€…æ˜¯æˆ‘è¿™è¾¹çš„æ‰€æœ‰å‘½ä»¤éƒ½å¤±è´¥äº†ï¼š<code>WriteCommand</code>ï¼ˆå†™å‘½ä»¤ï¼‰ã€<code>SendCommand</code>ï¼ˆå‘é€å‘½ä»¤ï¼‰ã€<code>ResendCommand</code>ï¼ˆé‡æ–°å‘é€å‘½ä»¤ï¼‰ï¼Œç­‰ç­‰ã€‚çœŸä¸å¹¸ã€‚</p>
<p>ä½†å°½ç®¡è¿™ä¸ªå®éªŒå¤±è´¥äº†ï¼Œä½ ç°åœ¨åº”è¯¥å¯¹å¦ä¸€ä¸ªGoFè®¾è®¡æ¨¡å¼æœ‰äº†ä¸€ä¸ªå¾ˆå¥½çš„ç†è§£ï¼š<strong>å‘½ä»¤è®¾è®¡æ¨¡å¼</strong>ã€‚</p>
<p><strong>å‘½ä»¤è®¾è®¡æ¨¡å¼è§£æ</strong></p>
<p>å‘½ä»¤è®¾è®¡æ¨¡å¼ä¸“æ³¨äºå°è£…å’Œéš”ç¦»å·¥ä½œåŒ…ï¼Œè¿™äº›å·¥ä½œåŒ…é€šå¸¸åªæ‰§è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”é€šå¸¸æ˜¯ç«‹å³æ‰§è¡Œçš„ã€‚ä¸ºæ­¤ï¼Œå®ƒè¯†åˆ«ä¸åŒç±»å‹çš„å·¥ä½œåŒ…ä½œä¸ºå˜åŒ–ç‚¹ï¼Œå¹¶å¼•å…¥ç›¸åº”çš„æŠ½è±¡ï¼Œå…è®¸è½»æ¾å®ç°æ–°çš„å·¥ä½œåŒ…ç±»å‹ã€‚</p>
<p>æ„å›¾ï¼šâ€œ<strong>å°†è¯·æ±‚å°è£…ä¸ºå¯¹è±¡ï¼Œä»è€Œè®©ä½ å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¯·æ±‚å‚æ•°åŒ–å®¢æˆ·ç«¯ï¼Œé˜Ÿåˆ—æˆ–è®°å½•è¯·æ±‚ï¼Œå¹¶æ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚</strong>â€</p>
<p>ä»¥è®¡ç®—å™¨ä¸ºä¾‹ï¼Œä¸‹é¢æ˜¯å‘½ä»¤è®¾è®¡æ¨¡å¼çš„ä¸€ä¸ªå®ç°ã€‚ç¬¬ä¸€ä¸ªä»£ç ç‰‡æ®µå±•ç¤ºäº†<code>CalculatorCommand</code>åŸºç±»çš„å®ç°ï¼Œå®ƒä»£è¡¨äº†å¯¹ç»™å®šæ•´æ•°è¿›è¡Œæ•°å­¦è¿ç®—çš„æŠ½è±¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;CalculatorCommand.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CalculatorCommand</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">CalculatorCommand</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">execute</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">undo</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>CalculatorCommand</code>ç±»æœŸæœ›æ´¾ç”Ÿç±»å®ç°çº¯è™šå‡½æ•°<code>execute()</code>å’Œ<code>undo()</code>ã€‚å¯¹äº<code>undo()</code>çš„é¢„æœŸæ˜¯å®ƒå®ç°äº†å¿…è¦çš„æ“ä½œæ¥é€†è½¬<code>execute()</code>å‡½æ•°çš„æ•ˆæœã€‚</p>
<p>åŠ æ³•å’Œå‡æ³•ç±»éƒ½ä»£è¡¨äº†è®¡ç®—å™¨å¯èƒ½çš„å‘½ä»¤ï¼Œå› æ­¤å®ƒä»¬å®ç°äº†<code>CalculatorCommand</code>åŸºç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Add.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;CalculatorCommand.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Add</span> <span class="o">:</span> <span class="k">public</span> <span class="n">CalculatorCommand</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Add</span><span class="p">(</span><span class="kt">int</span> <span class="n">operand</span><span class="p">)</span> <span class="o">:</span> <span class="n">operand_</span><span class="p">(</span><span class="n">operand</span><span class="p">)</span> <span class="p">{}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">execute</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span>   
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="n">operand_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">undo</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span>   
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">i</span> <span class="o">-</span> <span class="n">operand_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">operand_</span><span class="p">{};</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Subtract.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;CalculatorCommand.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Subtract</span> <span class="o">:</span> <span class="k">public</span> <span class="n">CalculatorCommand</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Subtract</span><span class="p">(</span><span class="kt">int</span> <span class="n">operand</span><span class="p">)</span> <span class="o">:</span> <span class="n">operand_</span><span class="p">(</span><span class="n">operand</span><span class="p">)</span> <span class="p">{}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">execute</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span>   
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">i</span> <span class="o">-</span> <span class="n">operand_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">undo</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span>   
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="n">operand_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">operand_</span><span class="p">{};</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Add</code>ç±»å®ç°äº†<code>execute()</code>å‡½æ•°ç”¨äºåŠ æ³•æ“ä½œï¼Œå¹¶å®ç°äº†<code>undo()</code>å‡½æ•°ç”¨äºå‡æ³•æ“ä½œã€‚<code>Subtract</code>ç±»åˆ™å®ç°äº†ç›¸åçš„æ“ä½œã€‚</p>
<p>ç”±äº<code>CalculatorCommand</code>å±‚æ¬¡ç»“æ„çš„å­˜åœ¨ï¼Œ<code>Calculator</code>ç±»æœ¬èº«å¯ä»¥ä¿æŒç›¸å½“ç®€å•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Calculator.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;CalculatorCommand.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stack&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Calculator</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">compute</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">CalculatorCommand</span><span class="o">&gt;</span> <span class="n">command</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">undoLast</span><span class="p">();</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">result</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">clear</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">using</span> <span class="n">CommandStack</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">stack</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">CalculatorCommand</span><span class="o">&gt;&gt;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">current_</span><span class="p">{};</span>  
</span></span><span class="line"><span class="cl">    <span class="n">CommandStack</span> <span class="n">stack_</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Calculator.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Calculator.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="n">Calculator</span><span class="o">::</span><span class="n">compute</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">CalculatorCommand</span><span class="o">&gt;</span> <span class="n">command</span><span class="p">)</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">current_</span> <span class="o">=</span> <span class="n">command</span><span class="o">-&gt;</span><span class="n">execute</span><span class="p">(</span><span class="n">current_</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="n">stack_</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">command</span><span class="p">));</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Calculator</span><span class="o">::</span><span class="n">undoLast</span><span class="p">()</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">stack_</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="k">return</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">command</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">stack_</span><span class="p">.</span><span class="n">top</span><span class="p">());</span> 
</span></span><span class="line"><span class="cl">    <span class="n">stack_</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">    <span class="n">current_</span> <span class="o">=</span> <span class="n">command</span><span class="o">-&gt;</span><span class="n">undo</span><span class="p">(</span><span class="n">current_</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">Calculator</span><span class="o">::</span><span class="n">result</span><span class="p">()</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">current_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Calculator</span><span class="o">::</span><span class="n">clear</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">current_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">CommandStack</span><span class="p">{}.</span><span class="n">swap</span><span class="p">(</span><span class="n">stack_</span><span class="p">);</span>  <span class="c1">// æ¸…ç©ºæ ˆ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬åªéœ€è¦ä¸¤ä¸ªå‡½æ•°æ¥è¿›è¡Œè®¡ç®—æ´»åŠ¨ï¼š<code>compute()</code>å’Œ<code>undoLast()</code>ã€‚</p>
<p><code>compute()</code>å‡½æ•°æ¥æ”¶ä¸€ä¸ª<code>CalculatorCommand</code>å®ä¾‹ï¼Œç«‹å³æ‰§è¡Œå®ƒä»¥æ›´æ–°å½“å‰å€¼ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨æ ˆä¸­ã€‚<code>undoLast()</code>å‡½æ•°é€šè¿‡ä»æ ˆä¸­å¼¹å‡ºæœ€åä¸€ä¸ªæ‰§è¡Œçš„å‘½ä»¤å¹¶è°ƒç”¨å…¶<code>undo()</code>æ–¹æ³•æ¥æ’¤é”€æœ€åä¸€æ¬¡æ“ä½œã€‚</p>
<p><code>main()</code>å‡½æ•°å°†æ‰€æœ‰éƒ¨åˆ†ç»„åˆåœ¨ä¸€èµ·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Main.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Calculator.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Add.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Subtract.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">Calculator</span> <span class="n">calculator</span><span class="p">{};</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">op1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Add</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">op2</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Add</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">op3</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Subtract</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">op4</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Subtract</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">calculator</span><span class="p">.</span><span class="n">compute</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">op1</span><span class="p">));</span>  <span class="c1">// è®¡ç®— 0 + 3ï¼Œå­˜å‚¨å¹¶è¿”å› 3 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">calculator</span><span class="p">.</span><span class="n">compute</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">op2</span><span class="p">));</span>  <span class="c1">// è®¡ç®— 3 + 7ï¼Œå­˜å‚¨å¹¶è¿”å› 10 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">calculator</span><span class="p">.</span><span class="n">compute</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">op3</span><span class="p">));</span>  <span class="c1">// è®¡ç®— 10 - 4ï¼Œå­˜å‚¨å¹¶è¿”å› 6 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">calculator</span><span class="p">.</span><span class="n">compute</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">op4</span><span class="p">));</span>  <span class="c1">// è®¡ç®— 6 - 2ï¼Œå­˜å‚¨å¹¶è¿”å› 4 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="n">calculator</span><span class="p">.</span><span class="n">undoLast</span><span class="p">();</span>  <span class="c1">// æ’¤é”€æœ€åä¸€æ¬¡æ“ä½œï¼Œå­˜å‚¨å¹¶è¿”å› 6 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="k">const</span> <span class="n">res</span> <span class="o">=</span> <span class="n">calculator</span><span class="p">.</span><span class="n">result</span><span class="p">();</span>  <span class="c1">// è·å–æœ€ç»ˆç»“æœï¼š6 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªè®¡ç®—å™¨ï¼Œå¹¶åˆ›å»ºä¸€ç³»åˆ—æ“ä½œï¼Œä¾æ¬¡åº”ç”¨è¿™äº›æ“ä½œã€‚</p>
<p>ä¹‹åï¼Œé€šè¿‡<code>undo()</code>æ“ä½œæ’¤é”€<code>op4</code>ï¼Œç„¶åæŸ¥è¯¢æœ€ç»ˆç»“æœã€‚</p>
<p>è¿™ç§è®¾è®¡å¾ˆå¥½åœ°éµå¾ªäº†<strong>SOLID</strong>åŸåˆ™ã€‚å®ƒéµå®ˆ<strong>å•ä¸€èŒè´£åŸåˆ™</strong>ï¼ˆSRPï¼‰ï¼Œå› ä¸ºé€šè¿‡<strong>å‘½ä»¤è®¾è®¡æ¨¡å¼</strong>å·²ç»æå–äº†å˜åŒ–ç‚¹ã€‚å› æ­¤ï¼Œ<code>compute()</code>å’Œ<code>undo()</code>ä¸éœ€è¦æ˜¯è™šå‡½æ•°ã€‚<strong>SRP</strong>ä¹Ÿä¿ƒè¿›äº†<strong>å¼€é—­åŸåˆ™</strong>ï¼ˆOCPï¼‰ï¼Œä½¿æˆ‘ä»¬å¯ä»¥æ·»åŠ æ–°æ“ä½œè€Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç ã€‚</p>
<p>æœ€åï¼Œå¦‚æœæ­£ç¡®åˆ†é…äº†<code>Command</code>åŸºç±»çš„æ‰€æœ‰æƒï¼Œåˆ™è®¾è®¡ä¹Ÿç¬¦åˆ<strong>ä¾èµ–å€’ç½®åŸåˆ™</strong>ï¼ˆDIPï¼‰ã€‚</p>
<p><strong>å‘½ä»¤è®¾è®¡æ¨¡å¼çš„ç¬¬äºŒä¸ªç»å…¸ç¤ºä¾‹ï¼šçº¿ç¨‹æ± </strong></p>
<p><strong>å‘½ä»¤è®¾è®¡æ¨¡å¼</strong>çš„å¦ä¸€ä¸ªç»å…¸ç¤ºä¾‹æ˜¯<strong>çº¿ç¨‹æ± </strong>ã€‚</p>
<p>çº¿ç¨‹æ± çš„ä½œç”¨æ˜¯ç»´æŠ¤å¤šä¸ªçº¿ç¨‹ï¼Œç­‰å¾…ä»»åŠ¡ä»¥ä¾¿å¹¶è¡Œæ‰§è¡Œã€‚</p>
<p>è¿™ä¸€æƒ³æ³•é€šè¿‡ä»¥ä¸‹<code>ThreadPool</code>ç±»å®ç°ï¼šå®ƒæä¾›äº†ä¸€äº›æˆå‘˜å‡½æ•°æ¥å°†æŸäº›ä»»åŠ¡åˆ†é…ç»™ç‰¹å®šæ•°é‡çš„å¯ç”¨çº¿ç¨‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Command</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> <span class="cm">/* æ‰§è¡Œå’Œæ’¤é”€ä»»ä½•ç±»å‹æ“ä½œçš„æŠ½è±¡æ¥å£ */</span> <span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ThreadPool</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">ThreadPool</span><span class="p">(</span><span class="n">size_t</span> <span class="n">numThreads</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="kr">inline</span> <span class="kt">bool</span> <span class="nf">isEmpty</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="kr">inline</span> <span class="n">size_t</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="kr">inline</span> <span class="n">size_t</span> <span class="nf">active</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="kr">inline</span> <span class="n">size_t</span> <span class="nf">ready</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">schedule</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Command</span><span class="o">&gt;</span> <span class="n">command</span><span class="p">);</span>   <span class="c1">// å®‰æ’ä¸€ä¸ªä»»åŠ¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="nf">wait</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€é‡è¦çš„æ˜¯ï¼Œ<code>ThreadPool</code>å…è®¸ä½ é€šè¿‡<code>schedule()</code>å‡½æ•°å®‰æ’ä¸€ä¸ªä»»åŠ¡ã€‚</p>
<p>è¿™ä¸ªä»»åŠ¡å¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„ï¼š<code>ThreadPool</code>å®Œå…¨ä¸å…³å¿ƒå…¶çº¿ç¨‹éœ€è¦æ‰§è¡Œä»€ä¹ˆç±»å‹çš„å·¥ä½œã€‚</p>
<p>é€šè¿‡<code>Command</code>åŸºç±»ï¼Œå®ƒä¸å®é™…è°ƒåº¦çš„ä»»åŠ¡ç±»å‹å®Œå…¨è§£è€¦ã€‚</p>
<p>åªéœ€ä»<code>Command</code>æ´¾ç”Ÿï¼Œå°±å¯ä»¥åˆ¶å®šä»»æ„ä»»åŠ¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">FormattingCommand</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Command</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> <span class="cm">/* å®ç°ç£ç›˜æ ¼å¼åŒ– */</span> <span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PrintCommand</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Command</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> <span class="cm">/* å®ç°æ‰“å°ä»»åŠ¡ */</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ›å»ºä¸€ä¸ªåˆå§‹æœ‰ä¸¤ä¸ªå·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹æ±  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">ThreadPool</span> <span class="n">threadpool</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// å®‰æ’ä¸¤ä¸ªå¹¶å‘ä»»åŠ¡ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">threadpool</span><span class="p">.</span><span class="n">schedule</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">FormattingCommand</span><span class="o">&gt;</span><span class="p">(</span><span class="cm">/* ä¸€äº›å‚æ•° */</span><span class="p">));</span> 
</span></span><span class="line"><span class="cl">    <span class="n">threadpool</span><span class="p">.</span><span class="n">schedule</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">PrintCommand</span><span class="o">&gt;</span><span class="p">(</span><span class="cm">/* ä¸€äº›å‚æ•° */</span><span class="p">));</span> 
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// ç­‰å¾…çº¿ç¨‹æ± å®Œæˆæ‰€æœ‰å‘½ä»¤ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">threadpool</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¾‹å¦‚ï¼Œ<code>FormattingCommand</code>ä»»åŠ¡ä¼šè·å–å¿…è¦çš„ä¿¡æ¯ï¼Œé€šè¿‡æ“ä½œç³»ç»Ÿè§¦å‘ç£ç›˜æ ¼å¼åŒ–ã€‚</p>
<p>å¦ä¸€ç§æƒ…å†µæ˜¯<code>PrintCommand</code>ï¼Œå®ƒæ¥æ”¶æ‰€æœ‰æ•°æ®ä»¥è§¦å‘æ‰“å°ä½œä¸šã€‚</p>
<p>åœ¨è¿™ä¸ªçº¿ç¨‹æ± ç¤ºä¾‹ä¸­ï¼Œä½ ä¹Ÿèƒ½å¤Ÿè¯†åˆ«å‡º<strong>å‘½ä»¤è®¾è®¡æ¨¡å¼</strong>çš„æ•ˆæœï¼šä¸åŒç±»å‹çš„ä»»åŠ¡è¢«è¯†åˆ«ä¸ºå˜åŒ–ç‚¹ï¼Œå¹¶è¢«æå–å‡ºæ¥ï¼ˆè¿™ä¹Ÿéµå¾ªäº†å•ä¸€èŒè´£åŸåˆ™ï¼‰ï¼Œè¿™ä½¿ä½ å¯ä»¥å®ç°ä¸åŒç±»å‹çš„ä»»åŠ¡è€Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç ï¼ˆç¬¦åˆå¼€é—­åŸåˆ™ï¼‰ã€‚</p>
<p>å½“ç„¶ï¼Œæ ‡å‡†åº“ä¸­ä¹Ÿæœ‰ä¸€äº›ä¾‹å­å±•ç¤ºäº†å‘½ä»¤è®¾è®¡æ¨¡å¼çš„åº”ç”¨ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨<code>std::for_each()</code>ç®—æ³•ä¸­å¯ä»¥çœ‹åˆ°å‘½ä»¤è®¾è®¡æ¨¡å¼çš„å®é™…åº”ç”¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="n">std</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">InputIt</span><span class="p">,</span> <span class="k">typename</span> <span class="n">UnaryFunction</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">constexpr</span> <span class="n">UnaryFunction</span> <span class="n">for_each</span><span class="p">(</span><span class="n">InputIt</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIt</span> <span class="n">last</span><span class="p">,</span> <span class="n">UnaryFunction</span> <span class="n">f</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c1">// namespace std 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç¬¬ä¸‰ä¸ªå‚æ•°</strong>æŒ‡å®šäº†ç®—æ³•åº”å¯¹æ‰€æœ‰ç»™å®šå…ƒç´ æ‰§è¡Œä»€ä¹ˆä»»åŠ¡ã€‚è¿™ä¸ªä»»åŠ¡å¯ä»¥æ˜¯ä»»ä½•æ“ä½œï¼Œä»æ“ä½œå…ƒç´ åˆ°æ‰“å°å®ƒä»¬ï¼Œå¯ä»¥é€šè¿‡ç®€å•çš„å‡½æ•°æŒ‡é’ˆæˆ–å¼ºå¤§çš„lambdaè¡¨è¾¾å¼æŒ‡å®šï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">multBy10</span><span class="p">(</span><span class="kt">int</span><span class="o">&amp;</span> <span class="n">i</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">*=</span> <span class="mi">10</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// å°†æ‰€æœ‰æ•´æ•°ä¹˜ä»¥10 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">for_each</span><span class="p">(</span><span class="n">begin</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">multBy10</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// æ‰“å°æ‰€æœ‰æ•´æ•° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">for_each</span><span class="p">(</span><span class="n">begin</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="p">[](</span><span class="kt">int</span><span class="o">&amp;</span> <span class="n">i</span><span class="p">){</span> 
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">});</span> 
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>std::for_each</code>çš„ç¬¬ä¸€ä¸ªè°ƒç”¨å°†å‘é‡ä¸­çš„æ¯ä¸ªæ•´æ•°ä¹˜ä»¥10ï¼Œç¬¬äºŒä¸ªè°ƒç”¨åˆ™æ‰“å°è¿™äº›æ•´æ•°ã€‚é€šè¿‡ä½¿ç”¨ä¸åŒçš„å‡½æ•°æˆ–lambdaè¡¨è¾¾å¼ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œä½ å¯ä»¥è½»æ¾åœ°æ”¹å˜<code>std::for_each</code>çš„è¡Œä¸ºï¼Œä»è€Œå®ç°é«˜åº¦çµæ´»çš„æ“ä½œã€‚è¿™ç§çµæ´»æ€§æ­£æ˜¯å‘½ä»¤è®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒä¼˜åŠ¿ä¹‹ä¸€ã€‚</p>
<p><strong>å‘½ä»¤è®¾è®¡æ¨¡å¼ä¸ç­–ç•¥è®¾è®¡æ¨¡å¼çš„å¯¹æ¯”</strong></p>
<p>â€œç­‰ä¸€ä¸‹ï¼â€ä½ å¯èƒ½ä¼šå–Šé“ï¼Œâ€œä½ ä¸æ˜¯åˆšåˆšè§£é‡Šè¿‡æ ‡å‡†åº“ç®—æ³•æ˜¯é€šè¿‡ç­–ç•¥è®¾è®¡æ¨¡å¼å®ç°çš„å—ï¼Ÿè¿™ä¸æ˜¯å®Œå…¨ä¸ä¹‹å‰çš„é™ˆè¿°çŸ›ç›¾å—ï¼Ÿâ€ æ˜¯çš„ï¼Œä½ æ˜¯å¯¹çš„ã€‚å°±åœ¨å‡ é¡µä¹‹å‰ï¼Œæˆ‘ç¡®å®è§£é‡Šäº†<code>std::partition()</code>å’Œ<code>std::sort()</code>ç®—æ³•æ˜¯é€šè¿‡ç­–ç•¥è®¾è®¡æ¨¡å¼å®ç°çš„ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘æ‰¿è®¤ç°åœ¨çœ‹èµ·æ¥åƒæ˜¯è‡ªç›¸çŸ›ç›¾ã€‚ç„¶è€Œï¼Œæˆ‘æ²¡æœ‰å£°ç§°æ‰€æœ‰ç®—æ³•éƒ½åŸºäºç­–ç•¥æ¨¡å¼ã€‚è®©æˆ‘è§£é‡Šä¸€ä¸‹ã€‚</p>
<p>ä»ç»“æ„ä¸Šçœ‹ï¼Œ<strong>ç­–ç•¥è®¾è®¡æ¨¡å¼</strong>å’Œ<strong>å‘½ä»¤è®¾è®¡æ¨¡å¼</strong>æ˜¯ç›¸åŒçš„ï¼šæ— è®ºæ˜¯ä½¿ç”¨åŠ¨æ€å¤šæ€è¿˜æ˜¯é™æ€å¤šæ€ã€‚</p>
<p>ä»å®ç°è§’åº¦æ¥çœ‹ï¼Œ<strong>ç­–ç•¥</strong>å’Œ<strong>å‘½ä»¤</strong>ä¹‹é—´æ²¡æœ‰åŒºåˆ«ã€‚ä¸¤è€…çš„å·®å¼‚å®Œå…¨åœ¨äºå®ƒä»¬çš„è®¾è®¡æ„å›¾ã€‚</p>
<p><strong>ç­–ç•¥è®¾è®¡æ¨¡å¼</strong>æŒ‡å®šæŸä»¶äº‹åº”è¯¥å¦‚ä½•å®Œæˆï¼Œè€Œ<strong>å‘½ä»¤è®¾è®¡æ¨¡å¼</strong>åˆ™æŒ‡å®šåº”è¯¥å®Œæˆä»€ä¹ˆã€‚</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘<code>std::partition()</code>å’Œ<code>std::for_each()</code>ç®—æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="n">std</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">ForwardIt</span><span class="p">,</span> <span class="k">typename</span> <span class="n">UnaryPredicate</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">constexpr</span> <span class="n">ForwardIt</span> <span class="n">partition</span><span class="p">(</span><span class="n">ForwardIt</span> <span class="n">first</span><span class="p">,</span> <span class="n">ForwardIt</span> <span class="n">last</span><span class="p">,</span> <span class="n">UnaryPredicate</span> <span class="n">p</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">InputIt</span><span class="p">,</span> <span class="k">typename</span> <span class="n">UnaryFunction</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">constexpr</span> <span class="n">UnaryFunction</span> <span class="n">for_each</span><span class="p">(</span><span class="n">InputIt</span> <span class="n">first</span><span class="p">,</span> <span class="n">InputIt</span> <span class="n">last</span><span class="p">,</span> <span class="n">UnaryFunction</span> <span class="n">f</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="c1">// namespace std 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨<code>std::partition()</code>ç®—æ³•ä¸­ï¼Œä½ åªèƒ½æ§åˆ¶å¦‚ä½•é€‰æ‹©å…ƒç´ ï¼Œè€Œåœ¨<code>std::for_each()</code>ç®—æ³•ä¸­ï¼Œä½ å¯ä»¥æ§åˆ¶å¯¹ç»™å®šèŒƒå›´å†…æ¯ä¸ªå…ƒç´ åº”ç”¨ä»€ä¹ˆæ“ä½œã€‚</p>
<p>åœ¨å½¢çŠ¶ç¤ºä¾‹ä¸­ï¼Œä½ åªèƒ½æŒ‡å®šå¦‚ä½•ç»˜åˆ¶æŸç§å½¢çŠ¶ï¼Œè€Œåœ¨çº¿ç¨‹æ± ç¤ºä¾‹ä¸­ï¼Œä½ å®Œå…¨è´Ÿè´£å†³å®šå®‰æ’ä»€ä¹ˆæ“ä½œã€‚</p>
<p>æ­¤å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªæŒ‡æ ‡å¯ä»¥å¸®åŠ©ä½ åŒºåˆ†è¿™ä¸¤ç§è®¾è®¡æ¨¡å¼çš„åº”ç”¨ï¼š</p>
<p><strong>ä¾èµ–æ³¨å…¥</strong>ï¼šå¦‚æœä½ æœ‰ä¸€ä¸ªå¯¹è±¡å¹¶é€šè¿‡åŠ¨ä½œï¼ˆæ‰§è¡Œä¾èµ–æ³¨å…¥ï¼‰é…ç½®å®ƒï¼Œé‚£ä¹ˆä½ å¾ˆå¯èƒ½åœ¨ä½¿ç”¨ç­–ç•¥è®¾è®¡æ¨¡å¼ã€‚å¦‚æœä½ ä¸ä½¿ç”¨åŠ¨ä½œæ¥é…ç½®å¯¹è±¡ï¼Œè€Œæ˜¯ç›´æ¥æ‰§è¡Œè¯¥åŠ¨ä½œï¼Œé‚£ä¹ˆä½ å¾ˆå¯èƒ½åœ¨ä½¿ç”¨<strong>å‘½ä»¤è®¾è®¡æ¨¡å¼</strong>ã€‚åœ¨æˆ‘ä»¬çš„è®¡ç®—å™¨ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä¼ é€’åŠ¨ä½œæ¥é…ç½®è®¡ç®—å™¨ï¼Œè€Œæ˜¯ç«‹å³è¯„ä¼°äº†è¯¥åŠ¨ä½œã€‚å› æ­¤ï¼Œæˆ‘ä»¬åŸºäºå‘½ä»¤æ¨¡å¼æ„å»ºã€‚</p>
<p>å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç­–ç•¥æ¨¡å¼å®ç°è®¡ç®—å™¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;CalculatorStrategy.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CalculatorStrategy</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"> <span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">CalculatorStrategy</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">int</span> <span class="nf">compute</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Calculator.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;CalculatorStrategy.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Calculator</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"> <span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">set</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">CalculatorStrategy</span><span class="o">&gt;</span> <span class="n">operation</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">compute</span><span class="p">(</span><span class="kt">int</span> <span class="n">value</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"> <span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">current_</span><span class="p">{};</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">CalculatorStrategy</span><span class="o">&gt;</span> <span class="n">operation_</span><span class="p">;</span>  <span class="c1">// éœ€è¦ä¸€ä¸ªé»˜è®¤å€¼ï¼ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Calculator.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Calculator.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Calculator</span><span class="o">::</span><span class="n">set</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">CalculatorStrategy</span><span class="o">&gt;</span> <span class="n">operation</span><span class="p">)</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">operation_</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">operation</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Calculator</span><span class="o">::</span><span class="n">compute</span><span class="p">(</span><span class="kt">int</span> <span class="n">value</span><span class="p">)</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">current_</span> <span class="o">=</span> <span class="n">operation_</span><span class="o">-&gt;</span><span class="n">compute</span><span class="p">(</span><span class="n">value</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™ä¸ªè®¡ç®—å™¨å®ç°ä¸­ï¼Œç­–ç•¥æ˜¯é€šè¿‡<code>set()</code>å‡½æ•°æ³¨å…¥çš„ã€‚<code>compute()</code>å‡½æ•°ä½¿ç”¨æ³¨å…¥çš„ç­–ç•¥è¿›è¡Œè®¡ç®—ã€‚ä½†æ˜¯è¯·æ³¨æ„ï¼Œè¿™ç§æ–¹æ³•ä½¿å¾—å®ç°åˆç†çš„æ’¤é”€æœºåˆ¶æ›´åŠ å›°éš¾ã€‚</p>
<p><strong>æ’¤é”€æ“ä½œ</strong>ï¼šå¦‚æœä½ çš„åŠ¨ä½œæä¾›äº†ä¸€ä¸ªæ’¤é”€æ“ä½œæ¥å›æ»šå®ƒæ‰€åšçš„å·¥ä½œï¼Œå¹¶å°è£…äº†æ‰§è¡Œæ’¤é”€æ‰€éœ€çš„ä¸€åˆ‡ï¼Œé‚£ä¹ˆä½ å¾ˆå¯èƒ½åœ¨å¤„ç†<strong>å‘½ä»¤è®¾è®¡æ¨¡å¼</strong>ã€‚</p>
<p>å¦‚æœä½ çš„åŠ¨ä½œæ²¡æœ‰æä¾›æ’¤é”€æ“ä½œï¼Œå› ä¸ºå®ƒä¸“æ³¨äºå¦‚ä½•å®ŒæˆæŸäº‹æˆ–ç¼ºä¹å›æ»šæ“ä½œçš„ä¿¡æ¯ï¼Œé‚£ä¹ˆä½ å¾ˆå¯èƒ½åœ¨å¤„ç†<strong>ç­–ç•¥è®¾è®¡æ¨¡å¼</strong>ã€‚</p>
<p>ç„¶è€Œï¼Œæˆ‘è¦æ˜ç¡®æŒ‡å‡ºçš„æ˜¯ï¼Œç¼ºå°‘æ’¤é”€æ“ä½œå¹¶ä¸èƒ½ä½œä¸ºç­–ç•¥æ¨¡å¼çš„ç»“è®ºæ€§è¯æ®ã€‚å¦‚æœæ„å›¾æ˜¯æŒ‡å®šåº”è¯¥åšä»€ä¹ˆï¼Œå³ä½¿æ²¡æœ‰æ’¤é”€æ“ä½œï¼Œä»ç„¶å¯èƒ½æ˜¯å‘½ä»¤æ¨¡å¼çš„ä¸€ç§å®ç°ã€‚</p>
<p>ä¾‹å¦‚ï¼Œ<code>std::for_each()</code>ç®—æ³•ä»ç„¶æœŸæœ›ä¸€ä¸ªå‘½ä»¤ï¼Œå°½ç®¡ä¸éœ€è¦æ’¤é”€æ“ä½œã€‚</p>
<p>æ’¤é”€æ“ä½œåº”è¢«è§†ä¸ºå‘½ä»¤è®¾è®¡æ¨¡å¼çš„ä¸€ä¸ªå¯é€‰ç‰¹æ€§ï¼Œè€Œä¸æ˜¯å®šä¹‰æ€§çš„ç‰¹å¾ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œæ’¤é”€æ“ä½œå¹¶ä¸æ˜¯å‘½ä»¤è®¾è®¡æ¨¡å¼çš„ä¼˜åŠ¿ï¼Œè€Œæ˜¯ä¸€ç§çº¯ç²¹çš„å¿…è¦æ€§ï¼šå¦‚æœä¸€ä¸ªåŠ¨ä½œæœ‰å®Œå…¨è‡ªç”±åšä»»ä½•å®ƒæƒ³åšçš„äº‹æƒ…ï¼Œé‚£ä¹ˆåªæœ‰è¿™ä¸ªåŠ¨ä½œæœ¬èº«æ‰èƒ½å›æ»šæ“ä½œï¼ˆå½“ç„¶ï¼Œå‡è®¾ä½ ä¸å¸Œæœ›ä¸ºæ¯æ¬¡è°ƒç”¨å‘½ä»¤å­˜å‚¨å®Œæ•´çš„å‰¯æœ¬ï¼‰ã€‚</p>
<p>æˆ‘æ‰¿è®¤è¿™ä¸¤ä¸ªæ¨¡å¼ä¹‹é—´æ²¡æœ‰æ˜ç¡®çš„åˆ†ç•Œçº¿ï¼Œè€Œä¸”å®ƒä»¬ä¹‹é—´å­˜åœ¨ç°è‰²åœ°å¸¦ã€‚ç„¶è€Œï¼Œäº‰è®ºæŸäº‹ç‰©æ˜¯å‘½ä»¤è¿˜æ˜¯ç­–ç•¥å¹¶æ²¡æœ‰æ„ä¹‰ï¼Œç”šè‡³å¯èƒ½å¤±å»ä¸€äº›æœ‹å‹ã€‚æ›´é‡è¦çš„æ˜¯åˆ©ç”¨å®ƒä»¬æå–å®ç°ç»†èŠ‚å’Œåˆ†ç¦»å…³æ³¨ç‚¹çš„èƒ½åŠ›ã€‚ä¸¤ç§è®¾è®¡æ¨¡å¼éƒ½å¯ä»¥å¸®åŠ©ä½ éš”ç¦»å˜åŒ–å’Œæ‰©å±•ï¼Œä»è€Œéµå¾ª<strong>å•ä¸€èŒè´£åŸåˆ™</strong>ï¼ˆSRPï¼‰å’Œ<strong>å¼€é—­åŸåˆ™</strong>ï¼ˆOCPï¼‰ã€‚</p>
<p>æ¯•ç«Ÿï¼Œè¿™å¯èƒ½æ˜¯ä¸ºä»€ä¹ˆåœ¨C++æ ‡å‡†åº“ä¸­æœ‰å¦‚æ­¤å¤šè¿™ä¸¤ç§è®¾è®¡æ¨¡å¼çš„ä¾‹å­çš„åŸå› ã€‚</p>
<p><strong>åˆ†æå‘½ä»¤è®¾è®¡æ¨¡å¼çš„ä¸è¶³ä¹‹å¤„</strong></p>
<p><strong>å‘½ä»¤è®¾è®¡æ¨¡å¼</strong>çš„ä¼˜ç‚¹ç±»ä¼¼äº<strong>ç­–ç•¥è®¾è®¡æ¨¡å¼</strong>çš„ä¼˜ç‚¹ï¼š<strong>å‘½ä»¤æ¨¡å¼</strong>é€šè¿‡å¼•å…¥æŸç§æŠ½è±¡ï¼ˆä¾‹å¦‚åŸºç±»æˆ–æ¦‚å¿µï¼‰å¸®åŠ©ä½ è§£è€¦å…·ä½“ä»»åŠ¡çš„å®ç°ç»†èŠ‚ã€‚è¿™ç§æŠ½è±¡å…è®¸ä½ è½»æ¾æ·»åŠ æ–°ä»»åŠ¡ã€‚å› æ­¤ï¼Œå‘½ä»¤æ¨¡å¼åŒæ—¶æ»¡è¶³äº†<strong>SRP</strong>å’Œ<strong>OCP</strong>ã€‚</p>
<p>ç„¶è€Œï¼Œ<strong>å‘½ä»¤è®¾è®¡æ¨¡å¼</strong>ä¹Ÿæœ‰å…¶ç¼ºç‚¹ã€‚ä¸ç­–ç•¥è®¾è®¡æ¨¡å¼ç›¸æ¯”ï¼Œå…¶ç¼ºç‚¹åˆ—è¡¨ç›¸å½“çŸ­ã€‚å”¯ä¸€çœŸæ­£çš„ç¼ºç‚¹æ˜¯ç”±äºé¢å¤–çš„é—´æ¥å±‚å¯¼è‡´çš„è¿è¡Œæ—¶æ€§èƒ½å¼€é”€ï¼Œå°¤å…¶æ˜¯åœ¨é€šè¿‡åŸºç±»å®ç°å‘½ä»¤æ¨¡å¼æ—¶ï¼ˆç»å…¸çš„GoFé£æ ¼ï¼‰ã€‚å†æ¬¡å¼ºè°ƒï¼Œç”±ä½ å†³å®šå¢åŠ çš„çµæ´»æ€§æ˜¯å¦è¶…è¿‡äº†è¿è¡Œæ—¶æ€§èƒ½çš„æŸå¤±ã€‚</p>
<p>æ€»ä¹‹ï¼Œå°±åƒç­–ç•¥è®¾è®¡æ¨¡å¼ä¸€æ ·ï¼Œå‘½ä»¤è®¾è®¡æ¨¡å¼æ˜¯è®¾è®¡æ¨¡å¼ç›®å½•ä¸­æœ€åŸºæœ¬å’Œæœ€æœ‰ç”¨çš„æ¨¡å¼ä¹‹ä¸€ã€‚ä½ ä¼šåœ¨è®¸å¤šä¸åŒçš„æƒ…å†µä¸‹é‡åˆ°å‘½ä»¤æ¨¡å¼çš„å®ç°ï¼Œæ— è®ºæ˜¯é™æ€çš„è¿˜æ˜¯åŠ¨æ€çš„ã€‚å› æ­¤ï¼Œç†è§£å‘½ä»¤æ¨¡å¼çš„æ„å›¾ã€ä¼˜ç‚¹å’Œç¼ºç‚¹å°†åœ¨è®¸å¤šæ—¶å€™è¯æ˜æ˜¯æœ‰ç”¨çš„ã€‚</p>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>åº”ç”¨Commandè®¾è®¡æ¨¡å¼ï¼Œç›®çš„æ˜¯æŠ½è±¡å’Œå°è£…ä¸€ä¸ªï¼ˆå¯èƒ½æ˜¯å¯æ’¤é”€çš„ï¼‰æ“ä½œã€‚</li>
<li>è¯·æ³¨æ„ï¼Œå‘½ä»¤å’Œç­–ç•¥è®¾è®¡æ¨¡å¼ä¹‹é—´çš„ç•Œé™æ˜¯å¯å˜çš„ã€‚</li>
<li>å¯¹åŠ¨æ€å’Œé™æ€åº”ç”¨ç¨‹åºéƒ½ä½¿ç”¨Commandã€‚</li>
</ul>
<h3 id="å‡†åˆ™22ä¼˜å…ˆä½¿ç”¨å€¼è¯­ä¹‰è€Œéå¼•ç”¨è¯­ä¹‰">å‡†åˆ™22ï¼šä¼˜å…ˆä½¿ç”¨å€¼è¯­ä¹‰è€Œéå¼•ç”¨è¯­ä¹‰
</h3><p>åœ¨â€œ<strong>å‡†åˆ™19ï¼šä½¿ç”¨ç­–ç•¥æ¨¡å¼éš”ç¦»å¦‚ä½•å®Œæˆä»»åŠ¡</strong>â€å’Œâ€œ<strong>å‡†åˆ™21ï¼šä½¿ç”¨å‘½ä»¤æ¨¡å¼éš”ç¦»åº”è¯¥å®Œæˆä»€ä¹ˆä»»åŠ¡</strong>â€ä¸­ï¼Œæˆ‘åˆ†åˆ«å‘ä½ ä»‹ç»äº†<strong>ç­–ç•¥è®¾è®¡æ¨¡å¼</strong>å’Œ<strong>å‘½ä»¤è®¾è®¡æ¨¡å¼</strong>ã€‚</p>
<p>åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œç¤ºä¾‹éƒ½æ˜¯åŸºäºç»å…¸çš„GoFé£æ ¼æ„å»ºçš„ï¼šå®ƒä»¬é€šè¿‡ç»§æ‰¿å±‚æ¬¡ç»“æ„ä½¿ç”¨åŠ¨æ€å¤šæ€æ€§ã€‚è¿™ç§ç»å…¸é¢å‘å¯¹è±¡çš„é£æ ¼ç¼ºä¹ç°ä»£æ„Ÿï¼Œå¯ä»¥æƒ³è±¡ä½ ç°åœ¨å¯èƒ½å·²ç»å› ä¸ºå’¬æŒ‡ç”²è€Œæƒ¹æ¼äº†ä½ çš„ç¾ç”²å¸ˆã€‚</p>
<p>ä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œéš¾é“æ²¡æœ‰å¦ä¸€ç§æ›´å¥½çš„æ–¹å¼æ¥å®ç°ç­–ç•¥å’Œå‘½ä»¤æ¨¡å¼å—ï¼Ÿä¸€ç§æ›´â€˜ç°ä»£â€™çš„æ–¹æ³•ï¼Ÿâ€ æ˜¯çš„ï¼Œæ”¾å¿ƒï¼›ç¡®å®æœ‰ã€‚è¿™ç§æ–¹æ³•å¯¹äºæˆ‘ä»¬ç°åœ¨ç§°ä¹‹ä¸º <strong>ç°ä»£C++</strong> çš„å“²å­¦éå¸¸é‡è¦ï¼Œä»¥è‡³äºå®ƒå€¼å¾—ä¸€ä¸ªå•ç‹¬çš„æŒ‡å—æ¥è§£é‡Šå…¶ä¼˜ç‚¹ã€‚</p>
<p>æˆ‘ç›¸ä¿¡ä½ çš„ç¾ç”²å¸ˆä¼šç†è§£è¿™æ¬¡å°æ’æ›²çš„åŸå› ã€‚</p>
<p><strong>GoFé£æ ¼çš„ä¸è¶³ï¼šå¼•ç”¨è¯­ä¹‰</strong></p>
<p>ç”±å››äººç»„ï¼ˆGang of Fourï¼‰æ”¶é›†å¹¶åœ¨ä»–ä»¬çš„ä¹¦ä¸­ä»‹ç»çš„<strong>è®¾è®¡æ¨¡å¼</strong>æ˜¯ä½œä¸º<strong>é¢å‘å¯¹è±¡è®¾è®¡æ¨¡å¼</strong>å¼•å…¥çš„ã€‚</p>
<p>ä»–ä»¬ä¹¦ä¸­æè¿°çš„<strong>23ç§è®¾è®¡æ¨¡å¼</strong>å‡ ä¹éƒ½ä½¿ç”¨è‡³å°‘ä¸€ä¸ª<strong>ç»§æ‰¿å±‚æ¬¡ç»“æ„</strong>ï¼Œå› æ­¤ç‰¢ç‰¢æ‰æ ¹äº<strong>é¢å‘å¯¹è±¡ç¼–ç¨‹é¢†åŸŸ</strong>ã€‚</p>
<p><strong>æ¨¡æ¿</strong>ä½œä¸ºæ˜¾è€Œæ˜“è§çš„ç¬¬äºŒé€‰æ‹©ï¼Œåœ¨GoFçš„ä¹¦ä¸­å¹¶æ²¡æœ‰æ‰®æ¼”ä»»ä½•è§’è‰²ï¼Œè¿™ç§<strong>çº¯ç²¹çš„é¢å‘å¯¹è±¡é£æ ¼</strong>å°±æ˜¯æˆ‘æ‰€ç§°çš„<strong>GoFé£æ ¼</strong>ã€‚</p>
<p>ä»ä»Šå¤©çš„è§†è§’æ¥çœ‹ï¼Œè¿™ç§é£æ ¼å¯èƒ½æ˜¾å¾—è€æ—§ã€è¿‡æ—¶ï¼Œä½†æˆ‘ä»¬éœ€è¦è®°ä½è¿™æœ¬ä¹¦æ˜¯åœ¨1994å¹´10æœˆå‘å¸ƒçš„ã€‚é‚£æ—¶ï¼Œæ¨¡æ¿å¯èƒ½å·²ç»æ˜¯è¯­è¨€çš„ä¸€éƒ¨åˆ†ï¼ˆè‡³å°‘åœ¨ã€Šæ³¨é‡Šå‚è€ƒæ‰‹å†Œã€‹(ARM)ä¸­æœ‰æ­£å¼æè¿°ï¼‰ï¼Œä½†æˆ‘ä»¬è¿˜æ²¡æœ‰ä¸æ¨¡æ¿ç›¸å…³çš„æƒ¯ç”¨æ³•ï¼ŒC++ä»ç„¶æ™®éè¢«è§†ä¸ºä¸€ç§é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ã€‚å› æ­¤ï¼Œä½¿ç”¨C++çš„å¸¸è§æ–¹å¼æ˜¯ä¸»è¦ä½¿ç”¨ç»§æ‰¿ã€‚</p>
<p>ä»Šå¤©æˆ‘ä»¬çŸ¥é“ï¼Œ<strong>GoFé£æ ¼å­˜åœ¨ä¸€äº›ç¼ºç‚¹</strong>ã€‚å…¶ä¸­æœ€é‡è¦ä¸”é€šå¸¸è¢«æåˆ°æœ€å¤šçš„æ˜¯<strong>æ€§èƒ½é—®é¢˜</strong>ï¼š</p>
<ul>
<li>è™šå‡½æ•°å¢åŠ äº†è¿è¡Œæ—¶å¼€é”€ï¼Œå¹¶å‡å°‘äº†ç¼–è¯‘å™¨ä¼˜åŒ–çš„æœºä¼šã€‚</li>
<li>å°å‹å¤šæ€å¯¹è±¡çš„å¤šæ¬¡åˆ†é…æ¶ˆè€—é¢å¤–çš„è¿è¡Œæ—¶é—´ï¼Œå¯¼è‡´å†…å­˜ç¢ç‰‡åŒ–ï¼Œå¹¶å¯¼è‡´ç¼“å­˜ä½¿ç”¨ä¸ä½³ã€‚</li>
<li>æ•°æ®çš„æ’åˆ—æ–¹å¼é€šå¸¸ä¸åˆ©äºæ•°æ®è®¿é—®æ–¹æ¡ˆã€‚</li>
</ul>
<p><strong>æ€§èƒ½</strong>ç¡®å®ä¸æ˜¯<strong>GoFé£æ ¼</strong>çš„å¼ºé¡¹ã€‚ä¸è¿›è¡Œå…¨é¢è®¨è®ºæ‰€æœ‰å¯èƒ½çš„GoFé£æ ¼çš„ä¸è¶³ä¹‹å¤„ï¼Œè®©æˆ‘ä»¬å…³æ³¨å¦ä¸€ä¸ªæˆ‘è®¤ä¸ºç‰¹åˆ«æœ‰è¶£çš„ç¼ºç‚¹ï¼š<strong>GoFé£æ ¼</strong>å±äºæˆ‘ä»¬ä»Šå¤©æ‰€è¯´çš„<strong>å¼•ç”¨è¯­ä¹‰</strong>ï¼ˆæœ‰æ—¶ä¹Ÿç§°ä¸ºæŒ‡é’ˆè¯­ä¹‰ï¼‰ã€‚</p>
<p>è¿™ç§é£æ ¼å› å…¶ä¸»è¦ä½¿ç”¨<strong>æŒ‡é’ˆ</strong>å’Œ<strong>å¼•ç”¨</strong>æ¥å‘½åã€‚</p>
<p>ä¸ºäº†å±•ç¤ºæœ¯è¯­<strong>å¼•ç”¨è¯­ä¹‰</strong>çš„å«ä¹‰åŠå…¶é€šå¸¸å¸¦æœ‰çš„è´Ÿé¢å«ä¹‰ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä»¥ä¸‹ä½¿ç”¨C++20 <code>std::span</code> ç±»æ¨¡æ¿çš„ä»£ç ç¤ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;span&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">span</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">s</span><span class="p">)</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; (&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="nl">i</span> <span class="p">:</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39; &#39;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; )</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">};</span>   
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="k">const</span> <span class="n">w</span><span class="p">{</span> <span class="n">v</span> <span class="p">};</span>   
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">span</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="k">const</span> <span class="n">s</span><span class="p">{</span> <span class="n">v</span> <span class="p">};</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">w</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99</span><span class="p">;</span>  <span class="c1">// ç¼–è¯‘é”™è¯¯ï¼   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99</span><span class="p">;</span>  <span class="c1">// æˆåŠŸï¼  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// è¾“å‡º ( 1 2 99 4 ); 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">print</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">v</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span> <span class="p">};</span>   
</span></span><span class="line"><span class="cl">    <span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99</span><span class="p">;</span>  <span class="c1">// æˆåŠŸï¼   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// è¾“å‡º ? 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">print</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>print()</code> å‡½æ•°å±•ç¤ºäº† <code>std::span</code> çš„ç”¨é€”ã€‚<code>std::span</code> ç±»æ¨¡æ¿è¡¨ç¤ºæ•°ç»„çš„æŠ½è±¡ã€‚</p>
<p><code>print()</code> å‡½æ•°å¯ä»¥ä¸ä»»ä½•ç±»å‹çš„æ•°ç»„ï¼ˆå†…ç½®æ•°ç»„ã€<code>std::array</code>ã€<code>std::vector</code> ç­‰ï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œ<br/>è€Œä¸è€¦åˆåˆ°ä»»ä½•ç‰¹å®šç±»å‹çš„æ•°ç»„ã€‚</p>
<p>åœ¨å…·æœ‰åŠ¨æ€èŒƒå›´çš„ <code>std::span</code> ç¤ºä¾‹ä¸­ï¼ˆæ²¡æœ‰ç¬¬äºŒä¸ªæ¨¡æ¿å‚æ•°è¡¨ç¤ºæ•°ç»„å¤§å°ï¼‰ï¼Œå…¸å‹çš„ <code>std::span</code> å®ç°åŒ…å«ä¸¤ä¸ªæ•°æ®æˆå‘˜ï¼š<strong>æŒ‡å‘æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ å’Œ æ•°ç»„çš„å¤§å°</strong>ã€‚</p>
<p>å› æ­¤ï¼Œ<code>std::span</code> å¾ˆå®¹æ˜“å¤åˆ¶ï¼Œé€šå¸¸æŒ‰å€¼ä¼ é€’ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œ<code>print()</code> åªæ˜¯éå† <code>std::span</code> çš„å…ƒç´ ï¼ˆåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯æ•´æ•°ï¼‰å¹¶é€šè¿‡ <code>std::cout</code> æ‰“å°å®ƒä»¬ã€‚</p>
<p>åœ¨ <code>main()</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»º <code>std::vector&lt;int&gt;</code> v å¹¶ç«‹å³å¡«å……æ•´æ•° 1ã€2ã€3 å’Œ 4ã€‚<br/>ç„¶åæˆ‘ä»¬åˆ›å»ºå¦ä¸€ä¸ª <code>std::vector</code> <strong>w</strong> ä½œä¸º <strong>v</strong> çš„å‰¯æœ¬ å’Œ <code>std::span</code> <strong>s</strong>ã€‚</p>
<p><strong>w</strong> å’Œ <strong>s</strong> éƒ½è¢«å£°æ˜ä¸º <code>const</code>ï¼Œç´§æ¥ç€ï¼Œæˆ‘ä»¬å°è¯•ä¿®æ”¹ <strong>w</strong> å’Œ <strong>s</strong> åœ¨ç´¢å¼• 2 å¤„çš„å€¼ã€‚<br/>å°è¯•æ›´æ”¹ w å¤±è´¥å¹¶å‡ºç°ç¼–è¯‘é”™è¯¯ï¼šw è¢«å£°æ˜ä¸º <code>const</code>ï¼Œå› æ­¤æ— æ³•æ›´æ”¹åŒ…å«çš„å…ƒç´ ã€‚<br/>ç„¶è€Œï¼Œå°è¯•æ›´æ”¹ s åˆ™æˆåŠŸã€‚å°½ç®¡ s è¢«å£°æ˜ä¸º <code>const</code>ï¼Œä¹Ÿä¸ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ã€‚</p>
<p>åŸå› æ˜¯ï¼š <strong>s</strong> ä¸æ˜¯ <strong>v</strong> çš„å‰¯æœ¬ï¼Œä¸ä»£è¡¨ä¸€ä¸ªå€¼ã€‚ç›¸åï¼Œå®ƒä»£è¡¨å¯¹ v çš„å¼•ç”¨ã€‚<br/>å®ƒå®é™…ä¸Šå……å½“æŒ‡å‘ v ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆã€‚å› æ­¤ï¼Œ<code>const</code> é™å®šç¬¦åœ¨è¯­ä¹‰ä¸Šç­‰åŒäºå£°æ˜æŒ‡é’ˆ <code>const</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">span</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="k">const</span> <span class="n">s</span><span class="p">{</span> <span class="n">v</span> <span class="p">};</span>  <span class="c1">// s ä½œä¸ºæŒ‡å‘ v ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span><span class="o">*</span> <span class="k">const</span> <span class="n">ptr</span><span class="p">{</span> <span class="n">v</span><span class="p">.</span><span class="n">data</span><span class="p">()</span> <span class="p">};</span>   <span class="c1">// ç­‰æ•ˆè¯­ä¹‰
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è™½ç„¶æŒ‡é’ˆ <code>ptr</code> ä¸èƒ½è¢«æ”¹å˜ï¼Œå¹¶ä¸”åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…å°†å§‹ç»ˆæŒ‡å‘ v çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä½†å¼•ç”¨çš„æ•´æ•°å¯ä»¥è½»æ¾ä¿®æ”¹ã€‚<br/>è¦é˜²æ­¢å¯¹æ•´æ•°è¿›è¡Œèµ‹å€¼ï¼Œéœ€è¦ä¸º <code>int</code> æ·»åŠ é¢å¤–çš„ <code>const</code> é™å®šç¬¦ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">span</span><span class="o">&lt;</span><span class="kt">int</span> <span class="k">const</span><span class="o">&gt;</span> <span class="k">const</span> <span class="n">s</span><span class="p">{</span><span class="n">v</span><span class="p">};</span>   <span class="c1">// s è¡¨ç¤ºæŒ‡å‘å¸¸é‡æ•´æ•°çš„å¸¸é‡æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="k">const</span><span class="o">*</span> <span class="k">const</span> <span class="n">ptr</span><span class="p">{</span> <span class="n">v</span><span class="p">.</span><span class="n">data</span><span class="p">()</span> <span class="p">};</span>  <span class="c1">// ç­‰æ•ˆè¯­ä¹‰
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç”±äºæŒ‡é’ˆå’Œ <code>std::span</code> çš„è¯­ä¹‰æ˜¯ç­‰ä»·çš„ï¼Œ<code>std::span</code> æ˜¾ç„¶å±äºå¼•ç”¨è¯­ä¹‰çš„èŒƒç•´ã€‚è¿™å¸¦æ¥äº†ä¸€äº›é¢å¤–çš„é£é™©ï¼Œå¦‚ <code>main()</code> å‡½æ•°å‰©ä½™éƒ¨åˆ†æ‰€ç¤ºã€‚ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬æ‰“å° s å¼•ç”¨çš„å…ƒç´ ã€‚æ³¨æ„ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä¼ é€’å‘é‡ vï¼Œå› ä¸º <code>std::span</code> æä¾›äº†å¿…è¦çš„è½¬æ¢æ„é€ å‡½æ•°æ¥æ¥å— <code>std::vector</code>ã€‚<code>print()</code> å‡½æ•°å°†æ­£ç¡®è¾“å‡ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="p">(</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">99</span> <span class="mi">4</span> <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸ºæˆ‘ä»¬å¯ä»¥ï¼ˆå¹¶ä¸”ç°åœ¨æ•°å­— 1 åˆ° 4 å¯èƒ½å¬èµ·æ¥æœ‰ç‚¹æ— èŠï¼‰ï¼Œæˆ‘ä»¬ç°åœ¨å°†ä¸€ç»„æ–°æ•°å­—èµ‹ç»™å‘é‡ vã€‚è¯šç„¶ï¼Œé€‰æ‹© 5ã€6ã€7ã€8 å’Œ 9 æ—¢ä¸ç‰¹åˆ«æœ‰åˆ›æ„ä¹Ÿä¸æœ‰è¶£ï¼Œä½†å®ƒä¼šè¾¾åˆ°ç›®çš„ã€‚ç´§æ¥ç€ï¼Œæˆ‘ä»¬å†æ¬¡é€šè¿‡ s å†™å…¥ç¬¬äºŒä¸ªç´¢å¼•å¹¶å†æ¬¡æ‰“å° s å¼•ç”¨çš„å…ƒç´ ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬æœŸæœ›è¾“å‡ºæ˜¯ <code>( 5 6 99 8 9 )</code>ï¼Œä½†ä¸å¹¸çš„æ˜¯å¹¶éå¦‚æ­¤ã€‚æˆ‘ä»¬å¯èƒ½ä¼šå¾—åˆ°ä»¥ä¸‹è¾“å‡ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="p">(</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">99</span> <span class="mi">4</span> <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¹Ÿè®¸ä½ ä¼šå®Œå…¨éœ‡æƒŠï¼Œå¹¶å› æ­¤å¤šå‡ºå‡ æ ¹ç™½å‘ï¼Œä¹Ÿè®¸ä½ ä¼šæ„Ÿåˆ°æƒŠè®¶ï¼Œæˆ–è€…ä½ ä¼šå¿ƒçŸ¥è‚šæ˜åœ°å¾®ç¬‘å¹¶ç‚¹å¤´ï¼šæ˜¯çš„ï¼Œå½“ç„¶ï¼Œæœªå®šä¹‰è¡Œä¸ºï¼</p>
<p>å½“æˆ‘ä»¬å°†æ–°å€¼èµ‹ç»™ <code>std::vector</code> <strong>v</strong> æ—¶ï¼Œæˆ‘ä»¬ä¸ä»…æ”¹å˜äº†å€¼ï¼Œè¿˜æ”¹å˜äº†å‘é‡çš„å¤§å°ã€‚<br/>åŸæœ¬å­˜å‚¨å››ä¸ªå€¼çš„å‘é‡ç°åœ¨éœ€è¦å­˜å‚¨äº”ä¸ªå…ƒç´ ï¼Œå› æ­¤ï¼Œå‘é‡å¯èƒ½è¿›è¡Œäº†é‡æ–°åˆ†é…ï¼Œä»è€Œæ”¹å˜äº†å…¶ç¬¬ä¸€ä¸ªå…ƒç´ çš„åœ°å€ã€‚<br/>ä¸å¹¸çš„æ˜¯ï¼Œ<code>std::span</code> <strong>s</strong> æ²¡æœ‰æ”¶åˆ°é€šçŸ¥ï¼Œå¹¶ä¸”ä»ç„¶ç´§ç´§æŒæœ‰æ—§çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„åœ°å€ã€‚<br/>å› æ­¤ï¼Œå½“æˆ‘ä»¬å°è¯•é€šè¿‡ s å‘ v å†™å…¥æ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯å†™å…¥å½“å‰çš„ v æ•°ç»„ï¼Œè€Œæ˜¯å†™å…¥äº†ä¸€ä¸ªå·²ç»è¢«ä¸¢å¼ƒçš„å†…å­˜åŒºåŸŸï¼Œè¯¥åŒºåŸŸæ›¾ç»æ˜¯ v çš„å†…éƒ¨æ•°ç»„ã€‚è¿™æ˜¯å…¸å‹çš„æœªå®šä¹‰è¡Œä¸ºï¼Œä¹Ÿæ˜¯å¼•ç”¨è¯­ä¹‰çš„ç»å…¸é—®é¢˜ã€‚</p>
<p>â€œå˜¿ï¼Œä½ æ˜¯ä¸æ˜¯åœ¨è¯•å›¾è¯‹æ¯ <code>std::span</code>ï¼Ÿâ€ä½ é—®ã€‚ä¸ï¼Œæˆ‘å¹¶ä¸æ˜¯åœ¨æš—ç¤º <code>std::span</code> å’Œ <code>std::string_view</code> æ˜¯ä¸å¥½çš„ã€‚</p>
<p>ç›¸åï¼Œæˆ‘å®é™…ä¸Šéå¸¸å–œæ¬¢è¿™ä¸¤ä¸ªå·¥å…·ï¼Œå› ä¸ºå®ƒä»¬æä¾›äº†éå¸¸ç®€å•ä¸”å»‰ä»·çš„æŠ½è±¡ï¼Œåˆ†åˆ«ç”¨äºå„ç§æ•°ç»„å’Œå­—ç¬¦ä¸²ã€‚<br/>ç„¶è€Œï¼Œè¯·è®°ä½æ¯ä¸ªå·¥å…·éƒ½æœ‰å…¶ä¼˜ç¼ºç‚¹ã€‚å½“æˆ‘ä½¿ç”¨å®ƒä»¬æ—¶ï¼Œæˆ‘ä¼šæœ‰æ„è¯†åœ°ä½¿ç”¨å®ƒä»¬ï¼Œå®Œå…¨æ„è¯†åˆ°ä»»ä½•éæ‹¥æœ‰å¼•ç”¨ç±»å‹éƒ½éœ€è¦ä»”ç»†æ³¨æ„å…¶æ‰€å¼•ç”¨å€¼çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¾‹å¦‚ï¼Œè™½ç„¶æˆ‘è®¤ä¸ºå®ƒä»¬ä½œä¸ºå‡½æ•°å‚æ•°éå¸¸æœ‰ç”¨ï¼Œä½†æˆ‘å€¾å‘äºä¸åœ¨æ•°æ®æˆå‘˜ä¸­ä½¿ç”¨å®ƒä»¬ã€‚ç”Ÿå‘½å‘¨æœŸé—®é¢˜çš„é£é™©å¤ªé«˜äº†ã€‚</p>
<p><strong>å¼•ç”¨è¯­ä¹‰ï¼šç¬¬äºŒä¸ªç¤ºä¾‹</strong></p>
<p>â€œå½“ç„¶ï¼Œæˆ‘çŸ¥é“è¿™ä¸€ç‚¹ï¼Œâ€ä½ äº‰è¾©é“ã€‚â€œæˆ‘ä¹Ÿä¸ä¼šé•¿æ—¶é—´å­˜å‚¨ <code>std::span</code>ã€‚ç„¶è€Œï¼Œæˆ‘ä»ç„¶ä¸ç›¸ä¿¡å¼•ç”¨å’ŒæŒ‡é’ˆæ˜¯ä¸ªé—®é¢˜ã€‚â€ å¥½çš„ï¼Œå¦‚æœç¬¬ä¸€ä¸ªä¾‹å­è¿˜ä¸è¶³ä»¥è®©ä½ éœ‡æƒŠï¼Œæˆ‘è¿˜æœ‰ä¸€ä¸ªç¬¬äºŒä¸ªä¾‹å­ã€‚</p>
<p>è¿™æ¬¡æˆ‘å°†ä½¿ç”¨ STL ç®—æ³•ä¹‹ä¸€ <code>std::remove()</code>ã€‚<br/><code>std::remove()</code> ç®—æ³•æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šä¸€ä¸ªç”¨äºéå†ä»¥ç§»é™¤ç‰¹å®šå€¼çš„æ‰€æœ‰å…ƒç´ çš„èŒƒå›´çš„è¿­ä»£å™¨å¯¹ï¼Œä»¥åŠç¬¬ä¸‰ä¸ªè¡¨ç¤ºè¦ç§»é™¤çš„å€¼çš„å‚æ•°ã€‚ç‰¹åˆ«æ³¨æ„ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯é€šè¿‡å¸¸é‡å¼•ç”¨ä¼ é€’çš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">ForwardIt</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">constexpr</span> <span class="n">ForwardIt</span> <span class="n">remove</span><span class="p">(</span> <span class="n">ForwardIt</span> <span class="n">first</span><span class="p">,</span> <span class="n">ForwardIt</span> <span class="n">last</span><span class="p">,</span> <span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">value</span> <span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸‹é¢çš„ä»£ç ç¤ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vec</span><span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">9</span> <span class="p">};</span>  
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="k">const</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">max_element</span><span class="p">(</span><span class="n">begin</span><span class="p">(</span><span class="n">vec</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">vec</span><span class="p">));</span>   
</span></span><span class="line"><span class="cl"><span class="n">vec</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">remove</span><span class="p">(</span><span class="n">begin</span><span class="p">(</span><span class="n">vec</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">vec</span><span class="p">),</span> <span class="o">*</span><span class="n">pos</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">vec</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬ä»åˆå§‹åŒ–äº†ä¸€äº›éšæœºæ•°å­—çš„ <code>std::vector</code> v å¼€å§‹ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ˜¯ç§»é™¤å‘é‡ä¸­ä»£è¡¨æœ€å¤§å€¼çš„æ‰€æœ‰å…ƒç´ ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™ä¸ªå€¼æ˜¯ 42ï¼Œå¹¶ä¸”åœ¨å‘é‡ä¸­å‡ºç°äº†ä¸¤æ¬¡ã€‚æ‰§è¡Œç§»é™¤çš„ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨ <code>std::max_element()</code> ç®—æ³•ç¡®å®šæœ€å¤§å€¼ã€‚<code>std::max_element()</code> è¿”å›æŒ‡å‘æœ€å¤§å€¼çš„è¿­ä»£å™¨ã€‚å¦‚æœèŒƒå›´å†…æœ‰å¤šä¸ªå…ƒç´ ç­‰åŒäºæœ€å¤§å…ƒç´ ï¼Œåˆ™è¿”å›æŒ‡å‘ç¬¬ä¸€ä¸ªæ­¤ç±»å…ƒç´ çš„è¿­ä»£å™¨ã€‚</p>
<p>ç§»é™¤æœ€å¤§å€¼çš„ç¬¬äºŒæ­¥æ˜¯å¯¹ <code>std::remove()</code> çš„è°ƒç”¨ã€‚æˆ‘ä»¬é€šè¿‡ <code>begin(vec)</code> å’Œ <code>end(vec)</code> ä¼ é€’å…ƒç´ èŒƒå›´ï¼Œå¹¶é€šè¿‡è§£å¼•ç”¨ <code>pos</code> è¿­ä»£å™¨ä¼ é€’æœ€å¤§å€¼ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨æˆå‘˜å‡½æ•° <code>erase()</code> å®Œæˆæ“ä½œï¼šæˆ‘ä»¬åˆ é™¤ç”± <code>std::remove()</code> ç®—æ³•è¿”å›çš„ä½ç½®åˆ°å‘é‡æœ«å°¾ä¹‹é—´çš„æ‰€æœ‰å€¼ã€‚è¿™ä¸€ç³»åˆ—æ“ä½œé€šå¸¸è¢«ç§°ä¸º erase-remove æƒ¯ç”¨æ³•ã€‚</p>
<p>æˆ‘ä»¬æœŸæœ›ä»å‘é‡ä¸­ç§»é™¤ä¸¤ä¸ª 42ï¼Œå¹¶å› æ­¤æœŸæœ›å¾—åˆ°ä»¥ä¸‹ç»“æœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="p">(</span> <span class="mi">1</span> <span class="o">-</span><span class="mi">3</span> <span class="mi">27</span> <span class="mi">4</span> <span class="o">-</span><span class="mi">8</span> <span class="mi">22</span> <span class="mi">37</span> <span class="mi">4</span> <span class="mi">18</span> <span class="mi">9</span> <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ªæœŸæœ›å¹¶ä¸æˆç«‹ã€‚ç›¸åï¼Œå‘é‡ç°åœ¨åŒ…å«ä»¥ä¸‹å€¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">( 1 -3 27 4 -8 22 42 37 18 9 )
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯·æ³¨æ„ï¼Œå‘é‡ä»ç„¶åŒ…å«ä¸€ä¸ª 42ï¼Œä½†ç°åœ¨ç¼ºå°‘äº†ä¸€ä¸ª 4ã€‚è¿™ç§è¡Œä¸ºä¸å½“çš„æ ¹æœ¬åŸå› ä»ç„¶æ˜¯å¼•ç”¨è¯­ä¹‰ï¼šé€šè¿‡å°†è§£å¼•ç”¨çš„è¿­ä»£å™¨ä¼ é€’ç»™ <code>remove()</code> ç®—æ³•ï¼Œæˆ‘ä»¬éšå¼åœ°æŒ‡å®šäº†è¯¥ä½ç½®å­˜å‚¨çš„å€¼åº”è¯¥è¢«ç§»é™¤ã€‚ç„¶è€Œï¼Œåœ¨ç§»é™¤äº†ç¬¬ä¸€ä¸ª 42 åï¼Œè¯¥ä½ç½®ç°åœ¨å­˜å‚¨çš„æ˜¯å€¼ 4ã€‚<code>remove()</code> ç®—æ³•ä¼šç§»é™¤æ‰€æœ‰å€¼ä¸º 4 çš„å…ƒç´ ã€‚å› æ­¤ï¼Œä¸‹ä¸€ä¸ªè¢«ç§»é™¤çš„å€¼ä¸æ˜¯ä¸‹ä¸€ä¸ª 42ï¼Œè€Œæ˜¯ä¸‹ä¸€ä¸ª 4ï¼Œä¾æ­¤ç±»æ¨ã€‚</p>
<p>â€œå¥½çš„ï¼Œæˆ‘æ˜ç™½äº†ï¼ä½†è¿™ä¸ªé—®é¢˜å·²ç»æˆä¸ºå†å²äº†ï¼ä»Šå¤©ï¼Œæˆ‘ä»¬ä¸å†ä½¿ç”¨ erase-remove æƒ¯ç”¨æ³•äº†ã€‚C++20 ç»ˆäºä¸ºæˆ‘ä»¬æä¾›äº†è‡ªç”±çš„ <code>std::erase()</code> å‡½æ•°ï¼â€ æˆ‘å¸Œæœ›åŒæ„è¿™ä¸ªè¯´æ³•ï¼Œä½†é—æ†¾çš„æ˜¯ï¼Œæˆ‘åªèƒ½ç¡®è®¤ <code>std::erase()</code> å‡½æ•°çš„å­˜åœ¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Alloc</span><span class="p">,</span> <span class="k">typename</span> <span class="n">U</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">constexpr</span> <span class="k">typename</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">Alloc</span><span class="o">&gt;::</span><span class="n">size_type</span> 
</span></span><span class="line"><span class="cl"><span class="n">erase</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">Alloc</span><span class="o">&gt;&amp;</span> <span class="n">c</span><span class="p">,</span> <span class="n">U</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">value</span> <span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>std::erase()</code> å‡½æ•°ä¹Ÿé€šè¿‡å¸¸é‡å¼•ç”¨ä¼ é€’å…¶ç¬¬äºŒä¸ªå‚æ•°ï¼Œå³è¦ç§»é™¤çš„å€¼ã€‚å› æ­¤ï¼Œæˆ‘åˆšæ‰æè¿°çš„é—®é¢˜ä»ç„¶å­˜åœ¨ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„å”¯ä¸€æ–¹æ³•æ˜¯æ˜¾å¼åœ°ç¡®å®šæœ€å¤§å…ƒç´ å¹¶å°†å…¶ä¼ é€’ç»™ <code>std::remove()</code> ç®—æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vec</span><span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">9</span> <span class="p">};</span> 
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="k">const</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">max_element</span><span class="p">(</span><span class="n">begin</span><span class="p">(</span><span class="n">vec</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">vec</span><span class="p">));</span> 
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="k">const</span> <span class="n">greatest</span> <span class="o">=</span> <span class="o">*</span><span class="n">pos</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl"><span class="n">vec</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">remove</span><span class="p">(</span><span class="n">begin</span><span class="p">(</span><span class="n">vec</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">vec</span><span class="p">),</span> <span class="n">greatest</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">vec</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>â€œä½ æ˜¯ä¸æ˜¯åœ¨è®¤çœŸå»ºè®®æˆ‘ä»¬ä¸è¦å†ä½¿ç”¨<strong>å¼•ç”¨å‚æ•°</strong>äº†ï¼Ÿâ€ ä¸ï¼Œç»å¯¹ä¸æ˜¯ï¼å½“ç„¶ä½ åº”è¯¥ä½¿ç”¨å¼•ç”¨å‚æ•°ï¼Œä¾‹å¦‚å‡ºäºæ€§èƒ½è€ƒè™‘ã€‚<br/>ç„¶è€Œï¼Œæˆ‘å¸Œæœ›å¼•èµ·ä¸€å®šçš„æ„è¯†ï¼Œå¸Œæœ›ä½ ç°åœ¨ç†è§£äº†é—®é¢˜æ‰€åœ¨ï¼šå¼•ç”¨ï¼Œå°¤å…¶æ˜¯<strong>æŒ‡é’ˆ</strong>ï¼Œè®©æˆ‘ä»¬çš„ç”Ÿæ´»å˜å¾—å¤æ‚å¾—å¤šï¼Œç†è§£ä»£ç å˜å¾—æ›´åŠ å›°éš¾ï¼Œå› æ­¤æ›´å®¹æ˜“åœ¨ä»£ç ä¸­å¼•å…¥é”™è¯¯ã€‚<br/>ç‰¹åˆ«æ˜¯æŒ‡é’ˆå¼•å‘äº†å¾ˆå¤šé—®é¢˜ï¼šå®ƒæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æŒ‡é’ˆè¿˜æ˜¯ <code>nullptr</code>ï¼Ÿè°æ‹¥æœ‰æŒ‡é’ˆèƒŒåçš„èµ„æºå¹¶ç®¡ç†å…¶ç”Ÿå‘½å‘¨æœŸï¼Ÿå½“ç„¶ï¼Œç”±äºæˆ‘ä»¬æ‰©å±•äº†å·¥å…·ç®±å¹¶æ‹¥æœ‰äº†<strong>æ™ºèƒ½æŒ‡é’ˆ</strong>ï¼Œç”Ÿå‘½å‘¨æœŸé—®é¢˜ä¸å†æ˜¯å¤§é—®é¢˜ã€‚<br/>æ­£å¦‚æ ¸å¿ƒæŒ‡å— R.3 æ¸…æ¥šæŒ‡å‡ºçš„é‚£æ ·ï¼š<strong>åŸå§‹æŒ‡é’ˆ</strong>ï¼ˆ<code>T*</code>ï¼‰æ˜¯éæ‹¥æœ‰çš„ã€‚</p>
<p>ç»“åˆçŸ¥é“<strong>æ™ºèƒ½æŒ‡é’ˆ</strong>æ‰¿æ‹…äº†æ‰€æœ‰æƒçš„è´£ä»»ï¼Œè¿™å¤§å¤§æ¸…ç†äº†æŒ‡é’ˆçš„è¯­ä¹‰ã€‚<br/>ä½†æ˜¯ï¼Œå°½ç®¡<strong>æ™ºèƒ½æŒ‡é’ˆ</strong>å½“ç„¶æ˜¯éå¸¸æœ‰ä»·å€¼çš„å·¥å…·ï¼Œå¹¶ä¸”å› å…¶ä¼˜ç‚¹è€Œè¢«èª‰ä¸ºâ€œç°ä»£ C++â€çš„é‡å¤§æˆå°±ï¼Œå®ƒä»¬æœ€ç»ˆåªæ˜¯ä¿®è¡¥å¼•ç”¨è¯­ä¹‰åœ¨æˆ‘ä»¬æ¨ç†ä»£ç èƒ½åŠ›ä¸Šæ’•å¼€çš„æ¼æ´ã€‚<br/>æ˜¯çš„ï¼Œå¼•ç”¨è¯­ä¹‰ä½¿ç†è§£ä»£ç å’Œæ¨ç†é‡è¦ç»†èŠ‚å˜å¾—æ›´åŠ å›°éš¾ï¼Œå› æ­¤æ˜¯æˆ‘ä»¬å¸Œæœ›é¿å…çš„ä¸œè¥¿ã€‚</p>
<p><strong>ç°ä»£C++å“²å­¦ï¼šå€¼è¯­ä¹‰</strong></p>
<p>â€œä½†æ˜¯ç­‰ç­‰ï¼Œâ€æˆ‘èƒ½å¬åˆ°ä½ åé©³ï¼Œâ€œæˆ‘ä»¬è¿˜æœ‰ä»€ä¹ˆå…¶ä»–é€‰æ‹©ï¼Ÿæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšï¼Ÿæˆ‘ä»¬å¦‚ä½•å¤„ç†ç»§æ‰¿å±‚æ¬¡ç»“æ„ï¼Ÿæˆ‘ä»¬ä¸èƒ½é¿å…ä½¿ç”¨æŒ‡é’ˆï¼Œå¯¹å§ï¼Ÿâ€ å¦‚æœä½ æœ‰ç±»ä¼¼çš„æƒ³æ³•ï¼Œé‚£ä¹ˆæˆ‘æœ‰ä¸€ä¸ªéå¸¸å¥½çš„æ¶ˆæ¯å‘Šè¯‰ä½ ï¼šæ˜¯çš„ï¼Œæœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>è¿™ä¸ªè§£å†³æ–¹æ¡ˆä½¿ä½ çš„ä»£ç æ›´å®¹æ˜“ç†è§£ã€æ¨ç†ï¼Œå¹¶ä¸”å¯èƒ½å¯¹æ€§èƒ½äº§ç”Ÿç§¯æå½±å“ï¼ˆè¿˜è®°å¾—æˆ‘ä»¬è®¨è®ºè¿‡çš„å¼•ç”¨è¯­ä¹‰çš„è´Ÿé¢æ€§èƒ½å½±å“ï¼‰ã€‚è¿™ä¸ªè§£å†³æ–¹æ¡ˆå°±æ˜¯å€¼è¯­ä¹‰ã€‚</p>
<p>å€¼è¯­ä¹‰åœ¨C++ä¸­å¹¶ä¸æ˜¯æ–°é²œäº‹ç‰©ã€‚è¿™ä¸ªæƒ³æ³•å·²ç»æ˜¯åŸå§‹STLçš„ä¸€éƒ¨åˆ†ã€‚è®©æˆ‘ä»¬è€ƒè™‘æœ€è‘—åçš„STLå®¹å™¨ä¹‹ä¸€ <code>std::vector</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">v1</span><span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span> <span class="p">};</span> 
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">v2</span><span class="p">{</span> <span class="n">v1</span> <span class="p">};</span>  
</span></span><span class="line"><span class="cl"><span class="n">assert</span><span class="p">(</span> <span class="n">v1</span> <span class="o">==</span> <span class="n">v2</span> <span class="p">);</span>   
</span></span><span class="line"><span class="cl"><span class="n">assert</span><span class="p">(</span> <span class="n">v1</span><span class="p">.</span><span class="n">data</span><span class="p">()</span> <span class="o">!=</span> <span class="n">v2</span><span class="p">.</span><span class="n">data</span><span class="p">()</span> <span class="p">);</span>   
</span></span><span class="line"><span class="cl"><span class="n">v2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl"><span class="n">assert</span><span class="p">(</span> <span class="n">v1</span> <span class="o">!=</span> <span class="n">v2</span> <span class="p">);</span>   
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="k">const</span> <span class="n">v3</span><span class="p">{</span> <span class="n">v1</span> <span class="p">};</span>   
</span></span><span class="line"><span class="cl"><span class="n">v3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99</span><span class="p">;</span>  <span class="c1">// ç¼–è¯‘é”™è¯¯!
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬ä»ä¸€ä¸ªåä¸º <code>v1</code> çš„ <code>std::vector</code> å¼€å§‹ï¼ŒåŒ…å«äº”ä¸ªæ•´æ•°ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»º <code>v1</code> çš„å‰¯æœ¬ï¼Œç§°ä¸º <code>v2</code>ã€‚å‘é‡ <code>v2</code> æ˜¯ä¸€ä¸ªçœŸæ­£çš„å‰¯æœ¬ï¼Œæœ‰æ—¶ä¹Ÿç§°ä¸ºæ·±æ‹·è´ï¼Œå®ƒç°åœ¨æ‹¥æœ‰è‡ªå·±çš„å†…å­˜å—å’Œæ•´æ•°ï¼Œä¸å¼•ç”¨ <code>v1</code> ä¸­çš„æ•´æ•°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ¯”è¾ƒä¸¤ä¸ªå‘é‡æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼ˆå®ƒä»¬è¢«è¯æ˜æ˜¯ç›¸ç­‰çš„ï¼‰ï¼Œä½†ç¬¬ä¸€ä¸ªå…ƒç´ çš„åœ°å€ä¸åŒã€‚ä¿®æ”¹ <code>v2</code> ä¸­çš„ä¸€ä¸ªå…ƒç´ ä¼šå¯¼è‡´ä¸¤ä¸ªå‘é‡ä¸å†ç›¸ç­‰ã€‚æ˜¯çš„ï¼Œä¸¤ä¸ªå‘é‡éƒ½æœ‰è‡ªå·±çš„æ•°ç»„ï¼Œå®ƒä»¬ä¸å…±äº«å†…å®¹ï¼Œå³ä¸è¯•å›¾â€œä¼˜åŒ–â€å¤åˆ¶æ“ä½œã€‚</p>
<p>ä½ å¯èƒ½å¬è¯´è¿‡ä¸€äº›æŠ€æœ¯ï¼Œä¾‹å¦‚å†™æ—¶å¤åˆ¶ï¼ˆcopy-on-writeï¼‰ã€‚ç¡®å®ï¼Œåœ¨C++11ä¹‹å‰ï¼Œè¿™æ›¾æ˜¯ <code>std::string</code> çš„å¸¸è§å®ç°ã€‚ç„¶è€Œï¼Œè‡ªC++11ä»¥æ¥ï¼Œç”±äºC++æ ‡å‡†ä¸­çš„è¦æ±‚ï¼Œ<code>std::string</code> ä¸å†å…è®¸ä½¿ç”¨å†™æ—¶å¤åˆ¶ã€‚åŸå› æ˜¯è¿™ç§â€œä¼˜åŒ–â€åœ¨ä¸€ä¸ªå¤šçº¿ç¨‹ä¸–ç•Œä¸­å¾ˆå®¹æ˜“å˜æˆåŠ£åŒ–ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿¡å¤åˆ¶æ„é€ ä¼šåˆ›å»ºä¸€ä¸ªçœŸæ­£çš„å‰¯æœ¬ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬åˆ›å»ºå¦ä¸€ä¸ªåä¸º <code>v3</code> çš„å‰¯æœ¬ï¼Œå¹¶å°†å…¶å£°æ˜ä¸º <code>const</code>ã€‚å¦‚æœæˆ‘ä»¬å°è¯•ä¿®æ”¹ <code>v3</code> çš„å€¼ï¼Œå°†ä¼šå¾—åˆ°ç¼–è¯‘é”™è¯¯ã€‚è¿™è¡¨æ˜ä¸€ä¸ª <code>const</code> å‘é‡ä¸ä»…é˜²æ­¢æ·»åŠ å’Œåˆ é™¤å…ƒç´ ï¼Œè€Œä¸”æ‰€æœ‰å…ƒç´ ä¹Ÿè¢«è§†ä¸º <code>const</code>ã€‚ä»è¯­ä¹‰è§’åº¦æ¥çœ‹ï¼Œè¿™æ„å‘³ç€ <code>std::vector</code> å’Œä»»ä½•STLå®¹å™¨ä¸€æ ·ï¼Œè¢«è§†ä¸ºä¸€ä¸ªå€¼ã€‚æ˜¯çš„ï¼Œä¸€ä¸ªå€¼ï¼Œå°±åƒä¸€ä¸ª <code>int</code>ã€‚å¦‚æœæˆ‘ä»¬å¤åˆ¶ä¸€ä¸ªå€¼ï¼Œæˆ‘ä»¬ä¸ä¼šåªå¤åˆ¶éƒ¨åˆ†å€¼ï¼Œè€Œæ˜¯æ•´ä¸ªå€¼ã€‚å¦‚æœæˆ‘ä»¬ä½¿ä¸€ä¸ªå€¼ <code>const</code>ï¼Œå®ƒä¸ä»…ä»…æ˜¯éƒ¨åˆ† <code>const</code>ï¼Œè€Œæ˜¯å®Œå…¨ <code>const</code>ã€‚è¿™å°±æ˜¯å€¼è¯­ä¹‰çš„åŸºæœ¬åŸç†ã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä¸€äº›ä¼˜ç‚¹ï¼šä¸æŒ‡é’ˆå’Œå¼•ç”¨ç›¸æ¯”ï¼Œå€¼æ›´å®¹æ˜“æ¨ç†ã€‚ä¾‹å¦‚ï¼Œæ”¹å˜ä¸€ä¸ªå€¼ä¸ä¼šå½±å“å…¶ä»–å€¼ã€‚å˜åŒ–æ˜¯å±€éƒ¨çš„ï¼Œè€Œä¸æ˜¯å‘ç”Ÿåœ¨åˆ«å¤„ã€‚è¿™æ˜¯ä¸€ä¸ªç¼–è¯‘å™¨ç”¨äºå…¶ä¼˜åŒ–å·¥ä½œçš„ä¼˜åŠ¿ã€‚æ­¤å¤–ï¼Œå€¼ä¸éœ€è¦æˆ‘ä»¬è€ƒè™‘æ‰€æœ‰æƒé—®é¢˜ã€‚å€¼è´Ÿè´£è‡ªå·±çš„å†…å®¹ã€‚å€¼è¿˜ä½¿å¾—æ€è€ƒçº¿ç¨‹é—®é¢˜å˜å¾—æ›´åŠ å®¹æ˜“ã€‚è¿™å¹¶ä¸æ„å‘³ç€æ²¡æœ‰é—®é¢˜äº†ï¼ˆä½ å¸Œæœ›å¦‚æ­¤ï¼ï¼‰ï¼Œä½†ä»£ç è‚¯å®šæ›´å®¹æ˜“ç†è§£ã€‚å€¼ä¸ä¼šç»™æˆ‘ä»¬ç•™ä¸‹å¾ˆå¤šç–‘é—®ã€‚</p>
<p>â€œå¥½çš„ï¼Œæˆ‘æ˜ç™½äº†ä»£ç æ¸…æ™°æ€§çš„è¦ç‚¹ï¼Œâ€ä½ äº‰è¾©é“ï¼Œâ€œä½†æ˜¯å…³äºæ€§èƒ½å‘¢ï¼Ÿé¢‘ç¹å¤„ç†å¤åˆ¶æ“ä½œæ˜¯ä¸æ˜¯éå¸¸æ˜‚è´µï¼Ÿâ€ æ˜¯çš„ï¼Œä½ æ˜¯æ­£ç¡®çš„ï¼›å¤åˆ¶æ“ä½œå¯èƒ½æ˜¯æ˜‚è´µçš„ã€‚ç„¶è€Œï¼Œåªæœ‰å½“å®ƒä»¬çœŸæ­£å‘ç”Ÿæ—¶æ‰ä¼šæ˜‚è´µã€‚åœ¨å®é™…ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å¯ä»¥ä¾èµ–äºå¤åˆ¶çœç•¥ã€ç§»åŠ¨è¯­ä¹‰å’ŒæŒ‰å¼•ç”¨ä¼ é€’ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼Œä»æ€§èƒ½è§’åº¦æ¥çœ‹ï¼Œå€¼è¯­ä¹‰å¯èƒ½ä¼šç»™æˆ‘ä»¬å¸¦æ¥æ€§èƒ½æå‡ã€‚å½“ç„¶ï¼Œæˆ‘æŒ‡çš„æ˜¯â€œæŒ‡å—17ï¼šè€ƒè™‘ä½¿ç”¨ <code>std::variant</code> å®ç°è®¿é—®è€…æ¨¡å¼â€ä¸­çš„ <code>std::variant</code> ç¤ºä¾‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨ <code>std::variant</code> ç±»å‹çš„å€¼æ˜¾è‘—æé«˜äº†æˆ‘ä»¬çš„æ€§èƒ½ï¼Œå› ä¸ºå‡å°‘äº†æŒ‡é’ˆå¯¼è‡´çš„é—´æ¥å¯»å€å’Œæ›´å¥½çš„å†…å­˜å¸ƒå±€åŠè®¿é—®æ¨¡å¼ã€‚</p>
<p>è®©æˆ‘ä»¬æ¥çœ‹ç¬¬äºŒä¸ªç¤ºä¾‹ã€‚è¿™æ¬¡æˆ‘ä»¬è€ƒè™‘ä»¥ä¸‹ <code>to_int()</code> å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">to_int</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªå‡½æ•°è§£æç»™å®šçš„å­—ç¬¦ä¸²ï¼ˆæ˜¯çš„ï¼Œæˆ‘ä½¿ç”¨ <code>std::string_view</code> ä»¥æé«˜æ€§èƒ½ï¼‰å¹¶å°†å…¶è½¬æ¢ä¸º <code>int</code>ã€‚å¯¹æˆ‘ä»¬æ¥è¯´æœ€æœ‰è¶£çš„é—®é¢˜æ˜¯å¦‚ä½•å¤„ç†é”™è¯¯ï¼Œæˆ–è€…è¯´ï¼Œå¦‚æœå­—ç¬¦ä¸²æ— æ³•è½¬æ¢ä¸º <code>int</code>ï¼Œå‡½æ•°åº”è¯¥åšä»€ä¹ˆã€‚ç¬¬ä¸€ä¸ªé€‰é¡¹æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹è¿”å› 0ã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•æœ‰é—®é¢˜ï¼Œå› ä¸º 0 æ˜¯ <code>to_int()</code> å‡½æ•°çš„æœ‰æ•ˆè¿”å›å€¼ã€‚æˆ‘ä»¬å°†æ— æ³•åŒºåˆ†æˆåŠŸå’Œå¤±è´¥ã€‚</p>
<p>å¦ä¸€ç§å¯èƒ½çš„æ–¹æ³•æ˜¯æŠ›å‡ºå¼‚å¸¸ã€‚å°½ç®¡å¼‚å¸¸å¯èƒ½æ˜¯C++åŸç”Ÿçš„é”™è¯¯ä¿¡å·å·¥å…·ï¼Œä½†å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæ ¹æ®ä¸ªäººé£æ ¼å’Œåå¥½ï¼Œè¿™å¯èƒ½æ˜¾å¾—è¿‡äºå¤æ‚ã€‚åŒæ—¶ï¼Œè€ƒè™‘åˆ°å¾ˆå¤§ä¸€éƒ¨åˆ†C++ç¤¾åŒºä¸èƒ½ä½¿ç”¨å¼‚å¸¸ï¼Œè¿™ä¸€é€‰æ‹©å¯èƒ½ä¼šé™åˆ¶å‡½æ•°çš„å¯ç”¨æ€§ã€‚</p>
<p>ç¬¬ä¸‰ç§å¯èƒ½æ€§æ˜¯ç¨å¾®æ”¹å˜ç­¾åï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">to_int</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span><span class="o">&amp;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨å‡½æ•°æ¥å—ä¸€ä¸ªå¯å˜ <code>int</code> çš„å¼•ç”¨ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ª <code>bool</code>ã€‚å¦‚æœæˆåŠŸï¼Œå‡½æ•°è¿”å› <code>true</code> å¹¶è®¾ç½®ä¼ å…¥çš„æ•´æ•°ï¼›å¦‚æœå¤±è´¥ï¼Œå‡½æ•°è¿”å› <code>false</code> å¹¶ä¿æŒæ•´æ•°ä¸å˜ã€‚è™½ç„¶è¿™å¯¹ä½ æ¥è¯´ä¼¼ä¹æ˜¯ä¸€ä¸ªåˆç†çš„æŠ˜è¡·æ–¹æ¡ˆï¼Œä½†æˆ‘è®¤ä¸ºæˆ‘ä»¬ç°åœ¨è¿›ä¸€æ­¥è¿›å…¥äº†å¼•ç”¨è¯­ä¹‰çš„é¢†åŸŸï¼ˆåŒ…æ‹¬æ‰€æœ‰æ½œåœ¨çš„è¯¯ç”¨ï¼‰ã€‚åŒæ—¶ï¼Œä»£ç çš„æ¸…æ™°åº¦æœ‰æ‰€ä¸‹é™ï¼šè¿”å›ç»“æœæœ€è‡ªç„¶çš„æ–¹å¼æ˜¯é€šè¿‡è¿”å›å€¼ï¼Œä½†ç°åœ¨ç»“æœæ˜¯ç”±è¾“å‡ºå€¼äº§ç”Ÿçš„ã€‚ä¾‹å¦‚ï¼Œè¿™é˜»æ­¢æˆ‘ä»¬å°†ç»“æœèµ‹å€¼ç»™ <code>const</code> å€¼ã€‚å› æ­¤ï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯è¿„ä»Šä¸ºæ­¢æœ€ä¸åˆ©çš„æ–¹æ³•ã€‚</p>
<p>ç¬¬å››ç§æ–¹æ³•æ˜¯é€šè¿‡æŒ‡é’ˆè¿”å›ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">to_int</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»è¯­ä¹‰ä¸Šè®²ï¼Œè¿™ç§æ–¹æ³•éå¸¸å¸å¼•äººï¼šå¦‚æœæˆåŠŸï¼Œå‡½æ•°è¿”å›æŒ‡å‘ <code>int</code> çš„æœ‰æ•ˆæŒ‡é’ˆï¼›å¦‚æœå¤±è´¥ï¼Œè¿”å› <code>nullptr</code>ã€‚å› æ­¤ï¼Œä»£ç çš„æ¸…æ™°åº¦å¾—åˆ°äº†æ”¹å–„ï¼Œå› ä¸ºæˆ‘ä»¬èƒ½æ¸…æ¥šåœ°åŒºåˆ†è¿™ä¸¤ç§æƒ…å†µã€‚ç„¶è€Œï¼Œæˆ‘ä»¬åœ¨åŠ¨æ€å†…å­˜åˆ†é…å’Œä½¿ç”¨ <code>std::unique_ptr</code> è¿›è¡Œç”Ÿå‘½å‘¨æœŸç®¡ç†æ–¹é¢ä»˜å‡ºäº†ä»£ä»·ï¼Œä»ç„¶åœç•™åœ¨å¼•ç”¨è¯­ä¹‰çš„é¢†åŸŸã€‚æ‰€ä»¥é—®é¢˜æ˜¯ï¼šå¦‚ä½•åˆ©ç”¨è¯­ä¹‰ä¸Šçš„ä¼˜åŠ¿ä½†ä»åšæŒå€¼è¯­ä¹‰ï¼Ÿè§£å†³æ–¹æ¡ˆçš„å½¢å¼æ˜¯ <code>std::optional</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">to_int</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>std::optional</code> æ˜¯ä¸€ç§å€¼ç±»å‹ï¼Œè¡¨ç¤ºå¦ä¸€ä¸ªå€¼ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯ <code>int</code>ã€‚å› æ­¤ï¼Œ<code>std::optional</code> å¯ä»¥å– <code>int</code> èƒ½å–çš„æ‰€æœ‰å€¼ã€‚<code>std::optional</code> çš„ç‰¹æ®Šä¹‹å¤„åœ¨äºå®ƒä¸ºå°è£…çš„å€¼å¢åŠ äº†ä¸€ä¸ªçŠ¶æ€ï¼Œè¡¨ç¤ºæ— å€¼çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„ <code>std::optional</code> æ˜¯ä¸€ä¸ªå¯èƒ½å­˜åœ¨ä¹Ÿå¯èƒ½ä¸å­˜åœ¨çš„ <code>int</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;charconv&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;optional&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sstream&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string_view&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">to_int</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">sv</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">oi</span><span class="p">{};</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">int</span> <span class="n">i</span><span class="p">{};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="k">auto</span> <span class="k">const</span> <span class="n">result</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">from_chars</span><span class="p">(</span><span class="n">sv</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">sv</span><span class="p">.</span><span class="n">data</span><span class="p">()</span> <span class="o">+</span> <span class="n">sv</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">i</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="k">if</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">ec</span> <span class="o">!=</span> <span class="n">std</span><span class="o">::</span><span class="n">errc</span><span class="o">::</span><span class="n">invalid_argument</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="n">oi</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="n">oi</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">value</span> <span class="o">=</span> <span class="s">&#34;42&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="k">if</span><span class="p">(</span><span class="k">auto</span> <span class="n">optional_int</span> <span class="o">=</span> <span class="n">to_int</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="c1">// ... æˆåŠŸï¼šè¿”å›çš„ std::optional åŒ…å«ä¸€ä¸ªæ•´æ•°å€¼ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="k">else</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="c1">// ... å¤±è´¥ï¼šè¿”å›çš„ std::optional ä¸åŒ…å«å€¼ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»è¯­ä¹‰ä¸Šè®²ï¼Œè¿™ç­‰åŒäºæŒ‡é’ˆæ–¹æ³•ï¼Œä½†æˆ‘ä»¬ä¸éœ€è¦æ”¯ä»˜åŠ¨æ€å†…å­˜åˆ†é…çš„æˆæœ¬ï¼Œä¹Ÿä¸éœ€è¦å¤„ç†ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚è¿™ä¸ªè§£å†³æ–¹æ¡ˆè¯­ä¹‰æ¸…æ™°ã€æ˜“äºç†è§£ä¸”é«˜æ•ˆã€‚</p>
<p><strong>ä½¿ç”¨å€¼è¯­ä¹‰å®ç°è®¾è®¡æ¨¡å¼</strong></p>
<p>â€œé‚£è®¾è®¡æ¨¡å¼å‘¢ï¼Ÿâ€ä½ é—®ã€‚â€œå‡ ä¹æ‰€æœ‰çš„GoFæ¨¡å¼éƒ½åŸºäºç»§æ‰¿å±‚æ¬¡ç»“æ„ï¼Œå› æ­¤æ˜¯å¼•ç”¨è¯­ä¹‰ã€‚æˆ‘ä»¬åº”è¯¥å¦‚ä½•å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Ÿâ€ è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é—®é¢˜ã€‚å¹¶ä¸”ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå®Œç¾çš„æ¡¥æ¢åˆ°ä¸‹ä¸€ä¸ªæŒ‡å—ã€‚ç®€çŸ­çš„å›ç­”æ˜¯ï¼šä½ åº”è¯¥ä¼˜å…ˆä½¿ç”¨å€¼è¯­ä¹‰æ¥å®ç°è®¾è®¡æ¨¡å¼ã€‚æ˜¯çš„ï¼Œè®¤çœŸåœ°è¯´ï¼è¿™äº›è§£å†³æ–¹æ¡ˆé€šå¸¸ä¼šå¸¦æ¥æ›´å…¨é¢ã€å¯ç»´æŠ¤çš„ä»£ç ï¼Œå¹¶ä¸”ï¼ˆé€šå¸¸ï¼‰å…·æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚</p>
<h3 id="å‡†åˆ™23ä¼˜å…ˆä½¿ç”¨åŸºäºå€¼çš„ç­–ç•¥å’Œå‘½ä»¤å®ç°">å‡†åˆ™23ï¼šä¼˜å…ˆä½¿ç”¨åŸºäºå€¼çš„ç­–ç•¥å’Œå‘½ä»¤å®ç°
</h3><p>åœ¨â€œ<strong>å‡†åˆ™19ï¼šä½¿ç”¨ç­–ç•¥æ¨¡å¼éš”ç¦»æ“ä½œæ–¹å¼</strong>â€ä¸­ï¼Œæˆ‘å‘ä½ ä»‹ç»äº†<strong>ç­–ç•¥è®¾è®¡æ¨¡å¼</strong>ï¼›åœ¨â€œ<strong>å‡†åˆ™21ï¼šä½¿ç”¨å‘½ä»¤æ¨¡å¼éš”ç¦»æ“ä½œå†…å®¹</strong>â€ä¸­ï¼Œæˆ‘ä»‹ç»äº†<strong>å‘½ä»¤è®¾è®¡æ¨¡å¼</strong>ã€‚</p>
<p>æˆ‘å±•ç¤ºäº†è¿™ä¸¤ç§è®¾è®¡æ¨¡å¼æ˜¯ä½ æ—¥å¸¸å·¥å…·ç®±ä¸­çš„é‡è¦è§£è€¦å·¥å…·ã€‚ç„¶è€Œï¼Œåœ¨â€œæŒ‡å—22ï¼šä¼˜å…ˆä½¿ç”¨å€¼è¯­ä¹‰è€Œéå¼•ç”¨è¯­ä¹‰â€ä¸­ï¼Œæˆ‘æå‡ºäº†ä½¿ç”¨å€¼è¯­ä¹‰æ¯”å¼•ç”¨è¯­ä¹‰æ›´å¥½çš„è§‚ç‚¹ã€‚è¿™å½“ç„¶å¼•å‘äº†ä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•å°†è¿™ä¸€æ™ºæ…§åº”ç”¨äºç­–ç•¥å’Œå‘½ä»¤è®¾è®¡æ¨¡å¼ï¼Ÿè¿™é‡Œæœ‰ä¸€ä¸ªå¯èƒ½çš„åŸºäºå€¼è¯­ä¹‰çš„è§£å†³æ–¹æ¡ˆï¼šåˆ©ç”¨ <code>std::function</code> çš„æŠ½è±¡èƒ½åŠ›ã€‚</p>
<p><strong><code>std::function</code> ç®€ä»‹</strong></p>
<p>å¦‚æœä½ è¿˜æ²¡æœ‰å¬è¯´è¿‡ <code>std::function</code>ï¼Œè®©æˆ‘æ¥ä»‹ç»ä¸€ä¸‹ã€‚<code>std::function</code> æ˜¯å¯¹å¯è°ƒç”¨å¯¹è±¡ï¼ˆä¾‹å¦‚å‡½æ•°æŒ‡é’ˆã€å‡½æ•°å¯¹è±¡æˆ–lambdaè¡¨è¾¾å¼ï¼‰çš„æŠ½è±¡ã€‚å”¯ä¸€çš„è¦æ±‚æ˜¯è¯¥å¯è°ƒç”¨å¯¹è±¡æ»¡è¶³ç‰¹å®šçš„å‡½æ•°ç±»å‹ï¼Œè¿™æ˜¯ä½œä¸ºå”¯ä¸€çš„æ¨¡æ¿å‚æ•°ä¼ é€’ç»™ <code>std::function</code> çš„ã€‚ä»¥ä¸‹ä»£ç ç»™å‡ºäº†ä¸€ä¸ªå°è±¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;functional&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;foo: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„ std::function å®ä¾‹ã€‚è°ƒç”¨å®ƒä¼šå¯¼è‡´ std::bad_function_call å¼‚å¸¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">f</span><span class="p">{};</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// å°†ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡èµ‹å€¼ç»™ &#39;f&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">f</span> <span class="o">=</span> <span class="p">[](</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;lambda: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>  <span class="c1">// ä½¿ç”¨æ•´æ•° &#39;1&#39; è°ƒç”¨ &#39;f&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">g</span> <span class="o">=</span> <span class="n">f</span><span class="p">;</span>  <span class="c1">// å°† &#39;f&#39; å¤åˆ¶åˆ° &#39;g&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="n">f</span> <span class="o">=</span> <span class="n">foo</span><span class="p">;</span>  <span class="c1">// å°†ä¸åŒçš„å¯è°ƒç”¨å¯¹è±¡èµ‹å€¼ç»™ &#39;f&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>  <span class="c1">// ä½¿ç”¨æ•´æ•° &#39;2&#39; è°ƒç”¨ &#39;f&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="n">g</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>  <span class="c1">// ä½¿ç”¨æ•´æ•° &#39;3&#39; è°ƒç”¨ &#39;g&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ <code>main()</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>f</code> çš„ <code>std::function</code> å®ä¾‹ã€‚æ¨¡æ¿å‚æ•°æŒ‡å®šäº†æ‰€éœ€çš„å‡½æ•°ç±»å‹ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™æ˜¯ <code>void(int)</code>ã€‚â€œå‡½æ•°ç±»å‹â€¦â€¦â€ä½ è¯´ã€‚â€œä½ ä¸æŒ‡çš„æ˜¯å‡½æ•°æŒ‡é’ˆç±»å‹å—ï¼Ÿâ€ å¥½å§ï¼Œç”±äºè¿™å¯èƒ½æ˜¯ä½ ä»¥å‰å¾ˆå°‘è§è¿‡çš„ä¸œè¥¿ï¼Œè®©æˆ‘è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯å‡½æ•°ç±»å‹ï¼Œå¹¶å°†å…¶ä¸ä½ å¯èƒ½æ›´å¸¸è§çš„å‡½æ•°æŒ‡é’ˆç±»å‹è¿›è¡Œå¯¹æ¯”ã€‚ä»¥ä¸‹ç¤ºä¾‹åŒæ—¶ä½¿ç”¨äº†å‡½æ•°ç±»å‹å’Œå‡½æ•°æŒ‡é’ˆç±»å‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">using</span> <span class="n">FunctionType</span> <span class="o">=</span> <span class="kt">double</span><span class="p">(</span><span class="kt">double</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">FunctionPointerType</span> <span class="o">=</span> <span class="kt">double</span><span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="kt">double</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æˆ–è€…ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1">// using FunctionPointerType = FunctionType*;
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬ä¸€è¡Œæ˜¾ç¤ºäº†ä¸€ä¸ªå‡½æ•°ç±»å‹ã€‚æ­¤ç±»å‹è¡¨ç¤ºä»»ä½•æ¥å— <code>double</code> å¹¶è¿”å› <code>double</code> çš„å‡½æ•°ã€‚è¿™ç§å‡½æ•°ç±»å‹çš„ä¾‹å­åŒ…æ‹¬ <code>std::sin</code>ã€<code>std::cos</code>ã€<code>std::log</code> æˆ– <code>std::sqrt</code> çš„ç›¸åº”é‡è½½ã€‚ç¬¬äºŒè¡Œæ˜¾ç¤ºäº†ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆç±»å‹ã€‚æ³¨æ„æ‹¬å·ä¸­çš„å°æ˜Ÿå·â€”â€”è¿™ä½¿å¾—å®ƒæˆä¸ºæŒ‡é’ˆç±»å‹ã€‚æ­¤ç±»å‹è¡¨ç¤ºå‡½æ•°ç±»å‹çš„ <code>FunctionType</code> å‡½æ•°çš„åœ°å€ã€‚å› æ­¤ï¼Œå‡½æ•°ç±»å‹å’Œå‡½æ•°æŒ‡é’ˆç±»å‹ä¹‹é—´çš„å…³ç³»éå¸¸ç±»ä¼¼äº <code>int</code> å’ŒæŒ‡å‘ <code>int</code> çš„æŒ‡é’ˆä¹‹é—´çš„å…³ç³»ï¼šè™½ç„¶æœ‰è®¸å¤š <code>int</code> å€¼ï¼Œä½†æŒ‡å‘ <code>int</code> çš„æŒ‡é’ˆå­˜å‚¨çš„æ˜¯æ°å¥½ä¸€ä¸ª <code>int</code> çš„åœ°å€ã€‚</p>
<p>å›åˆ° <code>std::function</code> ç¤ºä¾‹ï¼šæœ€åˆï¼Œå®ä¾‹æ˜¯ç©ºçš„ï¼Œå› æ­¤ä½ ä¸èƒ½è°ƒç”¨å®ƒã€‚å¦‚æœä½ ä»ç„¶å°è¯•è¿™æ ·åšï¼Œ<code>std::function</code> å®ä¾‹ä¼šæŠ›å‡º <code>std::bad_function_call</code> å¼‚å¸¸ã€‚æœ€å¥½åˆ«æƒ¹å®ƒã€‚è®©æˆ‘ä»¬ä¸ºå®ƒåˆ†é…ä¸€äº›æ»¡è¶³å‡½æ•°ç±»å‹è¦æ±‚çš„å¯è°ƒç”¨å¯¹è±¡ï¼Œä¾‹å¦‚ä¸€ä¸ªï¼ˆå¯èƒ½æ˜¯æœ‰çŠ¶æ€çš„ï¼‰lambdaã€‚è¿™ä¸ªlambdaæ¥å—ä¸€ä¸ª <code>int</code> å¹¶ä¸è¿”å›ä»»ä½•ä¸œè¥¿ã€‚ç›¸åï¼Œå®ƒé€šè¿‡æè¿°æ€§çš„è¾“å‡ºæ¶ˆæ¯æ‰“å°å‡ºå®ƒå·²è¢«è°ƒç”¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="nl">lambda</span><span class="p">:</span> <span class="mi">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¥½çš„ï¼Œè¿™å·¥ä½œå¾—å¾ˆå¥½ã€‚è®©æˆ‘ä»¬è¯•è¯•åˆ«çš„ï¼šæˆ‘ä»¬ç°åœ¨é€šè¿‡ <code>f</code> åˆ›å»ºå¦ä¸€ä¸ª <code>std::function</code> å®ä¾‹ <code>g</code>ã€‚ç„¶åæˆ‘ä»¬å°†å¦ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡åˆ†é…ç»™ <code>f</code>ã€‚è¿™æ¬¡ï¼Œæˆ‘ä»¬åˆ†é…äº† <code>foo()</code> å‡½æ•°çš„æŒ‡é’ˆã€‚åŒæ ·ï¼Œè¿™ä¸ªå¯è°ƒç”¨å¯¹è±¡æ»¡è¶³ <code>std::function</code> å®ä¾‹çš„è¦æ±‚ï¼šå®ƒæ¥å—ä¸€ä¸ª <code>int</code> å¹¶ä¸è¿”å›ä»»ä½•ä¸œè¥¿ã€‚ç›´æ¥åœ¨åˆ†é…åï¼Œä½ ç”¨æ•´æ•° <code>2</code> è°ƒç”¨ <code>f</code>ï¼Œè¿™è§¦å‘äº†é¢„æœŸçš„è¾“å‡ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="nl">foo</span><span class="p">:</span> <span class="mi">2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™å¯èƒ½æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚ç„¶è€Œï¼Œä¸‹ä¸€ä¸ªå‡½æ•°è°ƒç”¨è¦æœ‰è¶£å¾—å¤šã€‚å¦‚æœä½ ç”¨æ•´æ•° <code>3</code> è°ƒç”¨ <code>g</code>ï¼Œè¾“å‡ºè¡¨æ˜ <code>std::function</code> åšå®åœ°åŸºäºå€¼è¯­ä¹‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="nl">lambda</span><span class="p">:</span> <span class="mi">3</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨åˆå§‹åŒ– <code>g</code> æœŸé—´ï¼Œå®ä¾‹ <code>f</code> è¢«å¤åˆ¶ã€‚å¹¶ä¸”å®ƒæ˜¯æŒ‰ç…§å€¼åº”è¯¥è¢«å¤åˆ¶çš„æ–¹å¼å¤åˆ¶çš„ï¼šå®ƒæ²¡æœ‰æ‰§è¡Œâ€œæµ…æ‹·è´â€ï¼Œè¿™ä¼šå¯¼è‡´å½“ <code>f</code> éšåæ”¹å˜æ—¶å½±å“ <code>g</code>ï¼Œè€Œæ˜¯æ‰§è¡Œäº†ä¸€ä¸ªå®Œæ•´çš„å¤åˆ¶ï¼ˆæ·±æ‹·è´ï¼‰ï¼ŒåŒ…æ‹¬lambdaçš„å¤åˆ¶ã€‚å› æ­¤ï¼Œæ”¹å˜ <code>f</code> ä¸ä¼šå½±å“ <code>g</code>ã€‚è¿™å°±æ˜¯å€¼è¯­ä¹‰çš„å¥½å¤„ï¼šä»£ç ç®€å•ç›´è§‚ï¼Œä½ ä¸å¿…æ‹…å¿ƒæ„å¤–ç ´åå…¶ä»–åœ°æ–¹çš„å†…å®¹ã€‚</p>
<p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œ<code>std::function</code> çš„åŠŸèƒ½å¯èƒ½ä¼šè®©äººæ„Ÿè§‰æœ‰ç‚¹åƒé­”æ³•ï¼šå®ƒæ˜¯å¦‚ä½•èƒ½å¤Ÿæ¥å—ä»»ä½•ç±»å‹çš„å¯è°ƒç”¨å¯¹è±¡ï¼ŒåŒ…æ‹¬åƒlambdaè¿™æ ·çš„ä¸œè¥¿ï¼Ÿå®ƒæ˜¯å¦‚ä½•å­˜å‚¨ä»»ä½•å¯èƒ½çš„ç±»å‹ï¼Œç”šè‡³æ˜¯å®ƒä¸çŸ¥é“çš„ç±»å‹ï¼Œå³ä½¿è¿™äº›ç±»å‹æ˜¾ç„¶æ²¡æœ‰ä»»ä½•å…±åŒç‚¹ï¼Ÿä¸ç”¨æ‹…å¿ƒï¼šåœ¨ç¬¬8ç« ï¼Œæˆ‘ä¼šè¯¦ç»†ä»‹ç»ä¸€ç§ç§°ä¸ºç±»å‹æ“¦é™¤çš„æŠ€æœ¯ï¼Œå®ƒæ˜¯ <code>std::function</code> èƒŒåçš„é­”æ³•ã€‚</p>
<p><strong>é‡æ„ç»˜åˆ¶å½¢çŠ¶çš„ä»£ç </strong></p>
<p><code>std::function</code> æä¾›äº†æˆ‘ä»¬éœ€è¦çš„ä¸€åˆ‡æ¥é‡æ„æˆ‘ä»¬åœ¨â€œæŒ‡å—19ï¼šä½¿ç”¨ç­–ç•¥æ¨¡å¼éš”ç¦»æ“ä½œæ–¹å¼â€ä¸­çš„ç»˜å›¾ç¤ºä¾‹ã€‚å®ƒè¡¨ç¤ºå•ä¸ªå¯è°ƒç”¨å¯¹è±¡çš„æŠ½è±¡ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æ›¿æ¢ <code>DrawCircleStrategy</code> å’Œ <code>DrawSquareStrategy</code> å±‚æ¬¡ç»“æ„æ‰€éœ€è¦çš„ï¼Œæ¯ä¸ªå±‚æ¬¡ç»“æ„éƒ½åŒ…å«ä¸€ä¸ªå•ä¸€çš„è™šå‡½æ•°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¾èµ–äº <code>std::function</code> çš„æŠ½è±¡èƒ½åŠ›ï¼š</p>
<p>Shape.h</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">Shape</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>Circle.h</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;functional&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Circle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">using</span> <span class="n">DrawStrategy</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="n">Circle</span> <span class="k">const</span><span class="o">&amp;</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="nf">Circle</span><span class="p">(</span><span class="kt">double</span> <span class="n">radius</span><span class="p">,</span> <span class="n">DrawStrategy</span> <span class="n">drawer</span><span class="p">)</span>   
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">radius_</span><span class="p">(</span><span class="n">radius</span><span class="p">),</span> <span class="n">drawer_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">drawer</span><span class="p">))</span>   
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="c1">// æ£€æŸ¥ç»™å®šåŠå¾„çš„æœ‰æ•ˆæ€§ä»¥åŠ &#39;std::function&#39; å®ä¾‹æ˜¯å¦ä¸ä¸ºç©º 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">drawer_</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="cm">/* some arguments */</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">radius</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">radius_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">radius_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">DrawStrategy</span> <span class="n">drawer_</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>Square.h</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;functional&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Square</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">using</span> <span class="n">DrawStrategy</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="n">Square</span> <span class="k">const</span><span class="o">&amp;</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="nf">Square</span><span class="p">(</span><span class="kt">double</span> <span class="n">side</span><span class="p">,</span> <span class="n">DrawStrategy</span> <span class="n">drawer</span><span class="p">)</span>   
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">side_</span><span class="p">(</span><span class="n">side</span><span class="p">),</span> <span class="n">drawer_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">drawer</span><span class="p">))</span>   
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="c1">// æ£€æŸ¥ç»™å®šè¾¹é•¿çš„æœ‰æ•ˆæ€§ä»¥åŠ &#39;std::function&#39; å®ä¾‹æ˜¯å¦ä¸ä¸ºç©º 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">drawer_</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="cm">/* some arguments */</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">side</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">side_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">side_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">DrawStrategy</span> <span class="n">drawer_</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¦–å…ˆï¼Œåœ¨ <code>Circle</code> ç±»ä¸­ï¼Œæˆ‘ä»¬ä¸ºæœŸæœ›çš„ <code>std::function</code> ç±»å‹æ·»åŠ äº†ä¸€ä¸ªç±»å‹åˆ«åï¼ˆï¼‰ã€‚è¿™ä¸ª <code>std::function</code> ç±»å‹è¡¨ç¤ºä»»ä½•å¯ä»¥æ¥å— <code>Circle</code> å¯¹è±¡å’Œå¯èƒ½å‡ ä¸ªä¸ç»˜å›¾ç›¸å…³çš„å‚æ•°ï¼Œå¹¶ä¸”ä¸è¿”å›ä»»ä½•ä¸œè¥¿çš„å¯è°ƒç”¨å¯¹è±¡ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬åœ¨ <code>Square</code> ç±»ä¸­ä¹Ÿæ·»åŠ äº†ç›¸åº”çš„ç±»å‹åˆ«åï¼ˆï¼‰ã€‚åœ¨ <code>Circle</code> å’Œ <code>Square</code> çš„æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ç°åœ¨æ¥å—ä¸€ä¸ª <code>std::function</code> ç±»å‹çš„å®ä¾‹ï¼ˆï¼‰ä½œä¸ºæŒ‡å‘ç­–ç•¥åŸºç±»ï¼ˆ<code>DrawCircleStrategy</code> æˆ– <code>DrawSquareStrategy</code>ï¼‰æŒ‡é’ˆçš„æ›¿ä»£ã€‚è¿™ä¸ªå®ä¾‹ç«‹å³è¢«ç§»åŠ¨ï¼ˆï¼‰åˆ°æ•°æ®æˆå‘˜ <code>drawer_</code> ä¸­ï¼Œè¯¥æˆå‘˜ä¹Ÿæ˜¯ <code>DrawStrategy</code> ç±»å‹ï¼ˆï¼‰ã€‚</p>
<p>â€œå˜¿ï¼Œä¸ºä»€ä¹ˆä½ é€šè¿‡å€¼ä¼ é€’ <code>std::function</code> å®ä¾‹ï¼Ÿè¿™ä¸æ˜¯éå¸¸ä½æ•ˆå—ï¼Ÿæˆ‘ä»¬åº”è¯¥ä¼˜å…ˆé€šè¿‡å¼•ç”¨ä¼ é€’å—ï¼Ÿâ€ ç®€çŸ­å›ç­”ï¼šä¸ï¼Œé€šè¿‡å€¼ä¼ é€’å¹¶ä¸ä½æ•ˆï¼Œè€Œæ˜¯å¯¹æ›¿ä»£æ–¹æ¡ˆçš„ä¸€ç§ä¼˜é›…å¦¥åã€‚æˆ‘æ‰¿è®¤ï¼Œè¿™å¯èƒ½ä»¤äººæƒŠè®¶ã€‚ç”±äºè¿™æ˜¯ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„å®ç°ç»†èŠ‚ï¼Œè®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨å¸¸é‡å¼•ç”¨ï¼Œæˆ‘ä»¬ä¼šé‡åˆ° rvalue ä¸å¿…è¦åœ°è¢«å¤åˆ¶çš„ç¼ºç‚¹ã€‚å¦‚æœä¼ é€’ç»™æˆ‘ä»¬çš„æ˜¯ä¸€ä¸ª rvalueï¼Œè¿™ä¸ª rvalue å°†ç»‘å®šåˆ°ï¼ˆlvalueï¼‰å¸¸é‡å¼•ç”¨ã€‚ç„¶è€Œï¼Œå½“æˆ‘ä»¬æŠŠè¿™ä¸ªå¸¸é‡å¼•ç”¨ä¼ é€’ç»™æ•°æ®æˆå‘˜æ—¶ï¼Œå®ƒä¼šè¢«å¤åˆ¶ã€‚è¿™ä¸æ˜¯æˆ‘ä»¬çš„æ„å›¾ï¼šæˆ‘ä»¬è‡ªç„¶å¸Œæœ›å®ƒæ˜¯ç§»åŠ¨çš„ã€‚ç®€å•çš„åŸå› æ˜¯æˆ‘ä»¬ä¸èƒ½ä» <code>const</code> å¯¹è±¡ç§»åŠ¨ï¼ˆå³ä½¿ä½¿ç”¨ <code>std::move</code>ï¼‰ã€‚å› æ­¤ï¼Œä¸ºäº†é«˜æ•ˆå¤„ç† rvalueï¼Œæˆ‘ä»¬å¿…é¡»æä¾›æ¥å— rvalue å¼•ç”¨çš„ <code>Circle</code> å’Œ <code>Square</code> æ„é€ å‡½æ•°é‡è½½ï¼ˆ<code>DrawStrategy&amp;&amp;</code>ï¼‰ã€‚ä¸ºäº†æ€§èƒ½ï¼Œæˆ‘ä»¬å°†ä¸º <code>Circle</code> å’Œ <code>Square</code> æä¾›ä¸¤ä¸ªæ„é€ å‡½æ•°ã€‚</p>
<p>æä¾›ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼ˆä¸€ä¸ªç”¨äº lvalueï¼Œä¸€ä¸ªç”¨äº rvalueï¼‰ç¡®å®æœ‰æ•ˆä¸”é«˜æ•ˆï¼Œä½†æˆ‘ä¸ä¼šç§°ä¹‹ä¸ºä¼˜é›…ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬åº”è¯¥è®©åŒäº‹é¿å…å¤„ç†è¿™äº›é—®é¢˜ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬åˆ©ç”¨äº† <code>std::function</code> çš„å®ç°ã€‚<code>std::function</code> æä¾›äº†æ‹·è´æ„é€ å‡½æ•°å’Œç§»åŠ¨æ„é€ å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬çŸ¥é“å®ƒå¯ä»¥é«˜æ•ˆåœ°ç§»åŠ¨ã€‚å½“æˆ‘ä»¬é€šè¿‡å€¼ä¼ é€’ <code>std::function</code> æ—¶ï¼Œè¦ä¹ˆä¼šè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ï¼Œè¦ä¹ˆä¼šè°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°ã€‚å¦‚æœæˆ‘ä»¬ä¼ é€’çš„æ˜¯ä¸€ä¸ª lvalueï¼Œæ‹·è´æ„é€ å‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œå¤åˆ¶ lvalueã€‚ç„¶åæˆ‘ä»¬å°†è¿™ä¸ªå‰¯æœ¬ç§»åŠ¨åˆ°æ•°æ®æˆå‘˜ä¸­ã€‚æ€»å…±ï¼Œæˆ‘ä»¬å°†æ‰§è¡Œä¸€æ¬¡æ‹·è´å’Œä¸€æ¬¡ç§»åŠ¨æ¥åˆå§‹åŒ– <code>drawer_</code> æ•°æ®æˆå‘˜ã€‚å¦‚æœæˆ‘ä»¬ä¼ é€’çš„æ˜¯ä¸€ä¸ª rvalueï¼Œç§»åŠ¨æ„é€ å‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œç§»åŠ¨ rvalueã€‚ç»“æœå‚æ•°ç­–ç•¥å°†è¢«ç§»åŠ¨åˆ°æ•°æ®æˆå‘˜ <code>drawer_</code> ä¸­ã€‚æ€»å…±ï¼Œæˆ‘ä»¬å°†æ‰§è¡Œä¸¤æ¬¡ç§»åŠ¨æ“ä½œæ¥åˆå§‹åŒ– <code>drawer_</code> æ•°æ®æˆå‘˜ã€‚å› æ­¤ï¼Œè¿™ç§å½¢å¼ä»£è¡¨äº†ä¸€ç§å¾ˆå¥½çš„å¦¥åï¼šå®ƒä¼˜é›…ï¼Œå‡ ä¹æ²¡æœ‰æ•ˆç‡ä¸Šçš„å·®å¼‚ã€‚</p>
<p>ä¸€æ—¦æˆ‘ä»¬é‡æ„äº† <code>Circle</code> å’Œ <code>Square</code> ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥ä»»ä½•å½¢å¼å®ç°ä¸åŒçš„ç»˜å›¾ç­–ç•¥ï¼ˆä½œä¸ºå‡½æ•°ã€å‡½æ•°å¯¹è±¡æˆ– lambdaï¼‰ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä»¥ä¸‹ <code>OpenGLCircleStrategy</code> ä½œä¸ºå‡½æ•°å¯¹è±¡ï¼š</p>
<p>OpenGLCircleStrategy.h</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Circle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">OpenGLCircleStrategy</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">OpenGLCircleStrategy</span><span class="p">(</span><span class="cm">/* Drawing related arguments */</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="n">Circle</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">circle</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="cm">/* ç»˜å›¾ç›¸å…³çš„æ•°æ®æˆå‘˜ï¼Œå¦‚é¢œè‰²ã€çº¹ç†ç­‰ */</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>å”¯ä¸€éœ€è¦éµå¾ªçš„çº¦å®šæ˜¯æˆ‘ä»¬éœ€è¦æä¾›ä¸€ä¸ªè°ƒç”¨æ“ä½œç¬¦ï¼Œè¯¥æ“ä½œç¬¦æ¥å—ä¸€ä¸ª <code>Circle</code> å’Œå¯èƒ½å‡ ä¸ªä¸ç»˜å›¾ç›¸å…³çš„å‚æ•°ï¼Œå¹¶ä¸”ä¸è¿”å›ä»»ä½•ä¸œè¥¿ï¼ˆæ»¡è¶³å‡½æ•°ç±»å‹ <code>void(Circle const&amp;, /*â€¦*/)</code>ï¼‰ã€‚</p>
<p>å‡è®¾ç±»ä¼¼çš„å®ç°ç”¨äº <code>OpenGLSquareStrategy</code>ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥åˆ›å»ºä¸åŒç§ç±»çš„å½¢çŠ¶ï¼Œé…ç½®æ‰€éœ€çš„ç»˜å›¾è¡Œä¸ºï¼Œå¹¶æœ€ç»ˆç»˜åˆ¶å®ƒä»¬ï¼š</p>
<p>main.cpp</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Circle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Square.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;OpenGLCircleStrategy.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;OpenGLSquareStrategy.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">using</span> <span class="n">Shapes</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Shape</span><span class="o">&gt;&gt;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">Shapes</span> <span class="n">shapes</span><span class="p">{};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ›å»ºä¸€äº›å½¢çŠ¶ï¼Œæ¯ä¸ªå½¢çŠ¶éƒ½é…å¤‡äº†ç›¸åº”çš„ OpenGL ç»˜å›¾ç­–ç•¥ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">shapes</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Circle</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">2.3</span><span class="p">,</span> <span class="n">OpenGLCircleStrategy</span><span class="p">(</span><span class="cm">/*...red...*/</span><span class="p">)));</span> 
</span></span><span class="line"><span class="cl">    <span class="n">shapes</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Square</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">OpenGLSquareStrategy</span><span class="p">(</span><span class="cm">/*...green...*/</span><span class="p">)));</span> 
</span></span><span class="line"><span class="cl">    <span class="n">shapes</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Circle</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">4.1</span><span class="p">,</span> <span class="n">OpenGLCircleStrategy</span><span class="p">(</span><span class="cm">/*...blue...*/</span><span class="p">)));</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ç»˜åˆ¶æ‰€æœ‰å½¢çŠ¶ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="k">const</span><span class="o">&amp;</span> <span class="nl">shape</span> <span class="p">:</span> <span class="n">shapes</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">shape</span><span class="o">-&gt;</span><span class="n">draw</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>main()</code> å‡½æ•°ä¸ä½¿ç”¨ç»å…¸ç­–ç•¥å®ç°çš„åŸå§‹å®ç°éå¸¸ç›¸ä¼¼ï¼ˆå‚è§â€œæŒ‡å—19ï¼šä½¿ç”¨ç­–ç•¥æ¨¡å¼éš”ç¦»æ“ä½œæ–¹å¼â€ï¼‰ã€‚ç„¶è€Œï¼Œè¿™ç§éä¾µå…¥å¼ã€æ— åŸºç±»çš„æ–¹æ³•è¿›ä¸€æ­¥å‡å°‘äº†è€¦åˆã€‚è¿™åœ¨è§£å†³æ–¹æ¡ˆçš„ä¾èµ–å…³ç³»å›¾ä¸­å˜å¾—æ˜æ˜¾ï¼ˆè§å›¾5-9ï¼‰ï¼šæˆ‘ä»¬å¯ä»¥ä»¥ä»»ä½•å½¢å¼å®ç°ç»˜å›¾åŠŸèƒ½ï¼ˆä½œä¸ºè‡ªç”±å‡½æ•°ã€å‡½æ•°å¯¹è±¡æˆ– lambdaï¼‰ï¼Œå¹¶ä¸”ä¸å¿…éµå®ˆåŸºç±»çš„è¦æ±‚ã€‚æ­¤å¤–ï¼Œé€šè¿‡ <code>std::function</code>ï¼Œæˆ‘ä»¬è‡ªåŠ¨åè½¬äº†ä¾èµ–å…³ç³»ï¼ˆå‚è§â€œæŒ‡å—9ï¼šæ³¨æ„æŠ½è±¡çš„æ‰€æœ‰æƒâ€ï¼‰ã€‚</p>
<p><strong>æ€§èƒ½åŸºå‡†æµ‹è¯•</strong></p>
<p>â€œæˆ‘å–œæ¬¢è¿™ç§çµæ´»æ€§ã€è‡ªç”±åº¦ã€‚è¿™å¤ªæ£’äº†ï¼ä½†æ˜¯æ€§èƒ½å‘¢ï¼Ÿâ€ æ˜¯çš„ï¼Œå°±åƒä¸€ä¸ªçœŸæ­£çš„C++å¼€å‘è€…ä¼šè¯´çš„é‚£æ ·ã€‚å½“ç„¶ï¼Œæ€§èƒ½éå¸¸é‡è¦ã€‚ä½†åœ¨å±•ç¤ºæ€§èƒ½ç»“æœä¹‹å‰ï¼Œè®©æˆ‘å…ˆæé†’ä½ æˆ‘ä»¬ç”¨æ¥è·å–è¡¨4-2ï¼ˆâ€œæŒ‡å—16ï¼šä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ‰©å±•æ“ä½œâ€ï¼‰æ•°æ®çš„åŸºå‡†åœºæ™¯ã€‚å¯¹äºåŸºå‡†æµ‹è¯•ï¼Œæˆ‘å®ç°äº†å››ç§ä¸åŒç±»å‹çš„å½¢çŠ¶ï¼ˆåœ†å½¢ã€æ­£æ–¹å½¢ã€æ¤­åœ†å’ŒçŸ©å½¢ï¼‰ã€‚å†æ¬¡è¿è¡Œ25,000æ¬¡å¹³ç§»æ“ä½œåœ¨10,000ä¸ªéšæœºåˆ›å»ºçš„å½¢çŠ¶ä¸Šã€‚æˆ‘ä½¿ç”¨äº†GCC 11.1å’ŒClang 11.1ä¸¤ä¸ªç¼–è¯‘å™¨ï¼Œå¹¶ä¸”åªæ·»åŠ äº† <code>-O3</code> å’Œ <code>-DNDEBUG</code> ç¼–è¯‘æ ‡å¿—ã€‚å¹³å°æ˜¯æ­è½½8æ ¸Intel Core i7å¤„ç†å™¨ï¼ˆ3.8 GHzï¼‰ã€64 GBå†…å­˜çš„macOS Big Surï¼ˆç‰ˆæœ¬11.4ï¼‰ã€‚</p>
<p>æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œä½ å°±å¯ä»¥å‡†å¤‡å¥½æŸ¥çœ‹æ€§èƒ½ç»“æœäº†ã€‚è¡¨5-1å±•ç¤ºäº†åŸºäºç­–ç•¥å®ç°çš„ç»˜å›¾ç¤ºä¾‹ä»¥åŠä½¿ç”¨ <code>std::function</code> çš„è§£å†³æ–¹æ¡ˆçš„æ€§èƒ½æ•°å­—ã€‚</p>
<p><strong>è¡¨5-1 ä¸åŒç­–ç•¥å®ç°çš„æ€§èƒ½ç»“æœ</strong></p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>ç­–ç•¥å®ç°</th>
<th>GCC 11.1</th>
<th>Clang 11.1</th>
</tr>
</thead>
<tbody>
<tr>
<td>é¢å‘å¯¹è±¡è§£å†³æ–¹æ¡ˆ</td>
<td>1.5205 s</td>
<td>1.1480 s</td>
</tr>
<tr>
<td>ä½¿ç”¨ <code>std::function</code></td>
<td>2.1782 s</td>
<td>1.4884 s</td>
</tr>
<tr>
<td>æ‰‹åŠ¨å®ç° <code>std::function</code></td>
<td>1.6354 s</td>
<td>-</td>
</tr>
<tr>
<td>ç»å…¸ç­–ç•¥å®ç°</td>
<td>1.4465 s</td>
<td>1.6372 s</td>
</tr>
</tbody>
</table></div>
<p>ä¸ºäº†å‚è€ƒï¼Œç¬¬ä¸€è¡Œæ˜¾ç¤ºäº†æ¥è‡ªâ€œæŒ‡å—15ï¼šè®¾è®¡ä»¥å¢åŠ ç±»å‹æˆ–æ“ä½œâ€çš„é¢å‘å¯¹è±¡è§£å†³æ–¹æ¡ˆçš„æ€§èƒ½ã€‚å¦‚ä½ æ‰€è§ï¼Œè¿™ä¸ªè§£å†³æ–¹æ¡ˆæä¾›äº†æœ€ä½³æ€§èƒ½ã€‚ç„¶è€Œï¼Œè¿™ä¸æ˜¯æ„å¤–çš„ç»“æœï¼šç”±äºç­–ç•¥è®¾è®¡æ¨¡å¼æ— è®ºå®é™…å®ç°å¦‚ä½•éƒ½ä¼šå¼•å…¥é¢å¤–çš„å¼€é”€ï¼Œå› æ­¤æ€§èƒ½é¢„æœŸä¼šæœ‰æ‰€é™ä½ã€‚</p>
<p>ä¸è¿‡ï¼Œæ„æƒ³ä¸åˆ°çš„æ˜¯ï¼Œ<code>std::function</code> å®ç°å¸¦æ¥äº†æ€§èƒ½å¼€é”€ï¼ˆç‰¹åˆ«æ˜¯åœ¨GCCçš„æƒ…å†µä¸‹æ˜¾è‘—ï¼‰ã€‚ä½†è¯·ç¨ç­‰ï¼Œåœ¨ä½ å°†è¿™ç§æ–¹æ³•æ‰”è¿›å¿ƒç†åƒåœ¾æ¡¶ä¹‹å‰ï¼Œè¯·è€ƒè™‘ç¬¬ä¸‰è¡Œã€‚å®ƒå±•ç¤ºäº†ä½¿ç”¨ç±»å‹æ“¦é™¤æŠ€æœ¯çš„æ‰‹åŠ¨å®ç° <code>std::function</code>ï¼Œè¿™é¡¹æŠ€æœ¯å°†åœ¨ç¬¬8ç« è§£é‡Šã€‚è¿™ä¸ªå®ç°è¡¨ç°å¾—æ›´å¥½ï¼Œå®é™…ä¸Šä¸ç»å…¸ç­–ç•¥è®¾è®¡æ¨¡å¼çš„å®ç°ä¸€æ ·å¥½ï¼ˆæˆ–å¯¹Clangæ¥è¯´å‡ ä¹ä¸€æ ·å¥½ï¼‰ã€‚è¿™ä¸€ç»“æœè¡¨æ˜é—®é¢˜ä¸åœ¨äºå€¼è¯­ä¹‰ï¼Œè€Œæ˜¯ <code>std::function</code> çš„å…·ä½“å®ç°ç»†èŠ‚ã€‚æ€»ä¹‹ï¼Œä»æ€§èƒ½è§’åº¦æ¥çœ‹ï¼ŒåŸºäºå€¼è¯­ä¹‰çš„æ–¹æ³•å¹¶ä¸æ¯”ç»å…¸æ–¹æ³•å·®ï¼Œåè€Œå¦‚å‰æ‰€è¿°ï¼Œå®ƒæ”¹å–„äº†è®¸å¤šä»£ç çš„é‡è¦æ–¹é¢ã€‚</p>
<p><strong>åˆ†æ <code>std::function</code> è§£å†³æ–¹æ¡ˆçš„ä¸è¶³</strong></p>
<p>æ€»ä½“è€Œè¨€ï¼Œç­–ç•¥è®¾è®¡æ¨¡å¼çš„ <code>std::function</code> å®ç°æä¾›äº†è®¸å¤šå¥½å¤„ã€‚é¦–å…ˆï¼Œä½ çš„ä»£ç å˜å¾—æ›´æ¸…æ™°æ˜“è¯»ï¼Œå› ä¸ºä½ ä¸å¿…å¤„ç†æŒ‡é’ˆåŠå…¶ç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ <code>std::unique_ptr</code>ï¼‰ï¼Œä¹Ÿä¸å¿…ç»å†é€šå¸¸çš„å¼•ç”¨è¯­ä¹‰é—®é¢˜ï¼ˆå‚è§â€œæŒ‡å—22ï¼šä¼˜å…ˆä½¿ç”¨å€¼è¯­ä¹‰è€Œéå¼•ç”¨è¯­ä¹‰â€ï¼‰ã€‚å…¶æ¬¡ï¼Œä½ ä¿ƒè¿›äº†æ¾è€¦åˆã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>std::function</code> èµ·åˆ°äº†ç¼–è¯‘é˜²ç«å¢™çš„ä½œç”¨ï¼Œä¿æŠ¤ä½ å…å—ä¸åŒç­–ç•¥å®ç°çš„å®ç°ç»†èŠ‚å½±å“ï¼ŒåŒæ—¶ä¸ºå¼€å‘äººå‘˜æä¾›äº†å·¨å¤§çš„çµæ´»æ€§æ¥å®ç°ä¸åŒçš„ç­–ç•¥è§£å†³æ–¹æ¡ˆã€‚</p>
<p>å°½ç®¡æœ‰è¿™äº›ä¼˜ç‚¹ï¼Œæ²¡æœ‰ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯æ²¡æœ‰ç¼ºç‚¹çš„â€”â€”å³ä½¿æ˜¯ <code>std::function</code> æ–¹æ³•ä¹Ÿæœ‰å…¶åŠ£åŠ¿ã€‚æˆ‘å·²ç»æŒ‡å‡ºï¼Œå¦‚æœä½ ä¾èµ–æ ‡å‡†å®ç°ï¼Œå¯èƒ½ä¼šå­˜åœ¨æ€§èƒ½åŠ£åŠ¿ã€‚è™½ç„¶æœ‰ä¸€äº›è§£å†³æ–¹æ¡ˆå¯ä»¥æœ€å°åŒ–è¿™ç§å½±å“ï¼ˆå‚è§ç¬¬8ç« ï¼‰ï¼Œä½†å®ƒä»ç„¶æ˜¯ä½ åœ¨ä»£ç åº“ä¸­éœ€è¦è€ƒè™‘çš„å› ç´ ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªè®¾è®¡ç›¸å…³çš„é—®é¢˜ã€‚<code>std::function</code> åªèƒ½æ›¿æ¢å•ä¸ªè™šå‡½æ•°ã€‚å¦‚æœä½ éœ€è¦æŠ½è±¡å¤šä¸ªè™šå‡½æ•°ï¼Œè¿™ç§æƒ…å†µå¯èƒ½å‡ºç°åœ¨ä½ æƒ³ä½¿ç”¨ç­–ç•¥è®¾è®¡æ¨¡å¼é…ç½®å¤šä¸ªæ–¹é¢æ—¶ï¼Œæˆ–è€…ä½ éœ€è¦å‘½ä»¤è®¾è®¡æ¨¡å¼ä¸­çš„ <code>undo()</code> å‡½æ•°æ—¶ï¼Œä½ å°†ä¸å¾—ä¸ä½¿ç”¨å¤šä¸ª <code>std::function</code> å®ä¾‹ã€‚è¿™ä¸ä»…ä¼šå› ä¸ºå¤šä¸ªæ•°æ®æˆå‘˜è€Œå¢åŠ ç±»çš„å¤§å°ï¼Œè¿˜ä¼šå› ä¸ºå¦‚ä½•ä¼˜é›…åœ°å¤„ç†ä¼ é€’å¤šä¸ª <code>std::function</code> å®ä¾‹çš„é—®é¢˜è€Œå¸¦æ¥æ¥å£è´Ÿæ‹…ã€‚å› æ­¤ï¼Œ<code>std::function</code> æ–¹æ³•æœ€é€‚åˆç”¨äºæ›¿æ¢å•ä¸€æˆ–éå¸¸å°‘é‡çš„è™šå‡½æ•°ã€‚ä¸è¿‡ï¼Œè¿™å¹¶ä¸æ„å‘³ç€ä½ ä¸èƒ½å¯¹å¤šä¸ªè™šå‡½æ•°ä½¿ç”¨åŸºäºå€¼çš„æ–¹æ³•ï¼šå¦‚æœé‡åˆ°è¿™ç§æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘é€šè¿‡ç›´æ¥åº”ç”¨ <code>std::function</code> æŠ€æœ¯åˆ°ä½ çš„ç±»å‹ä¸Šæ¥æ³›åŒ–è¯¥æ–¹æ³•ã€‚æˆ‘å°†åœ¨ç¬¬8ç« è§£é‡Šå¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚</p>
<p>å°½ç®¡æœ‰è¿™äº›ä¸è¶³ä¹‹å¤„ï¼ŒåŸºäºå€¼è¯­ä¹‰çš„æ–¹æ³•è¢«è¯æ˜æ˜¯ç­–ç•¥è®¾è®¡æ¨¡å¼çš„ä¸€ä¸ªç»ä½³é€‰æ‹©ã€‚å‘½ä»¤è®¾è®¡æ¨¡å¼ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å› æ­¤ï¼Œè¯·è®°ä½è¿™æ¡æŒ‡å—ä½œä¸ºè¿ˆå‘ç°ä»£C++çš„é‡è¦æ­¥éª¤ã€‚</p>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>è€ƒè™‘ä½¿ç”¨ <code>std::function</code> æ¥å®ç°ç­–ç•¥æˆ–å‘½ä»¤è®¾è®¡æ¨¡å¼ã€‚</li>
<li>æ³¨æ„ <code>std::function</code> çš„æ€§èƒ½åŠ£åŠ¿ã€‚</li>
<li>äº†è§£ç±»å‹æ“¦é™¤æ˜¯ç­–ç•¥å’Œå‘½ä»¤è®¾è®¡æ¨¡å¼ä¸­å€¼è¯­ä¹‰æ–¹æ³•çš„ä¸€èˆ¬åŒ–ã€‚</li>
</ul>
<h2 id="ç¬¬å…­ç« -é€‚é…å™¨è§‚å¯Ÿè€…å’Œcrtpè®¾è®¡æ¨¡å¼">ç¬¬å…­ç«  é€‚é…å™¨ã€è§‚å¯Ÿè€…å’ŒCRTPè®¾è®¡æ¨¡å¼
</h2><p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ³¨æ„åŠ›è½¬å‘ä¸‰ä¸ªå¿…é¡»äº†è§£çš„è®¾è®¡æ¨¡å¼ï¼šä¸¤ä¸ªGoFï¼ˆGang of Fourï¼Œå››äººç»„ï¼‰è®¾è®¡æ¨¡å¼â€”â€”é€‚é…å™¨ï¼ˆAdapterï¼‰å’Œè§‚å¯Ÿè€…ï¼ˆObserverï¼‰ï¼Œä»¥åŠå¥‡ç‰¹çš„é€’å½’æ¨¡æ¿æ¨¡å¼ï¼ˆCuriously Recurring Template Pattern, CRTPï¼‰è®¾è®¡æ¨¡å¼ã€‚</p>
<p><strong>å‡†åˆ™24ï¼šä½¿ç”¨é€‚é…å™¨æ ‡å‡†åŒ–æ¥å£</strong></p>
<p>åœ¨â€œå‡†åˆ™24ï¼šä½¿ç”¨é€‚é…å™¨æ ‡å‡†åŒ–æ¥å£â€ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•é€šè¿‡é€‚é…æ¥å£ä½¿ä¸å…¼å®¹çš„äº‹ç‰©ååŒå·¥ä½œã€‚ä¸ºæ­¤ï¼Œæˆ‘å°†å‘ä½ å±•ç¤ºé€‚é…å™¨è®¾è®¡æ¨¡å¼åŠå…¶åœ¨ç»§æ‰¿å±‚æ¬¡ç»“æ„å’Œæ³›å‹ç¼–ç¨‹ä¸­çš„åº”ç”¨ã€‚ä½ è¿˜å°†è·å¾—ä¸åŒç±»å‹é€‚é…å™¨çš„æ¦‚è¿°ï¼ŒåŒ…æ‹¬å¯¹è±¡é€‚é…å™¨ã€ç±»é€‚é…å™¨å’Œå‡½æ•°é€‚é…å™¨ã€‚</p>
<p><strong>å‡†åˆ™25ï¼šåº”ç”¨è§‚å¯Ÿè€…ä½œä¸ºæŠ½è±¡é€šçŸ¥æœºåˆ¶</strong></p>
<p>åœ¨â€œå‡†åˆ™25ï¼šåº”ç”¨è§‚å¯Ÿè€…ä½œä¸ºæŠ½è±¡é€šçŸ¥æœºåˆ¶â€ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•è§‚å¯ŸçŠ¶æ€å˜åŒ–å¹¶æ¥æ”¶ç›¸å…³é€šçŸ¥ã€‚åœ¨æ­¤èƒŒæ™¯ä¸‹ï¼Œæˆ‘å°†å‘ä½ ä»‹ç»è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼ï¼Œè¿™æ˜¯æœ€è‘—åä¸”æœ€å¸¸ç”¨çš„æ¨¡å¼ä¹‹ä¸€ã€‚æˆ‘ä»¬å°†è®¨è®ºç»å…¸çš„GoFé£æ ¼è§‚å¯Ÿè€…æ¨¡å¼ï¼Œä»¥åŠå¦‚ä½•åœ¨ç°ä»£C++ä¸­å®ç°è§‚å¯Ÿè€…æ¨¡å¼ã€‚</p>
<p><strong>å‡†åˆ™26ï¼šä½¿ç”¨CRTPå¼•å…¥é™æ€ç±»å‹åˆ†ç±»</strong></p>
<p>åœ¨â€œå‡†åˆ™26ï¼šä½¿ç”¨CRTPå¼•å…¥é™æ€ç±»å‹åˆ†ç±»â€ä¸­ï¼Œæˆ‘ä»¬å°†å…³æ³¨CRTPã€‚æˆ‘å°†å‘ä½ å±•ç¤ºå¦‚ä½•ä½¿ç”¨CRTPå®šä¹‰ä¸€ç»„ç›¸å…³ç±»å‹çš„ç¼–è¯‘æ—¶å…³ç³»ï¼Œä»¥åŠå¦‚ä½•æ­£ç¡®å®ç°CRTPåŸºç±»ã€‚</p>
<p><strong>å‡†åˆ™27ï¼šä½¿ç”¨CRTPåˆ›å»ºé™æ€æ··åˆç±»</strong></p>
<p>åœ¨â€œå‡†åˆ™27ï¼šä½¿ç”¨CRTPåˆ›å»ºé™æ€æ··åˆç±»â€ä¸­ï¼Œæˆ‘å°†ç»§ç»­è®²è¿°CRTPçš„åº”ç”¨ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨CRTPåˆ›å»ºç¼–è¯‘æ—¶æ··åˆç±»ã€‚æˆ‘ä»¬è¿˜å°†çœ‹åˆ°è¯­ä¹‰ç»§æ‰¿ä¸æŠ€æœ¯ç»§æ‰¿ä¹‹é—´çš„åŒºåˆ«ï¼šè¯­ä¹‰ç»§æ‰¿ç”¨äºåˆ›å»ºæŠ½è±¡ï¼Œè€ŒæŠ€æœ¯ç»§æ‰¿ä»…ä½œä¸ºå®ç°ç»†èŠ‚ï¼Œç”¨äºæé«˜æŠ€æœ¯ä¸Šçš„ä¼˜é›…æ€§å’Œä¾¿åˆ©æ€§ã€‚</p>
<h3 id="å‡†åˆ™24ä½¿ç”¨é€‚é…å™¨æ ‡å‡†åŒ–æ¥å£">å‡†åˆ™24ï¼šä½¿ç”¨é€‚é…å™¨æ ‡å‡†åŒ–æ¥å£
</h3><p>å‡è®¾ä½ å·²ç»å®ç°äº†â€œå‡†åˆ™3ï¼šåˆ†ç¦»æ¥å£ä»¥é¿å…äººä¸ºè€¦åˆâ€ä¸­çš„æ–‡æ¡£ç¤ºä¾‹ï¼Œå¹¶ä¸”å› ä¸ºä½ ä¸¥æ ¼éµå¾ªæ¥å£éš”ç¦»åŸåˆ™ï¼ˆISPï¼‰ï¼Œä½ å¯¹å®ƒçš„è¿ä½œæ–¹å¼ç›¸å½“æ»¡æ„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">JSONExportable</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">virtual</span> <span class="o">~</span><span class="n">JSONExportable</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">exportToJSON</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Serializable</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">virtual</span> <span class="o">~</span><span class="n">Serializable</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">ByteStream</span><span class="o">&amp;</span> <span class="n">bs</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Document</span> 
</span></span><span class="line"><span class="cl">   <span class="o">:</span> <span class="k">public</span> <span class="n">JSONExportable</span> 
</span></span><span class="line"><span class="cl">   <span class="p">,</span> <span class="k">public</span> <span class="n">Serializable</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶è€Œï¼Œæœ‰ä¸€å¤©ä½ éœ€è¦å¼•å…¥Pagesæ–‡æ¡£æ ¼å¼ã€‚å½“ç„¶ï¼Œå®ƒä¸ä½ å·²æœ‰çš„Wordæ–‡æ¡£æ ¼å¼ç›¸ä¼¼ï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œä½ ä¸ç†Ÿæ‚‰Pagesæ ¼å¼çš„å…·ä½“ç»†èŠ‚ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œç”±äºä½ æœ‰å¾ˆå¤šå…¶ä»–äº‹æƒ…è¦åšï¼Œæ²¡æœ‰å¤ªå¤šæ—¶é—´å»ç†Ÿæ‚‰è¿™ç§æ ¼å¼ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œä½ çŸ¥é“æœ‰ä¸€ä¸ªç›¸å½“åˆç†çš„å¼€æºå®ç°â€”â€”OpenPagesç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OpenPages</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="kt">void</span> <span class="n">convertToBytes</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">exportToJSONFormat</span><span class="p">(</span><span class="n">OpenPages</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">pages</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»å¥½çš„æ–¹é¢æ¥çœ‹ï¼Œè¿™ä¸ªç±»å‡ ä¹æä¾›äº†ä½ æ‰€éœ€çš„ä¸€åˆ‡ï¼šä¸€ä¸ªç”¨äºåºåˆ—åŒ–æ–‡æ¡£å†…å®¹çš„<code>convertToBytes()</code>æˆå‘˜å‡½æ•°ï¼Œä»¥åŠä¸€ä¸ªå°†Pagesæ–‡æ¡£è½¬æ¢ä¸ºJSONæ ¼å¼çš„è‡ªç”±å‡½æ•°<code>exportToJSONFormat()</code>ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå®ƒä¸ç¬¦åˆä½ çš„æ¥å£æœŸæœ›ï¼šä½ å¸Œæœ›æœ‰ä¸€ä¸ª<code>serialize()</code>æˆå‘˜å‡½æ•°è€Œä¸æ˜¯<code>convertToBytes()</code>æˆå‘˜å‡½æ•°ã€‚å¹¶ä¸”ä½ å¸Œæœ›æœ‰ä¸€ä¸ª<code>exportToJSON()</code>æˆå‘˜å‡½æ•°è€Œä¸æ˜¯è‡ªç”±å‡½æ•°<code>exportToJSONFormat()</code>ã€‚æœ€ç»ˆï¼Œç¬¬ä¸‰æ–¹ç±»å¹¶æ²¡æœ‰ç»§æ‰¿è‡ªä½ çš„<code>Document</code>åŸºç±»ï¼Œè¿™æ„å‘³ç€ä½ æ— æ³•è½»æ¾åœ°å°†å…¶æ•´åˆåˆ°ç°æœ‰çš„ç±»å±‚æ¬¡ç»“æ„ä¸­ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªé—®é¢˜æœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨é€‚é…å™¨è®¾è®¡æ¨¡å¼è¿›è¡Œæ— ç¼é›†æˆã€‚</p>
<p><strong>ä½¿ç”¨é€‚é…å™¨è®¾è®¡æ¨¡å¼è¿›è¡Œæ— ç¼é›†æˆ</strong></p>
<p>ä¸ºäº†ä½¿<code>OpenPages</code>ç±»é€‚åº”ä½ çš„ç°æœ‰æ¥å£ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªé€‚é…å™¨ç±»ã€‚é€‚é…å™¨ç±»å°†å……å½“æ¡¥æ¢ï¼Œä½¿å¾—<code>OpenPages</code>ç±»èƒ½å¤Ÿç¬¦åˆä½ çš„æ¥å£è¦æ±‚ã€‚ä»¥ä¸‹æ˜¯å…·ä½“çš„å®ç°æ–¹æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// é€‚é…å™¨ç±»ï¼Œä½¿OpenPagesç±»ç¬¦åˆSerializableå’ŒJSONExportableæ¥å£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">OpenPagesAdapter</span> <span class="o">:</span> <span class="k">public</span> <span class="n">JSONExportable</span><span class="p">,</span> <span class="k">public</span> <span class="n">Serializable</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">OpenPages</span> <span class="n">openPages</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">OpenPagesAdapter</span><span class="p">(</span><span class="k">const</span> <span class="n">OpenPages</span><span class="o">&amp;</span> <span class="n">op</span><span class="p">)</span> <span class="o">:</span> <span class="n">openPages</span><span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// å®ç°Serializableæ¥å£çš„serializeæ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">ByteStream</span><span class="o">&amp;</span> <span class="n">bs</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">openPages</span><span class="p">.</span><span class="n">convertToBytes</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å°†convertToBytesçš„ç»“æœå†™å…¥ByteStream
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// è¿™é‡Œå‡è®¾æœ‰ä¸€äº›é€»è¾‘å°†å­—èŠ‚æ•°æ®å†™å…¥bs
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// å®ç°JSONExportableæ¥å£çš„exportToJSONæ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="nf">exportToJSON</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">exportToJSONFormat</span><span class="p">(</span><span class="n">openPages</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä½¿ç”¨é€‚é…å™¨ç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">OpenPages</span> <span class="n">op</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">OpenPagesAdapter</span> <span class="n">adapter</span><span class="p">(</span><span class="n">op</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ç°åœ¨å¯ä»¥åƒä½¿ç”¨Documentç±»ä¸€æ ·ä½¿ç”¨adapter
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">ByteStream</span> <span class="n">bs</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">adapter</span><span class="p">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">adapter</span><span class="p">.</span><span class="n">exportToJSON</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥æ— ç¼åœ°å°†<code>OpenPages</code>ç±»é›†æˆåˆ°ä½ çš„ç°æœ‰ç³»ç»Ÿä¸­ï¼Œè€Œæ— éœ€ä¿®æ”¹å…¶åŸå§‹å®ç°ã€‚é€‚é…å™¨ç±»èµ·åˆ°äº†æ¡¥æ¢çš„ä½œç”¨ï¼Œä½¿å¾—<code>OpenPages</code>ç±»èƒ½å¤Ÿç¬¦åˆä½ çš„æ¥å£æ ‡å‡†ã€‚</p>
<p><strong>é€‚é…å™¨è®¾è®¡æ¨¡å¼è§£æ</strong></p>
<p>é€‚é…å™¨è®¾è®¡æ¨¡å¼æ˜¯ç»å…¸çš„GoFï¼ˆå››äººç»„ï¼‰è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚å®ƒä¸“æ³¨äºæ ‡å‡†åŒ–æ¥å£ï¼Œå¹¶å¸®åŠ©éä¾µå…¥æ€§åœ°å‘ç°æœ‰çš„ç»§æ‰¿å±‚æ¬¡ç»“æ„ä¸­æ·»åŠ åŠŸèƒ½ã€‚</p>
<p><strong>æ„å›¾ï¼š</strong> â€œå°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢ä¸ºå®¢æˆ·æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£ã€‚é€‚é…å™¨ä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œæ— æ³•ååŒå·¥ä½œçš„ç±»èƒ½å¤Ÿä¸€èµ·å·¥ä½œã€‚â€</p>
<p>å›¾6-1å±•ç¤ºäº†ä½ çš„é€‚é…å™¨åœºæ™¯çš„UMLå›¾ï¼šä½ å·²ç»æœ‰äº†<code>Document</code>åŸºç±»ï¼ˆæˆ‘ä»¬æš‚æ—¶å¿½ç•¥<code>JSONExportable</code>å’Œ<code>Serializable</code>æ¥å£ï¼‰ï¼Œå¹¶ä¸”å·²ç»å®ç°äº†å‡ ç§ä¸åŒç±»å‹çš„æ–‡æ¡£ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨<code>Word</code>ç±»ï¼‰ã€‚è¿™ä¸ªå±‚æ¬¡ç»“æ„çš„æ–°æˆå‘˜æ˜¯<code>Pages</code>ç±»ã€‚</p>
<p><code>Pages</code>ç±»å……å½“ç¬¬ä¸‰æ–¹<code>OpenPages</code>ç±»çš„åŒ…è£…å™¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pages</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Document</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="kt">void</span> <span class="n">exportToJSON</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">       <span class="n">exportToJSONFormat</span><span class="p">(</span><span class="n">pages</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">ByteStream</span><span class="o">&amp;</span> <span class="n">bs</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">       <span class="n">pages</span><span class="p">.</span><span class="n">convertToBytes</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">OpenPages</span> <span class="n">pages</span><span class="p">;</span>  <span class="c1">// å¯¹è±¡é€‚é…å™¨çš„ä¾‹å­ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Pages</code>é€šè¿‡å°†è°ƒç”¨è½¬å‘åˆ°ç›¸åº”çš„<code>OpenPages</code>å‡½æ•°æ¥å®ç°<code>Document</code>æ¥å£ï¼šå¯¹<code>exportToJSON()</code>çš„è°ƒç”¨è¢«è½¬å‘åˆ°è‡ªç”±å‡½æ•°<code>exportToJSONFormat()</code>ï¼Œè€Œå¯¹<code>serialize()</code>çš„è°ƒç”¨åˆ™è¢«è½¬å‘åˆ°æˆå‘˜å‡½æ•°<code>convertToBytes()</code>ã€‚</p>
<p>æœ‰äº†<code>Pages</code>ç±»ï¼Œä½ å¯ä»¥è½»æ¾åœ°å°†ç¬¬ä¸‰æ–¹å®ç°é›†æˆåˆ°ç°æœ‰çš„å±‚æ¬¡ç»“æ„ä¸­ã€‚éå¸¸å®¹æ˜“åšåˆ°è¿™ä¸€ç‚¹ï¼šä½ å¯ä»¥åœ¨ä¸ä¿®æ”¹å…¶ä»»ä½•ä»£ç çš„æƒ…å†µä¸‹è¿›è¡Œé›†æˆã€‚è¿™ç§éä¾µå…¥æ€§çš„ç‰¹æ€§æ­£æ˜¯é€‚é…å™¨è®¾è®¡æ¨¡å¼çš„æœ€å¤§ä¼˜åŠ¿ä¹‹ä¸€ï¼šä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡æ·»åŠ é€‚é…å™¨æ¥é€‚åº”ä¸€ä¸ªæ¥å£ä»¥åŒ¹é…å¦ä¸€ä¸ªç°æœ‰æ¥å£ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>Pages</code>ç±»ä½œä¸ºå¯¹<code>OpenPages</code>ç±»å®é™…å®ç°ç»†èŠ‚çš„æŠ½è±¡ã€‚å› æ­¤ï¼Œé€‚é…å™¨è®¾è®¡æ¨¡å¼å°†æ¥å£çš„å…³æ³¨ç‚¹ä¸å®ç°ç»†èŠ‚åˆ†ç¦»ã€‚è¿™å¾ˆå¥½åœ°ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰ï¼Œå¹¶ä¸å¼€é—­åŸåˆ™ï¼ˆOCPï¼‰çš„æ„å›¾ç›¸å¥‘åˆï¼ˆå‚è§â€œæŒ‡å—2ï¼šä¸ºå˜åŒ–è®¾è®¡â€å’Œâ€œæŒ‡å—5ï¼šä¸ºæ‰©å±•è®¾è®¡â€ï¼‰ã€‚</p>
<p>æŸç§ç¨‹åº¦ä¸Šï¼Œ<code>Pages</code>é€‚é…å™¨ä½œä¸ºä¸€ä¸ªé—´æ¥å±‚ï¼Œä»ä¸€ç»„å‡½æ•°æ˜ å°„åˆ°å¦ä¸€ç»„å‡½æ•°ã€‚è¯·æ³¨æ„ï¼Œä¸¥æ ¼æ¥è¯´ï¼Œå¹¶ä¸ä¸€å®šéœ€è¦å°†ä¸€ä¸ªå‡½æ•°æ˜ å°„åˆ°å¦ä¸€ä¸ªå‡½æ•°ã€‚ç›¸åï¼Œä½ å¯ä»¥çµæ´»åœ°å†³å®šå¦‚ä½•å°†é¢„æœŸçš„å‡½æ•°é›†æ˜ å°„åˆ°å¯ç”¨çš„å‡½æ•°é›†ã€‚å› æ­¤ï¼Œé€‚é…å™¨å¹¶ä¸ä¸€å®šä»£è¡¨ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œä¹Ÿå¯ä»¥æ”¯æŒä¸€å¯¹å¤šçš„å…³ç³»ã€‚</p>
<p>å‡è®¾ä½ æœ‰ä»¥ä¸‹ä¸¤ä¸ªç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// ç¬¬ä¸‰æ–¹åº“æä¾›çš„ç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">OpenPages</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="n">convertToBytes</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">exportToJSONFormat</span><span class="p">(</span><span class="n">OpenPages</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">pages</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»¥åŠä½ å·²æœ‰çš„<code>Document</code>åŸºç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Document</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="o">~</span><span class="n">Document</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">exportToJSON</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">ByteStream</span><span class="o">&amp;</span> <span class="n">bs</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸ºäº†ä½¿<code>OpenPages</code>ç±»é€‚åº”<code>Document</code>æ¥å£ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªé€‚é…å™¨ç±»<code>Pages</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pages</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Document</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">OpenPages</span> <span class="n">pages</span><span class="p">;</span>  <span class="c1">// å¯¹è±¡é€‚é…å™¨çš„ä¾‹å­ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="n">exportToJSON</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">       <span class="n">exportToJSONFormat</span><span class="p">(</span><span class="n">pages</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">ByteStream</span><span class="o">&amp;</span> <span class="n">bs</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">       <span class="n">pages</span><span class="p">.</span><span class="n">convertToBytes</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>Pages</code>ç±»é€šè¿‡å°†<code>Document</code>æ¥å£çš„æ–¹æ³•è½¬å‘ç»™<code>OpenPages</code>ç±»çš„æ–¹æ³•ï¼Œå®ç°äº†é€‚é…å™¨çš„åŠŸèƒ½ã€‚å…·ä½“æ¥è¯´ï¼š</p>
<ul>
<li><code>exportToJSON()</code>æ–¹æ³•è¢«è½¬å‘åˆ°è‡ªç”±å‡½æ•°<code>exportToJSONFormat()</code>ã€‚</li>
<li><code>serialize()</code>æ–¹æ³•è¢«è½¬å‘åˆ°<code>OpenPages</code>ç±»çš„<code>convertToBytes()</code>æ–¹æ³•ã€‚</li>
</ul>
<p>è¿™æ ·ï¼Œ<code>Pages</code>ç±»å°±å¯ä»¥æ— ç¼åœ°èå…¥ä½ çš„ç°æœ‰ç³»ç»Ÿä¸­ï¼Œè€Œæ— éœ€ä¿®æ”¹<code>OpenPages</code>ç±»çš„åŸå§‹å®ç°ã€‚é€‚é…å™¨è®¾è®¡æ¨¡å¼çš„è¿™ç§çµæ´»æ€§ä½¿å…¶æˆä¸ºè§£å†³æ¥å£ä¸å…¼å®¹é—®é¢˜çš„å¼ºå¤§å·¥å…·ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦é›†æˆç¬¬ä¸‰æ–¹åº“æˆ–æ—§æœ‰ç³»ç»Ÿæ—¶ã€‚</p>
<p><strong>å¯¹è±¡é€‚é…å™¨ä¸ç±»é€‚é…å™¨</strong></p>
<p><code>Pages</code>ç±»æ˜¯ä¸€ä¸ªæ‰€è°“çš„å¯¹è±¡é€‚é…å™¨çš„ä¾‹å­ã€‚è¿™ä¸ªæœ¯è¯­æŒ‡çš„æ˜¯ä½ å­˜å‚¨äº†è¢«åŒ…è£…ç±»å‹çš„å®ä¾‹ã€‚æˆ–è€…ï¼Œå¦‚æœè¢«åŒ…è£…ç±»å‹æ˜¯æŸä¸ªç»§æ‰¿å±‚æ¬¡ç»“æ„çš„ä¸€éƒ¨åˆ†ï¼Œä½ å¯ä»¥å­˜å‚¨è¯¥å±‚æ¬¡ç»“æ„åŸºç±»çš„æŒ‡é’ˆã€‚è¿™å°†å…è®¸ä½ ä½¿ç”¨å¯¹è±¡é€‚é…å™¨å¤„ç†æ‰€æœ‰å±äºè¯¥å±‚æ¬¡ç»“æ„çš„ç±»å‹ï¼Œä»è€Œå¤§å¤§æé«˜äº†å¯¹è±¡é€‚é…å™¨çš„çµæ´»æ€§ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œè¿˜æœ‰ä¸€ç§å®ç°æ‰€è°“çš„ç±»é€‚é…å™¨çš„æ–¹å¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Pages</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Document</span> 
</span></span><span class="line"><span class="cl">            <span class="p">,</span> <span class="k">private</span> <span class="n">OpenPages</span>  <span class="c1">// ç±»é€‚é…å™¨çš„ä¾‹å­   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="kt">void</span> <span class="n">exportToJSON</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="n">exportToJSONFormat</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">ByteStream</span><span class="o">&amp;</span> <span class="n">bs</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="o">-&gt;</span><span class="n">convertToBytes</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™ç§æ–¹å¼ä¸­ï¼Œä¸æ˜¯å­˜å‚¨è¢«é€‚é…ç±»å‹çš„å®ä¾‹ï¼Œè€Œæ˜¯é€šè¿‡ï¼ˆå¯èƒ½éå…¬å¼€åœ°ï¼‰ç»§æ‰¿å®ƒï¼Œå¹¶ç›¸åº”åœ°å®ç°é¢„æœŸæ¥å£ã€‚ç„¶è€Œï¼Œæ­£å¦‚åœ¨â€œæŒ‡å—20ï¼šä¼˜å…ˆç»„åˆè€Œéç»§æ‰¿â€ä¸­è®¨è®ºçš„é‚£æ ·ï¼ŒåŸºäºç»„åˆæ„å»ºé€šå¸¸æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯¹è±¡é€‚é…å™¨æ¯”ç±»é€‚é…å™¨æ›´çµæ´»ï¼Œå› æ­¤åº”ä¼˜å…ˆé€‰æ‹©å¯¹è±¡é€‚é…å™¨ã€‚åªæœ‰åœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¼šæ›´å€¾å‘äºä½¿ç”¨ç±»é€‚é…å™¨ï¼š</p>
<ol>
<li>å¦‚æœä½ éœ€è¦è¦†ç›–ä¸€ä¸ªè™šå‡½æ•°ã€‚</li>
<li>å¦‚æœä½ éœ€è¦è®¿é—®ä¸€ä¸ªå—ä¿æŠ¤çš„æˆå‘˜å‡½æ•°ã€‚</li>
<li>å¦‚æœä½ éœ€è¦é€‚åº”çš„ç±»å‹åœ¨å¦ä¸€ä¸ªåŸºç±»ä¹‹å‰æ„é€ ã€‚</li>
<li>å¦‚æœä½ éœ€è¦å…±äº«ä¸€ä¸ªå…±åŒçš„è™šåŸºç±»æˆ–è¦†ç›–è™šåŸºç±»çš„æ„é€ ã€‚</li>
<li>å¦‚æœä½ å¯ä»¥ä»ç©ºåŸºç±»ä¼˜åŒ–ï¼ˆEBOï¼‰ä¸­è·å¾—æ˜¾è‘—ä¼˜åŠ¿ã€‚</li>
</ol>
<p>å¦åˆ™ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥ä¼˜å…ˆé€‰æ‹©å¯¹è±¡é€‚é…å™¨ã€‚</p>
<p><strong>å…³äºå‘½åçš„è®¨è®º</strong></p>
<p>â€œæˆ‘å–œæ¬¢è¿™ä¸ªè®¾è®¡æ¨¡å¼â€”â€”å®ƒå¾ˆå¼ºå¤§ã€‚ä½†æ˜¯ï¼Œæˆ‘åˆšæƒ³èµ·æ¥ä½ å»ºè®®åœ¨ä»£ç ä¸­ä½¿ç”¨è®¾è®¡æ¨¡å¼çš„åå­—æ¥ä¼ è¾¾æ„å›¾ã€‚è¿™ä¸ªç±»ä¸åº”è¯¥å«åš<code>PagesAdapter</code>å—ï¼Ÿâ€ ä½ æå‡ºäº†ä¸€ä¸ªå¾ˆå¥½çš„è§‚ç‚¹ã€‚æˆ‘å¾ˆé«˜å…´ä½ è®°å¾—â€œæŒ‡å—14ï¼šä½¿ç”¨è®¾è®¡æ¨¡å¼çš„åå­—æ¥ä¼ è¾¾æ„å›¾â€ï¼Œç¡®å®æˆ‘åœ¨å…¶ä¸­æåˆ°è®¾è®¡æ¨¡å¼çš„åå­—æœ‰åŠ©äºç†è§£ä»£ç ã€‚æˆ‘æ‰¿è®¤åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘å¯¹ä¸¤ç§å‘½åçº¦å®šéƒ½æŒå¼€æ”¾æ€åº¦ã€‚è™½ç„¶æˆ‘çœ‹åˆ°äº†<code>PagesAdapter</code>è¿™ä¸ªåå­—çš„ä¼˜ç‚¹ï¼Œå› ä¸ºå®ƒç«‹å³ä¼ è¾¾äº†ä½ ä½¿ç”¨äº†é€‚é…å™¨è®¾è®¡æ¨¡å¼ï¼Œä½†æˆ‘å¹¶ä¸è®¤ä¸ºæœ‰å¿…è¦æ˜ç¡®è¯´æ˜è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªé€‚é…å™¨ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œé€‚é…å™¨åœ¨è¿™é‡Œæ›´åƒæ˜¯ä¸€ä¸ªå®ç°ç»†èŠ‚ï¼šæˆ‘ä¸éœ€è¦çŸ¥é“<code>Pages</code>ç±»æ²¡æœ‰è‡ªå·±å®ç°æ‰€æœ‰ç»†èŠ‚ï¼Œè€Œæ˜¯ä½¿ç”¨äº†<code>OpenPages</code>ç±»ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘è¯´è¦â€œè€ƒè™‘ä½¿ç”¨è¿™ä¸ªåå­—â€ã€‚ä½ åº”è¯¥æ ¹æ®å…·ä½“æƒ…å†µå†³å®šã€‚</p>
<p><strong>æ ‡å‡†åº“ä¸­çš„ä¾‹å­</strong></p>
<p>é€‚é…å™¨è®¾è®¡æ¨¡å¼çš„ä¸€ä¸ªæœ‰ç”¨åº”ç”¨æ˜¯æ ‡å‡†åŒ–ä¸åŒç§ç±»å®¹å™¨çš„æ¥å£ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹çš„<code>Stack</code>åŸºç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Stack.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Stack</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="o">~</span><span class="n">Stack</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">top</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">empty</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="n">size_t</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">push</span><span class="p">(</span><span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">pop</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ª<code>Stack</code>ç±»æä¾›äº†å¿…è¦çš„æ¥å£æ¥è®¿é—®æ ˆé¡¶å…ƒç´ ã€æ£€æŸ¥æ ˆæ˜¯å¦ä¸ºç©ºã€æŸ¥è¯¢æ ˆçš„å¤§å°ã€å°†å…ƒç´ å‹å…¥æ ˆä»¥åŠç§»é™¤æ ˆé¡¶å…ƒç´ ã€‚è¿™ä¸ªåŸºç±»ç°åœ¨å¯ä»¥ç”¨äºä¸ºå„ç§æ•°æ®ç»“æ„å®ç°ä¸åŒçš„é€‚é…å™¨ï¼Œä¾‹å¦‚<code>std::vector</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;VectorStack.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Stack.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">VectorStack</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Stack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">T</span><span class="o">&amp;</span> <span class="n">top</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="k">return</span> <span class="n">vec_</span><span class="p">.</span><span class="n">back</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">bool</span> <span class="nf">empty</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span> <span class="k">return</span> <span class="n">vec_</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="n">size_t</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span> <span class="k">return</span> <span class="n">vec_</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="nf">push</span><span class="p">(</span><span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span> <span class="n">vec_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">value</span><span class="p">);</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="nf">pop</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="n">vec_</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">vec_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½ å¯èƒ½ä¼šæ‹…å¿ƒï¼šâ€œä½ çœŸçš„å»ºè®®ç”¨æŠ½è±¡åŸºç±»æ¥å®ç°æ ˆå—ï¼Ÿä½ ä¸æ‹…å¿ƒæ€§èƒ½å½±å“å—ï¼Ÿæ¯æ¬¡è°ƒç”¨æˆå‘˜å‡½æ•°æ—¶ï¼Œéƒ½è¦ä»˜å‡ºè™šæ‹Ÿå‡½æ•°è°ƒç”¨çš„ä»£ä»·ï¼â€ ä¸ï¼Œå½“ç„¶æˆ‘ä¸æ˜¯è¿™ä¹ˆå»ºè®®çš„ã€‚æ˜¾ç„¶ä½ æ˜¯å¯¹çš„ï¼Œæˆ‘ä¹Ÿå®Œå…¨åŒæ„ä½ çš„çœ‹æ³•ï¼šä»C++çš„è§’åº¦æ¥çœ‹ï¼Œè¿™ç§å®¹å™¨æ˜¾å¾—å¥‡æ€ªä¸”éå¸¸ä½æ•ˆã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæˆ‘ä»¬é€šå¸¸é€šè¿‡ç±»æ¨¡æ¿æ¥å®ç°ç›¸åŒçš„æƒ³æ³•ã€‚è¿™æ˜¯C++æ ‡å‡†åº“é‡‡ç”¨çš„æ–¹æ³•ï¼Œä»¥ä¸‰ç§STLç±»çš„å½¢å¼å®ç°å®¹å™¨é€‚é…å™¨ï¼š<code>std::stack</code>ã€<code>std::queue</code>å’Œ<code>std::priority_queue</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Container</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">deque</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">stack</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Container</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">deque</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">queue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Container</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Compare</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">less</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Container</span><span class="o">::</span><span class="n">value_type</span><span class="o">&gt;&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">priority_queue</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸‰ä¸ªç±»æ¨¡æ¿å°†ç»™å®šå®¹å™¨ç±»å‹çš„æ¥å£é€‚é…åˆ°ç‰¹å®šç”¨é€”ã€‚ä¾‹å¦‚ï¼Œ<code>std::stack</code>ç±»æ¨¡æ¿çš„ç›®çš„æ˜¯å°†å®¹å™¨æ¥å£é€‚é…åˆ°æ ˆæ“ä½œï¼š<code>top()</code>ã€<code>empty()</code>ã€<code>size()</code>ã€<code>push()</code>ã€<code>emplace()</code>ã€<code>pop()</code>å’Œ<code>swap()</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‰ä¸ªå¯ç”¨çš„åºåˆ—å®¹å™¨ï¼š<code>std::vector</code>ã€<code>std::list</code>å’Œ<code>std::deque</code>ã€‚å¯¹äºä»»ä½•å…¶ä»–å®¹å™¨ç±»å‹ï¼Œä½ å¯ä»¥ç‰¹åŒ–<code>std::stack</code>ç±»æ¨¡æ¿ã€‚</p>
<p>â€œè¿™æ„Ÿè§‰ç†Ÿæ‚‰å¤šäº†ï¼Œâ€ä½ è¯´ï¼Œæ˜æ˜¾æ¾äº†ä¸€å£æ°”ã€‚æˆ‘å®Œå…¨åŒæ„ã€‚æˆ‘ä¹Ÿè®¤ä¸ºæ ‡å‡†åº“çš„æ–¹æ³•æ›´é€‚åˆå®¹å™¨çš„ç›®çš„ã€‚ä½†æ¯”è¾ƒè¿™ä¸¤ç§æ–¹æ³•ä»ç„¶å¾ˆæœ‰è¶£ã€‚è™½ç„¶<code>Stack</code>åŸºç±»å’Œ<code>std::stack</code>ç±»æ¨¡æ¿ä¹‹é—´æœ‰è®¸å¤šæŠ€æœ¯ä¸Šçš„å·®å¼‚ï¼Œä½†è¿™ä¸¤è€…çš„ç”¨é€”å’Œè¯­ä¹‰éƒ½éå¸¸ç›¸ä¼¼ï¼šå®ƒä»¬éƒ½æä¾›äº†ä¸€ç§å°†ä»»ä½•æ•°æ®ç»“æ„é€‚é…åˆ°ç»™å®šæ ˆæ¥å£çš„èƒ½åŠ›ã€‚å¹¶ä¸”ä¸¤è€…éƒ½ä½œä¸ºå˜åŒ–ç‚¹ï¼Œå…è®¸ä½ åœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹éä¾µå…¥æ€§åœ°æ·»åŠ æ–°çš„é€‚é…å™¨ã€‚</p>
<p><strong>é€‚é…å™¨è®¾è®¡æ¨¡å¼ä¸ç­–ç•¥è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒ</strong></p>
<p>â€œè¿™ä¸‰ä¸ªSTLç±»ä¼¼ä¹å®ç°äº†é€‚é…å™¨çš„ç›®çš„ï¼Œä½†è¿™ä¸å°±æ˜¯ç­–ç•¥è®¾è®¡æ¨¡å¼ä¸­é…ç½®è¡Œä¸ºçš„æ–¹å¼å—ï¼Ÿè¿™å’Œ<code>std::unique_ptr</code>åŠå…¶åˆ é™¤å™¨ä¸æ˜¯ä¸€æ ·çš„å—ï¼Ÿâ€ä½ é—®é“ã€‚æ˜¯çš„ï¼Œä½ æ˜¯å¯¹çš„ã€‚ä»ç»“æ„ä¸Šçœ‹ï¼Œç­–ç•¥è®¾è®¡æ¨¡å¼å’Œé€‚é…å™¨è®¾è®¡æ¨¡å¼éå¸¸ç›¸ä¼¼ã€‚ç„¶è€Œï¼Œæ­£å¦‚åœ¨â€œæŒ‡å—11ï¼šç†è§£è®¾è®¡æ¨¡å¼çš„ç›®çš„â€ä¸­è§£é‡Šçš„é‚£æ ·ï¼Œè®¾è®¡æ¨¡å¼çš„ç»“æ„å¯èƒ½ç›¸ä¼¼ç”šè‡³ç›¸åŒï¼Œä½†å®ƒä»¬çš„æ„å›¾ä¸åŒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¹å™¨å‚æ•°ä¸ä»…ä»…æŒ‡å®šè¡Œä¸ºçš„ä¸€ä¸ªæ–¹é¢ï¼Œè€Œæ˜¯å¤§éƒ¨åˆ†æˆ–å…¨éƒ¨è¡Œä¸ºã€‚ç±»æ¨¡æ¿åªæ˜¯ç»™å®šç±»å‹çš„å°è£…å™¨â€”â€”å®ƒä»¬ä¸»è¦é€‚é…æ¥å£ã€‚å› æ­¤ï¼Œé€‚é…å™¨çš„ä¸»è¦å…³æ³¨ç‚¹æ˜¯æ ‡å‡†åŒ–æ¥å£å¹¶å°†ä¸å…¼å®¹çš„åŠŸèƒ½é›†æˆåˆ°ç°æœ‰çš„è§„èŒƒé›†ä¸­ï¼›è€Œå¦ä¸€æ–¹é¢ï¼Œç­–ç•¥è®¾è®¡æ¨¡å¼çš„ä¸»è¦å…³æ³¨ç‚¹æ˜¯ä»å¤–éƒ¨é…ç½®è¡Œä¸ºï¼Œæ„å»ºå¹¶æä¾›é¢„æœŸçš„æ¥å£ã€‚æ­¤å¤–ï¼Œå¯¹äºé€‚é…å™¨è€Œè¨€ï¼Œä¸éœ€è¦éšæ—¶é‡æ–°é…ç½®è¡Œä¸ºã€‚</p>
<p><strong>å‡½æ•°é€‚é…å™¨</strong></p>
<p>é€‚é…å™¨è®¾è®¡æ¨¡å¼çš„å…¶ä»–ä¾‹å­åŒ…æ‹¬æ ‡å‡†åº“ä¸­çš„è‡ªç”±å‡½æ•°<code>begin()</code>å’Œ<code>end()</code>ã€‚â€œä½ è®¤çœŸçš„å—ï¼Ÿâ€ä½ æƒŠè®¶åœ°é—®ï¼Œâ€œä½ å£°ç§°è‡ªç”±å‡½æ•°æ˜¯é€‚é…å™¨è®¾è®¡æ¨¡å¼çš„ä¾‹å­ï¼Ÿè¿™ä¸æ˜¯ç±»çš„å·¥ä½œå—ï¼Ÿâ€å…¶å®ä¸ä¸€å®šã€‚è‡ªç”±<code>begin()</code>å’Œ<code>end()</code>å‡½æ•°çš„ç›®çš„æ˜¯å°†ä»»ä½•ç±»å‹çš„è¿­ä»£å™¨æ¥å£é€‚é…åˆ°é¢„æœŸçš„STLè¿­ä»£å™¨æ¥å£ã€‚å› æ­¤ï¼Œå®ƒå°†å¯ç”¨çš„ä¸€ç»„å‡½æ•°æ˜ å°„åˆ°é¢„æœŸçš„ä¸€ç»„å‡½æ•°ï¼Œå¹¶ä¸å…¶ä»–é€‚é…å™¨å…·æœ‰ç›¸åŒçš„ç›®çš„ã€‚ä¸»è¦åŒºåˆ«åœ¨äºï¼Œä¸åŸºäºç»§æ‰¿ï¼ˆè¿è¡Œæ—¶å¤šæ€ï¼‰æˆ–æ¨¡æ¿ï¼ˆç¼–è¯‘æ—¶å¤šæ€ï¼‰çš„å¯¹è±¡é€‚é…å™¨æˆ–ç±»é€‚é…å™¨ä¸åŒï¼Œ<code>begin()</code>å’Œ<code>end()</code>ä¾èµ–äºå‡½æ•°é‡è½½ï¼Œè¿™æ˜¯C++ä¸­çš„ç¬¬äºŒç§ä¸»è¦ç¼–è¯‘æ—¶å¤šæ€æœºåˆ¶ã€‚å°½ç®¡å¦‚æ­¤ï¼ŒæŸç§å½¢å¼çš„æŠ½è±¡ä»ç„¶å­˜åœ¨ã€‚</p>
<p><strong>æ³¨æ„</strong></p>
<p>è®°ä½æ‰€æœ‰ç±»å‹çš„æŠ½è±¡éƒ½ä»£è¡¨ä¸€ç»„éœ€æ±‚ï¼Œå› æ­¤å¿…é¡»éµå®ˆé‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLSPï¼‰ã€‚è¿™å¯¹é‡è½½é›†ä¹Ÿé€‚ç”¨ï¼›å‚è§â€œæŒ‡å—8ï¼šç†è§£é‡è½½é›†çš„è¯­ä¹‰è¦æ±‚â€ã€‚</p>
<p>è€ƒè™‘ä»¥ä¸‹å‡½æ•°æ¨¡æ¿ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Range</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">traverseRange</span><span class="p">(</span><span class="n">Range</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">range</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;&amp;</span> <span class="nl">element</span> <span class="p">:</span> <span class="n">range</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨<code>traverseRange()</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡åŸºäºèŒƒå›´çš„forå¾ªç¯éå†ç»™å®šèŒƒå›´å†…åŒ…å«çš„æ‰€æœ‰å…ƒç´ ã€‚éå†é€šè¿‡ç¼–è¯‘å™¨ä½¿ç”¨è‡ªç”±<code>begin()</code>å’Œ<code>end()</code>å‡½æ•°è·å–çš„è¿­ä»£å™¨å®Œæˆã€‚å› æ­¤ï¼Œå‰é¢çš„forå¾ªç¯ç­‰ä»·äºä»¥ä¸‹å½¢å¼çš„forå¾ªç¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Range</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">traverseRange</span><span class="p">(</span><span class="n">Range</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">range</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">begin</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">end</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">auto</span> <span class="nf">first</span><span class="p">(</span><span class="n">begin</span><span class="p">(</span><span class="n">range</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">      <span class="k">auto</span> <span class="nf">last</span><span class="p">(</span><span class="n">end</span><span class="p">(</span><span class="n">range</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">      <span class="k">for</span><span class="p">(;</span> <span class="n">first</span> <span class="o">!=</span> <span class="n">last</span><span class="p">;</span> <span class="o">++</span><span class="n">first</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="k">auto</span><span class="o">&amp;&amp;</span> <span class="n">element</span> <span class="o">=</span> <span class="o">*</span><span class="n">first</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">         <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ˜¾ç„¶ï¼ŒåŸºäºèŒƒå›´çš„forå¾ªç¯æ›´æ–¹ä¾¿ä½¿ç”¨ã€‚ç„¶è€Œï¼Œåœ¨è¡¨é¢ä¹‹ä¸‹ï¼Œç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç åŸºäºè‡ªç”±<code>begin()</code>å’Œ<code>end()</code>å‡½æ•°ã€‚æ³¨æ„å…¶å¼€å¤´çš„ä¸¤ä¸ªusingå£°æ˜ï¼šç›®çš„æ˜¯ä¸ºç»™å®šèŒƒå›´ç±»å‹å¯ç”¨å‚æ•°ç›¸å…³æŸ¥æ‰¾ï¼ˆADLï¼‰ã€‚ADLç¡®ä¿å³ä½¿é‡è½½å‡½æ•°ä½äºç”¨æˆ·ç‰¹å®šçš„å‘½åç©ºé—´ä¸­ï¼Œä¹Ÿä¼šè°ƒç”¨â€œæ­£ç¡®çš„â€<code>begin()</code>å’Œ<code>end()</code>å‡½æ•°ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä¸ºä»»ä½•ç±»å‹é‡è½½<code>begin()</code>å’Œ<code>end()</code>ï¼Œå¹¶å°†é¢„æœŸæ¥å£æ˜ å°„åˆ°ä¸åŒçš„ã€ç‰¹å®šç”¨é€”çš„å‡½æ•°é›†ã€‚</p>
<p>è¿™ç§ç±»å‹çš„å‡½æ•°é€‚é…å™¨åœ¨2004å¹´è¢«Matthew Wilsonç§°ä¸ºâ€œshimâ€ã€‚è¯¥æŠ€æœ¯çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§æ˜¯å®Œå…¨éä¾µå…¥æ€§ï¼šå¯ä»¥ä¸ºä»»ä½•ç±»å‹æ·»åŠ ä¸€ä¸ªè‡ªç”±å‡½æ•°ï¼Œç”šè‡³æ˜¯ç¬¬ä¸‰æ–¹åº“æä¾›çš„ç±»å‹ã€‚å› æ­¤ï¼Œä»¥shimsæˆ–å‡½æ•°é€‚é…å™¨ç¼–å†™çš„ä»»ä½•é€šç”¨ä»£ç éƒ½èƒ½è®©ä½ æ‹¥æœ‰å·¨å¤§çš„èƒ½åŠ›ï¼Œå°†å‡ ä¹ä»»ä½•ç±»å‹é€‚é…åˆ°é¢„æœŸæ¥å£ã€‚å› æ­¤ï¼Œä½ å¯ä»¥æƒ³è±¡shimsæˆ–å‡½æ•°é€‚é…å™¨æ˜¯æ³›å‹ç¼–ç¨‹çš„æ ¸å¿ƒã€‚</p>
<p><strong>åˆ†æé€‚é…å™¨è®¾è®¡æ¨¡å¼çš„ä¸è¶³</strong></p>
<p>å°½ç®¡é€‚é…å™¨è®¾è®¡æ¨¡å¼æœ‰å…¶ä»·å€¼ï¼Œä½†æˆ‘åº”è¯¥æ˜ç¡®æŒ‡å‡ºè¿™ä¸ªè®¾è®¡æ¨¡å¼æœ‰ä¸€ä¸ªé—®é¢˜ã€‚</p>
<p>è€ƒè™‘ä»¥ä¸‹ä¾‹å­ï¼Œæˆ‘å€Ÿé‰´è‡ªEric Freemanå’ŒElisabeth Robsonï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Duck.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Duck</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="o">~</span><span class="n">Duck</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">quack</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">fly</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;MallardDuck.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Duck.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">MallardDuck</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Duck</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="n">quack</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="cm">/*...*/</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="nf">fly</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="cm">/*...*/</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬ä»æŠ½è±¡çš„<code>Duck</code>ç±»å¼€å§‹ï¼Œè¯¥ç±»å¼•å…¥äº†ä¸¤ä¸ªçº¯è™šå‡½æ•°<code>quack()</code>å’Œ<code>fly()</code>ã€‚ç¡®å®ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å½“é¢„æœŸä¸”è‡ªç„¶çš„é¸­å­ç±»æ¥å£ï¼Œå¹¶ä¸”å½“ç„¶ä¼šå¼•å‘ä¸€äº›æœŸæœ›ï¼šé¸­å­å‘å‡ºéå¸¸ç‹¬ç‰¹çš„å£°éŸ³å¹¶ä¸”èƒ½å¤Ÿå¾ˆå¥½åœ°é£è¡Œã€‚è®¸å¤šå¯èƒ½çš„é¸­å­ç±»å‹å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œä¾‹å¦‚<code>MallardDuck</code>ç±»ã€‚ç°åœ¨ï¼Œç”±äºæŸäº›åŸå› ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å¤„ç†ç«é¸¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Turkey.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Turkey</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="o">~</span><span class="n">Turkey</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">gobble</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// ç«é¸¡ä¸ä¼šå˜å˜å«ï¼Œè€Œæ˜¯å’¯å’¯å«ï¼ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">fly</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>     
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;WildTurkey.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">WildTurkey</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Turkey</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="n">gobble</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="cm">/*...*/</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="nf">fly</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="cm">/*...*/</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç«é¸¡ç”±æŠ½è±¡çš„<code>Turkey</code>ç±»è¡¨ç¤ºï¼Œå½“ç„¶æœ‰è®¸å¤šä¸åŒç§ç±»çš„å…·ä½“ç«é¸¡å®ç°ï¼Œæ¯”å¦‚<code>WildTurkey</code>ã€‚ä¸ºäº†ä½¿äº‹æƒ…å˜å¾—æ›´ç³Ÿï¼Œå‡ºäºæŸäº›åŸå› ï¼Œé¸­å­å’Œç«é¸¡éœ€è¦ä¸€èµ·ä½¿ç”¨ã€‚ä¸€ç§å¯èƒ½çš„æ–¹æ³•æ˜¯å‡è£…ç«é¸¡æ˜¯ä¸€åªé¸­å­ã€‚æ¯•ç«Ÿï¼Œç«é¸¡ä¸é¸­å­éå¸¸ç›¸ä¼¼ã€‚å¥½å§ï¼Œè™½ç„¶å®ƒä¸ä¼šå˜å˜å«ï¼Œä½†å®ƒä¼šå’¯å’¯å«ï¼ˆå…¸å‹çš„ç«é¸¡å£°éŸ³ï¼‰ï¼Œè€Œä¸”å®ƒä¹Ÿèƒ½é£ï¼ˆè™½ç„¶è·ç¦»ä¸é•¿ï¼Œä½†ç¡®å®èƒ½é£ï¼‰ã€‚å› æ­¤ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>TurkeyAdapter</code>æ¥é€‚é…ç«é¸¡åˆ°é¸­å­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;TurkeyAdapter.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">TurkeyAdapter</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Duck</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">explicit</span> <span class="n">TurkeyAdapter</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Turkey</span><span class="o">&gt;</span> <span class="n">turkey</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">:</span> <span class="n">turkey_</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">turkey</span><span class="p">)}</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{}</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="nf">quack</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="n">turkey_</span><span class="o">-&gt;</span><span class="n">gobble</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="nf">fly</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span> <span class="n">turkey_</span><span class="o">-&gt;</span><span class="n">fly</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Turkey</span><span class="o">&gt;</span> <span class="n">turkey_</span><span class="p">;</span>  <span class="c1">// è¿™æ˜¯ä¸€ä¸ªå¯¹è±¡é€‚é…å™¨çš„ä¾‹å­ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è™½ç„¶è¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„é¸­å­ç±»å‹è§£é‡Šï¼Œä½†è¿™ä¸ªä¾‹å­å¾ˆå¥½åœ°å±•ç¤ºäº†å°†å¤–æ¥äº‹ç‰©è½»æ¾é›†æˆåˆ°ç°æœ‰å±‚æ¬¡ç»“æ„ä¸­æ˜¯å¤šä¹ˆå®¹æ˜“ã€‚ç«é¸¡æ ¹æœ¬ä¸æ˜¯é¸­å­ï¼Œå³ä½¿æˆ‘ä»¬å¸Œæœ›å®ƒæ˜¯ã€‚æˆ‘è®¤ä¸º<code>quack()</code>å’Œ<code>fly()</code>å‡½æ•°å¾ˆå¯èƒ½è¿åäº†LSPã€‚è¿™äº›å‡½æ•°å®é™…ä¸Šå¹¶æ²¡æœ‰åšæˆ‘æœŸæœ›çš„äº‹æƒ…ï¼ˆè‡³å°‘æˆ‘å¾ˆç¡®å®šæˆ‘å¸Œæœ›å¬åˆ°çš„æ˜¯å˜å˜å«è€Œä¸æ˜¯å’¯å’¯å«çš„åŠ¨ç‰©ï¼Œå¹¶ä¸”æˆ‘å¸Œæœ›çœ‹åˆ°åƒé¸­å­ä¸€æ ·çœŸæ­£é£è¡Œçš„ä¸œè¥¿ï¼‰ã€‚å½“ç„¶ï¼Œè¿™å–å†³äºå…·ä½“çš„ä¸Šä¸‹æ–‡ï¼Œä½†ä¸å¯å¦è®¤çš„æ˜¯ï¼Œé€‚é…å™¨è®¾è®¡æ¨¡å¼ä½¿å¾—ç»„åˆä¸ç›¸å¹²çš„äº‹ç‰©å˜å¾—éå¸¸å®¹æ˜“ã€‚å› æ­¤ï¼Œåœ¨åº”ç”¨æ­¤è®¾è®¡æ¨¡å¼æ—¶ï¼Œéå¸¸é‡è¦çš„æ˜¯è¦è€ƒè™‘é¢„æœŸçš„è¡Œä¸ºå¹¶æ£€æŸ¥æ˜¯å¦è¿åäº†LSPï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;MallardDuck.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;WildTurkey.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;TurkeyAdapter.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">DuckChoir</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Duck</span><span class="o">&gt;&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">give_concert</span><span class="p">(</span><span class="n">DuckChoir</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">duck_choir</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="k">const</span><span class="o">&amp;</span> <span class="nl">duck</span> <span class="p">:</span> <span class="n">duck_choir</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">duck</span><span class="o">-&gt;</span><span class="n">quack</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="n">DuckChoir</span> <span class="n">duck_choir</span><span class="p">{};</span>
</span></span><span class="line"><span class="cl">   <span class="c1">// è®©æˆ‘ä»¬é›‡ä½£ä¸–ç•Œä¸Šæœ€å¥½çš„é¸­å­ç»„æˆåˆå”±å›¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="n">duck_choir</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">MallardDuck</span><span class="o">&gt;</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">   <span class="n">duck_choir</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">MallardDuck</span><span class="o">&gt;</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">   <span class="n">duck_choir</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">MallardDuck</span><span class="o">&gt;</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1">// ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬è¿˜é›‡äº†ä¸€ä¸ªä¼ªè£…æˆé¸­å­çš„ç«é¸¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">auto</span> <span class="n">turkey</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">WildTurkey</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">   <span class="k">auto</span> <span class="n">turkey_in_disguise</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">TurkeyAdapter</span><span class="o">&gt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">turkey</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">   <span class="n">duck_choir</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">turkey_in_disguise</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1">// æ¼”å‡ºå°†æ˜¯ä¸€åœºéŸ³ä¹ç¾éš¾...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="n">give_concert</span><span class="p">(</span><span class="n">duck_choir</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>åº”ç”¨<strong>Adapter</strong>è®¾è®¡æ¨¡å¼çš„ç›®çš„æ˜¯<strong>è°ƒæ•´æ¥å£</strong>ï¼Œä»¥ä¾¿ä¸å…¼å®¹çš„éƒ¨åˆ†å¯ä»¥ä¸€èµ·å·¥ä½œã€‚</li>
<li>è¯·æ³¨æ„ï¼Œ<strong>Adapter</strong>å¯¹åŠ¨æ€å’Œé™æ€å¤šæ€æ€§éƒ½å¾ˆæœ‰ç”¨ã€‚</li>
<li>åŒºåˆ†å¯¹è±¡é€‚é…å™¨ã€ç±»é€‚é…å™¨å’Œå‡½æ•°é€‚é…å™¨ã€‚</li>
<li>ç†è§£é€‚é…å™¨å’Œç­–ç•¥è®¾è®¡æ¨¡å¼ä¹‹é—´çš„åŒºåˆ«ã€‚</li>
<li>åœ¨ä½¿ç”¨<strong>Adapter</strong>è®¾è®¡æ¨¡å¼æ—¶ï¼Œè¦æ³¨æ„LSPè¿è§„</li>
</ul>
<h3 id="å‡†åˆ™25åº”ç”¨è§‚å¯Ÿè€…ä½œä¸ºæŠ½è±¡é€šçŸ¥æœºåˆ¶">å‡†åˆ™25ï¼šåº”ç”¨è§‚å¯Ÿè€…ä½œä¸ºæŠ½è±¡é€šçŸ¥æœºåˆ¶
</h3><p>ä½ å¾ˆå¯èƒ½ä¹‹å‰å¬è¯´è¿‡è§‚å¯Ÿè€…æ¨¡å¼ã€‚â€œå“¦ï¼Œæ˜¯çš„ï¼Œå½“ç„¶æˆ‘å¬è¯´è¿‡â€”â€”è¿™ä¸å°±æ˜¯æ‰€è°“çš„ç¤¾äº¤åª’ä½“å¹³å°å¯¹æˆ‘ä»¬æ‰€åšçš„å—ï¼Ÿâ€ä½ é—®é“ã€‚å—¯ï¼Œè™½ç„¶ä¸æ˜¯æˆ‘æ‰€æŒ‡çš„å…·ä½“å†…å®¹ï¼Œä½†ç¡®å®ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›å¹³å°ç§°ä¸ºè§‚å¯Ÿè€…ã€‚è€Œä¸”ï¼Œä»–ä»¬åšçš„äº‹æƒ…ä¹Ÿéµå¾ªæŸç§æ¨¡å¼ï¼Œå°½ç®¡è¿™ä¸æ˜¯ä¸€ä¸ªè®¾è®¡æ¨¡å¼ã€‚å®é™…ä¸Šï¼Œæˆ‘æŒ‡çš„æ˜¯GoFï¼ˆå››äººç»„ï¼‰è®¾è®¡æ¨¡å¼ä¸­æœ€å—æ¬¢è¿çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€â€”â€”è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼ã€‚å³ä½¿ä½ è¿˜ä¸ç†Ÿæ‚‰è¿™ä¸ªæ¦‚å¿µï¼Œä½ ä¹Ÿå¯èƒ½åœ¨ç”Ÿæ´»ä¸­æœ‰è¿‡ä¸æœ‰ç”¨çš„è§‚å¯Ÿè€…çš„ç»éªŒã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æ³¨æ„åˆ°åœ¨æŸäº›æ¶ˆæ¯åº”ç”¨ç¨‹åºä¸­ï¼Œä¸€æ—¦ä½ é˜…è¯»äº†ä¸€æ¡æ–°æ¶ˆæ¯ï¼Œå‘é€è€…ä¼šç«‹å³è¢«å‘ŠçŸ¥ã€‚è¿™æ„å‘³ç€æ¶ˆæ¯æ˜¾ç¤ºä¸ºâ€œå·²è¯»â€è€Œä¸æ˜¯ä»…ä»…â€œå·²é€è¾¾â€ã€‚è¿™é¡¹å°æœåŠ¡æœ¬è´¨ä¸Šæ˜¯ç”±ç°å®ç”Ÿæ´»ä¸­çš„è§‚å¯Ÿè€…å®Œæˆçš„ï¼šä¸€æ—¦æ–°æ¶ˆæ¯çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œå‘é€è€…å°±ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œä»è€Œæœ‰æœºä¼šå¯¹çŠ¶æ€å˜åŒ–åšå‡ºå“åº”ã€‚</p>
<p><strong>è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼è§£é‡Š</strong>
åœ¨è®¸å¤šè½¯ä»¶åœºæ™¯ä¸­ï¼Œå¸Œæœ›åœ¨æŸä¸ªçŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ç«‹å³è·å¾—åé¦ˆï¼šä»»åŠ¡é˜Ÿåˆ—ä¸­æ·»åŠ äº†ä¸€ä¸ªæ–°ä»»åŠ¡ã€é…ç½®å¯¹è±¡ä¸­çš„è®¾ç½®è¢«æ›´æ”¹ã€ç»“æœå‡†å¤‡å¥½è¢«æå–ç­‰ã€‚ä½†æ˜¯åŒæ—¶ï¼Œå¼•å…¥ä¸»é¢˜ï¼ˆè¢«è§‚å¯Ÿå®ä½“ï¼Œä¼šå‘ç”Ÿå˜åŒ–ï¼‰ä¸å…¶è§‚å¯Ÿè€…ï¼ˆåŸºäºçŠ¶æ€å˜åŒ–è€Œè¢«é€šçŸ¥çš„å›è°ƒå‡½æ•°ï¼‰ä¹‹é—´çš„æ˜¾å¼ä¾èµ–å…³ç³»æ˜¯éå¸¸ä¸å¯å–çš„ã€‚ç›¸åï¼Œä¸»é¢˜åº”è¯¥å¯¹æ½œåœ¨çš„å¤šç§ä¸åŒç±»å‹çš„è§‚å¯Ÿè€…ä¿æŒä¸çŸ¥æƒ…ã€‚åŸå› å¾ˆç®€å•ï¼Œä»»ä½•ç›´æ¥çš„ä¾èµ–éƒ½ä¼šä½¿è½¯ä»¶æ›´éš¾æ”¹å˜å’Œæ‰©å±•ã€‚è¿™ç§ä¸»é¢˜ä¸å…¶æ½œåœ¨å¤šä¸ªè§‚å¯Ÿè€…ä¹‹é—´çš„è§£è€¦æ­£æ˜¯è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼çš„ç›®çš„ã€‚</p>
<p>åƒæ‰€æœ‰è®¾è®¡æ¨¡å¼ä¸€æ ·ï¼Œè§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼è¯†åˆ«å‡ºä¸€ä¸ªæ–¹é¢ä½œä¸ºå˜åŒ–ç‚¹ï¼ˆä¸€ä¸ªå˜åŒ–æˆ–é¢„æœŸä¼šå˜åŒ–çš„æ–¹é¢ï¼‰ï¼Œå¹¶ä»¥æŠ½è±¡çš„å½¢å¼æå–å®ƒã€‚å› æ­¤ï¼Œå®ƒæœ‰åŠ©äºè§£è€¦è½¯ä»¶å®ä½“ã€‚åœ¨è§‚å¯Ÿè€…çš„æƒ…å†µä¸‹ï¼Œå¼•å…¥æ–°è§‚å¯Ÿè€…çš„éœ€æ±‚â€”â€”æ‰©å±•ä¸€å¯¹å¤šä¾èµ–å…³ç³»â€”â€”è¢«è®¤ä¸ºæ˜¯å˜åŒ–ç‚¹ã€‚å¦‚å›¾6-2æ‰€ç¤ºï¼Œè¿™ç§å˜åŒ–ç‚¹é€šè¿‡è§‚å¯Ÿè€…åŸºç±»çš„å½¢å¼å®ç°ã€‚</p>
<p>è§‚å¯Ÿè€…ç±»ä»£è¡¨äº†æ‰€æœ‰å¯èƒ½çš„è§‚å¯Ÿè€…å®ç°çš„æŠ½è±¡ã€‚è¿™äº›è§‚å¯Ÿè€…è¢«é™„åŠ åˆ°ç”±å…·ä½“ä¸»é¢˜ç±»ï¼ˆConcreteSubjectï¼‰è¡¨ç¤ºçš„ç‰¹å®šä¸»é¢˜ä¸Šã€‚ä¸ºäº†å‡å°‘è§‚å¯Ÿè€…ä¸å…¶ä¸»é¢˜ä¹‹é—´çš„è€¦åˆï¼Œæˆ–è€…é€šè¿‡æä¾›æ‰€æœ‰é€šç”¨æœåŠ¡æ¥ç®€åŒ–ä»£ç é‡å¤ï¼Œå¯ä»¥ä½¿ç”¨ä¸»é¢˜æŠ½è±¡æ¥è¿›è¡Œattach()å’Œdetach()æ“ä½œã€‚è¯¥ä¸»é¢˜è¿˜å¯ä»¥åœ¨å…¶çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶é€šçŸ¥æ‰€æœ‰é™„åŠ çš„è§‚å¯Ÿè€…ï¼Œå¹¶è§¦å‘å®ƒä»¬ç›¸åº”çš„æ›´æ–°åŠŸèƒ½ï¼ˆupdate()ï¼‰ã€‚</p>
<p>â€œå¼•å…¥è§‚å¯Ÿè€…åŸºç±»æ˜¯ä¸æ˜¯å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰çš„å¦ä¸€ä¸ªä¾‹å­ï¼Ÿâ€ä½ é—®ã€‚æ˜¯çš„ï¼Œä½ 100%æ­£ç¡®ï¼šæå–è§‚å¯Ÿè€…ç±»ã€æå–å˜åŒ–ç‚¹æ­£æ˜¯SRPçš„å®é™…åº”ç”¨ï¼ˆå‚è§â€œæŒ‡å—2ï¼šä¸ºå˜åŒ–è€Œè®¾è®¡â€ï¼‰ã€‚å†æ¬¡å¼ºè°ƒï¼ŒSRPå……å½“å¼€æ”¾å°é—­åŸåˆ™ï¼ˆOCPï¼‰çš„æ¨åŠ¨è€…ï¼ˆå‚è§â€œæŒ‡å—5ï¼šä¸ºæ‰©å±•è€Œè®¾è®¡â€ï¼‰ï¼šé€šè¿‡å¼•å…¥è§‚å¯Ÿè€…æŠ½è±¡ï¼Œä»»ä½•äººéƒ½å¯ä»¥åœ¨ä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹æ·»åŠ æ–°çš„è§‚å¯Ÿè€…ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œå…·ä½“è§‚å¯Ÿè€…ConcreteObserverï¼‰ã€‚å¦‚æœä½ æ³¨æ„è§‚å¯Ÿè€…åŸºç±»çš„æ‰€æœ‰æƒï¼Œå¹¶ç¡®ä¿è§‚å¯Ÿè€…ç±»ä½äºæ¶æ„çš„é«˜çº§åˆ«ï¼Œé‚£ä¹ˆä½ ä¹Ÿæ»¡è¶³äº†ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDIPï¼‰ã€‚</p>
<p><strong>ç»å…¸è§‚å¯Ÿè€…å®ç°</strong></p>
<p>â€œå¾ˆå¥½ï¼Œæˆ‘æ˜ç™½äº†ï¼å¾ˆé«˜å…´å†æ¬¡çœ‹åˆ°è¿™äº›è®¾è®¡åŸåˆ™çš„å®é™…åº”ç”¨ï¼Œä½†æˆ‘å¸Œæœ›èƒ½å¤Ÿçœ‹åˆ°ä¸€ä¸ªå…·ä½“çš„è§‚å¯Ÿè€…ä¾‹å­ã€‚â€ æˆ‘ç†è§£ã€‚é‚£ä¹ˆè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„è§‚å¯Ÿè€…å®ç°ã€‚ç„¶è€Œï¼Œåœ¨æˆ‘ä»¬å¼€å§‹çœ‹ä»£ç ä¹‹å‰ï¼Œæˆ‘åº”è¯¥æ¸…æ¥šåœ°è¯´æ˜ä»¥ä¸‹ç¤ºä¾‹çš„å±€é™æ€§ã€‚ä½ å¯èƒ½å·²ç»ç†Ÿæ‚‰è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå› æ­¤ä½ å¯èƒ½åœ¨å¯»æ‰¾å…³äºè®¸å¤šæ£˜æ‰‹å®ç°ç»†èŠ‚çš„å¸®åŠ©å’Œæ·±å…¥å»ºè®®ï¼šå¦‚ä½•å¤„ç†é™„åŠ å’Œåˆ†ç¦»è§‚å¯Ÿè€…çš„é¡ºåºã€å¤šæ¬¡é™„åŠ åŒä¸€ä¸ªè§‚å¯Ÿè€…ä»¥åŠç‰¹åˆ«æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸­ä½¿ç”¨è§‚å¯Ÿè€…ã€‚æˆ‘å¿…é¡»è¯šå®åœ°è¯´æ˜ï¼Œæˆ‘çš„æ„å›¾å¹¶ä¸æ˜¯å›ç­”è¿™äº›é—®é¢˜ã€‚è¿™ç§è®¨è®ºå°±åƒæ˜¯æ‰“å¼€æ½˜å¤šæ‹‰é­”ç›’ï¼Œå¾ˆå¿«ä¼šæŠŠæˆ‘ä»¬å¸¦å…¥å®ç°ç»†èŠ‚çš„é¢†åŸŸã€‚ä¸ï¼Œå°½ç®¡ä½ å¯èƒ½ä¼šå¤±æœ›ï¼Œä½†æˆ‘çš„æ„å›¾ä¸»è¦æ˜¯åœç•™åœ¨è½¯ä»¶è®¾è®¡çš„å±‚é¢ä¸Šã€‚</p>
<p>åƒå‰é¢çš„è®¾è®¡æ¨¡å¼ä¸€æ ·ï¼Œæˆ‘ä»¬ä»è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼çš„ç»å…¸å®ç°å¼€å§‹ã€‚æ ¸å¿ƒå…ƒç´ æ˜¯è§‚å¯Ÿè€…åŸºç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Observer.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Observer</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="o">~</span><span class="n">Observer</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span> <span class="cm">/*...*/</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªç±»æœ€é‡è¦çš„å®ç°ç»†èŠ‚æ˜¯çº¯è™šå‡½æ•°<code>update()</code>ï¼Œå½“è§‚å¯Ÿè€…è¢«é€šçŸ¥æŸä¸ªçŠ¶æ€å˜åŒ–æ—¶å°±ä¼šè°ƒç”¨å®ƒã€‚æœ‰ä¸‰ç§å®šä¹‰<code>update()</code>å‡½æ•°çš„æ–¹å¼ï¼Œæä¾›äº†åˆç†çš„å®ç°å’Œè®¾è®¡çµæ´»æ€§ã€‚ç¬¬ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ª<code>update()</code>å‡½æ•°æ¨é€æ›´æ–°çŠ¶æ€ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Observer</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">virtual</span> <span class="kt">void</span> <span class="n">update1</span><span class="p">(</span> <span class="cm">/*arguments representing the updated state*/</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">update2</span><span class="p">(</span> <span class="cm">/*arguments representing the updated state*/</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ç§å½¢å¼çš„è§‚å¯Ÿè€…é€šå¸¸è¢«ç§°ä¸ºâ€œæ¨è§‚å¯Ÿè€…â€ã€‚åœ¨è¿™ç§å½¢å¼ä¸­ï¼Œè§‚å¯Ÿè€…ç”±ä¸»é¢˜æä¾›æ‰€æœ‰å¿…è¦çš„ä¿¡æ¯ï¼Œå› æ­¤ä¸éœ€è¦è‡ªå·±ä»ä¸»é¢˜ä¸­æå–ä»»ä½•ä¿¡æ¯ã€‚è¿™å¯ä»¥æ˜¾è‘—å‡å°‘ä¸ä¸»é¢˜çš„è€¦åˆï¼Œå¹¶ä¸ºå¤šä¸ªä¸»é¢˜é‡ç”¨è§‚å¯Ÿè€…ç±»åˆ›é€ æœºä¼šã€‚æ­¤å¤–ï¼Œæ¯ç§çŠ¶æ€å˜åŒ–éƒ½æœ‰å•ç‹¬çš„é‡è½½å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªé€‰é¡¹ã€‚åœ¨å‰é¢çš„ä»£ç ç‰‡æ®µä¸­æœ‰ä¸¤ä¸ª<code>update()</code>å‡½æ•°ï¼Œæ¯ä¸ªå¯¹åº”ä¸€ç§å¯èƒ½çš„çŠ¶æ€å˜åŒ–ã€‚ç”±äºæ€»æ˜¯æ˜ç¡®çŸ¥é“å“ªä¸ªçŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼Œè§‚å¯Ÿè€…ä¸éœ€è¦â€œæœç´¢â€ä»»ä½•çŠ¶æ€å˜åŒ–ï¼Œè¿™è¯æ˜æ˜¯é«˜æ•ˆçš„ã€‚</p>
<p>â€œå¯¹ä¸èµ·ï¼Œâ€ä½ è¯´ï¼Œâ€œä½†è¿™ä¸æ˜¯è¿åäº†æ¥å£éš”ç¦»åŸåˆ™ï¼ˆISPï¼‰å—ï¼Ÿæˆ‘ä»¬åº”è¯¥é€šè¿‡å°†<code>update()</code>å‡½æ•°åˆ†å¼€åˆ°å‡ ä¸ªåŸºç±»æ¥åˆ†ç¦»å…³æ³¨ç‚¹å—ï¼Ÿâ€ è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ï¼æ˜¾ç„¶ï¼Œä½ åœ¨è­¦æƒ•äººä¸ºçš„è€¦åˆã€‚éå¸¸å¥½ï¼ä½ æ˜¯æ­£ç¡®çš„ï¼šæˆ‘ä»¬å¯ä»¥å°†å…·æœ‰å¤šä¸ª<code>update()</code>å‡½æ•°çš„è§‚å¯Ÿè€…æ‹†åˆ†ä¸ºæ›´å°çš„è§‚å¯Ÿè€…ç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Observer1</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">virtual</span> <span class="kt">void</span> <span class="n">update1</span><span class="p">(</span> <span class="cm">/*arguments representing the updated state*/</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Observer2</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">virtual</span> <span class="kt">void</span> <span class="n">update2</span><span class="p">(</span> <span class="cm">/*arguments representing the updated state*/</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç†è®ºä¸Šï¼Œè¿™ç§æ–¹æ³•å¯ä»¥å¸®åŠ©å‡å°‘å¯¹ç‰¹å®šä¸»é¢˜çš„è€¦åˆï¼Œå¹¶æ›´å®¹æ˜“ä¸ºä¸åŒçš„ä¸»é¢˜é‡ç”¨è§‚å¯Ÿè€…ã€‚ä¸åŒè§‚å¯Ÿè€…å¯èƒ½å¯¹ä¸åŒçš„çŠ¶æ€å˜åŒ–æ„Ÿå…´è¶£ï¼Œå› æ­¤äººä¸ºåœ°å°†æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€å˜åŒ–è€¦åˆåœ¨ä¸€èµ·å¯èƒ½æ˜¯è¿åISPçš„ã€‚å½“ç„¶ï¼Œå¦‚æœèƒ½å¤Ÿé¿å…å¾ˆå¤šä¸å¿…è¦çš„çŠ¶æ€å˜åŒ–é€šçŸ¥ï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥æ•ˆç‡æå‡ã€‚</p>
<p>ä¸å¹¸çš„æ˜¯ï¼Œç‰¹å®šçš„ä¸»é¢˜ä¸å¤ªå¯èƒ½åŒºåˆ†ä¸åŒç±»å‹çš„è§‚å¯Ÿè€…ã€‚é¦–å…ˆï¼Œå› ä¸ºè¿™éœ€è¦ä¸»é¢˜å­˜å‚¨ä¸åŒç±»å‹çš„æŒ‡é’ˆï¼ˆå¯¹äºä¸»é¢˜æ¥è¯´å¤„ç†èµ·æ¥ä¸æ–¹ä¾¿ï¼‰ï¼Œå…¶æ¬¡ï¼Œå› ä¸ºä¸åŒçŠ¶æ€å˜åŒ–ä¹‹é—´å¯èƒ½å­˜åœ¨æŸç§è”ç³»ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸»é¢˜æœŸæœ›è§‚å¯Ÿè€…å¯¹æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€å˜åŒ–éƒ½æ„Ÿå…´è¶£ã€‚ä»è¿™ä¸ªè§’åº¦æ¥çœ‹ï¼Œå°†å¤šä¸ª<code>update()</code>å‡½æ•°ç»„åˆåˆ°ä¸€ä¸ªåŸºç±»ä¸­æ˜¯åˆç†çš„ã€‚æ— è®ºæ€æ ·ï¼Œå…·ä½“è§‚å¯Ÿè€…å¾ˆå¯èƒ½éœ€è¦å¤„ç†æ‰€æœ‰ç±»å‹çš„çŠ¶æ€å˜åŒ–ã€‚æˆ‘çŸ¥é“ï¼Œå³ä½¿åªå¯¹å…¶ä¸­ä¸€å°éƒ¨åˆ†æ„Ÿå…´è¶£ï¼Œä¹Ÿå¿…é¡»å¤„ç†å¤šä¸ª<code>update()</code>å‡½æ•°ï¼Œè¿™å¯èƒ½æ˜¯ä¸ªéº»çƒ¦ã€‚ä½†æ˜¯ï¼Œä»ç„¶è¦ç¡®ä¿ä¸è¦æ— æ„ä¸­è¿åé‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLSPï¼‰ï¼Œå¦‚æœä¸éµå®ˆæŸäº›é¢„æœŸè¡Œä¸ºï¼ˆå¦‚æœæœ‰ï¼‰ã€‚</p>
<p>æœ‰å‡ ä¸ªæ½œåœ¨ç¼ºç‚¹ä½¿å¾—æ¨è§‚å¯Ÿè€…å¹¶ä¸ç†æƒ³ã€‚é¦–å…ˆï¼Œè§‚å¯Ÿè€…æ€»æ˜¯å¾—åˆ°æ‰€æœ‰ä¿¡æ¯ï¼Œæ— è®ºæ˜¯å¦éœ€è¦ã€‚å› æ­¤ï¼Œåªæœ‰åœ¨è§‚å¯Ÿè€…å¤§å¤šæ•°æ—¶å€™éƒ½éœ€è¦è¿™äº›ä¿¡æ¯æ—¶ï¼Œè¿™ç§æ¨é€é£æ ¼æ‰æœ‰æ•ˆã€‚å¦åˆ™ï¼Œå¾ˆå¤šåŠªåŠ›ä¼šæµªè´¹åœ¨ä¸å¿…è¦çš„é€šçŸ¥ä¸Šã€‚å…¶æ¬¡ï¼Œæ¨é€ä¼šäº§ç”Ÿå¯¹ä¼ é€’ç»™è§‚å¯Ÿè€…çš„å‚æ•°æ•°é‡å’Œç§ç±»çš„ä¾èµ–ã€‚å¯¹è¿™äº›å‚æ•°çš„ä»»ä½•æ›´æ”¹éƒ½éœ€è¦åœ¨ç»§æ‰¿è§‚å¯Ÿè€…ç±»ä¸­è¿›è¡Œå¤§é‡åç»­æ›´æ”¹ã€‚</p>
<p>ä¸€äº›è¿™äº›ç¼ºç‚¹å¯ä»¥é€šè¿‡ç¬¬äºŒç§è§‚å¯Ÿè€…æ›¿ä»£æ–¹æ¡ˆè§£å†³ã€‚å¯ä»¥åªä¼ é€’ä¸»é¢˜çš„å¼•ç”¨æ¥è§‚å¯Ÿè€…ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Observer</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">virtual</span> <span class="kt">void</span> <span class="n">update</span><span class="p">(</span> <span class="n">Subject</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">subject</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”±äºæ²¡æœ‰å‘è§‚å¯Ÿè€…ä¼ é€’ç‰¹å®šä¿¡æ¯ï¼Œç»§æ‰¿è‡ªè§‚å¯Ÿè€…åŸºç±»çš„ç±»éœ€è¦è‡ªè¡Œä»ä¸»é¢˜ä¸­æå–æ–°ä¿¡æ¯ã€‚å› æ­¤ï¼Œè¿™ç§å½¢å¼çš„è§‚å¯Ÿè€…é€šå¸¸è¢«ç§°ä¸ºâ€œæ‹‰è§‚å¯Ÿè€…â€ã€‚ä¼˜ç‚¹æ˜¯å¯¹å‚æ•°æ•°é‡å’Œç§ç±»çš„ä¾èµ–å‡å°‘ã€‚è¡ç”Ÿè§‚å¯Ÿè€…å¯ä»¥è‡ªç”±æŸ¥è¯¢ä»»ä½•ä¿¡æ¯ï¼Œè€Œä¸ä»…ä»…æ˜¯æ”¹å˜çš„çŠ¶æ€ã€‚å¦ä¸€æ–¹é¢ï¼Œè¿™ç§è®¾è®¡ä¼šåœ¨ç»§æ‰¿è‡ªè§‚å¯Ÿè€…çš„ç±»å’Œä¸»é¢˜ä¹‹é—´åˆ›å»ºå¼ºç›´æ¥ä¾èµ–å…³ç³»ã€‚å› æ­¤ï¼Œä»»ä½•å¯¹ä¸»é¢˜çš„æ›´æ”¹éƒ½ä¼šè½»æ˜“å½±å“è§‚å¯Ÿè€…ã€‚æ­¤å¤–ï¼Œè§‚å¯Ÿè€…å¯èƒ½éœ€è¦â€œæœç´¢â€çŠ¶æ€å˜åŒ–ï¼Œå¦‚æœå¤šä¸ªç»†èŠ‚å‘ç”Ÿäº†å˜åŒ–ï¼Œè¿™å¯èƒ½ä¼šè¯æ˜æ˜¯ä¸å¿…è¦çš„ä½æ•ˆã€‚</p>
<p>å¦‚æœä½ ä»…è€ƒè™‘å•ä¸ªå˜åŒ–çŠ¶æ€ï¼Œæ€§èƒ½åŠ£åŠ¿å¯èƒ½ä¸ä¼šå¯¹ä½ æ„æˆé™åˆ¶ã€‚ä¸è¿‡ï¼Œè¯·è®°ä½è½¯ä»¶ä¼šå‘ç”Ÿå˜åŒ–ï¼šä¸»é¢˜å¯èƒ½ä¼šå¢é•¿ï¼Œéšä¹‹è€Œæ¥çš„æ˜¯é€šçŸ¥ä¸åŒç±»å‹å˜åŒ–çš„éœ€æ±‚ã€‚é€‚åº”è¿™äº›å˜åŒ–ä¼šå¯¼è‡´å¤§é‡çš„é¢å¤–å·¥ä½œã€‚ä»è¿™ä¸ªè§’åº¦çœ‹ï¼Œæ¨è§‚å¯Ÿè€…ä¼¼ä¹æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œå­˜åœ¨ç¬¬ä¸‰ç§æ›¿ä»£æ–¹æ¡ˆï¼Œæ¶ˆé™¤äº†ä¹‹å‰çš„è®¸å¤šç¼ºç‚¹ï¼Œä»è€Œæˆä¸ºæˆ‘ä»¬çš„é¦–é€‰ï¼šé™¤äº†ä¼ é€’ä¸»é¢˜å¼•ç”¨å¤–ï¼Œè¿˜ä¼ é€’ä¸€ä¸ªæ ‡ç­¾ä»¥æä¾›æœ‰å…³å“ªä¸ªå±æ€§å·²æ›´æ”¹çš„ä¿¡æ¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Observer.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Observer</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="o">~</span><span class="n">Observer</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span> <span class="n">Subject</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">subject</span><span class="p">,</span> <span class="cm">/*Subject-specific type*/</span> <span class="n">property</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯¥æ ‡ç­¾å¯ä»¥å¸®åŠ©è§‚å¯Ÿè€…å†³å®šæŸä¸ªçŠ¶æ€å˜åŒ–æ˜¯å¦æœ‰è¶£ã€‚é€šå¸¸è¡¨ç¤ºä¸ºä¸»é¢˜ç‰¹å®šæšä¸¾ç±»å‹ï¼Œåˆ—å‡ºæ‰€æœ‰å¯èƒ½çš„çŠ¶æ€å˜åŒ–ã€‚é—æ†¾çš„æ˜¯ï¼Œè¿™å¢åŠ äº†è§‚å¯Ÿè€…ç±»å¯¹ç‰¹å®šä¸»é¢˜çš„è€¦åˆã€‚</p>
<p>â€œé€šè¿‡å°†è§‚å¯Ÿè€…åŸºç±»å®ç°ä¸ºç±»æ¨¡æ¿ï¼Œæ˜¯å¦å¯ä»¥ç§»é™¤å¯¹ç‰¹å®šä¸»é¢˜çš„ä¾èµ–ï¼Ÿâ€ä½ é—®é“ã€‚è¯·çœ‹ä»¥ä¸‹ä»£ç ç‰‡æ®µï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Observer.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">Subject</span><span class="p">,</span> <span class="k">typename</span> <span class="n">StateTag</span> <span class="o">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Observer</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="o">~</span><span class="n">Observer</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span> <span class="n">Subject</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">subject</span><span class="p">,</span> <span class="n">StateTag</span> <span class="n">property</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å»ºè®®ã€‚é€šè¿‡å°†è§‚å¯Ÿè€…ç±»å®šä¹‰ä¸ºç±»æ¨¡æ¿çš„å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾å°†å…¶æå‡åˆ°æ›´é«˜çš„æ¶æ„çº§åˆ«ã€‚åœ¨è¿™ç§å½¢å¼ä¸‹ï¼Œç±»ä¸ä¾èµ–äºä»»ä½•ç‰¹å®šä¸»é¢˜ï¼Œå› æ­¤å¯ä»¥è¢«å¸Œæœ›å®šä¹‰ä¸€å¯¹å¤šå…³ç³»çš„è®¸å¤šä¸åŒä¸»é¢˜é‡å¤ä½¿ç”¨ã€‚ç„¶è€Œï¼Œä½ ä¸åº”å¯¹æ­¤æ”¹è¿›æœŸæœ›è¿‡é«˜ï¼šæ•ˆæœä»…é™äºè§‚å¯Ÿè€…ç±»ã€‚å…·ä½“ä¸»é¢˜ä¼šæœŸæœ›è¯¥è§‚å¯Ÿè€…ç±»çš„å…·ä½“å®ä¾‹åŒ–ï¼Œå¹¶ä¸”å…·ä½“å®ç°çš„è§‚å¯Ÿè€…ä»ç„¶å¼ºçƒˆä¾èµ–äºä¸»é¢˜ã€‚</p>
<p>ä¸ºäº†æ›´å¥½åœ°ç†è§£ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸€ä¸ªå¯èƒ½çš„ä¸»é¢˜å®ç°ã€‚åœ¨ä½ æœ€åˆçš„å…³äºç¤¾äº¤åª’ä½“çš„è¯„è®ºä¹‹åï¼Œæˆ‘å»ºè®®æˆ‘ä»¬ä¸ºäººç‰©å®ç°ä¸€ä¸ªè§‚å¯Ÿè€…ã€‚å¥½å§ï¼Œè¿™ä¸ªä¾‹å­å¯èƒ½åœ¨é“å¾·ä¸Šæœ‰é—®é¢˜ï¼Œä½†å®ƒä¼šè¾¾åˆ°ç›®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç”¨è¿™ä¸ªä¾‹å­å§ã€‚è‡³å°‘æˆ‘ä»¬çŸ¥é“æ˜¯è°é€ æˆçš„ã€‚</p>
<p>ä»¥ä¸‹<code>Person</code>ç±»ä»£è¡¨ä¸€ä¸ªè¢«è§‚å¯Ÿçš„äººç‰©ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Person.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Observer.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;set&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">Person</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">enum</span> <span class="nc">StateChange</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="n">forenameChanged</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">      <span class="n">surnameChanged</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">      <span class="n">addressChanged</span> 
</span></span><span class="line"><span class="cl">   <span class="p">};</span> 
</span></span><span class="line"><span class="cl">   <span class="k">using</span> <span class="n">PersonObserver</span> <span class="o">=</span> <span class="n">Observer</span><span class="o">&lt;</span><span class="n">Person</span><span class="p">,</span><span class="n">StateChange</span><span class="o">&gt;</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">   <span class="k">explicit</span> <span class="nf">Person</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">forename</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">surname</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">      <span class="o">:</span> <span class="n">forename_</span><span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">forename</span><span class="p">)</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">      <span class="p">,</span> <span class="n">surname_</span><span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">surname</span><span class="p">)</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{}</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">bool</span> <span class="nf">attach</span><span class="p">(</span> <span class="n">PersonObserver</span><span class="o">*</span> <span class="n">observer</span> <span class="p">);</span>   
</span></span><span class="line"><span class="cl">   <span class="kt">bool</span> <span class="nf">detach</span><span class="p">(</span> <span class="n">PersonObserver</span><span class="o">*</span> <span class="n">observer</span> <span class="p">);</span>   
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="nf">notify</span><span class="p">(</span> <span class="n">StateChange</span> <span class="n">property</span> <span class="p">);</span>   
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="nf">forename</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">newForename</span> <span class="p">);</span>   
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="nf">surname</span> <span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">newSurname</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="nf">address</span> <span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">newAddress</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">forename</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">forename_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">surname</span> <span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">surname_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">address</span> <span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">address_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">forename_</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">   <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">surname_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">address_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">PersonObserver</span><span class="o">*&gt;</span> <span class="n">observers_</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>Person</code>åªæ˜¯ä¸‰ä¸ªæ•°æ®æˆå‘˜çš„èšåˆï¼š<code>forename_</code>ã€<code>surname_</code>å’Œ<code>address_</code>ï¼ˆæˆ‘çŸ¥é“ï¼Œè¿™æ˜¯ä¸€ä¸ªäººéå¸¸ç®€å•çš„è¡¨ç¤ºï¼‰ã€‚æ­¤å¤–ï¼Œä¸€ä¸ªäººæŒæœ‰æ³¨å†Œè§‚å¯Ÿè€…çš„<code>std::set</code>ã€‚è¯·æ³¨æ„ï¼Œè§‚å¯Ÿè€…æ˜¯é€šè¿‡æŒ‡å‘<code>PersonObserver</code>å®ä¾‹çš„æŒ‡é’ˆæ³¨å†Œçš„ã€‚è¿™æœ‰ä¸¤ä¸ªåŸå› ï¼šé¦–å…ˆï¼Œè¿™å±•ç¤ºäº†æ¨¡æ¿åŒ–çš„è§‚å¯Ÿè€…ç±»çš„ç›®çš„ï¼š<code>Person</code>ç±»å®ä¾‹åŒ–äº†è‡ªå·±çš„è§‚å¯Ÿè€…ç±»å‹ã€‚å…¶æ¬¡ï¼ŒæŒ‡é’ˆåœ¨è¿™é‡Œéå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå¯¹è±¡çš„åœ°å€æ˜¯å”¯ä¸€çš„ã€‚å› æ­¤ï¼Œé€šå¸¸ä½¿ç”¨åœ°å€ä½œä¸ºè§‚å¯Ÿè€…çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</p>
<p>â€œè¿™ä¸åº”è¯¥ä½¿ç”¨<code>std::unique_ptr</code>æˆ–<code>std::shared_ptr</code>å—ï¼Ÿâ€ä½ é—®ã€‚ä¸ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¸éœ€è¦ã€‚æŒ‡é’ˆä»…ä½œä¸ºæ³¨å†Œè§‚å¯Ÿè€…çš„å¥æŸ„ï¼›å®ƒä»¬ä¸åº”è¯¥æ‹¥æœ‰è§‚å¯Ÿè€…ã€‚å› æ­¤ï¼Œä»»ä½•æ‹¥æœ‰æ™ºèƒ½æŒ‡é’ˆéƒ½æ˜¯ä¸åˆé€‚çš„å·¥å…·ã€‚å”¯ä¸€åˆç†çš„é€‰æ‹©æ˜¯<code>std::weak_ptr</code>ï¼Œå®ƒå¯ä»¥è®©ä½ æ£€æŸ¥æ‚¬ç©ºæŒ‡é’ˆã€‚ç„¶è€Œï¼Œ<code>std::weak_ptr</code>ä¸é€‚åˆç”¨ä½œ<code>std::set</code>çš„é”®ï¼ˆå³ä½¿æ˜¯å¸¦æœ‰è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼‰ã€‚è™½ç„¶æœ‰ä¸€äº›æ–¹æ³•ä»ç„¶å¯ä»¥ä½¿ç”¨<code>std::weak_ptr</code>ï¼Œä½†æˆ‘å°†åšæŒä½¿ç”¨åŸå§‹æŒ‡é’ˆã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬è¦æ”¾å¼ƒç°ä»£C++çš„å¥½å¤„ã€‚åœ¨è¿™ç§æƒ…å†µä½¿ç”¨åŸå§‹æŒ‡é’ˆæ˜¯å®Œå…¨æœ‰æ•ˆçš„ã€‚è¿™ä¹Ÿä½“ç°åœ¨C++æ ¸å¿ƒæŒ‡å—F.7ä¸­ï¼š å¯¹äºä¸€èˆ¬ç”¨é€”ï¼Œå–<code>T*</code>æˆ–<code>T&amp;</code>å‚æ•°è€Œä¸æ˜¯æ™ºèƒ½æŒ‡é’ˆã€‚</p>
<p>æ¯å½“å¯¹äººçš„çŠ¶æ€å˜åŒ–æ„Ÿå…´è¶£æ—¶ï¼Œéƒ½å¯ä»¥é€šè¿‡<code>attach()</code>æˆå‘˜å‡½æ•°æ³¨å†Œä¸€ä¸ªè§‚å¯Ÿè€…ã€‚å½“ä½ ä¸å†å¸Œæœ›æ¥æ”¶é€šçŸ¥æ—¶ï¼Œå¯ä»¥é€šè¿‡<code>detach()</code>æˆå‘˜å‡½æ•°æ³¨é”€è§‚å¯Ÿè€…ã€‚è¿™ä¸¤ä¸ªå‡½æ•°æ˜¯è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œå¹¶ä¸”æ˜¯åº”ç”¨è¯¥è®¾è®¡æ¨¡å¼çš„æ˜ç¡®æ ‡å¿—ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">bool</span> <span class="n">Person</span><span class="o">::</span><span class="n">attach</span><span class="p">(</span> <span class="n">PersonObserver</span><span class="o">*</span> <span class="n">observer</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="k">auto</span> <span class="p">[</span><span class="n">pos</span><span class="p">,</span><span class="n">success</span><span class="p">]</span> <span class="o">=</span> <span class="n">observers_</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span> <span class="n">observer</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="n">success</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">bool</span> <span class="n">Person</span><span class="o">::</span><span class="n">detach</span><span class="p">(</span> <span class="n">PersonObserver</span><span class="o">*</span> <span class="n">observer</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="p">(</span> <span class="n">observers_</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span> <span class="n">observer</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0U</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è‡ªç”±å®ç°<code>attach()</code>å’Œ<code>detach()</code>å‡½æ•°ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å…è®¸ä¸€ä¸ªè§‚å¯Ÿè€…åªèƒ½æ³¨å†Œä¸€æ¬¡åˆ°<code>std::set</code>ä¸­ã€‚å¦‚æœä½ å°è¯•ç¬¬äºŒæ¬¡æ³¨å†ŒåŒä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œå‡½æ•°ä¼šè¿”å›<code>false</code>ã€‚åŒæ ·ï¼Œå¦‚æœä½ å°è¯•æ³¨é”€ä¸€ä¸ªæœªæ³¨å†Œçš„è§‚å¯Ÿè€…ï¼Œä¹Ÿä¼šè¿”å›<code>false</code>ã€‚è¯·æ³¨æ„ï¼Œä¸å…è®¸å¤šæ¬¡æ³¨å†Œæ˜¯æˆ‘çš„é€‰æ‹©ã€‚åœ¨å…¶ä»–åœºæ™¯ä¸­ï¼Œæ¥å—é‡å¤æ³¨å†Œå¯èƒ½æ˜¯å¯å–ç”šè‡³å¿…è¦çš„ã€‚æ— è®ºå¦‚ä½•ï¼Œä¸»é¢˜çš„è¡Œä¸ºå’Œæ¥å£åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½åº”è¯¥ä¸€è‡´ã€‚</p>
<p>å¦ä¸€ä¸ªè§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒå‡½æ•°æ˜¯<code>notify()</code>æˆå‘˜å‡½æ•°ã€‚æ¯å½“å‘ç”ŸæŸç§çŠ¶æ€å˜åŒ–æ—¶ï¼Œæ­¤å‡½æ•°ä¼šè¢«è°ƒç”¨ä»¥é€šçŸ¥æ‰€æœ‰æ³¨å†Œçš„è§‚å¯Ÿè€…ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Person</span><span class="o">::</span><span class="n">notify</span><span class="p">(</span> <span class="n">StateChange</span> <span class="n">property</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="k">for</span><span class="p">(</span> <span class="k">auto</span> <span class="n">iter</span><span class="o">=</span><span class="n">begin</span><span class="p">(</span><span class="n">observers_</span><span class="p">);</span> <span class="n">iter</span><span class="o">!=</span><span class="n">end</span><span class="p">(</span><span class="n">observers_</span><span class="p">);</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="k">auto</span> <span class="k">const</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">iter</span><span class="o">++</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="o">*</span><span class="n">pos</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span><span class="n">property</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>â€œä¸ºä»€ä¹ˆ<code>notify()</code>å‡½æ•°çš„å®ç°å¦‚æ­¤å¤æ‚ï¼ŸèŒƒå›´åŸºäºçš„forå¾ªç¯éš¾é“ä¸å¤Ÿå—ï¼Ÿâ€ä½ é—®å¾—å¯¹ï¼Œæˆ‘åº”è¯¥è§£é‡Šä¸€ä¸‹è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆã€‚ç»™å‡ºçš„è¡¨è¾¾å¼ç¡®ä¿å¯ä»¥åœ¨è¿­ä»£æœŸé—´æ£€æµ‹åˆ°<code>detach()</code>æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœè§‚å¯Ÿè€…åœ¨è°ƒç”¨<code>update()</code>å‡½æ•°æ—¶å†³å®šè‡ªæˆ‘åˆ†ç¦»ï¼Œåˆ™å¯èƒ½å‘ç”Ÿè¿™ç§æƒ…å†µã€‚ä½†æˆ‘ä¸èƒ½è¯´è¿™ç§å®ç°æ˜¯å®Œç¾çš„ï¼šä¸å¹¸çš„æ˜¯ï¼Œå®ƒæ— æ³•åº”å¯¹<code>attach()</code>æ“ä½œã€‚è€Œä¸”ä¸è¦å¼€å§‹è¯¢é—®å¹¶å‘é—®é¢˜ï¼å› æ­¤ï¼Œè¿™åªæ˜¯è§‚å¯Ÿè€…å®ç°ç»†èŠ‚ä¸ºä½•å¦‚æ­¤æ£˜æ‰‹çš„ä¸€ä¸ªä¾‹å­ã€‚</p>
<p><code>notify()</code>å‡½æ•°åœ¨æ‰€æœ‰ä¸‰ä¸ªè®¾ç½®å‡½æ•°ä¸­è¢«è°ƒç”¨ã€‚è¯·æ³¨æ„ï¼Œåœ¨æ‰€æœ‰ä¸‰ä¸ªå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬æ€»æ˜¯ä¼ é€’ä¸åŒçš„æ ‡ç­¾æ¥æŒ‡ç¤ºå“ªä¸ªå±æ€§å·²æ›´æ”¹ã€‚è¿™ä¸ªæ ‡ç­¾å¯ä»¥ç”±ç»§æ‰¿è‡ªè§‚å¯Ÿè€…åŸºç±»çš„ç±»ç”¨æ¥ç¡®å®šå˜åŒ–çš„æ€§è´¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Person</span><span class="o">::</span><span class="n">forename</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">newForename</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="n">forename_</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">newForename</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="n">notify</span><span class="p">(</span> <span class="n">forenameChanged</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Person</span><span class="o">::</span><span class="n">surname</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">newSurname</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="n">surname_</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">newSurname</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="n">notify</span><span class="p">(</span> <span class="n">surnameChanged</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Person</span><span class="o">::</span><span class="n">address</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">newAddress</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="n">address_</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">newAddress</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="n">notify</span><span class="p">(</span> <span class="n">addressChanged</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰äº†è¿™äº›æœºåˆ¶ï¼Œä½ ç°åœ¨å¯ä»¥ç¼–å†™æ–°çš„å®Œå…¨ç¬¦åˆOCPï¼ˆå¼€é—­åŸåˆ™ï¼‰çš„è§‚å¯Ÿè€…ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å†³å®šå®ç°ä¸€ä¸ª<code>NameObserver</code>å’Œä¸€ä¸ª<code>AddressObserver</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;NameObserver.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Observer.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Person.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">NameObserver</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Observer</span><span class="o">&lt;</span><span class="n">Person</span><span class="p">,</span><span class="n">Person</span><span class="o">::</span><span class="n">StateChange</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="n">update</span><span class="p">(</span> <span class="n">Person</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">person</span><span class="p">,</span> <span class="n">Person</span><span class="o">::</span><span class="n">StateChange</span> <span class="n">property</span> <span class="p">)</span> <span class="k">override</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;NameObserver.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;NameObserver.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="n">NameObserver</span><span class="o">::</span><span class="n">update</span><span class="p">(</span> <span class="n">Person</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">person</span><span class="p">,</span> <span class="n">Person</span><span class="o">::</span><span class="n">StateChange</span> <span class="n">property</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="k">if</span><span class="p">(</span> <span class="n">property</span> <span class="o">==</span> <span class="n">Person</span><span class="o">::</span><span class="n">forenameChanged</span> <span class="o">||</span> 
</span></span><span class="line"><span class="cl">       <span class="n">property</span> <span class="o">==</span> <span class="n">Person</span><span class="o">::</span><span class="n">surnameChanged</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="c1">// ... å“åº”åå­—å˜åŒ– 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;AddressObserver.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Observer.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Person.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">AddressObserver</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Observer</span><span class="o">&lt;</span><span class="n">Person</span><span class="p">,</span><span class="n">Person</span><span class="o">::</span><span class="n">StateChange</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="kt">void</span> <span class="n">update</span><span class="p">(</span> <span class="n">Person</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">person</span><span class="p">,</span> <span class="n">Person</span><span class="o">::</span><span class="n">StateChange</span> <span class="n">property</span> <span class="p">)</span> <span class="k">override</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;AddressObserver.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;AddressObserver.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="n">AddressObserver</span><span class="o">::</span><span class="n">update</span><span class="p">(</span> <span class="n">Person</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">person</span><span class="p">,</span> <span class="n">Person</span><span class="o">::</span><span class="n">StateChange</span> <span class="n">property</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="k">if</span><span class="p">(</span> <span class="n">property</span> <span class="o">==</span> <span class="n">Person</span><span class="o">::</span><span class="n">addressChanged</span> <span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="c1">// ... å“åº”åœ°å€å˜åŒ– 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è£…å¤‡äº†è¿™ä¸¤ä¸ªè§‚å¯Ÿè€…åï¼Œç°åœ¨æ— è®ºä½•æ—¶äººçš„åå­—æˆ–åœ°å€å‘ç”Ÿå˜åŒ–ï¼Œä½ éƒ½ä¼šæ”¶åˆ°é€šçŸ¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;AddressObserver.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;NameObserver.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Person.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="n">NameObserver</span> <span class="n">nameObserver</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="n">AddressObserver</span> <span class="n">addressObserver</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Person</span> <span class="n">homer</span><span class="p">(</span> <span class="s">&#34;Homer&#34;</span>     <span class="p">,</span> <span class="s">&#34;Simpson&#34;</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Person</span> <span class="n">marge</span><span class="p">(</span> <span class="s">&#34;Marge&#34;</span>     <span class="p">,</span> <span class="s">&#34;Simpson&#34;</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Person</span> <span class="n">monty</span><span class="p">(</span> <span class="s">&#34;Montgomery&#34;</span><span class="p">,</span> <span class="s">&#34;Burns&#34;</span>   <span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// æ³¨å†Œè§‚å¯Ÿè€… 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="n">homer</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">nameObserver</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="n">marge</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">addressObserver</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="n">monty</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">addressObserver</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// æ›´æ–°Homer Simpsonçš„ä¿¡æ¯ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="n">homer</span><span class="p">.</span><span class="n">forename</span><span class="p">(</span> <span class="s">&#34;Homer Jay&#34;</span> <span class="p">);</span>  <span class="c1">// æ·»åŠ ä¸­é—´å 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="c1">// æ›´æ–°Marge Simpsonçš„ä¿¡æ¯ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="n">marge</span><span class="p">.</span><span class="n">address</span><span class="p">(</span> <span class="s">&#34;712 Red Bark Lane, Henderson, Clark County, Nevada 89011&#34;</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// æ›´æ–°Montgomery Burnsçš„ä¿¡æ¯ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="n">monty</span><span class="p">.</span><span class="n">address</span><span class="p">(</span> <span class="s">&#34;Springfield Nuclear Power Plant&#34;</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// æ³¨é”€è§‚å¯Ÿè€… 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="n">homer</span><span class="p">.</span><span class="n">detach</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">nameObserver</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨äº†è§£äº†è¿™ä¹ˆå¤šå®ç°ç»†èŠ‚ä¹‹åï¼Œè®©æˆ‘ä»¬é€€ä¸€æ­¥çœ‹çœ‹æ›´å¤§çš„å›¾æ™¯ã€‚å›¾6-3æ˜¾ç¤ºäº†è¿™ä¸ªè§‚å¯Ÿè€…ç¤ºä¾‹çš„ä¾èµ–å…³ç³»å›¾ã€‚</p>
<p>ç”±äºå†³å®šä»¥ç±»æ¨¡æ¿çš„å½¢å¼å®ç°è§‚å¯Ÿè€…ç±»ï¼Œè§‚å¯Ÿè€…ç±»ä½äºæˆ‘ä»¬æ¶æ„çš„æœ€é«˜å±‚æ¬¡ã€‚è¿™ä½¿ä½ èƒ½å¤Ÿä¸ºå¤šç§ç”¨é€”é‡ç”¨è§‚å¯Ÿè€…ç±»ï¼Œä¾‹å¦‚<code>Person</code>ç±»ã€‚<code>Person</code>ç±»å£°æ˜äº†è‡ªå·±çš„<code>Observer&lt;Person,Person::StateChange&gt;</code>ç±»å‹ï¼Œå¹¶é€šè¿‡è¿™ç§æ–¹å¼å°†è‡ªå·±çš„ä»£ç æ³¨å…¥å…¶è‡ªèº«çš„æ¶æ„å±‚æ¬¡ã€‚å…·ä½“çš„äººè§‚å¯Ÿè€…ï¼Œå¦‚<code>NameObserver</code>å’Œ<code>AddressObserver</code>ï¼Œå¯ä»¥åœ¨æ­¤å£°æ˜çš„åŸºç¡€ä¸Šæ„å»ºã€‚</p>
<p><strong>åŸºäºå€¼è¯­ä¹‰çš„è§‚å¯Ÿè€…å®ç°</strong></p>
<p>â€œæˆ‘ç†è§£ä½ ä¸ºä»€ä¹ˆä»ç»å…¸å®ç°å¼€å§‹ï¼Œä½†æ—¢ç„¶ä½ å·²ç»å¼ºè°ƒäº†åå¥½å€¼è¯­ä¹‰çš„é‡è¦æ€§ï¼Œé‚£ä¹ˆåœ¨ä¸€ä¸ªåŸºäºå€¼è¯­ä¹‰çš„ä¸–ç•Œä¸­ï¼Œè§‚å¯Ÿè€…ä¼šæ˜¯ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿâ€ è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é—®é¢˜ï¼Œå› ä¸ºè¿™æ˜¯éå¸¸åˆç†çš„ä¸‹ä¸€æ­¥ã€‚æ­£å¦‚åœ¨â€œæŒ‡å—22ï¼šä¼˜å…ˆé€‰æ‹©å€¼è¯­ä¹‰è€Œä¸æ˜¯å¼•ç”¨è¯­ä¹‰â€ä¸­è§£é‡Šçš„é‚£æ ·ï¼Œæœ‰å¾ˆå¤šå¥½çš„ç†ç”±é¿å…å¼•ç”¨è¯­ä¹‰çš„é¢†åŸŸã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä¸ä¼šå®Œå…¨åç¦»ç»å…¸çš„å®ç°ï¼šä¸ºäº†æ³¨å†Œå’Œæ³¨é”€è§‚å¯Ÿè€…ï¼Œæˆ‘ä»¬æ€»æ˜¯éœ€è¦æŸç§å”¯ä¸€çš„æ ‡è¯†ç¬¦æ¥æ ‡è¯†è§‚å¯Ÿè€…ï¼Œè€Œè§‚å¯Ÿè€…çš„å”¯ä¸€åœ°å€åªæ˜¯è§£å†³è¿™ä¸ªé—®é¢˜æœ€ç®€å•ã€æœ€æ–¹ä¾¿çš„æ–¹æ³•ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†ç»§ç»­ä½¿ç”¨æŒ‡é’ˆæ¥å¼•ç”¨å·²æ³¨å†Œçš„è§‚å¯Ÿè€…ã€‚ä½†æ˜¯ï¼Œ<code>std::function</code>æ˜¯ä¸€ç§ä¼˜é›…çš„æ–¹å¼æ¥é¿å…ç»§æ‰¿å±‚æ¬¡ç»“æ„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Observer.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;functional&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">Subject</span><span class="p">,</span> <span class="k">typename</span> <span class="n">StateTag</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Observer</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">using</span> <span class="n">OnUpdate</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="n">Subject</span> <span class="k">const</span><span class="o">&amp;</span><span class="p">,</span><span class="n">StateTag</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl">   <span class="k">explicit</span> <span class="nf">Observer</span><span class="p">(</span> <span class="n">OnUpdate</span> <span class="n">onUpdate</span> <span class="p">)</span>   
</span></span><span class="line"><span class="cl">      <span class="o">:</span> <span class="n">onUpdate_</span><span class="p">{</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">onUpdate</span><span class="p">)</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="c1">// å¯èƒ½å“åº”æ— æ•ˆ/ç©ºçš„ std::function å®ä¾‹ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="p">}</span> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">   <span class="c1">// éè™šå‡½æ•° update 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span> <span class="n">Subject</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">subject</span><span class="p">,</span> <span class="n">StateTag</span> <span class="n">property</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="n">onUpdate_</span><span class="p">(</span> <span class="n">subject</span><span class="p">,</span> <span class="n">property</span> <span class="p">);</span>   
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> <span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">OnUpdate</span> <span class="n">onUpdate_</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»£æ›¿å°†è§‚å¯Ÿè€…ç±»å®ç°ä¸ºåŸºç±»ï¼Œå¹¶è¦æ±‚æ´¾ç”Ÿç±»ä»¥ç‰¹å®šæ–¹å¼ç»§æ‰¿å¹¶å®ç°<code>update()</code>å‡½æ•°ï¼Œæˆ‘ä»¬é€šè¿‡ç»„åˆï¼ˆå‚è§â€œæŒ‡å—20ï¼šä¼˜å…ˆé€‰æ‹©ç»„åˆè€Œä¸æ˜¯ç»§æ‰¿â€ï¼‰æ¥åˆ†ç¦»å…³æ³¨ç‚¹ã€‚è§‚å¯Ÿè€…ç±»é¦–å…ˆæä¾›äº†ä¸€ä¸ªåä¸º<code>OnUpdate</code>çš„ç±»å‹åˆ«åï¼Œç”¨äºé¢„æœŸç­¾åçš„<code>std::function</code>ç±»å‹ã€‚é€šè¿‡æ„é€ å‡½æ•°ï¼Œæ‚¨ä¼ é€’äº†ä¸€ä¸ª<code>std::function</code>å®ä¾‹ï¼Œå¹¶å°†å…¶ç§»åŠ¨åˆ°æ•°æ®æˆå‘˜<code>onUpdate_</code>ä¸­ã€‚<code>update()</code>å‡½æ•°ç°åœ¨çš„å·¥ä½œæ˜¯å°†è°ƒç”¨åŠå…¶å‚æ•°è½¬å‘ç»™<code>onUpdate_</code>ã€‚</p>
<p><code>std::function</code>çš„çµæ´»æ€§å¯ä»¥é€šè¿‡æ›´æ–°åçš„<code>main()</code>å‡½æ•°è½»æ¾å±•ç¤ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Observer.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Person.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">propertyChanged</span><span class="p">(</span> <span class="n">Person</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">person</span><span class="p">,</span> <span class="n">Person</span><span class="o">::</span><span class="n">StateChange</span> <span class="n">property</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="k">if</span><span class="p">(</span> <span class="n">property</span> <span class="o">==</span> <span class="n">Person</span><span class="o">::</span><span class="n">forenameChanged</span> <span class="o">||</span> 
</span></span><span class="line"><span class="cl">       <span class="n">property</span> <span class="o">==</span> <span class="n">Person</span><span class="o">::</span><span class="n">surnameChanged</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">   <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="c1">// ... å“åº”åå­—å˜åŒ– 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="k">using</span> <span class="n">PersonObserver</span> <span class="o">=</span> <span class="n">Observer</span><span class="o">&lt;</span><span class="n">Person</span><span class="p">,</span><span class="n">Person</span><span class="o">::</span><span class="n">StateChange</span><span class="o">&gt;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">   <span class="n">PersonObserver</span> <span class="n">nameObserver</span><span class="p">(</span> <span class="n">propertyChanged</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">   <span class="n">PersonObserver</span> <span class="n">addressObserver</span><span class="p">(</span> 
</span></span><span class="line"><span class="cl">      <span class="p">[</span><span class="cm">/*æ•è·çš„çŠ¶æ€*/</span><span class="p">](</span> <span class="n">Person</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">person</span><span class="p">,</span> <span class="n">Person</span><span class="o">::</span><span class="n">StateChange</span> <span class="n">property</span> <span class="p">){</span> 
</span></span><span class="line"><span class="cl">         <span class="k">if</span><span class="p">(</span> <span class="n">property</span> <span class="o">==</span> <span class="n">Person</span><span class="o">::</span><span class="n">addressChanged</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">         <span class="p">{</span> 
</span></span><span class="line"><span class="cl">            <span class="c1">// ... å“åº”åœ°å€å˜åŒ– 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>         <span class="p">}</span> 
</span></span><span class="line"><span class="cl">      <span class="p">}</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">   <span class="n">Person</span> <span class="n">homer</span><span class="p">(</span> <span class="s">&#34;Homer&#34;</span>     <span class="p">,</span> <span class="s">&#34;Simpson&#34;</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Person</span> <span class="n">marge</span><span class="p">(</span> <span class="s">&#34;Marge&#34;</span>     <span class="p">,</span> <span class="s">&#34;Simpson&#34;</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Person</span> <span class="n">monty</span><span class="p">(</span> <span class="s">&#34;Montgomery&#34;</span><span class="p">,</span> <span class="s">&#34;Burns&#34;</span>   <span class="p">);</span> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">   <span class="c1">// æ³¨å†Œè§‚å¯Ÿè€… 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="n">homer</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">nameObserver</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="n">marge</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">addressObserver</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">   <span class="n">monty</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">addressObserver</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> 
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”±äºé€‰æ‹©äº†ä¾µå…¥æ€§è¾ƒä½çš„æ–¹æ³•ï¼Œå¹¶ä¸”ä¸<code>std::function</code>è§£è€¦ï¼Œå¦‚ä½•å®ç°<code>update()</code>å‡½æ•°çš„é€‰æ‹©å®Œå…¨å–å†³äºè§‚å¯Ÿè€…çš„å®ç°è€…ï¼ˆæ— çŠ¶æ€ã€æœ‰çŠ¶æ€ç­‰ï¼‰ã€‚å¯¹äº<code>nameObserver</code>ï¼Œæˆ‘ä»¬ä¾èµ–äºè‡ªç”±å‡½æ•°<code>propertyChanged()</code>ï¼Œå®ƒæœ¬èº«æ˜¯é«˜åº¦è§£è€¦çš„ï¼Œå› ä¸ºå®ƒä¸ç»‘å®šåˆ°ä»»ä½•ç±»å¹¶ä¸”å¯èƒ½åœ¨å¤šä¸ªåœºåˆé‡ç”¨ã€‚å¦ä¸€æ–¹é¢ï¼Œ<code>addressObserver</code>é€‰æ‹©ä½¿ç”¨lambdaè¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼å¯ä»¥æ•è·ä¸€äº›çŠ¶æ€ã€‚æ— è®ºå¦‚ä½•ï¼Œè¿™ä¸¤ä¸ªè§‚å¯Ÿè€…åªéœ€è¦éµå¾ªæ‰€éœ€çš„<code>std::function</code>ç±»å‹çš„å¿…è¦ç­¾åè¿™ä¸€çº¦å®šã€‚</p>
<p>â€œä¸ºä»€ä¹ˆæˆ‘ä»¬ä»ç„¶éœ€è¦è§‚å¯Ÿè€…ç±»ï¼Ÿéš¾é“æˆ‘ä»¬ä¸èƒ½ç›´æ¥ä½¿ç”¨<code>std::function</code>å—ï¼Ÿâ€ ä»åŠŸèƒ½è§’åº¦æ¥çœ‹ï¼Œè§‚å¯Ÿè€…ç±»æœ¬èº«å¹¶æ²¡æœ‰æ·»åŠ ä»»ä½•ä¸œè¥¿ã€‚ç„¶è€Œï¼Œä½œä¸ºå€¼è¯­ä¹‰çš„çœŸæ­£äº§ç‰©ï¼Œæˆ‘ä»¬å€¾å‘äºå¤åˆ¶æˆ–ç§»åŠ¨<code>std::function</code>å¯¹è±¡ã€‚ä½†åœ¨è¿™ç§æƒ…å†µä¸‹è¿™ä¸æ˜¯æ‰€å¸Œæœ›çš„ï¼šç‰¹åˆ«æ˜¯å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯æœ‰çŠ¶æ€è§‚å¯Ÿè€…ï¼Œæ‚¨ä¸å¸Œæœ›æ‚¨çš„è§‚å¯Ÿè€…çš„å‰¯æœ¬è¢«è°ƒç”¨ã€‚å°½ç®¡æŠ€æœ¯ä¸Šå¯è¡Œï¼Œä½†ä¼ é€’æŒ‡å‘<code>std::function</code>çš„æŒ‡é’ˆå¹¶ä¸å¸¸è§ã€‚å› æ­¤ï¼Œè§‚å¯Ÿè€…ç±»ä»å¯ä»¥ä½œä¸º<code>std::function</code>çš„é€‚é…å™¨ï¼ˆå‚è§â€œæŒ‡å—24ï¼šä½¿ç”¨é€‚é…å™¨æ ‡å‡†åŒ–æ¥å£â€ï¼‰å‘æŒ¥ä½œç”¨ã€‚</p>
<p><strong>åˆ†æè§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼çš„ä¸è¶³</strong></p>
<p>â€œè¿™å¹¶ä¸æ˜¯æˆ‘æœŸæœ›çš„å€¼è¯­ä¹‰è§£å†³æ–¹æ¡ˆï¼Œä½†æˆ‘ä»ç„¶å–œæ¬¢å®ƒï¼â€ æˆ‘å¾ˆé«˜å…´æ‚¨è¿™ä¹ˆæƒ³ã€‚ç¡®å®ï¼Œå€¼è¯­ä¹‰çš„ä¼˜åŠ¿ç»“åˆè§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼çš„ä¼˜ç‚¹ï¼ˆå³äº‹ä»¶ä¸å…¶ç›¸åº”åŠ¨ä½œçš„è§£è€¦ä»¥åŠè½»æ¾æ·»åŠ æ–°ç§ç±»è§‚å¯Ÿè€…çš„èƒ½åŠ›ï¼‰å·¥ä½œå¾—éå¸¸å¥½ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæ²¡æœ‰å®Œç¾çš„è®¾è®¡ï¼Œæ¯ä¸ªè®¾è®¡ä¹Ÿæœ‰å…¶ç¼ºç‚¹ã€‚</p>
<p>é¦–å…ˆï¼Œåº”è¯¥æ˜ç¡®æŒ‡å‡ºï¼Œæ¼”ç¤ºçš„<code>std::function</code>æ–¹æ³•ä»…é€‚ç”¨äºå…·æœ‰å•ä¸ª<code>update()</code>å‡½æ•°çš„æ‹‰å–è§‚å¯Ÿè€…ã€‚ç”±äº<code>std::function</code>åªèƒ½å¤„ç†å•ä¸€å¯è°ƒç”¨å¯¹è±¡ï¼Œä»»ä½•éœ€è¦å¤šä¸ª<code>update()</code>å‡½æ•°çš„æ–¹æ³•éƒ½æ— æ³•ç”±å•ä¸ª<code>std::function</code>å¤„ç†ã€‚å› æ­¤ï¼Œå¯¹äºå…·æœ‰å¤šä¸ª<code>update()</code>å‡½æ•°çš„æ¨é€è§‚å¯Ÿè€…æˆ–æ½œåœ¨å¢é•¿çš„<code>update()</code>å‡½æ•°æ•°é‡ï¼Œ<code>std::function</code>é€šå¸¸ä¸æ˜¯æœ€ä½³é€‰æ‹©ï¼ˆè®°ä½ï¼Œä»£ç å¾€å¾€ä¼šå‘ç”Ÿå˜åŒ–ï¼ï¼‰ã€‚ä¸è¿‡ï¼Œå¯ä»¥æ³›åŒ–<code>std::function</code>çš„æ–¹æ³•ã€‚å¦‚æœéœ€è¦ï¼Œç±»å‹æ“¦é™¤è®¾è®¡æ¨¡å¼ï¼ˆå‚è§ç¬¬8ç« ï¼‰æ˜¯é¦–é€‰ã€‚</p>
<p>ç¬¬äºŒä¸ªï¼ˆè¾ƒå°çš„ï¼‰ç¼ºç‚¹æ˜¯ï¼Œå¦‚æ‚¨æ‰€è§ï¼Œæ²¡æœ‰çº¯ç²¹åŸºäºå€¼çš„å®ç°ã€‚è™½ç„¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>std::function</code>å®ç°<code>update()</code>åŠŸèƒ½ä»¥è·å¾—çµæ´»æ€§ï¼Œä½†æˆ‘ä»¬ä»ç„¶ä½¿ç”¨åŸå§‹æŒ‡é’ˆæ¥é™„åŠ å’Œåˆ†ç¦»è§‚å¯Ÿè€…ã€‚è¿™ä¸€ç‚¹å¾ˆå®¹æ˜“è§£é‡Šï¼šä½¿ç”¨æŒ‡é’ˆä½œä¸ºå”¯ä¸€æ ‡è¯†ç¬¦çš„ä¼˜ç‚¹å®åœ¨å¤ªå¤šï¼Œæ— æ³•å¿½è§†ã€‚æ­¤å¤–ï¼Œå¯¹äºæœ‰çŠ¶æ€è§‚å¯Ÿè€…ï¼Œæˆ‘ä»¬ä¸æƒ³å¤„ç†å®ä½“çš„å‰¯æœ¬ã€‚å½“ç„¶ï¼Œè¿™ä»ç„¶éœ€è¦æˆ‘ä»¬æ£€æŸ¥<code>nullptr</code>ï¼ˆè¿™éœ€è¦é¢å¤–çš„åŠªåŠ›ï¼‰ï¼Œå¹¶ä¸”æˆ‘ä»¬å¿…é¡»å§‹ç»ˆæ”¯ä»˜æŒ‡é’ˆä»£è¡¨çš„é—´æ¥è´¹ç”¨ã€‚æˆ‘ä¸ªäººè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå°é—®é¢˜ï¼Œå› ä¸ºè¿™ç§æ–¹æ³•æœ‰è®¸å¤šä¼˜ç‚¹ã€‚</p>
<p>æ›´å¤§çš„ç¼ºç‚¹æ˜¯è§‚å¯Ÿè€…çš„æ½œåœ¨å®ç°é—®é¢˜ï¼šæ³¨å†Œå’Œæ³¨é”€çš„é¡ºåºå¯èƒ½ä¼šæœ‰å¾ˆå¤§å½±å“ï¼Œç‰¹åˆ«æ˜¯åœ¨å…è®¸è§‚å¯Ÿè€…å¤šæ¬¡æ³¨å†Œçš„æƒ…å†µä¸‹ã€‚æ­¤å¤–ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œçº¿ç¨‹å®‰å…¨åœ°æ³¨å†Œå’Œæ³¨é”€è§‚å¯Ÿè€…ä»¥åŠäº‹ä»¶å¤„ç†æ˜¯éå¸¸å¤æ‚çš„ä¸»é¢˜ã€‚ä¾‹å¦‚ï¼Œä¸å¯ä¿¡çš„è§‚å¯Ÿè€…åœ¨å›è°ƒæœŸé—´å¦‚æœè¡Œä¸ºä¸å½“å¯èƒ½ä¼šå†»ç»“æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä¸ºä»»æ„è®¡ç®—å®ç°è¶…æ—¶éå¸¸å¤æ‚ã€‚ç„¶è€Œï¼Œè¿™ä¸ªè¯é¢˜è¿œè¿œè¶…å‡ºäº†æœ¬ä¹¦çš„èŒƒå›´ã€‚</p>
<p>ç„¶è€Œï¼Œå±äºæœ¬ä¹¦èŒƒå›´çš„æ˜¯è§‚å¯Ÿè€…è¿‡åº¦ä½¿ç”¨çš„æ‰€è°“å±é™©ï¼šå®ƒå¯ä»¥å¿«é€Ÿä¸”å®¹æ˜“åœ°å¯¼è‡´å¤æ‚çš„äº’è¿ç½‘ç»œã€‚äº‹å®ä¸Šï¼Œå¦‚æœä¸å°å¿ƒï¼Œå¯èƒ½ä¼šæ„å¤–å¼•å…¥æ— é™å¾ªç¯çš„å›è°ƒï¼å› æ­¤ï¼Œå¼€å‘äººå‘˜æœ‰æ—¶ä¼šå¯¹ä½¿ç”¨è§‚å¯Ÿè€…æ„Ÿåˆ°æ‹…å¿§ï¼Œå¹¶æ‹…å¿ƒå•ä¸ªé€šçŸ¥å¯èƒ½ä¼šç”±äºè¿™äº›äº’è¿è€Œå¯¼è‡´å·¨å¤§çš„å…¨å±€å“åº”ã€‚è™½ç„¶è¿™ç§å±é™©ç¡®å®å­˜åœ¨ï¼Œä½†å¦‚æœè®¾è®¡åˆç†å¹¶ä¸”è§‚å¯Ÿè€…å®ç°æ­£ç¡®ï¼Œåˆ™ä»»ä½•é€šçŸ¥åºåˆ—éƒ½åº”è¯¥æ²¿ç€æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰æœç€æ¶æ„çš„ä½å±‚è¿è¡Œã€‚è€Œè¿™æ­£æ˜¯è‰¯å¥½è½¯ä»¶è®¾è®¡çš„ç¾å¦™ä¹‹å¤„ã€‚</p>
<p>æ€»ç»“æ¥è¯´ï¼Œæ—¨åœ¨æä¾›çŠ¶æ€å˜åŒ–é€šçŸ¥çš„è§£å†³æ–¹æ¡ˆï¼Œè§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼è¢«è¯æ˜æ˜¯æœ€è‘—åå’Œæœ€å¸¸ç”¨çš„æ¨¡å¼ä¹‹ä¸€ã€‚é™¤äº†æ½œåœ¨æ£˜æ‰‹çš„å®ç°ç»†èŠ‚å¤–ï¼Œå®ƒæ— ç–‘æ˜¯æ¯ä¸ªå¼€å‘äººå‘˜å·¥å…·ç®±ä¸­åº”åŒ…å«çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚åº”ç”¨è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼ä»¥åˆ›å»ºä¸»é¢˜ä¸å…¶è§‚å¯Ÿè€…ä¹‹é—´çš„ä¸€å¯¹å¤šå…³ç³»ï¼Œå¹¶äº†è§£æ¨é€è§‚å¯Ÿè€…ä¸æ‹‰å–è§‚å¯Ÿè€…ä¹‹é—´çš„æƒè¡¡ã€‚åˆ©ç”¨åŸºäºå€¼è¯­ä¹‰çš„è§‚å¯Ÿè€…å®ç°çš„ä¼˜åŠ¿ã€‚</p>
<h3 id="å‡†åˆ™26ä½¿ç”¨crtpå¼•å…¥é™æ€ç±»å‹ç±»åˆ«"><strong>å‡†åˆ™26ï¼šä½¿ç”¨CRTPå¼•å…¥é™æ€ç±»å‹ç±»åˆ«</strong>
</h3><p>C++ çœŸçš„æœ‰å¾ˆå¤šå€¼å¾—æ¢ç´¢çš„åœ°æ–¹ã€‚å®ƒå¸¦æœ‰è®¸å¤šç‰¹æ€§ã€è®¸å¤šè¯­æ³•ä¸Šçš„å¥‡ç‰¹ä¹‹å¤„ä»¥åŠå¤§é‡çš„ä»¤äººæƒŠå¹ä½†éš¾ä»¥å‘éŸ³ï¼ˆå¯¹äºæ–°æ‰‹æ¥è¯´å‡ ä¹æ˜¯ç¥ç§˜çš„ï¼‰çš„ç¼©å†™è¯ï¼šRAIIã€ADLã€CTADã€SFINAEã€NTTPã€IFNDR å’Œ SIOFã€‚å“¦ï¼Œå¤šä¹ˆæœ‰è¶£ï¼å…¶ä¸­ä¸€ä¸ªç¥ç§˜çš„ç¼©å†™æ˜¯ CRTPï¼Œå³ Curiously Recurring Template Patternï¼ˆå¥‡å¦™é€’å½’æ¨¡æ¿æ¨¡å¼ï¼‰çš„ç¼©å†™ã€‚</p>
<p>å¦‚æœä½ å› ä¸ºè¿™ä¸ªåå­—æ¯«æ— æ„ä¹‰è€Œæ„Ÿåˆ°å›°æƒ‘ï¼Œä¸è¦æ‹…å¿ƒï¼šåœ¨ C++ ä¸­ï¼Œåå­—é€šå¸¸æ˜¯éšæ„é€‰æ‹©çš„ï¼Œä½†ä¸€æ—¦é€‰å®šå°±ä¸ä¼šå†æ›´æ”¹ã€‚è¿™ä¸ªæ¨¡å¼æ˜¯ç”± James Coplien åœ¨ 1995 å¹´ 2 æœˆçš„ã€ŠC++ Reportã€‹ä¸­å‘½åçš„ï¼Œå› ä¸ºä»–æ„è¯†åˆ°è¿™ç§æ¨¡å¼åœ¨è®¸å¤šä¸åŒçš„ C++ ä»£ç åº“ä¸­åå¤å‡ºç°ã€‚å¹¶ä¸”å¥‡æ€ªçš„æ˜¯ï¼Œå°½ç®¡è¿™ç§æ¨¡å¼åŸºäºç»§æ‰¿ï¼ˆå¯èƒ½ä½œä¸ºæŠ½è±¡ï¼‰ï¼Œä½†å®ƒå¹¶æ²¡æœ‰è¡¨ç°å‡ºè®¸å¤šå…¶ä»–ç»å…¸è®¾è®¡æ¨¡å¼é€šå¸¸å…·æœ‰çš„æ€§èƒ½ç¼ºç‚¹ã€‚å› æ­¤ï¼ŒCRTP ç»å¯¹å€¼å¾—ä¸€çœ‹ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šæˆä¸ºä½ è®¾è®¡æ¨¡å¼å·¥å…·ç®±ä¸­ä¸€ä¸ªæœ‰ä»·å€¼ç”šè‡³å¯ä»¥è¯´æ˜¯â€œå¥‡å¦™â€çš„è¡¥å……ã€‚</p>
<p><strong>CRTP çš„åŠ¨æœº</strong></p>
<p>åœ¨ C++ ä¸­ï¼Œæ€§èƒ½éå¸¸é‡è¦ã€‚äº‹å®ä¸Šï¼Œåœ¨æŸäº›ä¸Šä¸‹æ–‡ä¸­ï¼Œä½¿ç”¨è™šå‡½æ•°çš„æ€§èƒ½å¼€é”€è¢«è®¤ä¸ºæ˜¯å®Œå…¨ä¸å¯æ¥å—çš„ã€‚å› æ­¤ï¼Œåœ¨æ€§èƒ½æ•æ„Ÿçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œä¾‹å¦‚æŸäº›è®¡ç®—æœºæ¸¸æˆæˆ–é«˜é¢‘äº¤æ˜“çš„éƒ¨åˆ†ï¼Œä¸ä¼šä½¿ç”¨è™šå‡½æ•°ã€‚åŒæ ·çš„æƒ…å†µä¹Ÿé€‚ç”¨äºé«˜æ€§èƒ½è®¡ç®—ï¼ˆHPCï¼‰ã€‚åœ¨ HPC ä¸­ï¼Œä»»ä½•æ¡ä»¶æˆ–é—´æ¥æ“ä½œï¼ŒåŒ…æ‹¬è™šå‡½æ•°ï¼Œéƒ½è¢«ç¦æ­¢å‡ºç°åœ¨æœ€å½±å“æ€§èƒ½çš„éƒ¨åˆ†ï¼Œä¾‹å¦‚è®¡ç®—å†…æ ¸çš„æœ€å†…å±‚å¾ªç¯ã€‚ä½¿ç”¨å®ƒä»¬ä¼šå¸¦æ¥å¤ªå¤šçš„æ€§èƒ½å¼€é”€ã€‚</p>
<p>ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹åŠå…¶é‡è¦æ€§ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ä»¥ä¸‹æ¥è‡ªçº¿æ€§ä»£æ•°ï¼ˆLAï¼‰åº“çš„ <code>DynamicVector</code> ç±»æ¨¡æ¿ç¤ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;DynamicVector.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;numeric&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iosfwd&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iterator&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DynamicVector</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">using</span> <span class="n">value_type</span>     <span class="o">=</span> <span class="n">T</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">   <span class="k">using</span> <span class="n">iterator</span>       <span class="o">=</span> <span class="k">typename</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">using</span> <span class="n">const_iterator</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">const_iterator</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... æ„é€ å‡½æ•°å’Œç‰¹æ®Šæˆå‘˜å‡½æ•° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="n">size_t</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">   <span class="n">T</span><span class="o">&amp;</span>       <span class="k">operator</span><span class="p">[](</span> <span class="n">size_t</span> <span class="n">index</span> <span class="p">);</span>   
</span></span><span class="line"><span class="cl">   <span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span> <span class="n">size_t</span> <span class="n">index</span> <span class="p">)</span> <span class="k">const</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="n">iterator</span>       <span class="nf">begin</span><span class="p">();</span>   
</span></span><span class="line"><span class="cl">   <span class="n">const_iterator</span> <span class="nf">begin</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="n">iterator</span>       <span class="nf">end</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">   <span class="n">const_iterator</span> <span class="nf">end</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... è®¸å¤šæ•°å€¼å‡½æ•° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">values_</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">DynamicVector</span> <span class="k">const</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">vector</span> <span class="p">)</span>  
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;(&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">for</span><span class="p">(</span> <span class="k">auto</span> <span class="k">const</span><span class="o">&amp;</span> <span class="nl">element</span> <span class="p">:</span> <span class="n">vector</span> <span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">element</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; )&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="n">os</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">l2norm</span><span class="p">(</span> <span class="n">DynamicVector</span> <span class="k">const</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">vector</span> <span class="p">)</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">begin</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">end</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">inner_product</span><span class="p">(</span> <span class="n">begin</span><span class="p">(</span><span class="n">vector</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">                                       <span class="p">,</span> <span class="n">begin</span><span class="p">(</span><span class="n">vector</span><span class="p">),</span> <span class="n">T</span><span class="p">{}</span> <span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// ... æ›´å¤šå†…å®¹
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å°½ç®¡åç§°å¦‚æ­¤ï¼Œ<code>DynamicVector</code> å¹¶ä¸ä»£è¡¨å®¹å™¨ï¼Œè€Œæ˜¯ç”¨äº LA è®¡ç®—çš„æ•°å€¼å‘é‡ã€‚åç§°ä¸­çš„â€œåŠ¨æ€â€éƒ¨åˆ†æ„å‘³ç€å®ƒä»¥åŠ¨æ€æ–¹å¼åˆ†é…å…¶å…ƒç´ ï¼Œåœ¨æ­¤ç¤ºä¾‹ä¸­ä½¿ç”¨ <code>std::vector</code>ã€‚å› æ­¤ï¼Œå®ƒé€‚ç”¨äºå¤§å‹ LA é—®é¢˜ï¼ˆè‚¯å®šæ˜¯åœ¨æ•°ç™¾ä¸‡ä¸ªå…ƒç´ çš„èŒƒå›´å†…ï¼‰ã€‚è™½ç„¶æ­¤ç±»å¯èƒ½åŒ…å«è®¸å¤šæ•°å€¼è¿ç®—ï¼Œä½†ä»æ¥å£è§’åº¦æ¥çœ‹ï¼Œä½ å¯èƒ½ä¼šç§°ä¹‹ä¸ºå®¹å™¨ï¼šå®ƒæä¾›äº†å¸¸ç”¨çš„åµŒå¥—ç±»å‹ï¼ˆ<code>value_type</code>ã€<code>iterator</code> å’Œ <code>const_iterator</code>ï¼‰ã€æŸ¥è¯¢å½“å‰å…ƒç´ æ•°é‡çš„ <code>size()</code> å‡½æ•°ã€é€šè¿‡ç´¢å¼•è®¿é—®å•ä¸ªå…ƒç´ çš„ä¸‹æ ‡è¿ç®—ç¬¦ï¼ˆä¸€ä¸ªç”¨äºéå¸¸é‡å‘é‡ï¼Œä¸€ä¸ªç”¨äºå¸¸é‡å‘é‡ï¼‰ã€è¿­ä»£å…ƒç´ çš„ <code>begin()</code> å’Œ <code>end()</code> å‡½æ•°ã€‚é™¤äº†æˆå‘˜å‡½æ•°å¤–ï¼Œå®ƒè¿˜æä¾›äº†ä¸€ä¸ªè¾“å‡ºè¿ç®—ç¬¦å’Œè‡³å°‘ä¸€ä¸ª LA æ“ä½œï¼Œç”¨äºè®¡ç®—å‘é‡çš„æ¬§å‡ é‡Œå¾—èŒƒæ•°ï¼ˆé€šå¸¸ä¹Ÿç§°ä¸º L2 èŒƒæ•°ï¼Œå› ä¸ºå®ƒè¿‘ä¼¼äºç¦»æ•£å‘é‡çš„ L2 èŒƒæ•°ï¼‰ã€‚</p>
<p>ç„¶è€Œï¼Œ<code>DynamicVector</code> ä¸æ˜¯å”¯ä¸€çš„å‘é‡ç±»ã€‚åœ¨æˆ‘ä»¬çš„ LA åº“ä¸­ï¼Œä½ è¿˜ä¼šå‘ç°ä»¥ä¸‹ <code>StaticVector</code> ç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;StaticVector.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;array&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;numeric&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iosfwd&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iterator&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">Size</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">StaticVector</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">using</span> <span class="n">value_type</span>     <span class="o">=</span> <span class="n">T</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">   <span class="k">using</span> <span class="n">iterator</span>       <span class="o">=</span> <span class="k">typename</span> <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">Size</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">using</span> <span class="n">const_iterator</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">Size</span><span class="o">&gt;::</span><span class="n">const_iterator</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... æ„é€ å‡½æ•°å’Œç‰¹æ®Šæˆå‘˜å‡½æ•° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="n">size_t</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">   <span class="n">T</span><span class="o">&amp;</span>       <span class="k">operator</span><span class="p">[](</span> <span class="n">size_t</span> <span class="n">index</span> <span class="p">);</span>   
</span></span><span class="line"><span class="cl">   <span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span> <span class="n">size_t</span> <span class="n">index</span> <span class="p">)</span> <span class="k">const</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="n">iterator</span>       <span class="nf">begin</span><span class="p">();</span>   
</span></span><span class="line"><span class="cl">   <span class="n">const_iterator</span> <span class="nf">begin</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="n">iterator</span>       <span class="nf">end</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">   <span class="n">const_iterator</span> <span class="nf">end</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... è®¸å¤šæ•°å€¼å‡½æ•° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">Size</span><span class="o">&gt;</span> <span class="n">values_</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">Size</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span>     
</span></span><span class="line"><span class="cl">                          <span class="n">StaticVector</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">Size</span><span class="o">&gt;</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">vector</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;(&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">for</span><span class="p">(</span> <span class="k">auto</span> <span class="k">const</span><span class="o">&amp;</span> <span class="nl">element</span> <span class="p">:</span> <span class="n">vector</span> <span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">element</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; )&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="n">os</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">Size</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">l2norm</span><span class="p">(</span> <span class="n">StaticVector</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">Size</span><span class="o">&gt;</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">vector</span> <span class="p">)</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">begin</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">end</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">inner_product</span><span class="p">(</span> <span class="n">begin</span><span class="p">(</span><span class="n">vector</span><span class="p">),</span> <span class="n">end</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">                                       <span class="p">,</span> <span class="n">begin</span><span class="p">(</span><span class="n">vector</span><span class="p">),</span> <span class="n">T</span><span class="p">{}</span> <span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// ... æ›´å¤šå†…å®¹
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>â€œè¿™ä¸æ˜¯å‡ ä¹ä¸ <code>DynamicVector</code> ç±»ç›¸åŒå—ï¼Ÿâ€ä½ å¯èƒ½ä¼šé—®ã€‚æ˜¯çš„ï¼Œè¿™ä¸¤ä¸ªç±»ç¡®å®éå¸¸ç›¸ä¼¼ã€‚<code>StaticVector</code> ç±»æä¾›äº†ä¸ <code>DynamicVector</code> ç›¸åŒçš„æ¥å£ï¼Œå¦‚åµŒå¥—ç±»å‹ <code>value_type</code>ã€<code>iterator</code> å’Œ <code>const_iterator</code>ã€æŸ¥è¯¢å½“å‰å…ƒç´ æ•°é‡çš„ <code>size()</code> æˆå‘˜å‡½æ•°ã€ä¸‹æ ‡è¿ç®—ç¬¦ã€è¿­ä»£å…ƒç´ çš„ <code>begin()</code> å’Œ <code>end()</code> å‡½æ•°ã€‚å®ƒè¿˜åŒ…æ‹¬ä¸€ä¸ªè¾“å‡ºè¿ç®—ç¬¦å’Œä¸€ä¸ªè‡ªç”±çš„ <code>l2norm()</code> å‡½æ•°ã€‚ç„¶è€Œï¼Œä¸¤è€…ä¹‹é—´æœ‰ä¸€ä¸ªé‡è¦çš„æ€§èƒ½ç›¸å…³çš„åŒºåˆ«ï¼šæ­£å¦‚åç§°ä¸­çš„â€œé™æ€â€æ‰€æš—ç¤ºçš„é‚£æ ·ï¼Œ<code>StaticVector</code> ä¸åŠ¨æ€åˆ†é…å…¶å…ƒç´ ã€‚ç›¸åï¼Œå®ƒä½¿ç”¨ç±»å†…çš„ç¼“å†²åŒºæ¥å­˜å‚¨å…¶å…ƒç´ ï¼Œä¾‹å¦‚ä½¿ç”¨ <code>std::array</code>ã€‚å› æ­¤ï¼Œä¸ <code>DynamicVector</code> ç›¸æ¯”ï¼Œ<code>StaticVector</code> çš„æ‰€æœ‰åŠŸèƒ½éƒ½é’ˆå¯¹å°‘é‡å›ºå®šæ•°é‡çš„å…ƒç´ è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¾‹å¦‚ 2D æˆ– 3D å‘é‡ã€‚</p>
<p>â€œå¥½çš„ï¼Œæˆ‘ç†è§£è¿™å¯¹æ€§èƒ½å¾ˆé‡è¦ï¼Œä½†è¿™ä»ç„¶å¯¼è‡´äº†å¤§é‡çš„ä»£ç é‡å¤ï¼Œå¯¹å§ï¼Ÿâ€ä½ å†æ¬¡æ­£ç¡®ã€‚å¦‚æœä»”ç»†æŸ¥çœ‹ä¸¤ä¸ªå‘é‡ç±»çš„å…³è”è¾“å‡ºè¿ç®—ç¬¦ï¼Œä½ ä¼šå‘ç°è¿™ä¸¤ä¸ªå‡½æ•°çš„å®ç°æ˜¯ç›¸åŒçš„ã€‚è¿™æ˜¯éå¸¸ä¸ç†æƒ³çš„ï¼šå¦‚æœå‘ç”Ÿä»»ä½•å˜åŒ–ï¼Œä¾‹å¦‚å‘é‡æ ¼å¼çš„å˜åŒ–ï¼ˆè®°ä½ï¼šå˜åŒ–æ˜¯è½¯ä»¶å¼€å‘ä¸­çš„å”¯ä¸€ä¸å˜ï¼Œå¿…é¡»é¢„æœŸå¹¶å¤„ç†ï¼›å‚è§â€œæŒ‡å—2ï¼šä¸ºå˜åŒ–è€Œè®¾è®¡â€ï¼‰ï¼Œé‚£ä¹ˆä½ å°†ä¸å¾—ä¸åœ¨å¤šä¸ªåœ°æ–¹è¿›è¡Œä¿®æ”¹ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªåœ°æ–¹ã€‚è¿™è¿åäº†â€œä¸è¦é‡å¤è‡ªå·±â€ï¼ˆDRYï¼‰åŸåˆ™ï¼šå¾ˆå®¹æ˜“å¿˜è®°æˆ–é”™è¿‡æ›´æ–°æŸä¸€å¤„ï¼Œä»è€Œå¼•å…¥ä¸ä¸€è‡´ç”šè‡³é”™è¯¯ã€‚</p>
<p>â€œä½†è¿™ä¸æ˜¯å¯ä»¥é€šè¿‡ç¨å¾®æ›´é€šç”¨çš„å‡½æ•°æ¨¡æ¿è½»æ¾è§£å†³çš„é—®é¢˜å—ï¼Ÿä¾‹å¦‚ï¼Œæˆ‘å¯ä»¥æƒ³è±¡ä»¥ä¸‹é€‚ç”¨äºæ‰€æœ‰å¯†é›†å‘é‡çš„è¾“å‡ºè¿ç®—ç¬¦ï¼šâ€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">DenseVector</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">DenseVector</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">vector</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... å¦‚å‰æ‰€è¿° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è™½ç„¶è¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªé€‚å½“çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æˆ‘ä¸ä¼šåœ¨æ‹‰å–è¯·æ±‚ä¸­æ¥å—æ­¤ä»£ç ã€‚è¯¥å‡½æ•°æ¨¡æ¿ç¡®å®æ›´é€šç”¨ï¼Œä½†æˆ‘ç»å¯¹ä¸ä¼šç§°å…¶ä¸ºâ€œç¨å¾®â€æ›´é€šç”¨ï¼›ä½ å»ºè®®çš„æ˜¯å¯ä»¥ç¼–å†™çš„æœ€é€šç”¨çš„è¾“å‡ºè¿ç®—ç¬¦ã€‚æ˜¯çš„ï¼Œè¯¥å‡½æ•°æ¨¡æ¿çš„åç§°å¯èƒ½æš—ç¤ºå®ƒä»…é€‚ç”¨äºå¯†é›†å‘é‡ï¼ˆåŒ…æ‹¬ <code>DynamicVector</code> å’Œ <code>StaticVector</code>ï¼‰ï¼Œä½†å®é™…ä¸Šï¼Œè¯¥å‡½æ•°æ¨¡æ¿ä¼šæ¥å—ä»»ä½•ç±»å‹ï¼š<code>DynamicVector</code>ã€<code>StaticVector</code>ã€<code>std::vector</code>ã€<code>std::string</code> ä»¥åŠåŸºæœ¬ç±»å‹å¦‚ <code>int</code> å’Œ <code>double</code>ã€‚å®ƒæ ¹æœ¬æ— æ³•æŒ‡å®šä»»ä½•è¦æ±‚æˆ–çº¦æŸã€‚å› æ­¤ï¼Œå®ƒè¿åäº†æ ¸å¿ƒæŒ‡å— T.10ï¼š ä¸ºæ‰€æœ‰æ¨¡æ¿å‚æ•°æŒ‡å®šæ¦‚å¿µã€‚</p>
<p>è™½ç„¶æ­¤è¾“å‡ºè¿ç®—ç¬¦é€‚ç”¨äºæ‰€æœ‰å¯†é›†å‘é‡å’Œåºåˆ—å®¹å™¨ï¼Œä½†å¯¹äºä¸æä¾›é¢„æœŸæ¥å£çš„ç±»å‹ï¼Œä½ ä¼šå¾—åˆ°ç¼–è¯‘é”™è¯¯ã€‚æˆ–è€…æ›´ç³Ÿç³•çš„æ˜¯ï¼Œä½ å¯èƒ½ä¼šå¾®å¦™åœ°è¿åéšå¼çš„è¦æ±‚å’ŒæœŸæœ›ï¼Œä»è€Œè¿å LSPï¼ˆå‚è§â€œæŒ‡å—6ï¼šéµå¾ªæŠ½è±¡çš„é¢„æœŸè¡Œä¸ºâ€ï¼‰ã€‚å½“ç„¶ï¼Œä½ ä¸ä¼šæœ‰æ„è¿™æ ·åšï¼Œä½†å¾ˆå¯èƒ½æ˜¯æ— æ„é—´å‘ç”Ÿçš„ï¼šæ­¤è¾“å‡ºè¿ç®—ç¬¦æ˜¯ä»»ä½•ç±»å‹çš„å®Œç¾åŒ¹é…ï¼Œå¹¶ä¸”å³ä½¿ä½ ä¸æœŸæœ›ä¹Ÿä¼šè¢«ä½¿ç”¨ã€‚å› æ­¤ï¼Œè¿™ä¸ªå‡½æ•°æ¨¡æ¿å°†æˆä¸ºè¾“å‡ºè¿ç®—ç¬¦é‡è½½é›†ä¸­çš„ä¸€ä¸ªä¸å¹¸æ·»åŠ ã€‚æˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ç»„å…¨æ–°çš„ç±»å‹ï¼Œä¸€ä¸ªæ–°çš„ç±»å‹ç±»åˆ«ã€‚</p>
<p>â€œè¿™ä¸æ˜¯åŸºç±»çš„ä½œç”¨å—ï¼Ÿæˆ‘ä»¬ä¸èƒ½ç®€å•åœ°å®šä¹‰ä¸€ä¸ª <code>DenseVector</code> åŸºç±»æ¥ä¸ºæ‰€æœ‰å¯†é›†å‘é‡å®šä¹‰é¢„æœŸæ¥å£å—ï¼Ÿè€ƒè™‘ä»¥ä¸‹ <code>DenseVector</code> åŸºç±»çš„è‰å›¾ï¼šâ€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span>  <span class="c1">// å…ƒç´ ç±»å‹ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">DenseVector</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="o">~</span><span class="n">DenseVector</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="n">size_t</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="n">T</span><span class="o">&amp;</span>       <span class="k">operator</span><span class="p">[](</span> <span class="n">size_t</span> <span class="n">index</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">virtual</span> <span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span> <span class="n">size_t</span> <span class="n">index</span> <span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">DenseVector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">vector</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... å¦‚å‰æ‰€è¿° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>â€œè¿™åº”è¯¥å¯ä»¥å·¥ä½œï¼Œå¯¹å§ï¼Ÿæˆ‘åªæ˜¯ä¸ç¡®å®šå¦‚ä½•å£°æ˜ <code>begin()</code> å’Œ <code>end()</code> å‡½æ•°ï¼Œå› ä¸ºæˆ‘æ— æ³•ä»ä¸åŒè¿­ä»£å™¨ç±»å‹ï¼ˆå¦‚ <code>std::vector&lt;T&gt;::iterator</code> å’Œ <code>std::array&lt;T&gt;::iterator</code>ï¼‰ä¸­æŠ½è±¡å‡ºæ¥ã€‚â€ æˆ‘ä¹Ÿæœ‰ç±»ä¼¼çš„æ„Ÿè§‰ï¼Œè¿™ä¸ªé—®é¢˜æ²¡æœ‰å¿«é€Ÿè§£å†³æ–¹æ¡ˆã€‚ä½†è¿˜æœ‰ä¸€ä¸ªæ›´ä¸ºä¸¥é‡çš„é—®é¢˜ï¼šæœ‰äº†è¿™ä¸ªåŸºç±»ï¼Œæˆ‘ä»¬ä¼šå°†æ‰€æœ‰æˆå‘˜å‡½æ•°å˜æˆè™šæˆå‘˜å‡½æ•°ã€‚è¿™åŒ…æ‹¬ <code>begin()</code> å’Œ <code>end()</code> å‡½æ•°ï¼Œä½†æœ€é‡è¦çš„æ˜¯ä¸¤ä¸ªä¸‹æ ‡è¿ç®—ç¬¦ã€‚åæœå°†æ˜¯æ˜¾è‘—çš„ï¼šæ¯æ¬¡è®¿é—®å‘é‡çš„ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæˆ‘ä»¬ç°åœ¨éƒ½éœ€è¦è°ƒç”¨ä¸€ä¸ªè™šå‡½æ•°ã€‚æ¯ä¸€æ¬¡è®¿é—®ï¼å› æ­¤ï¼Œæœ‰äº†è¿™ä¸ªåŸºç±»ï¼Œæˆ‘ä»¬å°±å‘Šåˆ«äº†é«˜æ€§èƒ½ã€‚</p>
<p>ç„¶è€Œï¼Œæ„å»ºæŠ½è±¡çš„åŸºæœ¬ç±»çš„æƒ³æ³•æœ¬èº«æ˜¯å¥½çš„ã€‚æˆ‘ä»¬åªéœ€è¦ä»¥ä¸åŒçš„æ–¹å¼å»åšã€‚è¿™å°±æ˜¯æˆ‘ä»¬åº”è¯¥ä»”ç»†çœ‹çœ‹ CRTP çš„åœ°æ–¹ã€‚</p>
<p><strong>CRTP è®¾è®¡æ¨¡å¼è§£é‡Š</strong></p>
<p>CRTP è®¾è®¡æ¨¡å¼å»ºç«‹åœ¨åˆ›å»ºæŠ½è±¡çš„åŸºæœ¬ç±»è¿™ä¸€å¸¸è§æƒ³æ³•ä¸Šã€‚ä½†æ˜¯ï¼Œå®ƒé€šè¿‡ç¼–è¯‘æ—¶å…³ç³»è€Œä¸æ˜¯è¿è¡Œæ—¶å…³ç³»ï¼ˆé€šè¿‡è™šå‡½æ•°ï¼‰åœ¨åŸºç±»å’Œæ´¾ç”Ÿç±»ä¹‹é—´å»ºç«‹äº†è”ç³»ã€‚</p>
<p>CRTP è®¾è®¡æ¨¡å¼é€šè¿‡è¯†åˆ«ä¸€ä¸ªæ–¹é¢ä½œä¸ºå˜åŒ–ç‚¹ï¼ˆä¸€ä¸ªå˜åŒ–æˆ–é¢„æœŸä¼šå˜åŒ–çš„æ–¹é¢ï¼‰å¹¶å°†å…¶æå–ä¸ºæŠ½è±¡å½¢å¼æ¥å¸®åŠ©è§£è€¦è½¯ä»¶å®ä½“ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¼•å…¥æ–°è§‚å¯Ÿè€…çš„éœ€æ±‚â€”â€”æ‰©å±•ä¸€å¯¹å¤šä¾èµ–å…³ç³»â€”â€”è¢«è®¤ä¸ºæ˜¯å˜åŒ–ç‚¹ã€‚å¦‚å›¾ 6-2 æ‰€ç¤ºï¼Œè¿™ç§å˜åŒ–ç‚¹é€šè¿‡è§‚å¯Ÿè€…åŸºç±»çš„å½¢å¼å®ç°ã€‚</p>
<p><code>Observer</code> ç±»ä»£è¡¨æ‰€æœ‰å¯èƒ½çš„è§‚å¯Ÿè€…å®ç°çš„æŠ½è±¡ã€‚è¿™äº›è§‚å¯Ÿè€…é™„åŠ åˆ°ç”±å…·ä½“ä¸»é¢˜ç±»ï¼ˆ<code>ConcreteSubject</code>ï¼‰è¡¨ç¤ºçš„ç‰¹å®šä¸»é¢˜ä¸Šã€‚ä¸ºäº†å‡å°‘è§‚å¯Ÿè€…ä¸å…¶ä¸»é¢˜ä¹‹é—´çš„è€¦åˆï¼Œæˆ–è€…é€šè¿‡æä¾›æ‰€æœ‰é€šç”¨æœåŠ¡æ¥ç®€åŒ–ä»£ç é‡å¤ï¼Œå¯ä»¥ä½¿ç”¨ä¸»é¢˜æŠ½è±¡æ¥è¿›è¡Œ <code>attach()</code> å’Œ <code>detach()</code> æ“ä½œã€‚è¯¥ä¸»é¢˜è¿˜å¯ä»¥åœ¨å…¶çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶é€šçŸ¥æ‰€æœ‰é™„åŠ çš„è§‚å¯Ÿè€…ï¼Œå¹¶è§¦å‘å®ƒä»¬ç›¸åº”çš„æ›´æ–°åŠŸèƒ½ï¼ˆ<code>update()</code>ï¼‰ã€‚</p>
<p>CRTP è®¾è®¡æ¨¡å¼åŸºäºä½¿ç”¨åŸºç±»åˆ›å»ºæŠ½è±¡çš„å¸¸è§æ€æƒ³ã€‚ä½†å®ƒä¸æ˜¯é€šè¿‡è™šå‡½æ•°åœ¨åŸºç±»å’Œæ´¾ç”Ÿç±»ä¹‹é—´å»ºç«‹è¿è¡Œæ—¶å…³ç³»ï¼Œè€Œæ˜¯åˆ›å»ºç¼–è¯‘æ—¶å…³ç³»ã€‚</p>
<p><code>DenseVector</code> åŸºç±»å’Œ <code>DynamicVector</code> æ´¾ç”Ÿç±»ä¹‹é—´çš„ç¼–è¯‘æ—¶å…³ç³»æ˜¯é€šè¿‡å°†åŸºç±»å‡çº§ä¸ºç±»æ¨¡æ¿æ¥åˆ›å»ºçš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;DenseVector.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">Derived</span> <span class="o">&gt;</span>   
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">DenseVector</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="n">size_t</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Derived</span> <span class="k">const</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">).</span><span class="n">size</span><span class="p">();</span> <span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;DynamicVector.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DynamicVector</span> <span class="o">:</span> <span class="k">public</span> <span class="n">DenseVector</span><span class="o">&lt;</span><span class="n">DynamicVector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="n">size_t</span> <span class="n">size</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>CRTP çš„å¥‡å¦™ä¹‹å¤„åœ¨äºï¼ŒåŸºç±»çš„æ–°æ¨¡æ¿å‚æ•°è¡¨ç¤ºå…³è”æ´¾ç”Ÿç±»çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œ<code>DynamicVector</code> ç­‰æ´¾ç”Ÿç±»éœ€è¦æä¾›è‡ªå·±çš„ç±»å‹æ¥å®ä¾‹åŒ–åŸºç±»ã€‚</p>
<p>â€œå“‡ï¼Œç­‰ä¸€ä¸‹â€”â€”è¿™æ€ä¹ˆå¯èƒ½ï¼Ÿâ€ä½ å¯èƒ½ä¼šé—®ã€‚ç¡®å®å¯ä»¥ã€‚ä¸ºäº†å®ä¾‹åŒ–ä¸€ä¸ªæ¨¡æ¿ï¼Œä½ ä¸éœ€è¦å®Œæ•´çš„ç±»å‹å®šä¹‰ã€‚ä½¿ç”¨ä¸å®Œæ•´ç±»å‹å°±è¶³å¤Ÿäº†ã€‚è¿™ç§ä¸å®Œæ•´ç±»å‹åœ¨ç¼–è¯‘å™¨çœ‹åˆ° <code>DynamicVector</code> ç±»å£°æ˜åå³å¯è·å¾—ã€‚å®é™…ä¸Šï¼Œè¿™æ®µè¯­æ³•èµ·åˆ°äº†å‰å‘å£°æ˜çš„ä½œç”¨ã€‚å› æ­¤ï¼Œ<code>DynamicVector</code> ç±»ç¡®å®å¯ä»¥ä½¿ç”¨è‡ªèº«ä½œä¸º <code>DenseVector</code> åŸºç±»çš„æ¨¡æ¿å‚æ•°ã€‚</p>
<p>å½“ç„¶ï¼Œä½ å¯ä»¥æ ¹æ®å–œå¥½å‘½ååŸºç±»çš„æ¨¡æ¿å‚æ•°ï¼ˆä¾‹å¦‚ï¼Œç®€å•åœ°å‘½åä¸º <code>T</code>ï¼‰ï¼Œä½†æ­£å¦‚â€œæŒ‡å—14ï¼šä½¿ç”¨è®¾è®¡æ¨¡å¼åç§°ä¼ è¾¾æ„å›¾â€ä¸­è®¨è®ºçš„é‚£æ ·ï¼Œä½¿ç”¨è®¾è®¡æ¨¡å¼çš„åç§°æˆ–å¸¸ç”¨åç§°æœ‰åŠ©äºä¼ è¾¾æ„å›¾ã€‚å› æ­¤ï¼Œä½ å¯ä»¥å°†å‚æ•°å‘½åä¸º <code>CRTP</code>ï¼Œè¿™å¾ˆå¥½åœ°ä¼ è¾¾äº†æ¨¡å¼ï¼Œä½†ä¸å¹¸çš„æ˜¯åªå¯¹ç†Ÿæ‚‰çš„äººæœ‰æ„ä¹‰ã€‚å…¶ä»–äººä¼šå¯¹æ­¤ç¼©å†™æ„Ÿåˆ°å›°æƒ‘ã€‚å› æ­¤ï¼Œæ¨¡æ¿å‚æ•°é€šå¸¸ç§°ä¸º <code>Derived</code>ï¼Œè¿™å®Œç¾è¡¨è¾¾äº†å…¶ç”¨é€”å¹¶ä¼ è¾¾äº†æ„å›¾ï¼šå®ƒä»£è¡¨æ´¾ç”Ÿç±»çš„ç±»å‹ã€‚</p>
<p>é€šè¿‡è¿™ä¸ªæ¨¡æ¿å‚æ•°ï¼ŒåŸºç±»ç°åœ¨çŸ¥é“äº†å®é™…æ´¾ç”Ÿç±»å‹çš„ç±»å‹ã€‚è™½ç„¶å®ƒä»ç„¶ä»£è¡¨æ‰€æœ‰å¯†é›†å‘é‡çš„æŠ½è±¡å’Œå…¬å…±æ¥å£ï¼Œä½†ç°åœ¨èƒ½å¤Ÿè®¿é—®å’Œè°ƒç”¨æ´¾ç”Ÿç±»å‹ä¸­çš„å…·ä½“å®ç°ã€‚ä¾‹å¦‚ï¼Œåœ¨ <code>size()</code> æˆå‘˜å‡½æ•°ä¸­å‘ç”Ÿè¿™ç§æƒ…å†µï¼š<code>DenseVector</code> ä½¿ç”¨ <code>static_cast</code> å°†è‡ªèº«è½¬æ¢ä¸ºæ´¾ç”Ÿç±»çš„å¼•ç”¨ï¼Œå¹¶è°ƒç”¨è¯¥ç±»çš„ <code>size()</code> å‡½æ•°ã€‚ä¹ä¸€çœ‹ï¼Œè¿™çœ‹èµ·æ¥åƒæ˜¯é€’å½’å‡½æ•°è°ƒç”¨ï¼ˆåœ¨ <code>size()</code> å‡½æ•°å†…éƒ¨è°ƒç”¨ <code>size()</code> å‡½æ•°ï¼‰ï¼Œä½†å®é™…ä¸Šæ˜¯åœ¨æ´¾ç”Ÿç±»ä¸­è°ƒç”¨ <code>size()</code> æˆå‘˜å‡½æ•°ã€‚</p>
<p>â€œæ‰€ä»¥è¿™å°±æ˜¯ä½ æ‰€è¯´çš„ç¼–è¯‘æ—¶å…³ç³»ã€‚åŸºç±»ä»£è¡¨å…·ä½“æ´¾ç”Ÿç±»å‹å’Œå®ç°ç»†èŠ‚çš„æŠ½è±¡ï¼Œä½†ä»ç¡®åˆ‡çŸ¥é“å®ç°ç»†èŠ‚åœ¨å“ªé‡Œã€‚æ‰€ä»¥æˆ‘ä»¬çœŸçš„ä¸éœ€è¦ä»»ä½•è™šå‡½æ•°ã€‚â€ æ­£ç¡®ã€‚é€šè¿‡ CRTPï¼Œæˆ‘ä»¬ç°åœ¨èƒ½å¤Ÿå®ç°ä¸€ä¸ªé€šç”¨æ¥å£ï¼Œå¹¶é€šè¿‡ç®€å•çš„ <code>static_cast</code> å°†æ¯ä¸ªè°ƒç”¨è½¬å‘ç»™æ´¾ç”Ÿç±»ã€‚è¿™æ ·åšæ²¡æœ‰ä»»ä½•æ€§èƒ½æŸå¤±ã€‚å®é™…ä¸Šï¼ŒåŸºç±»å‡½æ•°å¾ˆå¯èƒ½ä¼šè¢«å†…è”ï¼Œå¦‚æœ <code>DenseVector</code> æ˜¯å”¯ä¸€çš„æˆ–ç¬¬ä¸€ä¸ªåŸºç±»ï¼Œ<code>static_cast</code> ç”šè‡³ä¸ä¼šäº§ç”Ÿå•æ¡æ±‡ç¼–æŒ‡ä»¤ã€‚å®ƒåªæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨å°†å¯¹è±¡è§†ä¸ºæ´¾ç”Ÿç±»å‹çš„å¯¹è±¡ã€‚</p>
<p>ä¸ºäº†æä¾›ä¸€ä¸ªå¹²å‡€çš„ CRTP åŸºç±»ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ›´æ–°ä¸€äº›ç»†èŠ‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;DenseVector.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">Derived</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">DenseVector</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">protected</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="o">~</span><span class="n">DenseVector</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">   <span class="n">Derived</span><span class="o">&amp;</span>       <span class="n">derived</span><span class="p">()</span>       
</span></span><span class="line"><span class="cl">      <span class="p">{</span> <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Derived</span><span class="o">&amp;&gt;</span><span class="p">(</span> <span class="o">*</span><span class="k">this</span> <span class="p">);</span> <span class="p">}</span>  
</span></span><span class="line"><span class="cl">   <span class="n">Derived</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">derived</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Derived</span> <span class="k">const</span><span class="o">&amp;&gt;</span><span class="p">(</span> <span class="o">*</span><span class="k">this</span> <span class="p">);</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="n">size_t</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">derived</span><span class="p">().</span><span class="n">size</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>å› ä¸ºæˆ‘ä»¬æƒ³é¿å…ä»»ä½•è™šå‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯¹è™šææ„å‡½æ•°ä¸æ„Ÿå…´è¶£ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†ææ„å‡½æ•°å®ç°ä¸ºä¿æŠ¤éƒ¨åˆ†ä¸­çš„éè™šå‡½æ•°ã€‚è¿™å®Œå…¨ç¬¦åˆæ ¸å¿ƒæŒ‡å— C.35ï¼š åŸºç±»ææ„å‡½æ•°åº”è¯¥æ˜¯å…¬å…±ä¸”è™šçš„ï¼Œæˆ–è€…æ˜¯å—ä¿æŠ¤ä¸”éè™šçš„ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤ææ„å‡½æ•°çš„å®šä¹‰é˜»æ­¢äº†ç¼–è¯‘å™¨ç”Ÿæˆä¸¤ä¸ªç§»åŠ¨æ“ä½œã€‚ç”±äº CRTP åŸºç±»é€šå¸¸æ˜¯ç©ºçš„ï¼Œæ²¡æœ‰ä»€ä¹ˆå¯ç§»åŠ¨çš„å†…å®¹ï¼Œè¿™ä¸æ˜¯é—®é¢˜ï¼›ä½†ä»ç„¶è¦æ—¶åˆ»æ³¨æ„â€œè§„åˆ™5â€ã€‚</p>
<p>æˆ‘ä»¬è¿˜åº”è¯¥é¿å…åœ¨åŸºç±»çš„æ¯ä¸ªæˆå‘˜å‡½æ•°ä¸­ä½¿ç”¨ <code>static_cast</code>ã€‚è™½ç„¶è¿™æ˜¯æ­£ç¡®çš„ï¼Œä½†ä»»ä½•ç±»å‹è½¬æ¢éƒ½åº”è¯¥è¢«è§†ä¸ºå¯ç–‘è¡Œä¸ºï¼Œåº”å°½é‡å‡å°‘ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸¤ä¸ª <code>derived()</code> æˆå‘˜å‡½æ•°ï¼Œå®ƒä»¬æ‰§è¡Œè½¬æ¢å¹¶åœ¨å…¶ä»–æˆå‘˜å‡½æ•°ä¸­ä½¿ç”¨ã€‚è¿™æ ·ä¸ä»…ä½¿ä»£ç æ›´ç®€æ´ã€éµå¾ª DRY åŸåˆ™ï¼Œè€Œä¸”çœ‹èµ·æ¥ä¹Ÿè¿œä¸é‚£ä¹ˆå¯ç–‘ã€‚</p>
<p>æœ‰äº† <code>derived()</code> å‡½æ•°ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å®šä¹‰ä¸‹æ ‡è¿ç®—ç¬¦å’Œ <code>begin()</code> å’Œ <code>end()</code> å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">Derived</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">DenseVector</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="k">operator</span><span class="p">[](</span> <span class="n">size_t</span> <span class="n">index</span> <span class="p">)</span>       <span class="p">{</span> <span class="k">return</span> <span class="nf">derived</span><span class="p">()[</span><span class="n">index</span><span class="p">];</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="k">operator</span><span class="p">[](</span> <span class="n">size_t</span> <span class="n">index</span> <span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">derived</span><span class="p">()[</span><span class="n">index</span><span class="p">];</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="n">begin</span><span class="p">()</span>       <span class="p">{</span> <span class="k">return</span> <span class="nf">derived</span><span class="p">().</span><span class="n">begin</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="n">begin</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">derived</span><span class="p">().</span><span class="n">begin</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="n">end</span><span class="p">()</span>         <span class="p">{</span> <span class="k">return</span> <span class="nf">derived</span><span class="p">().</span><span class="n">end</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="n">end</span><span class="p">()</span>   <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">derived</span><span class="p">().</span><span class="n">end</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶è€Œï¼Œè¿™äº›å‡½æ•°ä¸åƒ <code>size()</code> æˆå‘˜å‡½æ•°é‚£æ ·ç›´æ¥ã€‚ç‰¹åˆ«æ˜¯è¿”å›ç±»å‹è¯æ˜æœ‰ç‚¹éš¾ä»¥æŒ‡å®šï¼Œå› ä¸ºè¿™äº›ç±»å‹ä¾èµ–äº <code>Derived</code> ç±»çš„å®ç°ã€‚â€œå—¯ï¼Œé‚£ä¸åº”è¯¥å¤ªéš¾å§ï¼Œâ€ä½ è¯´ã€‚â€œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ´¾ç”Ÿç±»å‹æä¾›äº†å‡ ä¸ªåµŒå¥—ç±»å‹ï¼Œå¦‚ <code>value_type</code>ã€<code>iterator</code> å’Œ <code>const_iterator</code>ï¼Œå¯¹å§ï¼Ÿâ€ å®é™…ä¸Šï¼Œç›´æ¥è¯¢é—®ä¼¼ä¹æ˜¯ç›´è§‚çš„åšæ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">Derived</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">DenseVector</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">using</span> <span class="n">value_type</span>     <span class="o">=</span> <span class="k">typename</span> <span class="n">Derived</span><span class="o">::</span><span class="n">value_type</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">   <span class="k">using</span> <span class="n">iterator</span>       <span class="o">=</span> <span class="k">typename</span> <span class="n">Derived</span><span class="o">::</span><span class="n">iterator</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">using</span> <span class="n">const_iterator</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">Derived</span><span class="o">::</span><span class="n">const_iterator</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="n">value_type</span><span class="o">&amp;</span>       <span class="k">operator</span><span class="p">[](</span> <span class="n">size_t</span> <span class="n">index</span> <span class="p">)</span>       <span class="p">{</span> <span class="k">return</span> <span class="nf">derived</span><span class="p">()[</span><span class="n">index</span><span class="p">];</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="n">value_type</span> <span class="k">const</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span> <span class="n">size_t</span> <span class="n">index</span> <span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">derived</span><span class="p">()[</span><span class="n">index</span><span class="p">];</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="n">iterator</span>       <span class="nf">begin</span><span class="p">()</span>       <span class="p">{</span> <span class="k">return</span> <span class="n">derived</span><span class="p">().</span><span class="n">begin</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="n">const_iterator</span> <span class="nf">begin</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">derived</span><span class="p">().</span><span class="n">begin</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="n">iterator</span>       <span class="nf">end</span><span class="p">()</span>         <span class="p">{</span> <span class="k">return</span> <span class="n">derived</span><span class="p">().</span><span class="n">end</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="n">const_iterator</span> <span class="nf">end</span><span class="p">()</span>   <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">derived</span><span class="p">().</span><span class="n">end</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬æŸ¥è¯¢æ´¾ç”Ÿç±»ä¸­çš„ <code>value_type</code>ã€<code>iterator</code> å’Œ <code>const_iterator</code> ç±»å‹ï¼ˆä¸è¦å¿˜è®° <code>typename</code> å…³é”®å­—ï¼‰å¹¶ä½¿ç”¨è¿™äº›ç±»å‹æ¥æŒ‡å®šæˆ‘ä»¬çš„è¿”å›ç±»å‹ã€‚è¿™çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œå¯¹å§ï¼Ÿä½ å‡ ä¹å¯ä»¥è‚¯å®šè¿™å¹¶ä¸é‚£ä¹ˆç®€å•ã€‚å¦‚æœä½ å°è¯•è¿™æ ·åšï¼ŒClang ç¼–è¯‘å™¨ä¼šæŠ¥å‡ºä¸€æ¡éå¸¸å¥‡æ€ªä¸”ä»¤äººå›°æƒ‘çš„é”™è¯¯æ¶ˆæ¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">CRTP</span><span class="p">.</span><span class="nl">cpp</span><span class="p">:</span><span class="mi">29</span><span class="o">:</span><span class="mi">41</span><span class="o">:</span> <span class="nl">error</span><span class="p">:</span> <span class="n">no</span> <span class="n">type</span> <span class="n">named</span> <span class="err">&#39;</span><span class="n">value_type</span><span class="err">&#39;</span> <span class="n">in</span> <span class="err">&#39;</span><span class="n">DynamicVector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="err">&#39;</span> 
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">value_type</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">Derived</span><span class="o">::</span><span class="n">value_type</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">                      <span class="o">~~~~~~~~~~~~~~~~~~^~~~~~~~~~</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>â€œæ²¡æœ‰ <code>DynamicVector&lt;int&gt;</code> ä¸­çš„ <code>value_type</code> â€”â€” å¾ˆå¥‡æ€ªã€‚â€ ä½ çš„ç¬¬ä¸€ä¸ªæƒ³æ³•æ˜¯ä½ æç ¸äº†ã€‚ä¸€å®šæ˜¯æ‹¼å†™é”™è¯¯ã€‚å½“ç„¶ï¼æ‰€ä»¥ä½ å›åˆ°ä»£ç ä¸­æ£€æŸ¥æ‹¼å†™ã€‚ç„¶è€Œï¼Œç»“æœæ˜¯æ‹¼å†™æ²¡æœ‰é—®é¢˜ã€‚ä½ å†æ¬¡æ£€æŸ¥ <code>DynamicVector</code> ç±»ï¼šé‚£é‡Œæœ‰åµŒå¥—çš„ <code>value_type</code> æˆå‘˜ã€‚è€Œä¸”ä¸€åˆ‡éƒ½æ˜¯å…¬å¼€çš„ã€‚é”™è¯¯ä¿¡æ¯æ¯«æ— æ„ä¹‰ã€‚ä½ é‡æ–°æ£€æŸ¥ä¸€åˆ‡ï¼Œå†æ£€æŸ¥ä¸€éï¼ŒåŠå°æ—¶åä½ å¾—å‡ºç»“è®ºï¼šâ€œç¼–è¯‘å™¨æœ‰ä¸€ä¸ª bugï¼â€</p>
<p>ä¸ï¼Œè¿™ä¸æ˜¯ç¼–è¯‘å™¨çš„ bugã€‚æ— è®ºæ˜¯ Clang è¿˜æ˜¯å…¶ä»–ç¼–è¯‘å™¨éƒ½æ²¡æœ‰ bugã€‚GCC æä¾›äº†ä¸€ä¸ªä¸åŒçš„ä½†ç¨å¾®æ›´å…·å¯å‘æ€§çš„é”™è¯¯æ¶ˆæ¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">CRTP</span><span class="p">.</span><span class="nl">cpp</span><span class="p">:</span><span class="mi">29</span><span class="o">:</span><span class="mi">10</span><span class="o">:</span> <span class="nl">error</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">use</span> <span class="n">of</span> <span class="n">incomplete</span> <span class="n">type</span> <span class="err">&#39;</span><span class="k">class</span> <span class="nc">DynamicVector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="err">&#39;</span> 
</span></span><span class="line"><span class="cl"><span class="mi">29</span> <span class="o">|</span>    <span class="k">using</span> <span class="n">value_type</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">Derived</span><span class="o">::</span><span class="n">value_type</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="o">^~~~~~~~~~</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Clang ç¼–è¯‘å™¨æ˜¯å¯¹çš„ï¼šåœ¨ <code>DynamicVector</code> ç±»ä¸­è¿˜æ²¡æœ‰ <code>value_type</code>ã€‚è¿˜æ²¡æœ‰ï¼å½“ä½ æŸ¥è¯¢åµŒå¥—ç±»å‹æ—¶ï¼Œ<code>DynamicVector</code> ç±»çš„å®šä¹‰è¿˜æ²¡æœ‰è¢«çœ‹åˆ°ï¼Œ<code>DynamicVector</code> ä»ç„¶æ˜¯ä¸€ä¸ªä¸å®Œæ•´ç±»å‹ã€‚è¿™æ˜¯å› ä¸ºç¼–è¯‘å™¨ä¼šåœ¨ <code>DynamicVector</code> ç±»å®šä¹‰ä¹‹å‰å®ä¾‹åŒ– <code>DenseVector</code> åŸºç±»ã€‚æ¯•ç«Ÿï¼Œä»è¯­æ³•ä¸Šçœ‹ï¼ŒåŸºç±»æ˜¯åœ¨ç±»ä¸»ä½“ä¹‹å‰æŒ‡å®šçš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DynamicVector</span> <span class="o">:</span> <span class="k">public</span> <span class="n">DenseVector</span><span class="o">&lt;</span><span class="n">DynamicVector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å› æ­¤ï¼Œæ²¡æœ‰åŠæ³•ä½¿ç”¨æ´¾ç”Ÿç±»çš„åµŒå¥—ç±»å‹æ¥æŒ‡å®š CRTP ç±»çš„è¿”å›ç±»å‹ã€‚å®é™…ä¸Šï¼Œåªè¦æ´¾ç”Ÿç±»æ˜¯ä¸å®Œæ•´ç±»å‹ï¼Œä½ å°±ä¸èƒ½ä½¿ç”¨ä»»ä½•ä¸œè¥¿ã€‚â€œä½†æ˜¯ä¸ºä»€ä¹ˆæˆ‘å¯ä»¥è°ƒç”¨æ´¾ç”Ÿç±»çš„æˆå‘˜å‡½æ•°å‘¢ï¼Ÿè¿™éš¾é“ä¸ä¼šå¯¼è‡´åŒæ ·çš„é—®é¢˜å—ï¼Ÿâ€ å¹¸è¿çš„æ˜¯ï¼Œè¿™å¯ä»¥å·¥ä½œï¼ˆå¦åˆ™ CRTP æ¨¡å¼æ ¹æœ¬æ— æ³•å·¥ä½œï¼‰ã€‚ä½†è¿™ä»…åœ¨ç±»æ¨¡æ¿çš„ä¸€ä¸ªç‰¹æ®Šå±æ€§ä¸‹æœ‰æ•ˆï¼šæˆå‘˜å‡½æ•°ä»…åœ¨å®é™…è°ƒç”¨æ—¶æ‰å®ä¾‹åŒ–ã€‚ç”±äºå®é™…è°ƒç”¨é€šå¸¸å‘ç”Ÿåœ¨æ´¾ç”Ÿç±»å®šä¹‰å¯ç”¨ä¹‹åï¼Œå› æ­¤ä¸å­˜åœ¨ç¼ºå°‘å®šä¹‰çš„é—®é¢˜ã€‚æ­¤æ—¶ï¼Œæ´¾ç”Ÿç±»ä¸å†æ˜¯ä¸å®Œæ•´ç±»å‹ã€‚</p>
<p>â€œå¥½çš„ï¼Œæˆ‘æ˜ç™½äº†ã€‚ä½†æˆ‘ä»¬å¦‚ä½•æŒ‡å®šä¸‹æ ‡è¿ç®—ç¬¦å’Œ <code>begin()</code> å’Œ <code>end()</code> å‡½æ•°çš„è¿”å›ç±»å‹å‘¢ï¼Ÿâ€ å¤„ç†è¿™ä¸ªé—®é¢˜æœ€æ–¹ä¾¿çš„æ–¹æ³•æ˜¯ä½¿ç”¨è¿”å›ç±»å‹æ¨å¯¼ã€‚è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>decltype(auto)</code> è¿”å›ç±»å‹çš„ç»ä½³æœºä¼šï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">Derived</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">DenseVector</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="k">operator</span><span class="p">[](</span> <span class="n">size_t</span> <span class="n">index</span> <span class="p">)</span>       <span class="p">{</span> <span class="k">return</span> <span class="nf">derived</span><span class="p">()[</span><span class="n">index</span><span class="p">];</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="k">operator</span><span class="p">[](</span> <span class="n">size_t</span> <span class="n">index</span> <span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">derived</span><span class="p">()[</span><span class="n">index</span><span class="p">];</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="n">begin</span><span class="p">()</span>       <span class="p">{</span> <span class="k">return</span> <span class="nf">derived</span><span class="p">().</span><span class="n">begin</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="n">begin</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">derived</span><span class="p">().</span><span class="n">begin</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="n">end</span><span class="p">()</span>         <span class="p">{</span> <span class="k">return</span> <span class="nf">derived</span><span class="p">().</span><span class="n">end</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="n">end</span><span class="p">()</span>   <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">derived</span><span class="p">().</span><span class="n">end</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>â€œä»…ä»…ä½¿ç”¨ <code>auto</code> ä¸å¤Ÿå—ï¼Ÿä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®šä¹‰è¿”å›ç±»å‹ï¼šâ€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">Derived</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">DenseVector</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... æ³¨æ„ï¼šè¿™ç§æ–¹æ³•åœ¨è¿™ç§æƒ…å†µä¸‹å¯èƒ½ä¸å¤Ÿé€šç”¨ï¼Œè€Œ `decltype(auto)` æ€»æ˜¯æœ‰æ•ˆçš„ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="k">auto</span><span class="o">&amp;</span>       <span class="k">operator</span><span class="p">[](</span> <span class="n">size_t</span> <span class="n">index</span> <span class="p">)</span>       <span class="p">{</span> <span class="k">return</span> <span class="nf">derived</span><span class="p">()[</span><span class="n">index</span><span class="p">];</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="k">auto</span> <span class="k">const</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span> <span class="n">size_t</span> <span class="n">index</span> <span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="nf">derived</span><span class="p">()[</span><span class="n">index</span><span class="p">];</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="k">auto</span> <span class="nf">begin</span><span class="p">()</span>       <span class="p">{</span> <span class="k">return</span> <span class="n">derived</span><span class="p">().</span><span class="n">begin</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="k">auto</span> <span class="nf">begin</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">derived</span><span class="p">().</span><span class="n">begin</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="k">auto</span> <span class="nf">end</span><span class="p">()</span>         <span class="p">{</span> <span class="k">return</span> <span class="n">derived</span><span class="p">().</span><span class="n">end</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">   <span class="k">auto</span> <span class="nf">end</span><span class="p">()</span>   <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">derived</span><span class="p">().</span><span class="n">end</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ç¡®å®æ˜¯è¶³å¤Ÿçš„ã€‚ç„¶è€Œï¼Œæ­£å¦‚æˆ‘ä¸€ç›´å¼ºè°ƒçš„ï¼Œä»£ç ä¼šå‘ç”Ÿå˜åŒ–ã€‚æœ€ç»ˆï¼Œå¯èƒ½ä¼šå‡ºç°å¦ä¸€ä¸ªè¡ç”Ÿå‘é‡ç±»ï¼Œå®ƒä¸å­˜å‚¨å€¼è€Œæ˜¯æŒ‰å€¼è¿”å›ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ª <code>ZeroVector</code> ç±»ï¼Œå®ƒä»£è¡¨å‘é‡çš„é›¶å…ƒç´ ã€‚è¿™æ ·çš„å‘é‡ä¸ä¼šå­˜å‚¨æ‰€æœ‰å…ƒç´ ï¼Œå› ä¸ºè¿™æ ·åšä¼šæµªè´¹èµ„æºï¼Œè€Œæ˜¯å¯èƒ½å®ç°ä¸ºç©ºç±»ï¼Œæ¯æ¬¡è®¿é—®å…ƒç´ æ—¶è¿”å›é›¶å€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>auto&amp;</code> è¿”å›ç±»å‹å°†æ˜¯ä¸æ­£ç¡®çš„ã€‚æ˜¯çš„ï¼Œç¼–è¯‘å™¨ï¼ˆå¸Œæœ›ï¼‰ä¼šè­¦å‘Šä½ è¿™ä¸€ç‚¹ã€‚ä½†ä½ å¯ä»¥é€šè¿‡è¿”å›ä¸æ´¾ç”Ÿç±»ç›¸åŒçš„ç±»å‹æ¥é¿å…æ•´ä¸ªé—®é¢˜ã€‚è¿™ç§è¿”å›ç±»å‹ç”± <code>decltype(auto)</code> è¡¨ç¤ºã€‚</p>
<p><strong>åˆ†æ CRTP è®¾è®¡æ¨¡å¼çš„ä¸è¶³</strong></p>
<p>â€œå“‡ï¼Œè¿™ä¸ª CRTP è®¾è®¡æ¨¡å¼å¬èµ·æ¥å¤ªæ£’äº†ã€‚æ‰€ä»¥ï¼Œé™¤äº†è¿™äº›æ¯”å¹³å¸¸ç¨å¾®å¤æ‚ä¸€ç‚¹çš„å®ç°ç»†èŠ‚ä¹‹å¤–ï¼Œè¿™ä¸æ˜¯è§£å†³æ‰€æœ‰è™šå‡½æ•°æ€§èƒ½é—®é¢˜çš„åŠæ³•å—ï¼Ÿè¿™éš¾é“ä¸æ˜¯æ‰€æœ‰ä¸ç»§æ‰¿ç›¸å…³é—®é¢˜çš„å…³é”®ã€åœ£æ¯å—ï¼Ÿâ€ æˆ‘èƒ½ç†è§£ä½ çš„çƒ­æƒ…ï¼ä¹ä¸€çœ‹ï¼ŒCRTP ç¡®å®åƒæ˜¯è§£å†³å„ç§ç»§æ‰¿å±‚æ¬¡ç»“æ„çš„ç»ˆææ–¹æ¡ˆã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™æ˜¯ä¸€ç§é”™è§‰ã€‚è®°ä½ï¼šæ¯ç§è®¾è®¡æ¨¡å¼éƒ½æœ‰å…¶ä¼˜ç‚¹ï¼Œä½†ä¹Ÿæœ‰ç¼ºç‚¹ã€‚CRTP è®¾è®¡æ¨¡å¼æœ‰å‡ ä¸ªç›¸å½“é™åˆ¶æ€§çš„ç¼ºç‚¹ã€‚</p>
<p>ç¬¬ä¸€ä¸ªï¼Œä¹Ÿæ˜¯æœ€é™åˆ¶æ€§çš„ç¼ºç‚¹ä¹‹ä¸€æ˜¯ç¼ºä¹ä¸€ä¸ªé€šç”¨åŸºç±»ã€‚ä¸ºäº†å¼ºè°ƒå…¶ä¸¥é‡æ€§ï¼Œæˆ‘å†é‡å¤ä¸€éï¼šæ²¡æœ‰é€šç”¨åŸºç±»ï¼å®é™…ä¸Šï¼Œæ¯ä¸ªæ´¾ç”Ÿç±»éƒ½æœ‰ä¸åŒçš„åŸºç±»ã€‚ä¾‹å¦‚ï¼Œ<code>DynamicVector&lt;T&gt;</code> ç±»æœ‰ <code>DenseVector&lt;DynamicVector&lt;T&gt;&gt;</code> åŸºç±»ã€‚<code>StaticVector&lt;T, Size&gt;</code> ç±»æœ‰ <code>DenseVector&lt;StaticVector&lt;T, Size&gt;&gt;</code> åŸºç±»ï¼ˆè§å›¾ 6-4ï¼‰ã€‚å› æ­¤ï¼Œæ¯å½“éœ€è¦ä¸€ä¸ªé€šç”¨åŸºç±»æ—¶ï¼Œæ¯”å¦‚ç”¨äºåœ¨é›†åˆä¸­å­˜å‚¨ä¸åŒç±»å‹ï¼ŒCRTP è®¾è®¡æ¨¡å¼å°±ä¸æ˜¯ä¸€ä¸ªåˆé€‚çš„é€‰æ‹©ã€‚</p>
<p>â€œå“¦ï¼Œå“‡ï¼Œæˆ‘çœ‹åˆ°è¿™ç¡®å®æ˜¯ä¸€ä¸ªçœŸæ­£çš„é™åˆ¶ã€‚ä½†æˆ‘ä»¬ä¸èƒ½è®© CRTP åŸºç±»ä»ä¸€ä¸ªé€šç”¨åŸºç±»æ´¾ç”Ÿå—ï¼Ÿâ€ ä½ å¯èƒ½ä¼šäº‰è¾©ã€‚ä¸ï¼Œå®é™…ä¸Šä¸è¡Œï¼Œå› ä¸ºè¿™æ ·åšä¼šè¦æ±‚æˆ‘ä»¬å†æ¬¡å¼•å…¥è™šå‡½æ•°ã€‚â€œå¥½å§ï¼Œæˆ‘æ˜ç™½äº†ã€‚é‚£ä¹ˆä½¿ç”¨ <code>std::variant</code> æ¨¡æ‹Ÿä¸€ä¸ªé€šç”¨åŸºç±»å‘¢ï¼Ÿâ€ æ˜¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªé€‰é¡¹ã€‚ç„¶è€Œï¼Œè¯·è®°ä½ <code>std::variant</code> å®é™…ä¸Šæ˜¯è®¿é—®è€…è®¾è®¡æ¨¡å¼çš„ä¸€ç§è¡¨ç°å½¢å¼ï¼ˆè§â€œæŒ‡å— 16ï¼šä½¿ç”¨è®¿é—®è€…æ‰©å±•æ“ä½œâ€ï¼‰ã€‚ç”±äº <code>std::variant</code> éœ€è¦çŸ¥é“å…¶æ‰€æœ‰æ½œåœ¨æ›¿ä»£é¡¹ï¼Œè¿™å°†é™åˆ¶ä½ æ·»åŠ æ–°ç±»å‹çš„è‡ªç”±åº¦ã€‚æ‰€ä»¥ä½ çœ‹ï¼Œå³ä½¿ä½ å¯èƒ½ä¸å–œæ¬¢å®ƒï¼ŒCRTP å¹¶ä¸èƒ½æ›¿ä»£æ‰€æœ‰çš„ç»§æ‰¿å±‚æ¬¡ç»“æ„ã€‚</p>
<p>ç¬¬äºŒä¸ªï¼ŒåŒæ ·å¯èƒ½éå¸¸é™åˆ¶æ€§çš„ç¼ºç‚¹æ˜¯ï¼Œæ‰€æœ‰ä¸ CRTP åŸºç±»æ¥è§¦çš„ä¸œè¥¿æœ¬èº«éƒ½å˜æˆäº†æ¨¡æ¿ã€‚è¿™å¯¹äºæ‰€æœ‰ä¸è¯¥åŸºç±»ä¸€èµ·å·¥ä½œçš„å‡½æ•°æ¥è¯´å°¤å…¶å¦‚æ­¤ã€‚ä¾‹å¦‚ï¼Œå‡çº§åçš„è¾“å‡ºè¿ç®—ç¬¦å’Œ <code>l2norm()</code> å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">Derived</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">DenseVector</span><span class="o">&lt;</span><span class="n">Derived</span><span class="o">&gt;</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">vector</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">Derived</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">l2norm</span><span class="p">(</span> <span class="n">DenseVector</span><span class="o">&lt;</span><span class="n">Derived</span><span class="o">&gt;</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">vector</span> <span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸¤ä¸ªå‡½æ•°åº”è¯¥é€‚ç”¨äºæ‰€æœ‰ä» <code>DenseVector</code> CRTP ç±»æ´¾ç”Ÿçš„ç±»ã€‚å½“ç„¶ï¼Œå®ƒä»¬ä¸åº”è¯¥ä¾èµ–äºæ´¾ç”Ÿç±»çš„å…·ä½“ç±»å‹ã€‚å› æ­¤ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°å¿…é¡»æ˜¯å‡½æ•°æ¨¡æ¿ï¼š<code>Derived</code> ç±»å‹å¿…é¡»è¢«æ¨å¯¼å‡ºæ¥ã€‚è™½ç„¶åœ¨ä¸€ä¸ªçº¿æ€§ä»£æ•°åº“çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™é€šå¸¸ä¸æ˜¯é—®é¢˜ï¼Œå› ä¸ºå‡ ä¹æ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯ç”¨æ¨¡æ¿å®ç°çš„ï¼Œä½†åœ¨å…¶ä»–ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹ã€‚å°†å¤§é‡ä»£ç è½¬æ¢ä¸ºæ¨¡æ¿å¹¶å°†å®šä¹‰ç§»åˆ°å¤´æ–‡ä»¶ä¸­ï¼Œå®é™…ä¸Šç‰ºç‰²äº†æºæ–‡ä»¶çš„å°è£…æ€§ã€‚æ˜¯çš„ï¼Œè¿™å¯èƒ½ç¡®å®æ˜¯ä¸€ä¸ªä¸¥é‡çš„ç¼ºç‚¹ï¼</p>
<p>ç¬¬ä¸‰ï¼ŒCRTP æ˜¯ä¸€ç§ä¾µå…¥å¼è®¾è®¡æ¨¡å¼ã€‚æ´¾ç”Ÿç±»å¿…é¡»é€šè¿‡ç»§æ‰¿è‡ª CRTP åŸºç±»æ¥æ˜ç¡®é€‰æ‹©åŠ å…¥ã€‚è™½ç„¶åœ¨æˆ‘ä»¬è‡ªå·±çš„ä»£ç ä¸­è¿™å¯èƒ½ä¸æ˜¯é—®é¢˜ï¼Œä½†ä½ æ— æ³•è½»æ˜“åœ°ä¸ºå¤–éƒ¨ä»£ç æ·»åŠ åŸºç±»ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¿…é¡»æ±‚åŠ©äºé€‚é…å™¨è®¾è®¡æ¨¡å¼ï¼ˆè§â€œæŒ‡å— 24ï¼šä½¿ç”¨é€‚é…å™¨æ ‡å‡†åŒ–æ¥å£â€ï¼‰ã€‚å› æ­¤ï¼ŒCRTP ä¸æä¾›éä¾µå…¥å¼è®¾è®¡æ¨¡å¼çš„çµæ´»æ€§ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ <code>std::variant</code> å®ç°çš„è®¿é—®è€…è®¾è®¡æ¨¡å¼ã€é€‚é…å™¨è®¾è®¡æ¨¡å¼ç­‰ï¼‰ã€‚</p>
<p>æœ€åä½†å¹¶éæœ€ä¸é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼ŒCRTP ä¸æä¾›è¿è¡Œæ—¶å¤šæ€æ€§ï¼Œåªæä¾›ç¼–è¯‘æ—¶å¤šæ€æ€§ã€‚å› æ­¤ï¼Œåªæœ‰åœ¨éœ€è¦æŸç§é™æ€ç±»å‹æŠ½è±¡çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ¨¡å¼æ‰æœ‰æ„ä¹‰ã€‚å¦‚æœä¸æ˜¯è¿™æ ·ï¼Œå®ƒä¹Ÿä¸æ˜¯æ‰€æœ‰ç»§æ‰¿å±‚æ¬¡ç»“æ„çš„æ›¿ä»£å“ã€‚</p>
<p><strong>CRTP çš„æœªæ¥ï¼šCRTP ä¸ C++20 æ¦‚å¿µçš„æ¯”è¾ƒ</strong></p>
<p>â€œæˆ‘æ˜ç™½äº†ï¼Œä½ æ˜¯å¯¹çš„ã€‚CRTP æ˜¯çº¯ç²¹çš„ç¼–è¯‘æ—¶å¤šæ€æ€§ã€‚ç„¶è€Œï¼Œè¿™è®©æˆ‘æ€è€ƒï¼šæˆ‘ä»¬èƒ½å¦åŸºäº C++20 æ¦‚å¿µè€Œä¸æ˜¯ CRTP æ¥æ„å»ºï¼Ÿè€ƒè™‘ä»¥ä¸‹ä»£ç ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¦‚å¿µæ¥å®šä¹‰ä¸€ç»„ç±»å‹çš„æ¥å£è¦æ±‚ï¼Œå¹¶å°†å‡½æ•°å’Œè¿ç®—ç¬¦é™åˆ¶ä¸ºä»…é‚£äº›æä¾›é¢„æœŸæ¥å£çš„ç±»å‹ï¼šâ€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">concept</span> <span class="n">DenseVector</span> <span class="o">=</span> 
</span></span><span class="line"><span class="cl">   <span class="k">requires</span> <span class="p">(</span> <span class="n">T</span> <span class="n">t</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">index</span> <span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="n">t</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">      <span class="n">t</span><span class="p">[</span><span class="n">index</span><span class="p">];</span> 
</span></span><span class="line"><span class="cl">      <span class="p">{</span> <span class="n">t</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">same_as</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">::</span><span class="n">iterator</span><span class="o">&gt;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">      <span class="p">{</span> <span class="n">t</span><span class="p">.</span><span class="n">end</span><span class="p">()</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">same_as</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">::</span><span class="n">iterator</span><span class="o">&gt;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="p">}</span> <span class="o">&amp;&amp;</span> 
</span></span><span class="line"><span class="cl">   <span class="k">requires</span> <span class="p">(</span> <span class="n">T</span> <span class="k">const</span> <span class="n">t</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">index</span> <span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="n">t</span><span class="p">[</span><span class="n">index</span><span class="p">];</span> 
</span></span><span class="line"><span class="cl">      <span class="p">{</span> <span class="n">t</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">same_as</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">::</span><span class="n">const_iterator</span><span class="o">&gt;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">      <span class="p">{</span> <span class="n">t</span><span class="p">.</span><span class="n">end</span><span class="p">()</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">same_as</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">::</span><span class="n">const_iterator</span><span class="o">&gt;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">   <span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="n">DenseVector</span> <span class="n">VectorT</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="n">VectorT</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">vector</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">   <span class="c1">// ... å¦‚ä¹‹å‰ä¸€æ · 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½ å®Œå…¨æ­£ç¡®ã€‚æˆ‘åŒæ„ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸åˆç†çš„æ›¿ä»£æ–¹æ¡ˆã€‚å®é™…ä¸Šï¼ŒC++20 æ¦‚å¿µä¸ CRTP éå¸¸ç›¸ä¼¼ï¼Œä½†æä¾›äº†æ›´ç®€å•ã€éä¾µå…¥å¼çš„æ›¿ä»£æ–¹æ³•ã€‚ç‰¹åˆ«æ˜¯ç”±äºå…¶éä¾µå…¥æ€§ï¼Œå¦‚æœä½ å¯ä»¥ä½¿ç”¨ C++20 æ¦‚å¿µå¹¶å¯ä»¥é€šè¿‡æ¦‚å¿µå®šä¹‰é™æ€ç±»å‹é›†ï¼Œä½ åº”è¯¥ä¼˜å…ˆé€‰æ‹©æ¦‚å¿µè€Œä¸æ˜¯ CRTPã€‚</p>
<p>å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘å¯¹è¿™ä¸ªè§£å†³æ–¹æ¡ˆå¹¶ä¸å®Œå…¨æ»¡æ„ã€‚è™½ç„¶è¿™ç§å½¢å¼çš„è¾“å‡ºè¿ç®—ç¬¦æœ‰æ•ˆåœ°å°†å‡½æ•°æ¨¡æ¿é™åˆ¶ä¸ºä»…é‚£äº›æä¾›é¢„æœŸæ¥å£çš„ç±»å‹ï¼Œä½†å®ƒå¹¶æ²¡æœ‰å®Œå…¨é™åˆ¶å‡½æ•°æ¨¡æ¿åˆ°æˆ‘ä»¬çš„å¯†é›†å‘é‡ç±»å‹é›†ã€‚ä»ç„¶æœ‰å¯èƒ½ä¼ é€’ <code>std::vector</code> å’Œ <code>std::string</code>ï¼ˆ<code>std::string</code> åœ¨ <code>std</code> å‘½åç©ºé—´ä¸­å·²ç»æœ‰ä¸€ä¸ªè¾“å‡ºè¿ç®—ç¬¦ï¼‰ã€‚å› æ­¤ï¼Œè¿™ä¸ªæ¦‚å¿µè¿˜ä¸å¤Ÿå…·ä½“ã€‚ä½†æ˜¯å¦‚æœä½ é‡åˆ°è¿™ç§æƒ…å†µï¼Œä¸ç”¨æ‹…å¿ƒï¼šæœ‰ä¸€ç§ä½¿ç”¨æ ‡ç­¾ç±»çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">DenseVectorTag</span> <span class="p">{};</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">concept</span> <span class="n">DenseVector</span> <span class="o">=</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// ... å¯†é›†å‘é‡çš„æ‰€æœ‰è¦æ±‚å®šä¹‰ï¼ˆå¦‚å‰ï¼‰ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">&amp;&amp;</span> <span class="n">std</span><span class="o">::</span><span class="n">is_base_of_v</span><span class="o">&lt;</span><span class="n">DenseVectorTag</span><span class="p">,</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DynamicVector</span> <span class="o">:</span> <span class="k">private</span> <span class="n">DenseVectorTag</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡ä» <code>DenseVectorTag</code> ç±»ï¼ˆæœ€å¥½æ˜¯ç§æœ‰ç»§æ‰¿ï¼‰æ´¾ç”Ÿï¼Œåƒ <code>DynamicVector</code> è¿™æ ·çš„ç±»å¯ä»¥æ ‡è¯†ä¸ºå±äºæŸä¸ªç‰¹å®šç±»å‹çš„é›†åˆã€‚å› æ­¤ï¼Œå‡½æ•°å’Œè¿ç®—ç¬¦æ¨¡æ¿å¯ä»¥æœ‰æ•ˆåœ°é™åˆ¶ä¸ºä»…æ¥å—é‚£äº›æ˜ç¡®é€‰æ‹©åŠ å…¥ç±»å‹é›†åˆçš„ç±»å‹ã€‚</p>
<p>ä¸å¹¸çš„æ˜¯ï¼Œè¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼šè¿™ç§æ–¹æ³•ä¸å†æ˜¯éä¾µå…¥å¼çš„ã€‚ä¸ºäº†å…‹æœè¿™ä¸€é™åˆ¶ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªå¯å®šåˆ¶çš„ç±»å‹ç‰¹å¾ç±»æ¥è¿›è¡Œç¼–è¯‘æ—¶é—´æ¥è°ƒç”¨ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬åº”ç”¨å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰å¹¶å°†å…³æ³¨ç‚¹åˆ†ç¦»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">DenseVectorTag</span> <span class="p">{};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">IsDenseVector</span>  
</span></span><span class="line"><span class="cl"><span class="o">:</span> <span class="k">public</span> <span class="n">std</span><span class="o">::</span><span class="n">is_base_of</span><span class="o">&lt;</span><span class="n">DenseVectorTag</span><span class="p">,</span><span class="n">T</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="p">{};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">constexpr</span> <span class="kt">bool</span> <span class="n">IsDenseVector_v</span> <span class="o">=</span> <span class="n">IsDenseVector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">concept</span> <span class="n">DenseVector</span> <span class="o">=</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// ... å¯†é›†å‘é‡çš„æ‰€æœ‰è¦æ±‚å®šä¹‰ï¼ˆå¦‚å‰ï¼‰ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">&amp;&amp;</span> <span class="n">IsDenseVector_v</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DynamicVector</span> <span class="o">:</span> <span class="k">private</span> <span class="n">DenseVectorTag</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">Size</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">StaticVector</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">Size</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">IsDenseVector</span><span class="o">&lt;</span> <span class="n">StaticVector</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">Size</span><span class="o">&gt;</span> <span class="o">&gt;</span>   
</span></span><span class="line"><span class="cl"><span class="o">:</span> <span class="k">public</span> <span class="n">std</span><span class="o">::</span><span class="n">true_type</span> 
</span></span><span class="line"><span class="cl"><span class="p">{};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>IsDenseVector</code> ç±»æ¨¡æ¿åŠå…¶å¯¹åº”çš„å˜é‡æ¨¡æ¿æŒ‡ç¤ºç»™å®šç±»å‹æ˜¯å¦å±äºå¯†é›†å‘é‡ç±»å‹é›†ã€‚DenseVector æ¦‚å¿µä¸ä¼šç›´æ¥æŸ¥è¯¢ç»™å®šç±»å‹ï¼Œè€Œæ˜¯é€šè¿‡ <code>IsDenseVector</code> ç±»å‹ç‰¹å¾é—´æ¥è¯¢é—®ã€‚è¿™æ ·ï¼Œç±»å¯ä»¥é€‰æ‹©é€šè¿‡ç»§æ‰¿ <code>DenseVectorTag</code> æˆ–é€šè¿‡éä¾µå…¥å¼åœ°ç‰¹åŒ– <code>IsDenseVector</code> ç±»å‹ç‰¹å¾æ¥æ˜ç¡®é€‰æ‹©åŠ å…¥ç±»å‹é›†åˆã€‚åœ¨è¿™ç§å½¢å¼ä¸‹ï¼Œæ¦‚å¿µæ–¹æ³•çœŸæ­£å–ä»£äº†ç»å…¸çš„ CRTP æ–¹æ³•ã€‚</p>
<p>æ€»ç»“æ¥è¯´ï¼ŒCRTP æ˜¯ä¸€ç§ç”¨äºå®šä¹‰ç›¸å…³ç±»å‹å®¶æ—ä¹‹é—´ç¼–è¯‘æ—¶å…³ç³»çš„å‡ºè‰²è®¾è®¡æ¨¡å¼ã€‚æœ€æœ‰è¶£çš„æ˜¯ï¼Œå®ƒè§£å†³äº†ç»§æ‰¿å±‚æ¬¡ç»“æ„ä¸­å¯èƒ½é‡åˆ°çš„æ‰€æœ‰æ€§èƒ½é—®é¢˜ã€‚ç„¶è€Œï¼ŒCRTP æœ‰ä¸€äº›æ½œåœ¨çš„é™åˆ¶æ€§ç¼ºç‚¹ï¼Œä¾‹å¦‚ç¼ºä¹é€šç”¨åŸºç±»ã€æ¨¡æ¿ä»£ç çš„å¿«é€Ÿä¼ æ’­ä»¥åŠä»…é™äºç¼–è¯‘æ—¶å¤šæ€æ€§ã€‚åœ¨ C++20 ä¸­ï¼Œè€ƒè™‘ç”¨æ¦‚å¿µæ›¿æ¢ CRTPï¼Œå› ä¸ºæ¦‚å¿µæä¾›äº†æ›´ç®€å•ä¸”éä¾µå…¥å¼çš„æ›¿ä»£æ–¹æ¡ˆã€‚ç„¶è€Œï¼Œå¦‚æœä½ æ— æ³•ä½¿ç”¨ C++20 æ¦‚å¿µå¹¶ä¸” CRTP é€‚ç”¨ï¼Œå®ƒå°†å¯¹ä½ éå¸¸æœ‰ä»·å€¼ã€‚</p>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>åº”ç”¨ CRTP è®¾è®¡æ¨¡å¼ä¸ºç›¸å…³ç±»å‹å®¶æ—å®šä¹‰ç¼–è¯‘æ—¶æŠ½è±¡ã€‚</li>
<li>æ³¨æ„ä» CRTP åŸºç±»åˆ°æ´¾ç”Ÿç±»çš„æœ‰é™è®¿é—®ã€‚</li>
<li>è®°ä½ CRTP è®¾è®¡æ¨¡å¼çš„é™åˆ¶ï¼Œç‰¹åˆ«æ˜¯ç¼ºä¹é€šç”¨åŸºç±»ã€‚</li>
<li>å°½å¯èƒ½ä¼˜å…ˆé€‰æ‹© C++20 æ¦‚å¿µè€Œé CRTP è®¾è®¡æ¨¡å¼ã€‚</li>
</ul>
<h3 id="å‡†åˆ™27ä½¿ç”¨-crtp-å®ç°é™æ€æ··å…¥ç±»">å‡†åˆ™27ï¼šä½¿ç”¨ CRTP å®ç°é™æ€æ··å…¥ç±»
</h3><p>åœ¨â€œå‡†åˆ™ 26ï¼šä½¿ç”¨ CRTP å¼•å…¥é™æ€ç±»å‹ç±»åˆ«â€ä¸­ï¼Œæˆ‘å‘ä½ ä»‹ç»äº† CRTP è®¾è®¡æ¨¡å¼ã€‚æˆ‘ä¹Ÿå¯èƒ½ç»™ä½ ç•™ä¸‹äº† CRTP å·²ç»è¿‡æ—¶çš„å°è±¡ï¼Œè¢« C++20 æ¦‚å¿µçš„å‡ºç°æ‰€å–ä»£ã€‚ç„¶è€Œï¼Œæœ‰è¶£çš„æ˜¯ï¼Œäº‹å®å¹¶éå¦‚æ­¤ã€‚è‡³å°‘ä¸å®Œå…¨æ˜¯ã€‚é‚£æ˜¯å› ä¸ºæˆ‘è¿˜æ²¡æœ‰å‘Šè¯‰ä½ å®Œæ•´çš„æ•…äº‹ã€‚CRTP ä»ç„¶å¯èƒ½æœ‰ä»·å€¼ï¼šä¸æ˜¯ä½œä¸ºè®¾è®¡æ¨¡å¼ï¼Œè€Œæ˜¯ä½œä¸ºå®ç°æ¨¡å¼ã€‚è®©æˆ‘ä»¬ç¨å¾®åç¦»ä¸€ä¸‹ï¼Œè¿›å…¥å®ç°æ¨¡å¼çš„é¢†åŸŸï¼Œè®©æˆ‘æ¥è§£é‡Šã€‚</p>
<p><strong>å¼ºç±»å‹åŠ¨æœº</strong></p>
<p>è€ƒè™‘ä»¥ä¸‹ <code>StrongType</code> ç±»æ¨¡æ¿ï¼Œå®ƒè¡¨ç¤ºä»»ä½•å…¶ä»–ç±»å‹çš„åŒ…è£…å™¨ï¼Œç›®çš„æ˜¯åˆ›å»ºå”¯ä¸€ä¸”å‘½åçš„ç±»å‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;StrongType.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Tag</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">StrongType</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">using</span> <span class="n">value_type</span> <span class="o">=</span> <span class="n">T</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="nf">StrongType</span><span class="p">(</span> <span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">value</span> <span class="p">)</span> <span class="o">:</span> <span class="n">value_</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span> <span class="p">{}</span> 
</span></span><span class="line"><span class="cl">    <span class="n">T</span><span class="o">&amp;</span> <span class="n">get</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">value_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">get</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">value_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">T</span> <span class="n">value_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªç±»å¯ä»¥ç”¨äºå®šä¹‰ç±»å‹å¦‚ <code>Meter</code>ã€<code>Kilometer</code> å’Œ <code>Surname</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Distances.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;StrongType.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">Meter</span> <span class="o">=</span> <span class="n">StrongType</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="k">struct</span> <span class="nc">MeterTag</span><span class="o">&gt;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">Kilometer</span> <span class="o">=</span> <span class="n">StrongType</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="k">struct</span> <span class="nc">KilometerTag</span><span class="o">&gt;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Person.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;StrongType.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">Surname</span> <span class="o">=</span> <span class="n">StrongType</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="k">struct</span> <span class="nc">SurnameTag</span><span class="o">&gt;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨åˆ«åæ¨¡æ¿ï¼ˆalias templatesï¼‰ä¸º <code>Meter</code> å’Œ <code>Kilometer</code> å…è®¸ä½ é€‰æ‹©ä¸åŒçš„ç±»å‹ï¼ˆä¾‹å¦‚ <code>long</code> æˆ– <code>double</code>ï¼‰æ¥è¡¨ç¤ºè·ç¦»ã€‚å°½ç®¡è¿™äº›ç±»å‹åŸºäºåŸºç¡€ç±»å‹æˆ–æ ‡å‡†åº“ç±»å‹ï¼ˆå¦‚ <code>std::string</code>ï¼‰ï¼Œå®ƒä»¬ä»£è¡¨å…·æœ‰è¯­ä¹‰æ„ä¹‰çš„ç‹¬ç‰¹ç±»å‹ï¼ˆå¼ºç±»å‹ï¼‰ï¼Œä¸èƒ½åœ¨ç®—æœ¯æ“ä½œä¸­æ„å¤–åœ°ç»„åˆåœ¨ä¸€èµ·ï¼Œä¾‹å¦‚åŠ æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Main.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Distances.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="k">const</span> <span class="n">m1</span> <span class="o">=</span> <span class="n">Meter</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">{</span> <span class="mi">120L</span> <span class="p">};</span> 
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="k">const</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">Meter</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">{</span> <span class="mi">50L</span> <span class="p">};</span> 
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="k">const</span> <span class="n">km</span> <span class="o">=</span> <span class="n">Kilometer</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">{</span> <span class="mi">30L</span> <span class="p">};</span> 
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="k">const</span> <span class="n">surname1</span> <span class="o">=</span> <span class="n">Surname</span><span class="p">{</span> <span class="s">&#34;Stroustrup&#34;</span> <span class="p">};</span> 
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="k">const</span> <span class="n">surname2</span> <span class="o">=</span> <span class="n">Surname</span><span class="p">{</span> <span class="s">&#34;Iglberger&#34;</span> <span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ­£ç¡®åœ°ä¸ä¼šç¼–è¯‘ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">m1</span> <span class="o">+</span> <span class="n">km</span><span class="p">;</span>              
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// åŒæ ·æ­£ç¡®åœ°ä¸ä¼šç¼–è¯‘ï¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">surname1</span> <span class="o">+</span> <span class="n">surname2</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ä¸å¹¸çš„æ˜¯è¿™ä¹Ÿæ— æ³•ç¼–è¯‘ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">m1</span> <span class="o">+</span> <span class="n">m2</span><span class="p">;</span>              
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>è™½ç„¶ <code>Meter</code> å’Œ <code>Kilometer</code> éƒ½é€šè¿‡ <code>long</code> è¡¨ç¤ºï¼Œä½†ä¸èƒ½ç›´æ¥å°† <code>Meter</code> å’Œ <code>Kilometer</code> ç›¸åŠ ã€‚è¿™æ˜¯å¾ˆå¥½çš„ï¼šå®ƒä¸ä¼šç•™ä¸‹ä»»ä½•æ„å¤–å¼•å…¥é”™è¯¯çš„æ¼æ´ã€‚åŒæ ·ä¹Ÿä¸èƒ½å°†ä¸¤ä¸ª <code>Surname</code> ç›¸åŠ ï¼Œå°½ç®¡ <code>std::string</code> æä¾›äº†å­—ç¬¦ä¸²æ‹¼æ¥çš„åŠ æ³•è¿ç®—ç¬¦ã€‚è¿™ä¹Ÿæ˜¯å¾ˆå¥½çš„ï¼šå¼ºç±»å‹æœ‰æ•ˆåœ°é™åˆ¶äº†åº•å±‚ç±»å‹çš„ä¸æœŸæœ›æ“ä½œã€‚</p>
<p>ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸€â€œç‰¹æ€§â€ä¹Ÿé˜»æ­¢äº†ä¸¤ä¸ª <code>Meter</code> å®ä¾‹çš„ç›¸åŠ ã€‚ç„¶è€Œï¼Œè¿™ç§æ“ä½œæ˜¯å¯å–çš„ï¼šç›´è§‚ã€è‡ªç„¶ï¼Œå¹¶ä¸”ç”±äºæ“ä½œçš„ç»“æœä»ç„¶æ˜¯ <code>Meter</code> ç±»å‹ï¼Œå› æ­¤ç‰©ç†ä¸Šä¹Ÿæ˜¯å‡†ç¡®çš„ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º <code>Meter</code> ç±»å‹å®ç°ä¸€ä¸ªåŠ æ³•è¿ç®—ç¬¦ã€‚ç„¶è€Œï¼Œæ˜¾ç„¶è¿™ä¸ä¼šæ˜¯å”¯ä¸€çš„åŠ æ³•è¿ç®—ç¬¦ã€‚æˆ‘ä»¬è¿˜éœ€è¦ä¸ºå…¶ä»–å¼ºç±»å‹ï¼ˆå¦‚ <code>Kilometer</code>ã€<code>Mile</code>ã€<code>Foot</code> ç­‰ï¼‰å®ç°ç±»ä¼¼çš„è¿ç®—ç¬¦ã€‚ç”±äºæ‰€æœ‰è¿™äº›å®ç°çœ‹èµ·æ¥éƒ½ä¸€æ ·ï¼Œè¿™è¿åäº† DRY åŸåˆ™ã€‚å› æ­¤ï¼Œæ‰©å±• <code>StrongType</code> ç±»æ¨¡æ¿ä»¥åŒ…å«åŠ æ³•è¿ç®—ç¬¦ä¼¼ä¹æ˜¯åˆç†çš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Tag</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="n">StrongType</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">Tag</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">operator</span><span class="o">+</span><span class="p">(</span> <span class="n">StrongType</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">Tag</span><span class="o">&gt;</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="n">StrongType</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">Tag</span><span class="o">&gt;</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">b</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">StrongType</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">Tag</span><span class="o">&gt;</span><span class="p">(</span> <span class="n">a</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">+</span> <span class="n">b</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”±äºè¿™ä¸ªåŠ æ³•è¿ç®—ç¬¦çš„è¡¨è¿°æ–¹å¼ï¼Œä¸å¯èƒ½å°†ä¸¤ä¸ªä¸åŒçš„ <code>StrongType</code> å®ä¾‹ï¼ˆä¾‹å¦‚ <code>Meter</code> å’Œ <code>Kilometer</code>ï¼‰ç›¸åŠ ï¼Œä½†å®ƒå…è®¸ç›¸åŒå®ä¾‹åŒ–çš„ä¸¤ä¸ª <code>StrongType</code> å®ä¾‹ç›¸åŠ ã€‚â€œå“¦ï¼Œä½†æˆ‘çœ‹åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼šè™½ç„¶ç°åœ¨å¯ä»¥å°†ä¸¤ä¸ª <code>Meter</code> æˆ–ä¸¤ä¸ª <code>Kilometer</code> ç›¸åŠ ï¼Œä½†ä¹Ÿå¯ä»¥å°†ä¸¤ä¸ª <code>Surname</code> ç›¸åŠ ã€‚æˆ‘ä»¬ä¸å¸Œæœ›é‚£æ ·ï¼â€ ä½ æ˜¯å¯¹çš„ï¼šè¿™æ˜¯ä¸å¸Œæœ›çš„ã€‚æˆ‘ä»¬éœ€è¦çš„æ˜¯ç‰¹å®š <code>StrongType</code> å®ä¾‹åŒ–ä¸­æ“ä½œçš„æœ‰æ„æ·»åŠ ã€‚è¿™å°±æ˜¯ CRTP å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚</p>
<p><strong>ä½¿ç”¨ CRTP ä½œä¸ºå®ç°æ¨¡å¼</strong></p>
<p>ä¸å…¶ç›´æ¥ä¸º <code>StrongType</code> ç±»æ¨¡æ¿é…å¤‡æ“ä½œï¼Œæˆ‘ä»¬é€šè¿‡æ··å…¥ç±»ï¼ˆmixin classesï¼‰æä¾›è¿™äº›æ“ä½œï¼šè¿™äº›åŸºç±»â€œæ³¨å…¥â€æ‰€éœ€çš„æ“ä½œã€‚è¿™äº›æ··å…¥ç±»æ˜¯é€šè¿‡ CRTP å®ç°çš„ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘è¡¨ç¤ºåŠ æ³•æ“ä½œçš„ <code>Addable</code> ç±»æ¨¡æ¿ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Addable.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">Derived</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Addable</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">friend</span> <span class="n">Derived</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">+=</span><span class="p">(</span> <span class="n">Derived</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">Derived</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">rhs</span> <span class="p">)</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">        <span class="n">lhs</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">+=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">get</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">lhs</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">friend</span> <span class="n">Derived</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span> <span class="n">Derived</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">Derived</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">rhs</span> <span class="p">)</span> <span class="p">{</span>   
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Derived</span><span class="p">{</span> <span class="n">lhs</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="o">+</span> <span class="n">rhs</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="p">};</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¨¡æ¿å‚æ•°çš„åå­—æ­ç¤ºäº†å®ƒçš„ç”¨é€”ï¼š<code>Addable</code> æ˜¯ä¸€ä¸ª CRTP åŸºç±»ã€‚<code>Addable</code> åªæä¾›äº†ä¸¤ä¸ªå‡½æ•°ï¼Œä½œä¸ºéšè—å‹å…ƒå®ç°ï¼šèµ‹å€¼åŠ æ³•è¿ç®—ç¬¦å’ŒåŠ æ³•è¿ç®—ç¬¦ã€‚è¿™ä¸¤ä¸ªè¿ç®—ç¬¦éƒ½å®šä¹‰åœ¨æŒ‡å®šçš„ <code>Derived</code> ç±»å‹ä¸Šï¼Œå¹¶è¢«æ³¨å…¥åˆ°å‘¨å›´çš„å‘½åç©ºé—´ä¸­ã€‚å› æ­¤ï¼Œä»»ä½•ä»è¿™ä¸ª CRTP åŸºç±»æ´¾ç”Ÿçš„ç±»éƒ½ä¼šâ€œç»§æ‰¿â€ä¸¤ä¸ªè‡ªç”±åŠ æ³•è¿ç®—ç¬¦ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;StrongType.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;stdlib&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Tag</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">StrongType</span> <span class="o">:</span> <span class="k">private</span> <span class="n">Addable</span><span class="o">&lt;</span> <span class="n">StrongType</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">Tag</span><span class="o">&gt;</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Distances.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;StrongType.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">Meter</span> <span class="o">=</span> <span class="n">StrongType</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="k">struct</span> <span class="nc">MeterTag</span><span class="o">&gt;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Main.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Distances.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="k">const</span> <span class="n">m1</span> <span class="o">=</span> <span class="n">Meter</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">{</span> <span class="mi">100</span> <span class="p">};</span> 
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="k">const</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">Meter</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">{</span> <span class="mi">50</span> <span class="p">};</span> 
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="k">const</span> <span class="n">m3</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">+</span> <span class="n">m2</span><span class="p">;</span>  <span class="c1">// ç¼–è¯‘å¹¶å¾—åˆ° 150 ç±³çš„ç»“æœ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>â€œæˆ‘ç†è§£æ··å…¥ç±»çš„ç›®çš„ï¼Œä½†åœ¨è¿™ä¸ªå½¢å¼ä¸‹ï¼Œæ‰€æœ‰ <code>StrongType</code> çš„å®ä¾‹éƒ½ä¼šç»§æ‰¿ä¸€ä¸ªåŠ æ³•è¿ç®—ç¬¦ï¼Œå³ä½¿æœ‰äº›å®ä¾‹ä¸éœ€è¦åŠ æ³•æ“ä½œï¼Œå¯¹å§ï¼Ÿâ€ æ˜¯çš„ï¼Œç¡®å®å¦‚æ­¤ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰å®Œæˆã€‚æˆ‘ä»¬å¸Œæœ›çš„æ˜¯æœ‰é€‰æ‹©åœ°å°†æ··å…¥ç±»æ·»åŠ åˆ°é‚£äº›éœ€è¦æ“ä½œçš„ <code>StrongType</code> å®ä¾‹ä¸­ã€‚æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆæ˜¯å°†æ··å…¥ç±»ä»¥å¯é€‰æ¨¡æ¿å‚æ•°çš„å½¢å¼æä¾›ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°† <code>StrongType</code> ç±»æ¨¡æ¿æ‰©å±•ä¸ºå¸¦æœ‰å˜é•¿æ¨¡æ¿æ¨¡æ¿å‚æ•°åŒ…çš„å½¢å¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;StrongType.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Tag</span><span class="p">,</span> <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="o">&gt;</span> <span class="k">class</span><span class="err">... </span><span class="nc">Skills</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">StrongType</span> 
</span></span><span class="line"><span class="cl"><span class="o">:</span> <span class="k">private</span> <span class="n">Skills</span><span class="o">&lt;</span> <span class="n">StrongType</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">Tag</span><span class="p">,</span><span class="n">Skills</span><span class="p">...</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">...</span>  
</span></span><span class="line"><span class="cl"><span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ç§æ‰©å±•ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸ºæ¯ä¸ªå•ç‹¬çš„å¼ºç±»å‹æŒ‡å®šæ‰€éœ€çš„æŠ€èƒ½ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘å¦å¤–ä¸¤ä¸ªæŠ€èƒ½ <code>Printable</code> å’Œ <code>Swappable</code>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Printable.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">Derived</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Printable</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">friend</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">&amp;</span> <span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Derived</span><span class="o">&amp;</span> <span class="n">d</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">d</span><span class="p">.</span><span class="n">get</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">os</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Swappable.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">Derived</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Swappable</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">friend</span> <span class="kt">void</span> <span class="nf">swap</span><span class="p">(</span> <span class="n">Derived</span><span class="o">&amp;</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">Derived</span><span class="o">&amp;</span> <span class="n">rhs</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">swap</span><span class="p">;</span>  <span class="c1">// å¯ç”¨ ADL 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">swap</span><span class="p">(</span> <span class="n">lhs</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span> <span class="n">rhs</span><span class="p">.</span><span class="n">get</span><span class="p">()</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç»“åˆ <code>Addable</code> æŠ€èƒ½ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ç»„è£…å…·æœ‰æ‰€éœ€æŠ€èƒ½çš„å¼ºç±»å‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Distances.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;StrongType.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">Meter</span> <span class="o">=</span> <span class="n">StrongType</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="k">struct</span> <span class="nc">MeterTag</span><span class="p">,</span> <span class="n">Addable</span><span class="p">,</span> <span class="n">Printable</span><span class="p">,</span> <span class="n">Swappable</span><span class="o">&gt;</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">Kilometer</span> <span class="o">=</span> <span class="n">StrongType</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="k">struct</span> <span class="nc">KilometerTag</span><span class="p">,</span> <span class="n">Addable</span><span class="p">,</span> <span class="n">Printable</span><span class="p">,</span> <span class="n">Swappable</span><span class="o">&gt;</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Person.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;StrongType.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">Surname</span> <span class="o">=</span> <span class="n">StrongType</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="k">struct</span> <span class="nc">SurnameTag</span><span class="p">,</span> <span class="n">Printable</span><span class="p">,</span> <span class="n">Swappable</span><span class="o">&gt;</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>Meter</code> å’Œ <code>Kilometer</code> éƒ½å¯ä»¥è¿›è¡ŒåŠ æ³•ã€æ‰“å°å’Œäº¤æ¢ï¼Œè€Œ <code>Surname</code> å¯ä»¥æ‰“å°å’Œäº¤æ¢ï¼Œä½†ä¸èƒ½ç›¸åŠ ï¼ˆå³ä¸æ¥æ”¶ <code>Addable</code> æ··å…¥ç±»ï¼Œå› æ­¤ä¸ä»å…¶æ´¾ç”Ÿï¼‰ã€‚</p>
<p>â€œè¿™å¤ªå¥½äº†ã€‚æˆ‘ç†è§£åœ¨è¿™ç§æƒ…å†µä¸‹ CRTP æ··å…¥ç±»çš„ç›®çš„ã€‚ä½†è¿™ä¸ª CRTP ç¤ºä¾‹ä¸ä¹‹å‰çš„ç¤ºä¾‹æœ‰ä»€ä¹ˆä¸åŒï¼Ÿâ€ å¾ˆå¥½çš„é—®é¢˜ã€‚ä½ é—®å¾—å¯¹ï¼Œå®ç°ç»†èŠ‚éå¸¸ç›¸ä¼¼ã€‚ä½†æœ‰å‡ ä¸ªæ˜¾è‘—çš„åŒºåˆ«ã€‚æ³¨æ„ï¼ŒCRTP åŸºç±»æ²¡æœ‰æä¾›è™šæˆ–ä¿æŠ¤ææ„å‡½æ•°ã€‚å› æ­¤ï¼Œä¸ä¹‹å‰çš„ç¤ºä¾‹ç›¸æ¯”ï¼Œå®ƒä¸æ˜¯è®¾è®¡ä¸ºå¤šæ€åŸºç±»ã€‚è¿˜è¦æ³¨æ„ï¼Œåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨ CRTP åŸºç±»ä½œä¸ºç§æœ‰åŸºç±»å°±è¶³å¤Ÿäº†ï¼Œç”šè‡³æ›´å¥½ã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒCRTP åŸºç±»ä¸ä»£è¡¨æŠ½è±¡ï¼Œè€Œæ˜¯ä»…ä½œä¸ºä¸€ä¸ªå®ç°ç»†èŠ‚ã€‚å› æ­¤ï¼ŒCRTP ä¸å…·å¤‡è®¾è®¡æ¨¡å¼çš„ç‰¹æ€§ï¼Œä¹Ÿä¸å……å½“è®¾è®¡æ¨¡å¼ã€‚å®ƒä»ç„¶æ˜¯ä¸€ä¸ªæ¨¡å¼ï¼Œä½†åœ¨è¿™é‡Œåªæ˜¯ä½œä¸ºä¸€ä¸ªå®ç°æ¨¡å¼ã€‚</p>
<p>CRTP ç¤ºä¾‹çš„ä¸»è¦åŒºåˆ«åœ¨äºæˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ç»§æ‰¿ã€‚å¯¹äº CRTP è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬æ ¹æ® LSP ä½¿ç”¨ç»§æ‰¿ä½œä¸ºæŠ½è±¡ï¼šåŸºç±»ä»£è¡¨æ´¾ç”Ÿç±»çš„è¦æ±‚ï¼Œä»¥åŠå¯ç”¨å’Œé¢„æœŸçš„è¡Œä¸ºã€‚ç”¨æˆ·ä»£ç é€šè¿‡æŒ‡å‘åŸºç±»çš„æŒ‡é’ˆæˆ–å¼•ç”¨ç›´æ¥è®¿é—®æ“ä½œï¼Œè¿™åè¿‡æ¥è¦æ±‚æˆ‘ä»¬æä¾›è™šæˆ–ä¿æŠ¤ææ„å‡½æ•°ã€‚å½“è¿™æ ·å®ç°æ—¶ï¼ŒCRTP æˆä¸ºäº†è½¯ä»¶è®¾è®¡çš„ä¸€ä¸ªçœŸæ­£å…ƒç´ â€”â€”ä¸€ä¸ªè®¾è®¡æ¨¡å¼ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œå¯¹äº CRTP å®ç°æ¨¡å¼ï¼Œæˆ‘ä»¬ä½¿ç”¨ç»§æ‰¿æ¥å®ç°æŠ€æœ¯ä¸Šçš„ä¼˜é›…å’Œä¾¿åˆ©ã€‚åŸºç±»æˆä¸ºå®ç°ç»†èŠ‚ï¼Œä¸éœ€è¦è¢«è°ƒç”¨ä»£ç çŸ¥é“æˆ–ä½¿ç”¨ã€‚å› æ­¤ï¼Œå®ƒä¸éœ€è¦è™šæˆ–ä¿æŠ¤ææ„å‡½æ•°ã€‚å½“è¿™æ ·å®ç°æ—¶ï¼ŒCRTP ä¿æŒåœ¨å®ç°ç»†èŠ‚å±‚é¢ï¼Œå› æ­¤æ˜¯ä¸€ä¸ªå®ç°æ¨¡å¼ã€‚ç„¶è€Œï¼Œåœ¨è¿™ç§å½¢å¼ä¸‹ï¼ŒCRTP å¹¶ä¸ä¸ C++20 æ¦‚å¿µç«äº‰ã€‚ç›¸åï¼šåœ¨è¿™ç§å½¢å¼ä¸‹ï¼ŒCRTP æ˜¯æ— å¯æ›¿ä»£çš„ï¼Œå› ä¸ºå®ƒä»£è¡¨äº†ä¸€ç§æä¾›é™æ€æ··å…¥åŠŸèƒ½çš„ç‹¬ç‰¹æŠ€æœ¯ã€‚å› æ­¤ï¼ŒCRTP ä»Šå¤©ä»ç„¶åœ¨ä½¿ç”¨ï¼Œå¹¶ä¸”æ˜¯æ¯ä¸ª C++ å¼€å‘è€…å·¥å…·ç®±ä¸­çš„å®è´µè¡¥å……ã€‚</p>
<p>æ€»ç»“æ¥è¯´ï¼ŒCRTP å¹¶æ²¡æœ‰è¿‡æ—¶ï¼Œä½†å®ƒçš„ä»·å€¼å·²ç»æ”¹å˜ã€‚åœ¨ C++20 ä¸­ï¼ŒCRTP è¢«æ¦‚å¿µæ‰€å–ä»£ï¼Œå› æ­¤ä¸å†ä½œä¸ºè®¾è®¡æ¨¡å¼ã€‚ç„¶è€Œï¼Œå®ƒç»§ç»­ä½œä¸ºæ··å…¥ç±»çš„å®ç°æ¨¡å¼æœ‰ä»·å€¼ã€‚</p>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>è¯·æ³¨æ„å°†CRTPç”¨ä½œè®¾è®¡æ¨¡å¼å’Œå°†å…¶ç”¨ä½œå®ç°æ¨¡å¼ä¹‹é—´çš„åŒºåˆ«ã€‚</li>
<li>è¦ç†è§£è¡¨ç¤ºæŠ½è±¡çš„CRTPåŸºç±»å……å½“è®¾è®¡æ¨¡å¼ã€‚</li>
<li>è¦äº†è§£ï¼Œä¸è¡¨ç¤ºæŠ½è±¡çš„CRTPåŸºç±»å……å½“å®ç°æ¨¡å¼ã€‚</li>
</ul>
<h2 id="ç¬¬ä¸ƒç« æ¡¥æ¥åŸå‹å’Œå¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼">ç¬¬ä¸ƒç« ï¼šæ¡¥æ¥ã€åŸå‹å’Œå¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼
</h2><p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä¸“æ³¨äºä¸¤ä¸ªç»å…¸çš„ GoFï¼ˆGang of Fourï¼‰è®¾è®¡æ¨¡å¼ï¼šæ¡¥æ¥è®¾è®¡æ¨¡å¼å’ŒåŸå‹è®¾è®¡æ¨¡å¼ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å°†ç ”ç©¶å¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼ã€‚ä¹ä¸€çœ‹ï¼Œè¿™ç§é€‰æ‹©å¯èƒ½æ˜¾å¾—åƒæ˜¯ä¸€ä¸ªæ°å‡ºçš„ã€å‡ ä¹éšæœºçš„è®¾è®¡æ¨¡å¼ç»„åˆã€‚ç„¶è€Œï¼Œæˆ‘é€‰æ‹©è¿™äº›æ¨¡å¼æœ‰ä¸¤ä¸ªåŸå› ï¼šé¦–å…ˆï¼Œæ ¹æ®æˆ‘çš„ç»éªŒï¼Œè¿™ä¸‰ä¸ªæ¨¡å¼åœ¨è®¾è®¡æ¨¡å¼ç›®å½•ä¸­æ˜¯æœ€æœ‰ç”¨çš„ã€‚å› æ­¤ï¼Œä½ åº”è¯¥å¯¹å®ƒä»¬çš„æ„å›¾ã€ä¼˜ç‚¹å’Œç¼ºç‚¹æœ‰ç›¸å½“å¥½çš„äº†è§£ã€‚å…¶æ¬¡ä¸”åŒæ ·é‡è¦çš„æ˜¯ï¼šå®ƒä»¬åœ¨ç¬¬å…«ç« ä¸­éƒ½å°†å‘æŒ¥è‡³å…³é‡è¦çš„ä½œç”¨ã€‚</p>
<p><strong>å‡†åˆ™ 28ï¼šæ„å»ºæ¡¥æ¢ä»¥æ¶ˆé™¤ç‰©ç†ä¾èµ–</strong></p>
<p>åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘å°†å‘ä½ ä»‹ç»æ¡¥æ¥è®¾è®¡æ¨¡å¼åŠå…¶æœ€ç®€å•çš„å½¢å¼â€”â€”Pimpl æƒ¯ç”¨æ³•ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œæˆ‘å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨æ¡¥æ¥æ¥é€šè¿‡è§£è€¦æ¥å£ä¸å®ç°ç»†èŠ‚æ¥å‡å°‘ç‰©ç†è€¦åˆã€‚</p>
<p><strong>å‡†åˆ™ 29ï¼šæ³¨æ„æ¡¥æ¥æ€§èƒ½çš„å¢ç›Šä¸æŸå¤±</strong></p>
<p>åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†æ˜ç¡®åœ°æ¢è®¨æ¡¥æ¥å¯¹æ€§èƒ½çš„å½±å“ã€‚æˆ‘ä»¬å°†è¿è¡ŒåŸºå‡†æµ‹è¯•ï¼Œæ¯”è¾ƒæ²¡æœ‰æ¡¥æ¥çš„å®ç°ã€åŸºäºæ¡¥æ¥çš„å®ç°ä»¥åŠâ€œéƒ¨åˆ†â€æ¡¥æ¥çš„å®ç°ã€‚</p>
<p><strong>å‡†åˆ™ 30ï¼šåº”ç”¨åŸå‹è¿›è¡ŒæŠ½è±¡å¤åˆ¶æ“ä½œ</strong></p>
<p>åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘å°†å‘ä½ ä»‹ç»å…‹éš†çš„è‰ºæœ¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¤åˆ¶æ“ä½œï¼Œç‰¹åˆ«æ˜¯æŠ½è±¡å¤åˆ¶æ“ä½œã€‚ä¸ºæ­¤ç›®çš„ï¼Œæˆ‘ä»¬å°†é‡‡ç”¨åŸå‹è®¾è®¡æ¨¡å¼ã€‚</p>
<p><strong>å‡†åˆ™ 31ï¼šä½¿ç”¨å¤–éƒ¨å¤šæ€å®ç°éä¾µå…¥å¼è¿è¡Œæ—¶å¤šæ€</strong></p>
<p>åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ç»§ç»­åˆ†ç¦»å…³æ³¨ç‚¹çš„æ—…ç¨‹ï¼Œé€šè¿‡ä»ç±»ä¸­æå–å‡½æ•°çš„å®ç°ç»†èŠ‚ã€‚ä¸ºäº†è¿›ä¸€æ­¥å‡å°‘ä¾èµ–æ€§ï¼Œæˆ‘ä»¬å°†è¿™ç§åˆ†ç¦»æå‡åˆ°ä¸€ä¸ªæ–°çš„æ°´å¹³ï¼šä¸ä»…æå–è™šæ‹Ÿå‡½æ•°çš„å®ç°ç»†èŠ‚ï¼Œè¿˜æå–æ•´ä¸ªå‡½æ•°æœ¬èº«ï¼Œè¿™å°†é€šè¿‡å¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼æ¥å®ç°ã€‚</p>
<h3 id="å‡†åˆ™-28æ„å»ºæ¡¥æ¢ä»¥æ¶ˆé™¤ç‰©ç†ä¾èµ–">å‡†åˆ™ 28ï¼šæ„å»ºæ¡¥æ¢ä»¥æ¶ˆé™¤ç‰©ç†ä¾èµ–
</h3><p>æ ¹æ®è¯å…¸ï¼Œæœ¯è¯­â€œæ¡¥â€è¡¨ç¤ºæ—¶é—´ã€åœ°ç‚¹æˆ–è¿æ¥æˆ–è¿‡æ¸¡çš„æ–¹å¼ã€‚å¦‚æœæˆ‘é—®ä½ â€œæ¡¥â€è¿™ä¸ªè¯å¯¹ä½ æ„å‘³ç€ä»€ä¹ˆï¼Œæˆ‘ç›¸ä¿¡ä½ ä¼šæœ‰ä¸€ä¸ªç±»ä¼¼çš„å®šä¹‰ã€‚ä½ å¯èƒ½ä¼šéšå¼åœ°æƒ³åˆ°è¿æ¥ä¸¤ä»¶äº‹ç‰©ï¼Œå¹¶å› æ­¤ä½¿å®ƒä»¬æ›´æ¥è¿‘ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½ä¼šæƒ³åˆ°ä¸€ä¸ªè¢«æ²³æµåˆ†éš”çš„åŸå¸‚ã€‚ä¸€åº§æ¡¥ä¼šå°†åŸå¸‚çš„ä¸¤è¾¹è¿æ¥èµ·æ¥ï¼Œä½¿å®ƒä»¬æ›´æ¥è¿‘ï¼Œå¹¶èŠ‚çœäººä»¬å¾ˆå¤šæ—¶é—´ã€‚ä½ ä¹Ÿå¯èƒ½æƒ³åˆ°ç”µå­å­¦ä¸­çš„æ¡¥ï¼Œå®ƒè¿æ¥ç”µè·¯çš„ä¸¤ä¸ªç‹¬ç«‹éƒ¨åˆ†ã€‚éŸ³ä¹ä¸­æœ‰æ¡¥ï¼Œç°å®ä¸–ç•Œä¸­ä¹Ÿæœ‰å¾ˆå¤šä¾‹å­ï¼Œè¿™äº›æ¡¥å¸®åŠ©æˆ‘ä»¬è¿æ¥äº‹ç‰©ã€‚æ˜¯çš„ï¼Œç›´è§‰ä¸Šï¼Œâ€œæ¡¥â€è¿™ä¸ªè¯æš—ç¤ºç€å¢åŠ æ¥è¿‘å’Œé‚»è¿‘æ€§ã€‚å› æ­¤ï¼Œæ¡¥æ¥è®¾è®¡æ¨¡å¼æ°æ°ç›¸åï¼šå®ƒæ”¯æŒä½ å‡å°‘ç‰©ç†ä¾èµ–ï¼Œå¹¶å¸®åŠ©è§£è€¦ï¼Œå³ä¿æŒéœ€è¦ä¸€èµ·å·¥ä½œçš„ä¸¤ä¸ªåŠŸèƒ½æ¨¡å—åœ¨å½¼æ­¤ä¹‹é—´ä¿æŒä¸€å®šè·ç¦»ï¼Œä»è€Œä¸éœ€äº†è§£å¤ªå¤šå¯¹æ–¹çš„ç»†èŠ‚ã€‚</p>
<p><strong>ä¸€ä¸ªæ¿€åŠ±çš„ä¾‹å­</strong></p>
<p>ä¸ºäº†è¯´æ˜æˆ‘çš„æƒ³æ³•ï¼Œè€ƒè™‘ä»¥ä¸‹ <code>ElectricCar</code> ç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;ElectricEngine.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">ElectricEngine</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">start</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">stop</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;ElectricCar.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;ElectricEngine.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">ElectricCar</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">ElectricCar</span><span class="p">(</span><span class="cm">/* maybe some engine arguments */</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">drive</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">ElectricEngine</span> <span class="n">engine_</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">    <span class="c1">// ... æ›´å¤šä¸æ±½è½¦ç›¸å…³çš„æ•°æ®æˆå‘˜ï¼ˆè½®å­ã€é©±åŠ¨ç³»ç»Ÿç­‰ï¼‰ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;ElectricCar.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;ElectricCar.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">ElectricCar</span><span class="o">::</span><span class="n">ElectricCar</span><span class="p">(</span><span class="cm">/* maybe some engine arguments */</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="n">engine_</span><span class="p">{</span><span class="cm">/* engine arguments */</span><span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... åˆå§‹åŒ–å…¶ä»–æ•°æ®æˆå‘˜ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{}</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>é¡¾åæ€ä¹‰ï¼Œ<code>ElectricCar</code> ç±»é…å¤‡äº†ä¸€ä¸ª <code>ElectricEngine</code>ã€‚ç„¶è€Œï¼Œå°½ç®¡åœ¨ç°å®ä¸­è¿™æ ·çš„è½¦å¯èƒ½éå¸¸æœ‰å¸å¼•åŠ›ï¼Œå½“å‰çš„å®ç°ç»†èŠ‚å´ä»¤äººæ‹…å¿§ï¼šç”±äº <code>engine_</code> æ•°æ®æˆå‘˜çš„å­˜åœ¨ï¼Œã€ŠElectricCar.hã€‹å¤´æ–‡ä»¶éœ€è¦åŒ…å«ã€ŠElectricEngine.hã€‹å¤´æ–‡ä»¶ã€‚ç¼–è¯‘å™¨éœ€è¦çœ‹åˆ° <code>ElectricEngine</code> çš„ç±»å®šä¹‰ï¼Œå› ä¸ºå¦åˆ™å®ƒæ— æ³•ç¡®å®š <code>ElectricCar</code> å®ä¾‹çš„å¤§å°ã€‚ç„¶è€Œï¼ŒåŒ…å«ã€ŠElectricEngine.hã€‹å¤´æ–‡ä»¶å¾ˆå®¹æ˜“å¯¼è‡´ä¼ é€’æ€§çš„ç‰©ç†ä¾èµ–ï¼šæ¯ä¸ªåŒ…å«ã€ŠElectricCar.hã€‹å¤´æ–‡ä»¶çš„æ–‡ä»¶éƒ½ä¼šç‰©ç†ä¸Šä¾èµ–äºã€ŠElectricEngine.hã€‹å¤´æ–‡ä»¶ã€‚å› æ­¤ï¼Œæ¯å½“å¤´æ–‡ä»¶å‘ç”Ÿæ›´æ”¹æ—¶ï¼Œ<code>ElectricCar</code> ç±»ä»¥åŠæ½œåœ¨çš„è®¸å¤šå…¶ä»–ç±»éƒ½ä¼šå—åˆ°å½±å“ã€‚å®ƒä»¬å¯èƒ½éœ€è¦é‡æ–°ç¼–è¯‘ã€é‡æ–°æµ‹è¯•ï¼Œç”šè‡³åœ¨æœ€åçš„æƒ…å†µä¸‹é‡æ–°éƒ¨ç½²â€¦â€¦å”‰ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿™ç§è®¾è®¡æš´éœ²äº†æ‰€æœ‰å®ç°ç»†èŠ‚ã€‚â€œä½ æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿç±»çš„ç§æœ‰éƒ¨åˆ†ä¸æ˜¯ç”¨æ¥éšè—å’Œå°è£…å®ç°ç»†èŠ‚çš„å—ï¼Ÿâ€ æ˜¯çš„ï¼Œå®ƒæ˜¯ç§æœ‰çš„ï¼Œä½† <code>private</code> æ ‡ç­¾åªæ˜¯ä¸€ä¸ªè®¿é—®æ ‡ç­¾ã€‚å®ƒä¸æ˜¯ä¸€ä¸ªå¯è§æ€§æ ‡ç­¾ã€‚å› æ­¤ï¼Œä½ çš„ç±»å®šä¹‰ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ˆæˆ‘æ˜¯æŒ‡æ‰€æœ‰å†…å®¹ï¼‰å¯¹æ‰€æœ‰èƒ½çœ‹åˆ° <code>ElectricCar</code> ç±»å®šä¹‰çš„äººéƒ½å¯è§ã€‚è¿™æ„å‘³ç€ä½ ä¸èƒ½åœ¨ä¸è¢«äººæ³¨æ„çš„æƒ…å†µä¸‹æ”¹å˜è¿™ä¸ªç±»çš„å®ç°ç»†èŠ‚ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¦‚æœä½ éœ€è¦æä¾› ABI ç¨³å®šæ€§ï¼Œå³ä½ çš„ç±»çš„å†…å­˜è¡¨ç¤ºä¸èƒ½æ”¹å˜ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚</p>
<p>ç¨å¾®å¥½ä¸€ç‚¹çš„æ–¹æ³•æ˜¯åªå­˜å‚¨ä¸€ä¸ªæŒ‡å‘ <code>ElectricEngine</code> çš„æŒ‡é’ˆï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;ElectricCar.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">struct</span> <span class="nc">ElectricEngine</span><span class="p">;</span>  <span class="c1">// å‰å‘å£°æ˜ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">ElectricCar</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">ElectricCar</span><span class="p">(</span><span class="cm">/* maybe some engine arguments */</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">drive</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ElectricEngine</span><span class="o">&gt;</span> <span class="n">engine_</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">    <span class="c1">// ... æ›´å¤šä¸æ±½è½¦ç›¸å…³çš„æ•°æ®æˆå‘˜ï¼ˆè½®å­ã€é©±åŠ¨ç³»ç»Ÿç­‰ï¼‰ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;ElectricCar.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;ElectricCar.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;ElectricEngine.h&gt;</span><span class="cp">   
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">ElectricCar</span><span class="o">::</span><span class="n">ElectricCar</span><span class="p">(</span><span class="cm">/* maybe some engine arguments */</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="n">engine_</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">ElectricEngine</span><span class="o">&gt;</span><span class="p">(</span><span class="cm">/* engine arguments */</span><span class="p">)}</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... åˆå§‹åŒ–å…¶ä»–æ•°æ®æˆå‘˜ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ... å…¶ä»– &#39;ElectricCar&#39; æˆå‘˜å‡½æ•°ï¼Œä½¿ç”¨æŒ‡å‘ &#39;ElectricEngine&#39; çš„æŒ‡é’ˆ
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªéœ€è¦å‘å‰å£°æ˜ <code>ElectricEngine</code> ç±»å³å¯ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¸éœ€è¦çŸ¥é“ç±»å®šä¹‰æ¥ç¡®å®š <code>ElectricCar</code> å®ä¾‹çš„å¤§å°ã€‚</p>
<p>æ­¤å¤–ï¼Œç‰©ç†ä¾èµ–ä¹Ÿæ¶ˆå¤±äº†ï¼Œå› ä¸ºã€ŠElectricEngine.hã€‹å¤´æ–‡ä»¶å·²ç»ç§»åˆ°äº†æºæ–‡ä»¶ä¸­ã€‚<br/>å› æ­¤ï¼Œä»ä¾èµ–å…³ç³»çš„è§’åº¦æ¥çœ‹ï¼Œè¿™ä¸ªè§£å†³æ–¹æ¡ˆè¦å¥½å¾—å¤šï¼Œä»ç„¶å­˜åœ¨çš„é—®é¢˜æ˜¯å®ç°ç»†èŠ‚çš„å¯è§æ€§ï¼Œæ¯ä¸ªäººä»ç„¶å¯ä»¥çœ‹åˆ° <code>ElectricCar</code> æ„å»ºåœ¨ <code>ElectricEngine</code> ä¹‹ä¸Šï¼Œå› æ­¤æ¯ä¸ªäººéƒ½ä»ç„¶éšå¼åœ°ä¾èµ–äºè¿™äº›å®ç°ç»†èŠ‚ã€‚</p>
<p>å› æ­¤ï¼Œä»»ä½•å¯¹è¿™äº›ç»†èŠ‚çš„æ›´æ”¹ï¼Œä¾‹å¦‚å‡çº§åˆ°æ–°çš„ <code>PowerEngine</code>ï¼Œéƒ½ä¼šå½±å“ä½¿ç”¨ã€ŠElectricCar.hã€‹å¤´æ–‡ä»¶çš„æ‰€æœ‰ç±»ã€‚â€œè¿™æ˜¯ä¸å¥½çš„ï¼Œå¯¹å§ï¼Ÿâ€ ç¡®å®å¦‚æ­¤ï¼Œå› ä¸ºå˜åŒ–æ˜¯å¯ä»¥é¢„æœŸçš„ï¼ˆå‚è§â€œæŒ‡å— 2ï¼šä¸ºå˜åŒ–è€Œè®¾è®¡â€ï¼‰ã€‚</p>
<p>ä¸ºäº†æ‘†è„±è¿™ç§ä¾èµ–å¹¶è·å¾—éšæ—¶è½»æ¾æ›´æ”¹å®ç°ç»†èŠ‚è€Œä¸è¢«äººæ³¨æ„çš„ä¾¿åˆ©ï¼Œæˆ‘ä»¬å¿…é¡»å¼•å…¥æŠ½è±¡ã€‚ç»å…¸çš„æŠ½è±¡å½¢å¼æ˜¯å¼•å…¥æŠ½è±¡ç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Engine.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Engine</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">Engine</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">start</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">stop</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... æ›´å¤šä¸å¼•æ“ç›¸å…³çš„å‡½æ•° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;ElectricCar.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Engine.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ElectricCar</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">drive</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Engine</span><span class="o">&gt;</span> <span class="n">engine_</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">    <span class="c1">// ... æ›´å¤šä¸æ±½è½¦ç›¸å…³çš„æ•°æ®æˆå‘˜ï¼ˆè½®å­ã€é©±åŠ¨ç³»ç»Ÿç­‰ï¼‰ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;ElectricEngine.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Engine.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ElectricEngine</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Engine</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">start</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">stop</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;ElectricCar.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;ElectricCar.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;ElectricEngine.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">ElectricCar</span><span class="o">::</span><span class="n">ElectricCar</span><span class="p">(</span><span class="cm">/* maybe some engine arguments */</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="n">engine_</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">ElectricEngine</span><span class="o">&gt;</span><span class="p">(</span><span class="cm">/* engine arguments */</span><span class="p">)}</span>   
</span></span><span class="line"><span class="cl">    <span class="c1">// ... åˆå§‹åŒ–å…¶ä»–æ•°æ®æˆå‘˜ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ... å…¶ä»– &#39;ElectricCar&#39; æˆå‘˜å‡½æ•°ï¼Œä¸»è¦ä½¿ç”¨ &#39;Engine&#39; æŠ½è±¡ï¼Œä½†ä¹Ÿå¯èƒ½æ˜ç¡®å¤„ç† &#39;ElectricEngine&#39;
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰äº† <code>Engine</code> åŸºç±»ï¼ˆï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ç§æŠ½è±¡å®ç° <code>ElectricCar</code> ç±»ã€‚æ²¡æœ‰äººéœ€è¦çŸ¥é“æˆ‘ä»¬ä½¿ç”¨çš„å®é™…å¼•æ“ç±»å‹ã€‚ä¹Ÿæ²¡æœ‰äººéœ€è¦çŸ¥é“æˆ‘ä»¬ä½•æ—¶å‡çº§å¼•æ“ã€‚é€šè¿‡è¿™ç§å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥éšæ—¶é€šè¿‡ä»…ä¿®æ”¹æºæ–‡ä»¶è½»æ¾æ›´æ”¹å®ç°ç»†èŠ‚ã€‚å› æ­¤ï¼Œé€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬çœŸæ­£æœ€å°åŒ–äº†å¯¹ <code>ElectricEngine</code> å®ç°çš„ä¾èµ–ã€‚æˆ‘ä»¬å°†è¿™ä¸€ç»†èŠ‚çš„çŸ¥è¯†å˜æˆæˆ‘ä»¬çš„ç§˜å¯†å®ç°ç»†èŠ‚ã€‚é€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€åº§æ¡¥æ¢ã€‚</p>
<p><strong>æ¡¥æ¥è®¾è®¡æ¨¡å¼è§£é‡Š</strong></p>
<p>æ¡¥æ¥è®¾è®¡æ¨¡å¼æ˜¯1994å¹´ç”±GoFï¼ˆå››äººç»„ï¼‰å¼•å…¥çš„ç»å…¸è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚æ¡¥æ¥çš„ç›®çš„åœ¨äºé€šè¿‡å°†æŸäº›å®ç°ç»†èŠ‚å°è£…åœ¨æŠ½è±¡ä¹‹åæ¥æœ€å°åŒ–ç‰©ç†ä¾èµ–ã€‚åœ¨C++ä¸­ï¼Œå®ƒå……å½“ç¼–è¯‘é˜²ç«å¢™ï¼Œä½¿æ›´æ”¹å˜å¾—å®¹æ˜“ï¼š</p>
<p>åœ¨è¿™ä¸ªæ„å›¾çš„è¡¨è¿°ä¸­ï¼Œå››äººç»„è®¨è®ºäº†â€œæŠ½è±¡â€å’Œâ€œå®ç°â€ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œ<code>ElectricCar</code> ç±»ä»£è¡¨â€œæŠ½è±¡â€ï¼Œè€Œ <code>Engine</code> ç±»ä»£è¡¨â€œå®ç°â€ï¼ˆå‚è§å›¾7-1ï¼‰ã€‚è¿™ä¸¤è€…éƒ½åº”è¯¥èƒ½å¤Ÿç‹¬ç«‹å˜åŒ–ï¼›å³å¯¹å…¶ä¸­ä»»ä½•ä¸€ä¸ªçš„æ›´æ”¹éƒ½ä¸åº”å½±å“å¦ä¸€ä¸ªã€‚æ˜“äºæ›´æ”¹çš„éšœç¢æ˜¯ <code>ElectricCar</code> ç±»ä¸å…¶å¼•æ“ä¹‹é—´çš„ç‰©ç†ä¾èµ–ã€‚å› æ­¤ï¼Œæƒ³æ³•æ˜¯æå–å¹¶éš”ç¦»è¿™äº›ä¾èµ–å…³ç³»ã€‚é€šè¿‡ä»¥ <code>Engine</code> æŠ½è±¡çš„å½¢å¼éš”ç¦»å®ƒä»¬ï¼Œåˆ†ç¦»å…³æ³¨ç‚¹ï¼Œå¹¶æ»¡è¶³å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰ï¼Œä½ å¯ä»¥è·å¾—çµæ´»åœ°æ›´æ”¹ã€è°ƒæ•´æˆ–å‡çº§å¼•æ“çš„æ–¹å¼ï¼ˆå‚è§â€œæŒ‡å— 2ï¼šä¸ºå˜åŒ–è€Œè®¾è®¡â€ï¼‰ã€‚è¿™ç§å˜åŒ–ä¸å†åœ¨ <code>ElectricCar</code> ç±»ä¸­å¯è§ã€‚ç»“æœæ˜¯ï¼Œç°åœ¨å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„å¼•æ“ç±»å‹è€Œä¸è®©â€œæŠ½è±¡â€å¯Ÿè§‰ã€‚è¿™ç¬¦åˆå¼€æ”¾å°é—­åŸåˆ™ï¼ˆOCPï¼‰çš„æ€æƒ³ï¼ˆå‚è§â€œæŒ‡å— 5ï¼šä¸ºæ‰©å±•è€Œè®¾è®¡â€ï¼‰ã€‚</p>
<p>è™½ç„¶è¿™ä¸ºæˆ‘ä»¬æä¾›äº†è½»æ¾åº”ç”¨æ›´æ”¹çš„èƒ½åŠ›ï¼Œå¹¶å®ç°äº†æ¡¥æ¥çš„æƒ³æ³•ï¼Œä½†æˆ‘ä»¬å¯ä»¥é‡‡å–ä¸€ä¸ªé¢å¤–çš„æ­¥éª¤æ¥è¿›ä¸€æ­¥è§£è€¦å’Œå‡å°‘é‡å¤ã€‚å‡è®¾æˆ‘ä»¬ä¸ä»…å¯¹ç”µåŠ¨æ±½è½¦æ„Ÿå…´è¶£ï¼Œè¿˜å¯¹å†…ç‡ƒæœºæ±½è½¦æ„Ÿå…´è¶£ã€‚å› æ­¤ï¼Œå¯¹äºæ¯ä¸€ç§æˆ‘ä»¬è®¡åˆ’å®ç°çš„æ±½è½¦ç±»å‹ï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›å¼•å…¥ç›¸åŒçš„ä¸å¼•æ“ç»†èŠ‚è§£è€¦æ–¹å¼ï¼Œå³ç›¸åŒçš„æ¡¥æ¥ã€‚ä¸ºäº†å‡å°‘é‡å¤å¹¶éµå¾ªDRYåŸåˆ™ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¡¥æ¥ç›¸å…³çš„å®ç°ç»†èŠ‚æå–åˆ° <code>Car</code> åŸºç±»ä¸­ã€‚<code>Car</code> åŸºç±»å°è£…äº†ä¸å…³è” <code>Engine</code> çš„æ¡¥æ¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Car.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Engine.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Car</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">protected</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Car</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Engine</span><span class="o">&gt;</span> <span class="n">engine</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">pimpl_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">engine</span><span class="p">))</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{}</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">Car</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">drive</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... æ›´å¤šä¸æ±½è½¦ç›¸å…³çš„å‡½æ•° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">protected</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">Engine</span><span class="o">*</span> <span class="n">getEngine</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">pimpl_</span><span class="p">.</span><span class="n">get</span><span class="p">();</span> <span class="p">}</span>   
</span></span><span class="line"><span class="cl">    <span class="n">Engine</span> <span class="k">const</span><span class="o">*</span> <span class="nf">getEngine</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">pimpl_</span><span class="p">.</span><span class="n">get</span><span class="p">();</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Engine</span><span class="o">&gt;</span> <span class="n">pimpl_</span><span class="p">;</span>  <span class="c1">// Pointer-to-implementation (pimpl)   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ... æ›´å¤šä¸æ±½è½¦ç›¸å…³çš„æ•°æ®æˆå‘˜ï¼ˆè½®å­ã€é©±åŠ¨ç³»ç»Ÿç­‰ï¼‰ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡æ·»åŠ  <code>Car</code> ç±»ï¼Œâ€œæŠ½è±¡â€å’Œâ€œå®ç°â€éƒ½è·å¾—äº†æ˜“äºæ‰©å±•çš„æœºä¼šï¼Œå¹¶ä¸”å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚å°½ç®¡ <code>Engine</code> åŸºç±»ä»ç„¶åœ¨æ­¤æ¡¥æ¥å…³ç³»ä¸­ä»£è¡¨â€œå®ç°â€ï¼Œä½†ç°åœ¨ <code>Car</code> ç±»æ‰®æ¼”äº†â€œæŠ½è±¡â€çš„è§’è‰²ã€‚å…³äº <code>Car</code> ç±»çš„ç¬¬ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ç»†èŠ‚æ˜¯å—ä¿æŠ¤çš„æ„é€ å‡½æ•°ï¼ˆï¼‰ã€‚è¿™ä¸ªé€‰æ‹©ç¡®ä¿åªæœ‰æ´¾ç”Ÿç±»æ‰èƒ½æŒ‡å®šå¼•æ“ç±»å‹ã€‚æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªæŒ‡å‘ <code>Engine</code> çš„ <code>std::unique_ptr</code> å¹¶å°†å…¶ç§»åŠ¨åˆ°å…¶ <code>pimpl_</code> æ•°æ®æˆå‘˜ï¼ˆï¼‰ã€‚è¿™ä¸ªæŒ‡é’ˆæ•°æ®æˆå‘˜æ˜¯æ‰€æœ‰ç±»å‹çš„ <code>Car</code> çš„å•ä¸€å®ç°æŒ‡é’ˆï¼Œé€šå¸¸ç§°ä¸º pimplã€‚è¿™ä¸ªä¸é€æ˜æŒ‡é’ˆè¡¨ç¤ºåˆ°å°è£…çš„å®ç°ç»†èŠ‚çš„æ¡¥æ¥ï¼Œå¹¶å®è´¨ä¸Šä»£è¡¨äº†æ•´ä¸ªæ¡¥æ¥è®¾è®¡æ¨¡å¼ã€‚å› æ­¤ï¼Œåœ¨ä»£ç ä¸­ä½¿ç”¨åç§° <code>pimpl</code> æ¥æŒ‡ç¤ºä½ çš„æ„å›¾æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼ˆè®°ä½â€œæŒ‡å— 14ï¼šä½¿ç”¨è®¾è®¡æ¨¡å¼çš„åç§°ä¼ è¾¾æ„å›¾â€ï¼‰ã€‚</p>
<p>æ³¨æ„ <code>pimpl_</code> è¢«å£°æ˜åœ¨ç±»çš„ç§æœ‰éƒ¨åˆ†ï¼Œå°½ç®¡æ´¾ç”Ÿç±»éœ€è¦ä½¿ç”¨å®ƒã€‚è¿™ä¸€é€‰æ‹©æ˜¯ç”±æ ¸å¿ƒæŒ‡å— C.133 åŠ¨æœºï¼š é¿å…ä¿æŠ¤çš„æ•°æ®æˆå‘˜ã€‚ å®é™…ä¸Šï¼Œç»éªŒè¡¨æ˜ï¼Œä¿æŠ¤çš„æ•°æ®æˆå‘˜å‡ ä¹ä¸æ¯”å…¬å…±æ•°æ®æˆå‘˜æ›´å¥½ã€‚å› æ­¤ï¼Œä¸ºäº†æˆäºˆè®¿é—® <code>pimpl</code> çš„æƒé™ï¼Œ<code>Car</code> ç±»æä¾›äº†å—ä¿æŠ¤çš„ <code>getEngine()</code> æˆå‘˜å‡½æ•°ï¼ˆï¼‰ã€‚<code>ElectricCar</code> ç±»ç›¸åº”åœ°è¿›è¡Œäº†è°ƒæ•´ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;ElectricCar.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Engine.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ElectricCar</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Car</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">ElectricCar</span><span class="p">(</span><span class="cm">/* maybe some engine arguments */</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">drive</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;ElectricCar.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;ElectricCar.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;ElectricEngine.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">ElectricCar</span><span class="o">::</span><span class="n">ElectricCar</span><span class="p">(</span><span class="cm">/* maybe some engine arguments */</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="n">Car</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">ElectricEngine</span><span class="o">&gt;</span><span class="p">(</span><span class="cm">/* engine arguments */</span><span class="p">))</span>   
</span></span><span class="line"><span class="cl"><span class="p">{}</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>è€Œä¸æ˜¯å®ç°æ¡¥æ¥æœ¬èº«ï¼Œ<code>ElectricCar</code> ç±»ç°åœ¨ç»§æ‰¿è‡ª <code>Car</code> åŸºç±»ï¼ˆï¼‰ã€‚è¿™ç§ç»§æ‰¿å…³ç³»å¼•å…¥äº†é€šè¿‡æŒ‡å®šä¸€ä¸ª <code>Engine</code> åˆå§‹åŒ– <code>Car</code> åŸºç±»çš„è¦æ±‚ã€‚è¿™é¡¹ä»»åŠ¡åœ¨ <code>ElectricCar</code> æ„é€ å‡½æ•°ï¼ˆï¼‰ä¸­å®Œæˆã€‚</p>
<p><strong>Pimplæƒ¯ç”¨æ³•</strong></p>
<p>æœ‰ä¸€ç§æ›´ç®€å•çš„æ¡¥æ¥è®¾è®¡æ¨¡å¼å½¢å¼ï¼Œå‡ åå¹´æ¥åœ¨Cå’ŒC++ä¸­è¢«å¹¿æ³›æˆåŠŸä½¿ç”¨ã€‚ä¸ºäº†çœ‹ä¸€ä¸ªä¾‹å­ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ä»¥ä¸‹çš„<code>Person</code>ç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Person</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">year_of_birth</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... æ›´å¤šè®¿é—®å‡½æ•° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">forename_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">surname_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">address_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">city_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">country_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">zip_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">year_of_birth_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... å¯èƒ½è¿˜æœ‰æ›´å¤šçš„æ•°æ®æˆå‘˜ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸€ä¸ªäººåŒ…å«äº†è®¸å¤šæ•°æ®æˆå‘˜ï¼šåå­—ã€å§“æ°ã€å®Œæ•´çš„é‚®æ”¿åœ°å€ã€å‡ºç”Ÿå¹´ä»½ç­‰ï¼Œå¹¶ä¸”å¯èƒ½éœ€è¦åœ¨æœªæ¥æ·»åŠ æ›´å¤šæ•°æ®æˆå‘˜ï¼Œå¦‚æ‰‹æœºå·ç ã€Twitterè´¦å·æˆ–ä¸‹ä¸€ä¸ªç¤¾äº¤åª’ä½“çƒ­æ½®çš„è´¦æˆ·ä¿¡æ¯ã€‚æ¢å¥è¯è¯´ï¼Œå¯ä»¥åˆç†åœ°è®¤ä¸º<code>Person</code>ç±»éœ€è¦éšç€æ—¶é—´æ‰©å±•æˆ–æ›´æ”¹ï¼Œç”šè‡³å¯èƒ½ä¼šé¢‘ç¹æ›´æ”¹ã€‚è¿™å¯èƒ½ä¼šç»™è¯¥ç±»çš„ç”¨æˆ·å¸¦æ¥å¾ˆå¤šä¸ä¾¿ï¼šæ¯å½“<code>Person</code>å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä½¿ç”¨<code>Person</code>çš„ç”¨æˆ·å¿…é¡»é‡æ–°ç¼–è¯‘ä»–ä»¬çš„ä»£ç ã€‚æ›´ä¸ç”¨è¯´ABIç¨³å®šæ€§äº†ï¼š<code>Person</code>å®ä¾‹çš„å¤§å°ä¼šæ”¹å˜ï¼</p>
<p>ä¸ºäº†éšè—æ‰€æœ‰å¯¹<code>Person</code>å®ç°ç»†èŠ‚çš„æ›´æ”¹å¹¶è·å¾—ABIç¨³å®šæ€§ï¼Œä½ å¯ä»¥ä½¿ç”¨æ¡¥æ¥è®¾è®¡æ¨¡å¼ã€‚ç„¶è€Œï¼Œåœ¨è¿™ç§ç‰¹å®šæƒ…å†µä¸‹ï¼Œä¸éœ€è¦æä¾›ä»¥åŸºç±»å½¢å¼çš„æŠ½è±¡ï¼šåªæœ‰ä¸€ä¸ªå¹¶ä¸”ç¡®åˆ‡çš„<code>Person</code>å®ç°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ‰€åšçš„å°±æ˜¯å¼•å…¥ä¸€ä¸ªåä¸º<code>Impl</code>çš„ç§æœ‰åµŒå¥—ç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Person.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">Person</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="nc">Impl</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Impl</span><span class="o">&gt;</span> <span class="k">const</span> <span class="n">pimpl_</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Person.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Person.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">struct</span> <span class="nc">Person</span><span class="o">::</span><span class="n">Impl</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">forename</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">surname</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">address</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">city</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">country</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">zip</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">year_of_birth</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... å¯èƒ½è¿˜æœ‰æ›´å¤šçš„æ•°æ®æˆå‘˜ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åµŒå¥—çš„<code>Impl</code>ç±»çš„ä»»åŠ¡æ˜¯å°è£…<code>Person</code>çš„å®ç°ç»†èŠ‚ã€‚å› æ­¤ï¼Œ<code>Person</code>ç±»ä¸­å”¯ä¸€çš„å‰©ä½™æ•°æ®æˆå‘˜æ˜¯ä¸€ä¸ªæŒ‡å‘<code>Impl</code>å®ä¾‹çš„<code>std::unique_ptr</code>ã€‚å…¶ä»–æ‰€æœ‰æ•°æ®æˆå‘˜ä»¥åŠæ½œåœ¨çš„ä¸€äº›éè™šæ‹Ÿè¾…åŠ©å‡½æ•°éƒ½è¢«ç§»åˆ°äº†<code>Impl</code>ç±»ä¸­ã€‚è¯·æ³¨æ„ï¼Œ<code>Impl</code>ç±»ä»…åœ¨<code>Person</code>ç±»ä¸­å£°æ˜ä½†æœªå®šä¹‰ã€‚ç›¸åï¼Œå®ƒåœ¨ç›¸åº”çš„æºæ–‡ä»¶ä¸­å®šä¹‰ã€‚åªæœ‰è¿™æ ·ï¼Œæ‰€æœ‰ç»†èŠ‚åŠå…¶æ›´æ”¹ï¼ˆå¦‚æ·»åŠ æˆ–åˆ é™¤æ•°æ®æˆå‘˜ï¼Œæ›´æ”¹æ•°æ®æˆå‘˜ç±»å‹ç­‰ï¼‰æ‰ä¼šå¯¹<code>Person</code>çš„ç”¨æˆ·éšè—ã€‚</p>
<p>è¿™ä¸ª<code>Person</code>çš„å®ç°ä½¿ç”¨äº†æ¡¥æ¥è®¾è®¡æ¨¡å¼çš„æœ€ç®€å•å½¢å¼ï¼šè¿™ç§å±€éƒ¨ã€éå¤šæ€å½¢å¼çš„æ¡¥æ¥è¢«ç§°ä¸ºPimplæƒ¯ç”¨æ³•ã€‚å®ƒå¸¦æ¥äº†æ¡¥æ¥æ¨¡å¼çš„æ‰€æœ‰è§£è€¦ä¼˜åŠ¿ï¼Œä½†å°½ç®¡å…¶ç®€å•æ€§ï¼Œä»ç„¶å¯¼è‡´äº†<code>Person</code>ç±»å®ç°ç¨å¾®å¤æ‚ä¸€äº›ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Person.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;memory&gt; 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Person</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Person</span><span class="p">();</span>    
</span></span><span class="line"><span class="cl">    <span class="o">~</span><span class="n">Person</span><span class="p">();</span>   
</span></span><span class="line"><span class="cl">    <span class="n">Person</span><span class="p">(</span><span class="n">Person</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">    <span class="n">Person</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Person</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">    <span class="n">Person</span><span class="p">(</span><span class="n">Person</span><span class="o">&amp;&amp;</span> <span class="n">other</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">    <span class="n">Person</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Person</span><span class="o">&amp;&amp;</span> <span class="n">other</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">year_of_birth</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">    <span class="c1">// ... æ›´å¤šè®¿é—®å‡½æ•° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="nc">Impl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Impl</span><span class="o">&gt;</span> <span class="k">const</span> <span class="n">pimpl_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Person.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;Person.h&gt; 
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;string&gt; 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">struct</span> <span class="nc">Person</span><span class="o">::</span><span class="n">Impl</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Person</span><span class="o">::</span><span class="n">Person</span><span class="p">()</span>   
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="n">pimpl_</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Impl</span><span class="o">&gt;</span><span class="p">()}</span> 
</span></span><span class="line"><span class="cl"><span class="p">{}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Person</span><span class="o">::~</span><span class="n">Person</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Person</span><span class="o">::</span><span class="n">Person</span><span class="p">(</span><span class="n">Person</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span>   
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="n">pimpl_</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Impl</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">other</span><span class="p">.</span><span class="n">pimpl_</span><span class="p">)}</span> 
</span></span><span class="line"><span class="cl"><span class="p">{}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Person</span><span class="o">&amp;</span> <span class="n">Person</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Person</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="n">pimpl_</span> <span class="o">=</span> <span class="o">*</span><span class="n">other</span><span class="p">.</span><span class="n">pimpl_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Person</span><span class="o">::</span><span class="n">Person</span><span class="p">(</span><span class="n">Person</span><span class="o">&amp;&amp;</span> <span class="n">other</span><span class="p">)</span>   
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="n">pimpl_</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Impl</span><span class="o">&gt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="o">*</span><span class="n">other</span><span class="p">.</span><span class="n">pimpl_</span><span class="p">))}</span> 
</span></span><span class="line"><span class="cl"><span class="p">{}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Person</span><span class="o">&amp;</span> <span class="n">Person</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Person</span><span class="o">&amp;&amp;</span> <span class="n">other</span><span class="p">)</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="n">pimpl_</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="o">*</span><span class="n">other</span><span class="p">.</span><span class="n">pimpl_</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">Person</span><span class="o">::</span><span class="n">year_of_birth</span><span class="p">()</span> <span class="k">const</span>   
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">pimpl_</span><span class="o">-&gt;</span><span class="n">year_of_birth</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ... æ›´å¤šPersonæˆå‘˜å‡½æ•° 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>Person</code>æ„é€ å‡½æ•°é€šè¿‡<code>std::make_unique()</code>åˆå§‹åŒ–<code>pimpl_</code>æ•°æ®æˆå‘˜ã€‚å½“ç„¶ï¼Œè¿™æ¶‰åŠåŠ¨æ€å†…å­˜åˆ†é…ï¼Œè¿™æ„å‘³ç€éœ€è¦æ¸…ç†åŠ¨æ€å†…å­˜ã€‚â€œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨<code>std::unique_ptr</code>ï¼Œâ€ä½ è¯´ã€‚æ­£ç¡®ã€‚ä½†ä¹Ÿè®¸ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œå°½ç®¡æˆ‘ä»¬ä½¿ç”¨<code>std::unique_ptr</code>ä¸ºæ­¤ç›®çš„ï¼Œä»ç„¶éœ€è¦æ‰‹åŠ¨å¤„ç†ææ„å‡½æ•°ã€‚</p>
<p>â€œä¸ºä»€ä¹ˆæˆ‘ä»¬å¿…é¡»è¿™æ ·åšï¼Ÿ<code>std::unique_ptr</code>çš„ç›®çš„ä¸å°±æ˜¯æˆ‘ä»¬ä¸å¿…å¤„ç†æ¸…ç†å—ï¼Ÿâ€ æ˜¯çš„ï¼Œä½†æˆ‘ä»¬ä»éœ€è¿™ä¹ˆåšã€‚è®©æˆ‘è§£é‡Šä¸€ä¸‹ï¼šå¦‚æœä½ ä¸ç¼–å†™ææ„å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šä¸ºä½ ç”Ÿæˆä¸€ä¸ªææ„å‡½æ•°ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå®ƒä¼šåœ¨<code>&lt;Person.h&gt;</code>å¤´æ–‡ä»¶ä¸­ç”Ÿæˆææ„å‡½æ•°ã€‚<code>Person</code>çš„ææ„å‡½æ•°å°†è§¦å‘<code>std::unique_ptr</code>æ•°æ®æˆå‘˜ææ„å‡½æ•°çš„å®ä¾‹åŒ–ï¼Œè¿™åè¿‡æ¥åˆéœ€è¦<code>Impl</code>ç±»ææ„å‡½æ•°çš„å®šä¹‰ã€‚ç„¶è€Œï¼Œ<code>Impl</code>çš„å®šä¹‰ä¸åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯åœ¨æºæ–‡ä»¶ä¸­å®šä¹‰ã€‚å¦åˆ™ï¼Œå®ƒä¼šè¿èƒŒæ¡¥æ¥çš„ç›®çš„ã€‚å› æ­¤ï¼Œç¼–è¯‘å™¨ä¼šå‘å‡ºå…³äºä¸å®Œæ•´ç±»å‹<code>Impl</code>çš„é”™è¯¯ã€‚å¹¸è¿çš„æ˜¯ï¼Œä½ ä¸å¿…æ”¾å¼ƒ<code>std::unique_ptr</code>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼ˆäº‹å®ä¸Šä½ ä¸åº”è¯¥æ”¾å¼ƒï¼‰ã€‚é—®é¢˜ç›¸å½“ç®€å•ï¼šåªéœ€å°†<code>Person</code>ææ„å‡½æ•°çš„å®šä¹‰ç§»åˆ°æºæ–‡ä»¶ä¸­å³å¯ï¼šåœ¨ç±»å®šä¹‰ä¸­å£°æ˜ææ„å‡½æ•°å¹¶åœ¨æºæ–‡ä»¶ä¸­é€šè¿‡<code>=default</code>å®šä¹‰å®ƒã€‚</p>
<p>ç”±äº<code>std::unique_ptr</code>ä¸èƒ½è¢«å¤åˆ¶ï¼Œä½ å¿…é¡»å®ç°æ‹·è´æ„é€ å‡½æ•°ä»¥ä¿æŒ<code>Person</code>ç±»çš„æ‹·è´è¯­ä¹‰ã€‚åŒæ ·çš„é“ç†ä¹Ÿé€‚ç”¨äºæ‹·è´èµ‹å€¼è¿ç®—ç¬¦ã€‚è¯·æ³¨æ„ï¼Œæ­¤è¿ç®—ç¬¦å‡è®¾æ¯ä¸ª<code>Person</code>å®ä¾‹éƒ½å°†æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„<code>pimpl_</code>ã€‚è¿™ä¸€å‡è®¾è§£é‡Šäº†ç§»åŠ¨æ„é€ å‡½æ•°çš„å®ç°ï¼šè€Œä¸æ˜¯ç®€å•åœ°ç§»åŠ¨<code>std::unique_ptr</code>ï¼Œå®ƒæ‰§è¡Œå¯èƒ½å¤±è´¥æˆ–æŠ›å‡ºå¼‚å¸¸çš„åŠ¨æ€å†…å­˜åˆ†é…ä¸<code>std::make_unique()</code>ã€‚å› æ­¤ï¼Œå®ƒæ²¡æœ‰è¢«å£°æ˜ä¸º<code>noexcept</code>ã€‚è¿™ä¸€å‡è®¾è¿˜è§£é‡Šäº†ä¸ºä»€ä¹ˆ<code>pimpl_</code>æ•°æ®æˆå‘˜è¢«å£°æ˜ä¸º<code>const</code>ã€‚ä¸€æ—¦åˆå§‹åŒ–ï¼ŒæŒ‡é’ˆå°†ä¸å†æ”¹å˜ï¼Œå³ä½¿åœ¨ç§»åŠ¨æ“ä½œä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼ŒåŒ…æ‹¬ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ã€‚</p>
<p>æœ€åä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ç»†èŠ‚æ˜¯<code>year_of_birth()</code>æˆå‘˜å‡½æ•°çš„å®šä¹‰ä½äºæºæ–‡ä»¶ä¸­ã€‚å°½ç®¡è¿™ä¸ªç®€å•çš„getterå‡½æ•°æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å†…è”å€™é€‰è€…ï¼Œå®šä¹‰ä»éœ€ç§»åˆ°æºæ–‡ä»¶ä¸­ã€‚åŸå› æ˜¯å¤´æ–‡ä»¶ä¸­çš„<code>Impl</code>æ˜¯ä¸€ä¸ªä¸å®Œå…¨ç±»å‹ã€‚è¿™æ„å‘³ç€åœ¨å¤´æ–‡ä»¶ä¸­æ— æ³•è®¿é—®ä»»ä½•æˆå‘˜ï¼ˆæ•°æ®å’Œå‡½æ•°ï¼‰ã€‚è¿™åªèƒ½åœ¨æºæ–‡ä»¶ä¸­è¿›è¡Œï¼Œæˆ–è€…æ›´ä¸€èˆ¬åœ°è¯´ï¼Œå½“ç¼–è¯‘å™¨çŸ¥é“<code>Impl</code>çš„å®šä¹‰æ—¶ã€‚</p>
<p><strong>æ¡¥æ¥ä¸ç­–ç•¥è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒ</strong></p>
<p>â€œæˆ‘æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œâ€ä½ è¯´ï¼Œâ€œæˆ‘çœ‹åˆ°æ¡¥æ¥å’Œç­–ç•¥è®¾è®¡æ¨¡å¼ä¹‹é—´æœ‰å¾ˆå¤§çš„ç›¸ä¼¼ä¹‹å¤„ã€‚æˆ‘çŸ¥é“ä½ è¯´è¿‡è®¾è®¡æ¨¡å¼æœ‰æ—¶ç»“æ„ä¸Šéå¸¸ç›¸ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºå®ƒä»¬çš„æ„å›¾ã€‚ä½†è¿™ä¸¤è€…ä¹‹é—´çš„å…·ä½“åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿâ€ æˆ‘ç†è§£ä½ çš„é—®é¢˜ã€‚è¿™ä¸¤ç§æ¨¡å¼ä¹‹é—´çš„ç›¸ä¼¼æ€§ç¡®å®æœ‰äº›ä»¤äººå›°æƒ‘ã€‚ç„¶è€Œï¼Œæœ‰ä¸€äº›æ–¹æ³•å¯ä»¥å¸®åŠ©åŒºåˆ†å®ƒä»¬ï¼šå¦‚ä½•åˆå§‹åŒ–ç›¸åº”æ•°æ®æˆå‘˜æ˜¯ä¸€ä¸ªå¼ºæœ‰åŠ›çš„æŒ‡æ ‡ï¼Œè¡¨æ˜ä½ åœ¨ä½¿ç”¨å“ªç§æ¨¡å¼ã€‚</p>
<p>å¦‚æœä¸€ä¸ªç±»ä¸æƒ³çŸ¥é“æŸäº›å®ç°ç»†èŠ‚ï¼Œå¹¶å› æ­¤æä¾›äº†ä»å¤–éƒ¨ä¼ é€’è¿™äº›ç»†èŠ‚çš„æœºä¼šï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡æ„é€ å‡½æ•°æˆ–è®¾ç½®å‡½æ•°ï¼‰ï¼Œé‚£ä¹ˆä½ å¾ˆå¯èƒ½åœ¨å¤„ç†ç­–ç•¥è®¾è®¡æ¨¡å¼ã€‚å› ä¸ºçµæ´»é…ç½®è¡Œä¸ºï¼ˆå³å‡å°‘é€»è¾‘ä¾èµ–ï¼‰æ˜¯å®ƒçš„ä¸»è¦å…³æ³¨ç‚¹ï¼Œç­–ç•¥æ¨¡å¼å±äºè¡Œä¸ºè®¾è®¡æ¨¡å¼ç±»åˆ«ã€‚ä¾‹å¦‚ï¼Œåœ¨ä»¥ä¸‹ä»£ç ç‰‡æ®µä¸­ï¼Œ<code>Database</code>ç±»çš„æ„é€ å‡½æ•°å°±æ˜¯ä¸€ä¸ªæ˜æ˜¾çš„æ ‡å¿—ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DatabaseEngine</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">DatabaseEngine</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... è®¸å¤šæ•°æ®åº“ç‰¹å®šçš„å‡½æ•° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Database</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Database</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">DatabaseEngine</span><span class="o">&gt;</span> <span class="n">engine</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... è®¸å¤šæ•°æ®åº“ç‰¹å®šçš„å‡½æ•° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">DatabaseEngine</span><span class="o">&gt;</span> <span class="n">engine_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ•°æ®åº“ä¸äº†è§£ä»»ä½•å®ç°ç»†èŠ‚ï¼Œå¹¶é€šè¿‡å…¶æ„é€ å‡½æ•°ä»å¤–éƒ¨è¯·æ±‚ -&gt; ç­–ç•¥è®¾è®¡æ¨¡å¼ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Database</span><span class="o">::</span><span class="n">Database</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">DatabaseEngine</span><span class="o">&gt;</span> <span class="n">engine</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="n">engine_</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">engine</span><span class="p">)}</span> 
</span></span><span class="line"><span class="cl"><span class="p">{}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®é™…çš„<code>DatabaseEngine</code>ç±»å‹ä»å¤–éƒ¨ä¼ å…¥ï¼Œè¿™ä½¿å¾—å®ƒæˆä¸ºç­–ç•¥è®¾è®¡æ¨¡å¼çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä¸€ä¸ªç±»äº†è§£å®ç°ç»†èŠ‚ï¼Œä½†ä¸»è¦æƒ³å‡å°‘å¯¹è¿™äº›ç»†èŠ‚çš„ç‰©ç†ä¾èµ–ï¼Œåˆ™ä½ å¾ˆå¯èƒ½åœ¨å¤„ç†æ¡¥æ¥è®¾è®¡æ¨¡å¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç±»ä¸ä¼šæä¾›ä»»ä½•æœºä¼šä»å¤–éƒ¨è®¾ç½®æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæŒ‡é’ˆæ˜¯ä¸€ä¸ªå®ç°ç»†èŠ‚å¹¶å†…éƒ¨è®¾ç½®ã€‚ç”±äºæ¡¥æ¥è®¾è®¡æ¨¡å¼ä¸»è¦å…³æ³¨å®ç°ç»†èŠ‚çš„ç‰©ç†ä¾èµ–ï¼Œè€Œä¸æ˜¯é€»è¾‘ä¾èµ–ï¼Œå› æ­¤æ¡¥æ¥æ¨¡å¼å±äºç»“æ„æ€§è®¾è®¡æ¨¡å¼ç±»åˆ«ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹ä»£ç ç‰‡æ®µï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Database</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Database</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">DatabaseEngine</span><span class="o">&gt;</span> <span class="n">pimpl_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ•°æ®åº“äº†è§£æ‰€éœ€çš„å®ç°ç»†èŠ‚ï¼Œä½†ä¸æƒ³è¿‡äºä¾èµ–å®ƒ -&gt; æ¡¥æ¥è®¾è®¡æ¨¡å¼ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Database</span><span class="o">::</span><span class="n">Database</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="n">pimpl_</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">ConcreteDatabaseEngine</span><span class="o">&gt;</span><span class="p">(</span><span class="cm">/* ä¸€äº›å‚æ•° */</span><span class="p">)}</span>  
</span></span><span class="line"><span class="cl"><span class="p">{}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å†æ¬¡ï¼Œæ¡¥æ¥è®¾è®¡æ¨¡å¼çš„åº”ç”¨æœ‰ä¸€ä¸ªæ˜æ˜¾çš„æ ‡å¿—ï¼šä¸æ˜¯æ¥å—å¤–éƒ¨çš„å¼•æ“ï¼Œè€Œæ˜¯<code>Database</code>ç±»çš„æ„é€ å‡½æ•°äº†è§£<code>ConcreteDatabaseEngine</code>å¹¶å†…éƒ¨è®¾ç½®å®ƒã€‚</p>
<p>å›¾7-4æ˜¾ç¤ºäº†æ•°æ®åº“ç¤ºä¾‹çš„æ¡¥æ¥å®ç°çš„ä¾èµ–å…³ç³»å›¾ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œ<code>Database</code>ç±»ä¸<code>ConcreteDatabaseEngine</code>ç±»å¤„äºç›¸åŒçš„æ¶æ„çº§åˆ«ï¼Œå¹¶ä¸”ä¸å…è®¸å…¶ä»–äººæä¾›ä¸åŒçš„å®ç°ã€‚è¿™è¡¨æ˜ä¸ç­–ç•¥è®¾è®¡æ¨¡å¼ç›¸æ¯”ï¼Œæ¡¥æ¥åœ¨é€»è¾‘ä¸Šè€¦åˆåˆ°ç‰¹å®šå®ç°ï¼Œä½†åœ¨ç‰©ç†ä¸Šä»…é€šè¿‡<code>DatabaseEngine</code>æŠ½è±¡è§£è€¦ã€‚</p>
<p><strong>åˆ†ææ¡¥æ¥è®¾è®¡æ¨¡å¼çš„ä¸è¶³</strong></p>
<p>â€œæˆ‘å®Œå…¨ç†è§£ä¸ºä»€ä¹ˆæ¡¥æ¥è®¾è®¡æ¨¡å¼åœ¨ç¤¾åŒºä¸­å¦‚æ­¤å—æ¬¢è¿ã€‚å®ƒçš„è§£è€¦ç‰¹æ€§çœŸçš„éå¸¸å¥½ï¼â€ä½ æ„Ÿå¹é“ã€‚â€œç„¶è€Œï¼Œä½ ä¸€ç›´å‘Šè¯‰æˆ‘æ¯ä¸ªè®¾è®¡éƒ½æœ‰å…¶ä¼˜ç¼ºç‚¹ã€‚æˆ‘é¢„è®¡ä¼šæœ‰ä¸€äº›æ€§èƒ½æŸå¤±ï¼Ÿâ€å¾ˆå¥½ï¼Œä½ è¿˜è®°å¾—æ¯ä¸ªè®¾è®¡éƒ½æœ‰å…¶ç¼ºç‚¹ã€‚å½“ç„¶ï¼Œè¿™åŒ…æ‹¬æ¡¥æ¥è®¾è®¡æ¨¡å¼ï¼Œå°½ç®¡å®ƒè¢«è¯æ˜æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚æ˜¯çš„ï¼Œä½ çš„å‡è®¾æ˜¯æ­£ç¡®çš„ï¼Œç¡®å®ä¼šæœ‰ä¸€äº›æ€§èƒ½å¼€é”€ã€‚</p>
<p>æ¡¥æ¥è®¾è®¡æ¨¡å¼å¸¦æ¥çš„äº”ç§å¼€é”€ä¸­çš„ç¬¬ä¸€ç§æºäºè¿™æ ·ä¸€ä¸ªäº‹å®ï¼šæ¡¥æ¥å¼•å…¥äº†é¢å¤–çš„é—´æ¥å±‚ï¼špimplæŒ‡é’ˆä½¿å¾—æ‰€æœ‰å¯¹å®ç°ç»†èŠ‚çš„è®¿é—®éƒ½å˜å¾—æ›´åŠ æ˜‚è´µã€‚ç„¶è€Œï¼Œè¿™ä¸ªæŒ‡é’ˆå¯¼è‡´çš„æ€§èƒ½æŸå¤±æœ‰å¤šå¤§æ˜¯ä¸€ä¸ªéœ€è¦å•ç‹¬è®¨è®ºçš„é—®é¢˜ï¼ˆå‚è§â€œæŒ‡å— 29ï¼šæ³¨æ„æ¡¥æ¥çš„æ€§èƒ½å¢ç›Šä¸æŸå¤±â€ï¼‰ã€‚ä¸è¿‡ï¼Œè¿™å¹¶ä¸æ˜¯æ€§èƒ½å¼€é”€çš„å”¯ä¸€æ¥æºï¼›è¿˜æœ‰æ›´å¤šã€‚å–å†³äºä½ æ˜¯å¦ä½¿ç”¨æŠ½è±¡ï¼Œä½ å¯èƒ½è¿˜éœ€è¦æ”¯ä»˜è™šæ‹Ÿå‡½æ•°è°ƒç”¨çš„å¼€é”€ã€‚æ­¤å¤–ï¼Œç”±äºå³ä½¿æ˜¯è®¿é—®æ•°æ®æˆå‘˜çš„æœ€ç®€å•å‡½æ•°ä¹Ÿæ— æ³•å†…è”ï¼Œä½ ä¹Ÿéœ€è¦ä¸ºæ­¤æ”¯ä»˜æ›´å¤šçš„æˆæœ¬ã€‚å½“ç„¶ï¼Œæ¯å½“åˆ›å»ºä¸€ä¸ªæ–°çš„åŸºäºæ¡¥æ¥å®ç°çš„ç±»å®ä¾‹æ—¶ï¼Œä½ è¿˜éœ€è¦ä¸ºé¢å¤–çš„åŠ¨æ€å†…å­˜åˆ†é…æ”¯ä»˜æˆæœ¬ã€‚æœ€åä½†åŒæ ·é‡è¦çš„æ˜¯ï¼Œä½ è¿˜åº”è¯¥è€ƒè™‘åˆ°å¼•å…¥ pimpl æŒ‡é’ˆæ‰€å¸¦æ¥çš„å†…å­˜å¼€é”€ã€‚æ‰€ä»¥ï¼Œæ˜¯çš„ï¼Œéš”ç¦»ç‰©ç†ä¾èµ–å¹¶éšè—å®ç°ç»†èŠ‚å¹¶ä¸æ˜¯æ²¡æœ‰ä»£ä»·çš„ï¼Œè€Œæ˜¯ä¼šå¯¼è‡´ç›¸å½“å¤§çš„å¼€é”€ã€‚</p>
<p>å°½ç®¡å¦‚æ­¤ï¼Œè¿™ä¸åº”è¯¥æ˜¯æ™®éæŠ›å¼ƒæ¡¥æ¥è§£å†³æ–¹æ¡ˆçš„ç†ç”±ï¼šè¿™æ€»æ˜¯å–å†³äºå…·ä½“æƒ…å†µã€‚ä¾‹å¦‚ï¼Œå¦‚æœåº•å±‚å®ç°æ‰§è¡Œç¼“æ…¢ã€æ˜‚è´µçš„ä»»åŠ¡ï¼ˆå¦‚ç³»ç»Ÿè°ƒç”¨ï¼‰ï¼Œé‚£ä¹ˆè¿™ç§å¼€é”€å¯èƒ½æ ¹æœ¬æ— æ³•æµ‹é‡ã€‚æ¢å¥è¯è¯´ï¼Œæ˜¯å¦ä½¿ç”¨æ¡¥æ¥åº”è¯¥æ ¹æ®å…·ä½“æƒ…å†µå†³å®šï¼Œå¹¶é€šè¿‡æ€§èƒ½åŸºå‡†æµ‹è¯•æ¥æ”¯æŒã€‚</p>
<p>æ­¤å¤–ï¼Œä½ å·²ç»çœ‹åˆ°äº†å®ç°ç»†èŠ‚å¹¶æ„è¯†åˆ°ä»£ç å¤æ‚æ€§æœ‰æ‰€å¢åŠ ã€‚ç”±äºä»£ç çš„ç®€æ´æ€§å’Œå¯è¯»æ€§æ˜¯ä¸€ç§ç¾å¾·ï¼Œè¿™åº”è¯¥è¢«è§†ä¸ºä¸€ä¸ªç¼ºç‚¹ã€‚çš„ç¡®ï¼Œè¿™ä»…å½±å“ç±»çš„å†…éƒ¨å®ç°ï¼Œè€Œä¸å½±å“ç”¨æˆ·ä»£ç ã€‚ä½†æ˜¯ï¼Œå¯¹äºç»éªŒè¾ƒå°‘çš„å¼€å‘äººå‘˜æ¥è¯´ï¼Œä¸€äº›ç»†èŠ‚ï¼ˆä¾‹å¦‚éœ€è¦åœ¨æºæ–‡ä»¶ä¸­å®šä¹‰ææ„å‡½æ•°ï¼‰å¯èƒ½ä¼šä»¤äººå›°æƒ‘ã€‚</p>
<p>æ€»ç»“æ¥è¯´ï¼Œæ¡¥æ¥è®¾è®¡æ¨¡å¼æ˜¯å‡å°‘ç‰©ç†ä¾èµ–æœ€æœ‰ä»·å€¼å’Œæœ€å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚å°½ç®¡å¦‚æ­¤ï¼Œä½ åº”è¯¥æ„è¯†åˆ°æ¡¥æ¥å¼•å…¥çš„å¼€é”€å’Œå¤æ‚æ€§ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…·ä½“çš„è€ƒè™‘å› ç´ ï¼š</p>
<p><strong>æ€§èƒ½å¼€é”€ï¼š</strong></p>
<ul>
<li>é¢å¤–çš„é—´æ¥å±‚ï¼ˆpimplæŒ‡é’ˆï¼‰ä½¿è®¿é—®å®ç°ç»†èŠ‚çš„æˆæœ¬æ›´é«˜ã€‚</li>
<li>ä½¿ç”¨æŠ½è±¡æ—¶ï¼Œå¯èƒ½éœ€è¦æ”¯ä»˜è™šæ‹Ÿå‡½æ•°è°ƒç”¨çš„å¼€é”€ã€‚</li>
<li>ç®€å•å‡½æ•°æ— æ³•å†…è”ï¼Œå¢åŠ äº†æˆæœ¬ã€‚</li>
<li>åˆ›å»ºæ–°å®ä¾‹æ—¶éœ€è¦è¿›è¡Œé¢å¤–çš„åŠ¨æ€å†…å­˜åˆ†é…ã€‚</li>
<li>å¼•å…¥ pimpl æŒ‡é’ˆå¸¦æ¥äº†å†…å­˜å¼€é”€ã€‚</li>
</ul>
<p><strong>ä»£ç å¤æ‚æ€§ï¼š</strong></p>
<ul>
<li>å®ç°ç»†èŠ‚å˜å¾—æ›´ä¸ºå¤æ‚ï¼Œè™½ç„¶è¿™å¯¹ç”¨æˆ·ä»£ç çš„å½±å“è¾ƒå°ã€‚</li>
<li>å¯¹äºç»éªŒè¾ƒå°‘çš„å¼€å‘äººå‘˜æ¥è¯´ï¼ŒæŸäº›ç»†èŠ‚ï¼ˆå¦‚åœ¨æºæ–‡ä»¶ä¸­å®šä¹‰ææ„å‡½æ•°ï¼‰å¯èƒ½ä¼šé€ æˆå›°æƒ‘ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œåœ¨é€‰æ‹©æ˜¯å¦ä½¿ç”¨æ¡¥æ¥è®¾è®¡æ¨¡å¼æ—¶ï¼Œåº”æƒè¡¡å…¶ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œå¹¶æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œè¯„ä¼°ã€‚<br/>ç‰¹åˆ«æ˜¯åœ¨æ€§èƒ½æ•æ„Ÿçš„åº”ç”¨åœºæ™¯ä¸­ï¼Œå»ºè®®é€šè¿‡å®é™…çš„æ€§èƒ½åŸºå‡†æµ‹è¯•æ¥éªŒè¯æ¡¥æ¥è®¾è®¡æ¨¡å¼çš„å®é™…æ•ˆæœã€‚</p>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>æ³¨æ„ç”±æ•°æ®æˆå‘˜æˆ–åŒ…æ‹¬å¼•å…¥çš„ç‰©ç†ä¾èµ–å…³ç³»ã€‚</li>
<li>åº”ç”¨æ¡¥æ¥è®¾è®¡æ¨¡å¼çš„ç›®çš„æ˜¯å°†ç‰©ç†ä¾èµ–ä¸å®ç°ç»†èŠ‚éš”ç¦»å¼€æ¥ï¼›</li>
<li>å»ºè®®ä½¿ç”¨pimplæ•°æ®æˆå‘˜è¿›è¡Œæ¡¥æ¥é€šä¿¡ã€‚</li>
<li>äº†è§£æ¡¥æ¥è®¾è®¡æ¨¡å¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚</li>
<li>äº†è§£å‡å°‘ç‰©ç†ä¾èµ–ï¼ˆæ¡¥æ¥ï¼‰å’Œå‡å°‘é€»è¾‘ä¾èµ–ï¼ˆç­–ç•¥ï¼‰ä¹‹é—´çš„åŒºåˆ«ã€‚</li>
</ul>
<h3 id="å‡†åˆ™-29æ³¨æ„æ¡¥æ¥çš„æ€§èƒ½å¢ç›Šä¸æŸå¤±">å‡†åˆ™ 29ï¼šæ³¨æ„æ¡¥æ¥çš„æ€§èƒ½å¢ç›Šä¸æŸå¤±
</h3><p>åœ¨â€œå‡†åˆ™ 28ï¼šæ„å»ºæ¡¥æ¢ä»¥æ¶ˆé™¤ç‰©ç†ä¾èµ–â€ä¸­ï¼Œæˆ‘ä»¬è¯¦ç»†è®¨è®ºäº†æ¡¥æ¥è®¾è®¡æ¨¡å¼ã€‚è™½ç„¶æˆ‘æƒ³è±¡æ¡¥æ¥çš„è®¾è®¡å’Œè§£è€¦æ–¹é¢ç»™ä½ ç•™ä¸‹äº†ç§¯æçš„å°è±¡ï¼Œä½†æˆ‘å¿…é¡»è®©ä½ æ„è¯†åˆ°ä½¿ç”¨è¿™ç§æ¨¡å¼å¯èƒ½ä¼šå¼•å…¥æ€§èƒ½æŸå¤±ã€‚â€œæ˜¯çš„ï¼Œè¿™è®©æˆ‘æœ‰äº›æ‹…å¿ƒã€‚æ€§èƒ½å¯¹æˆ‘æ¥è¯´å¾ˆé‡è¦ï¼Œå¬èµ·æ¥æ¡¥æ¥ä¼šå¸¦æ¥å·¨å¤§çš„æ€§èƒ½å¼€é”€ï¼Œâ€ä½ è¯´ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸æ™®éçš„é¢„æœŸã€‚ç”±äºæ€§èƒ½è‡³å…³é‡è¦ï¼Œæˆ‘çœŸçš„åº”è¯¥ç»™ä½ ä¸€ä¸ªæ¦‚å¿µï¼Œå‘Šè¯‰ä½ åœ¨ä½¿ç”¨æ¡¥æ¥æ—¶éœ€è¦é¢„æœŸå¤šå°‘å¼€é”€ã€‚ç„¶è€Œï¼Œæˆ‘ä¹Ÿåº”è¯¥å±•ç¤ºå¦‚ä½•æ˜æ™ºåœ°ä½¿ç”¨æ¡¥æ¥æ¥æé«˜ä»£ç çš„æ€§èƒ½ã€‚å¬èµ·æ¥éš¾ä»¥ç½®ä¿¡ï¼Ÿè®©æˆ‘å‘ä½ å±•ç¤ºå¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚</p>
<p><strong>æ¡¥æ¥çš„æ€§èƒ½å½±å“</strong></p>
<p>æ­£å¦‚åœ¨â€œå‡†åˆ™ 28ï¼šæ„å»ºæ¡¥æ¢ä»¥æ¶ˆé™¤ç‰©ç†ä¾èµ–â€ä¸­è®¨è®ºçš„é‚£æ ·ï¼Œæ¡¥æ¥å®ç°çš„æ€§èƒ½å—åˆ°è®¸å¤šå› ç´ çš„å½±å“ï¼šé€šè¿‡é—´æ¥å±‚è®¿é—®ã€è™šæ‹Ÿå‡½æ•°è°ƒç”¨ã€å†…è”ã€åŠ¨æ€å†…å­˜åˆ†é…ç­‰ã€‚ç”±äºè¿™äº›å› ç´ å’Œå¯èƒ½çš„ç»„åˆéå¸¸å¤šï¼Œæ— æ³•ç»™å‡ºæ¡¥æ¥ä¼šè€—è´¹å¤šå°‘æ€§èƒ½çš„ç¡®åˆ‡ç­”æ¡ˆã€‚æ²¡æœ‰æ·å¾„ï¼Œä¹Ÿæ²¡æœ‰æ›¿ä»£æ–¹æ³•å¯ä»¥ä»£æ›¿ä¸ºè‡ªå·±çš„ä»£ç ç»„è£…ä¸€äº›åŸºå‡†æµ‹è¯•å¹¶è¿è¡Œå®ƒä»¬ä»¥å¾—å‡ºç¡®åˆ‡ç­”æ¡ˆã€‚æˆ‘æƒ³å±•ç¤ºçš„æ˜¯ï¼Œç¡®å®å­˜åœ¨ç”±äºé—´æ¥è®¿é—®æ•°æ®æˆå‘˜è€Œå¸¦æ¥çš„æ€§èƒ½æŸå¤±ï¼Œä½†ä½ ä»ç„¶å¯ä»¥ä½¿ç”¨æ¡¥æ¥æ¥å®é™…æé«˜æ€§èƒ½ã€‚</p>
<p>è®©æˆ‘ä»¬ä»ç»™ä½ ä¸€ä¸ªå…³äºåŸºå‡†æµ‹è¯•çš„æ¦‚å¿µå¼€å§‹ã€‚ä¸ºäº†å½¢æˆå¯¹æŒ‡é’ˆé—´æ¥å±‚æˆæœ¬çš„çœ‹æ³•ï¼Œæˆ‘ä»¬å°†æ¯”è¾ƒä»¥ä¸‹ä¸¤ç§ <code>Person</code> ç±»çš„å®ç°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Person1.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Person1</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">forename_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">surname_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">address_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">city_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">country_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">zip_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">year_of_birth_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Person1</code> ç»“æ„è¡¨ç¤ºä¸€ç§ä¸åŸºäºæ¡¥æ¥å®ç°çš„ç±»å‹ã€‚æ‰€æœ‰ä¸ƒä¸ªæ•°æ®æˆå‘˜ï¼ˆå…­ä¸ª <code>std::string</code> å’Œä¸€ä¸ª <code>int</code>ï¼‰éƒ½ç›´æ¥å±äºç»“æ„æœ¬èº«ã€‚æ€»å…±è€Œè¨€ï¼Œå¹¶å‡è®¾æ˜¯ä¸€ä¸ª64ä½æœºå™¨ï¼Œä¸€ä¸ª <code>Person1</code> å®ä¾‹çš„å¤§å°æ˜¯152å­—èŠ‚ï¼ˆClang 11.1ï¼‰æˆ–200å­—èŠ‚ï¼ˆGCC 11.1ï¼‰ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œ<code>Person2</code> ç»“æ„æ˜¯é€šè¿‡Pimplæƒ¯ç”¨æ³•å®ç°çš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Person2.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">Person2</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Person2</span><span class="p">(</span><span class="cm">/*...å„ç§personå‚æ•°...*/</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="o">~</span><span class="n">Person2</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="nc">Impl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Impl</span><span class="o">&gt;</span> <span class="n">pimpl_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Person2.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Person2.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">struct</span> <span class="nc">Person2</span><span class="o">::</span><span class="n">Impl</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">forename</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">surname</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">address</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">city</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">country</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">zip</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">year_of_birth</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Person2</span><span class="o">::</span><span class="n">Person2</span><span class="p">(</span><span class="cm">/*...å„ç§personå‚æ•°...*/</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="n">pimpl_</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Impl</span><span class="o">&gt;</span><span class="p">(</span><span class="cm">/*...å„ç§personå‚æ•°...*/</span><span class="p">)}</span> 
</span></span><span class="line"><span class="cl"><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Person2</span><span class="o">::~</span><span class="n">Person2</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰€æœ‰ä¸ƒä¸ªæ•°æ®æˆå‘˜éƒ½è¢«ç§»åˆ°åµŒå¥—çš„ <code>Impl</code> ç»“æ„ä¸­ï¼Œå¹¶ä¸”åªèƒ½é€šè¿‡ <code>pimpl</code> æŒ‡é’ˆè®¿é—®ã€‚è™½ç„¶åµŒå¥—çš„ <code>Impl</code> ç»“æ„çš„æ€»å¤§å°ä¸ <code>Person1</code> çš„å¤§å°ç›¸åŒï¼Œä½† <code>Person2</code> ç»“æ„çš„å¤§å°ä»…ä¸º8å­—èŠ‚ï¼ˆå†æ¬¡å‡è®¾æ˜¯64ä½æœºå™¨ï¼‰ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šé€šè¿‡æ¡¥æ¥è®¾è®¡ï¼Œä½ å¯ä»¥å‡å°‘ç±»å‹çš„å¤§å°ï¼Œæœ‰æ—¶ç”šè‡³æ˜¾è‘—å‡å°‘ã€‚è¿™å¯ä»¥è¯æ˜éå¸¸æœ‰ä»·å€¼ï¼Œä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³å°†è¯¥ç±»å‹ä½œä¸º <code>std::variant</code> çš„æ›¿ä»£æ–¹æ¡ˆï¼ˆå‚è§â€œå‡†åˆ™ 17ï¼šè€ƒè™‘ä½¿ç”¨ <code>std::variant</code> å®ç°è®¿é—®è€…â€ï¼‰ã€‚</p>
<p>å› æ­¤ï¼Œè®©æˆ‘æ¦‚è¿°ä¸€ä¸‹åŸºå‡†æµ‹è¯•ï¼šæˆ‘å°†åˆ›å»ºä¸¤ä¸ªåŒ…å«25,000ä¸ªäººçš„ <code>std::vector</code>ï¼Œæ¯ä¸ª <code>Person</code> å®ç°ä¸€ä¸ªã€‚è¿™ä¸ªæ•°é‡çš„å…ƒç´ å°†ç¡®ä¿æˆ‘ä»¬åœ¨åº•å±‚CPUçš„å†…éƒ¨ç¼“å­˜ä¹‹å¤–å·¥ä½œï¼ˆå³ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ€»è®¡3.2 MBçš„å†…å­˜ï¼ŒClang 11.1ï¼‰ï¼Œæˆ–è€…4.2 MBï¼ˆGCC 11.1ï¼‰ã€‚æ‰€æœ‰è¿™äº›äººè¢«èµ‹äºˆä»»æ„çš„åå­—å’Œåœ°å€ï¼Œä»¥åŠ1957å¹´è‡³2004å¹´ä¹‹é—´çš„å‡ºç”Ÿå¹´ä»½ï¼ˆåœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œè¿™ä»£è¡¨äº†ä¸€ä¸ªç»„ç»‡ä¸­å‘˜å·¥åˆç†çš„å¹´é¾„èŒƒå›´ï¼‰ã€‚ç„¶åæˆ‘ä»¬å°†éå†è¿™ä¸¤ä¸ª <code>Person</code> å‘é‡äº”åƒæ¬¡ï¼Œå¹¶æ¯æ¬¡ä½¿ç”¨ <code>std::min_element()</code> ç¡®å®šæœ€å¹´é•¿çš„äººã€‚ç»“æœç”±äºåŸºå‡†æµ‹è¯•çš„é‡å¤æ€§è€Œç›¸å½“æ— è¶£ã€‚ä¸€ç™¾æ¬¡è¿­ä»£åï¼Œä½ ä¼šè§‰å¾—æ— èŠåˆ°ä¸æƒ³å†çœ‹ã€‚å”¯ä¸€é‡è¦çš„æ˜¯çœ‹åˆ°ç›´æ¥è®¿é—®æ•°æ®æˆå‘˜ï¼ˆ<code>Person1</code>ï¼‰å’Œé—´æ¥è®¿é—®æ•°æ®æˆå‘˜ï¼ˆ<code>Person2</code>ï¼‰ä¹‹é—´çš„æ€§èƒ½å·®å¼‚ã€‚è¡¨7-1æ˜¾ç¤ºäº†ä¸åŒ <code>Person</code> å®ç°çš„æ€§èƒ½ç»“æœï¼Œå½’ä¸€åŒ–ä¸º <code>Person1</code> å®ç°çš„æ€§èƒ½ã€‚</p>
<p>è¡¨7-1 ä¸åŒ <code>Person</code> å®ç°çš„æ€§èƒ½ç»“æœï¼ˆå½’ä¸€åŒ–æ€§èƒ½ï¼‰</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th><code>Person</code> å®ç°</th>
<th>GCC 11.1</th>
<th>Clang 11.1</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Person1</code>ï¼ˆæ—  pimplï¼‰</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td><code>Person2</code>ï¼ˆå®Œæ•´ Pimpl æƒ¯ç”¨æ³•ï¼‰</td>
<td>1.1099</td>
<td>1.1312</td>
</tr>
</tbody>
</table></div>
<p>å¾ˆæ˜æ˜¾ï¼Œåœ¨è¿™ä¸ªç‰¹å®šçš„åŸºå‡†æµ‹è¯•ä¸­ï¼Œæ¡¥æ¥å®ç°å¸¦æ¥äº†ç›¸å½“æ˜¾è‘—çš„æ€§èƒ½æŸå¤±ï¼šå¯¹äºGCCæ˜¯11.0%ï¼Œå¯¹äºClangæ˜¯13.1%ã€‚è¿™å¬èµ·æ¥å¾ˆå¤šï¼ç„¶è€Œï¼Œä¸è¦æŠŠè¿™äº›æ•°å­—çœ‹å¾—å¤ªè®¤çœŸï¼šæ˜¾ç„¶ï¼Œç»“æœä¸¥é‡ä¾èµ–äºå®é™…å…ƒç´ çš„æ•°é‡ã€å®é™…æ•°æ®æˆå‘˜çš„æ•°é‡å’Œç±»å‹ã€è¿è¡Œç³»ç»Ÿçš„å…·ä½“é…ç½®ä»¥åŠåŸºå‡†æµ‹è¯•ä¸­æ‰§è¡Œçš„å®é™…è®¡ç®—ã€‚</p>
<p>å¦‚æœä½ æ”¹å˜å…¶ä¸­ä»»ä½•ä¸€ä¸ªç»†èŠ‚ï¼Œæ•°å­—ä¹Ÿä¼šæ”¹å˜ã€‚å› æ­¤ï¼Œè¿™äº›æ•°å­—ä»…è¡¨æ˜ç”±äºé—´æ¥è®¿é—®æ•°æ®æˆå‘˜è€Œå¯¼è‡´æœ‰ä¸€äº›ï¼Œç”šè‡³æ˜¯æ›´å¤šçš„å¼€é”€ã€‚</p>
<p><strong>ä½¿ç”¨éƒ¨åˆ†æ¡¥æ¥æ”¹è¿›æ€§èƒ½</strong></p>
<p>â€œå¥½å§ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªé¢„æœŸçš„ç»“æœï¼Œå¯¹å§ï¼Ÿæˆ‘åº”è¯¥ä»ä¸­å­¦ä¹ ä»€ä¹ˆï¼Ÿâ€ä½ é—®é“ã€‚æˆ‘æ‰¿è®¤è¿™ä¸ªåŸºå‡†æµ‹è¯•éå¸¸å…·ä½“ï¼Œå¹¶ä¸èƒ½å›ç­”æ‰€æœ‰é—®é¢˜ã€‚ç„¶è€Œï¼Œå®ƒç¡®å®ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæœºä¼šï¼Œå®é™…ä¸Šå¯ä»¥é€šè¿‡æ¡¥æ¥æ¥æé«˜æ€§èƒ½ã€‚å¦‚æœä½ ä»”ç»†è§‚å¯Ÿ <code>Person1</code> çš„å®ç°ï¼Œä½ å¯èƒ½ä¼šæ„è¯†åˆ°å¯¹äºç»™å®šçš„åŸºå‡†æµ‹è¯•ï¼Œå¯è¾¾åˆ°çš„æ€§èƒ½ç›¸å½“æœ‰é™ï¼šå°½ç®¡ <code>Person1</code> çš„æ€»å¤§å°æ˜¯152å­—èŠ‚ï¼ˆClang 11.1ï¼‰æˆ–200å­—èŠ‚ï¼ˆGCC 11.1ï¼‰ï¼Œä½†æˆ‘ä»¬åªä½¿ç”¨äº†4å­—èŠ‚ï¼Œå³å•ä¸ª <code>int</code>ï¼Œä»æ•´ä¸ªæ•°æ®ç»“æ„ä¸­ã€‚è¿™è¢«è¯æ˜æ˜¯éå¸¸æµªè´¹å’Œä½æ•ˆçš„ï¼šå› ä¸ºåœ¨åŸºäºç¼“å­˜çš„æ¶æ„ä¸­ï¼Œå†…å­˜æ€»æ˜¯æŒ‰ç¼“å­˜è¡ŒåŠ è½½ï¼Œæˆ‘ä»¬ä»å†…å­˜ä¸­åŠ è½½çš„å¤§éƒ¨åˆ†æ•°æ®å®é™…ä¸Šæ ¹æœ¬æ²¡æœ‰ä½¿ç”¨ã€‚äº‹å®ä¸Šï¼Œå‡ ä¹æˆ‘ä»¬ä»å†…å­˜ä¸­åŠ è½½çš„æ‰€æœ‰æ•°æ®éƒ½æ²¡æœ‰è¢«ä½¿ç”¨ï¼šå‡è®¾ç¼“å­˜è¡Œé•¿åº¦ä¸º64å­—èŠ‚ï¼Œæˆ‘ä»¬åªä½¿ç”¨äº†å¤§çº¦6%çš„åŠ è½½æ•°æ®ã€‚</p>
<p>å› æ­¤ï¼Œå°½ç®¡æˆ‘ä»¬æ ¹æ®æ‰€æœ‰äººçš„å‡ºç”Ÿå¹´æ¥ç¡®å®šæœ€å¹´é•¿çš„äººå¬èµ·æ¥åƒæ˜¯ä¸€ä¸ªè®¡ç®—å—é™çš„æ“ä½œï¼Œä½†å®é™…ä¸Šæˆ‘ä»¬å®Œå…¨å—å†…å­˜é™åˆ¶ï¼šæœºå™¨æ ¹æœ¬æ— æ³•è¶³å¤Ÿå¿«åœ°æä¾›æ•°æ®ï¼Œæ•´æ•°å•å…ƒå¤§å¤šæ•°æ—¶é—´å¤„äºç©ºé—²çŠ¶æ€ã€‚</p>
<p>è¿™ç§è®¾ç½®ä¸ºæˆ‘ä»¬æä¾›äº†ä½¿ç”¨æ¡¥æ¥æ¥æé«˜æ€§èƒ½çš„æœºä¼šã€‚å‡è®¾æˆ‘ä»¬å¯ä»¥åŒºåˆ†ç»å¸¸ä½¿ç”¨çš„æ•°æ®ï¼ˆå¦‚åå­—ã€å§“æ°å’Œå‡ºç”Ÿå¹´ä»½ï¼‰å’Œå¾ˆå°‘ä½¿ç”¨çš„æ•°æ®ï¼ˆå¦‚é‚®æ”¿åœ°å€ï¼‰ã€‚åŸºäºè¿™ç§åŒºåˆ†ï¼Œæˆ‘ä»¬ç°åœ¨ç›¸åº”åœ°å®‰æ’æ•°æ®æˆå‘˜ï¼šæ‰€æœ‰ç»å¸¸ä½¿ç”¨çš„æ•°æ®æˆå‘˜ç›´æ¥å­˜å‚¨åœ¨ <code>Person</code> ç±»ä¸­ã€‚æ‰€æœ‰å¾ˆå°‘ä½¿ç”¨çš„æ•°æ®æˆå‘˜å­˜å‚¨åœ¨ <code>Impl</code> ç»“æ„ä¸­ã€‚è¿™å¯¼è‡´äº† <code>Person3</code> å®ç°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Person3.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">Person3</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Person3</span><span class="p">(</span><span class="cm">/*...å„ç§personå‚æ•°...*/</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="o">~</span><span class="n">Person3</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">forename_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">surname_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">year_of_birth_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="nc">Impl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Impl</span><span class="o">&gt;</span> <span class="n">pimpl_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Person3.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Person3.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">struct</span> <span class="nc">Person3</span><span class="o">::</span><span class="n">Impl</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">address</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">city</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">country</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">zip</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Person3</span><span class="o">::</span><span class="n">Person3</span><span class="p">(</span><span class="cm">/*...å„ç§personå‚æ•°...*/</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="n">forename_</span><span class="p">{</span><span class="cm">/*...*/</span><span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="p">,</span> <span class="n">surname_</span><span class="p">{</span><span class="cm">/*...*/</span><span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="p">,</span> <span class="n">year_of_birth_</span><span class="p">{</span><span class="cm">/*...*/</span><span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="p">,</span> <span class="n">pimpl_</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Impl</span><span class="o">&gt;</span><span class="p">(</span><span class="cm">/*...addressç›¸å…³çš„å‚æ•°...*/</span><span class="p">)}</span> 
</span></span><span class="line"><span class="cl"><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Person3</span><span class="o">::~</span><span class="n">Person3</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸€ä¸ª <code>Person3</code> å®ä¾‹çš„æ€»å¤§å°ä¸º64å­—èŠ‚ï¼ˆClang 11.1ï¼Œä¸¤ä¸ª24å­—èŠ‚çš„ <code>std::string</code>ï¼Œä¸€ä¸ªæ•´æ•°ï¼Œä¸€ä¸ªæŒ‡é’ˆï¼Œä»¥åŠç”±äºå¯¹é½è¦æ±‚çš„å››ä¸ªå¡«å……å­—èŠ‚ï¼‰æˆ–80å­—èŠ‚ï¼ˆGCC 11.1ï¼Œä¸¤ä¸ª32å­—èŠ‚çš„ <code>std::string</code>ï¼Œä¸€ä¸ªæ•´æ•°ï¼Œä¸€ä¸ªæŒ‡é’ˆï¼Œä»¥åŠä¸€äº›å¡«å……ï¼‰ã€‚å› æ­¤ï¼Œ<code>Person3</code> å®ä¾‹åªæœ‰ <code>Person1</code> å®ä¾‹çš„ä¸€åŠå¤§å°ã€‚è¿™ç§å¤§å°ä¸Šçš„å·®å¼‚æ˜¯å¯ä»¥æµ‹é‡çš„ï¼šè¡¨7-2æ˜¾ç¤ºäº†æ‰€æœ‰ <code>Person</code> å®ç°çš„æ€§èƒ½ç»“æœï¼ŒåŒ…æ‹¬ <code>Person3</code>ã€‚åŒæ ·ï¼Œç»“æœå½’ä¸€åŒ–ä¸º <code>Person1</code> å®ç°çš„æ€§èƒ½ã€‚</p>
<p>è¡¨7-2 ä¸åŒ <code>Person</code> å®ç°çš„æ€§èƒ½ç»“æœï¼ˆå½’ä¸€åŒ–æ€§èƒ½ï¼‰</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th><code>Person</code> å®ç°</th>
<th>GCC 11.1</th>
<th>Clang 11.1</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Person1</code>ï¼ˆæ—  pimplï¼‰</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td><code>Person2</code>ï¼ˆå®Œæ•´ Pimpl æƒ¯ç”¨æ³•ï¼‰</td>
<td>1.1099</td>
<td>1.1312</td>
</tr>
<tr>
<td><code>Person3</code>ï¼ˆéƒ¨åˆ† Pimpl æƒ¯ç”¨æ³•ï¼‰</td>
<td>0.8597</td>
<td>0.9353</td>
</tr>
</tbody>
</table></div>
<p>ä¸ <code>Person1</code> å®ç°ç›¸æ¯”ï¼Œ<code>Person3</code> çš„æ€§èƒ½æé«˜äº†14.0%ï¼ˆGCC 11.1ï¼‰å’Œ6.5%ï¼ˆClang 11.1ï¼‰ã€‚è€Œä¸”ï¼Œå¦‚å‰æ‰€è¿°ï¼Œè¿™åªæ˜¯å› ä¸ºæˆ‘ä»¬å‡å°‘äº† <code>Person3</code> å®ç°çš„å¤§å°ã€‚â€œå“‡ï¼Œè¿™æ˜¯å‡ºä¹æ„æ–™çš„ã€‚æˆ‘æ˜ç™½äº†ï¼Œæ¡¥æ¥ä¸ä¸€å®šæ€»æ˜¯å¯¹æ€§èƒ½æœ‰å®³ï¼Œâ€ä½ è¯´ã€‚æ˜¯çš„ï¼Œç¡®å®å¦‚æ­¤ã€‚å½“ç„¶ï¼Œè¿™æ€»æ˜¯å–å†³äºå…·ä½“çš„è®¾ç½®ï¼Œä½†åŒºåˆ†ç»å¸¸ä½¿ç”¨å’Œå¾ˆå°‘ä½¿ç”¨çš„æ•°æ®æˆå‘˜å¹¶é€šè¿‡å®ç°â€œéƒ¨åˆ†â€æ¡¥æ¥æ¥å‡å°‘æ•°æ®ç»“æ„çš„å¤§å°ï¼Œå¯èƒ½ä¼šå¯¹æ€§èƒ½äº§ç”Ÿéå¸¸ç§¯æçš„å½±å“ã€‚</p>
<p>â€œæ€§èƒ½æå‡å¾ˆå¤§ï¼Œè¿™å¾ˆå¥½ï¼Œä½†è¿™ä¸æ˜¯è¿èƒŒäº†æ¡¥æ¥çš„åˆè¡·å—ï¼Ÿâ€ä½ é—®é“ã€‚ç¡®å®ï¼Œä½ æ„è¯†åˆ°éšè—å®ç°ç»†èŠ‚å’Œä¸ºäº†æ€§èƒ½â€œå†…è”â€æ•°æ®æˆå‘˜ä¹‹é—´å­˜åœ¨äºŒå…ƒå¯¹ç«‹ã€‚å¦‚å¸¸ï¼Œè¿™å–å†³äºå…·ä½“æƒ…å†µï¼šä½ éœ€è¦é€æ¡ˆå†³å®šè¦ä¼˜å…ˆè€ƒè™‘å“ªä¸€æ–¹é¢ã€‚ä½ ä¹Ÿæ„è¯†åˆ°åœ¨ä¸¤ä¸ªæç«¯ä¹‹é—´æœ‰ä¸€ç³»åˆ—å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼šæ²¡æœ‰å¿…è¦å°†æ‰€æœ‰æ•°æ®æˆå‘˜éƒ½éšè—åœ¨æ¡¥æ¥åé¢ã€‚æœ€ç»ˆï¼Œä½ æ‰æ˜¯æ‰¾åˆ°ç»™å®šé—®é¢˜æœ€ä¼˜è§£çš„äººã€‚</p>
<p>æ€»ä¹‹ï¼Œå°½ç®¡æ¡¥æ¥é€šå¸¸ä¼šå¯¼è‡´ä¸€å®šçš„æ€§èƒ½æŸå¤±ï¼Œä½†åœ¨é€‚å½“çš„æƒ…å†µä¸‹ï¼Œå®ç°éƒ¨åˆ†æ¡¥æ¥å¯èƒ½ä¼šå¯¹æ€§èƒ½äº§ç”Ÿéå¸¸ç§¯æçš„å½±å“ã€‚ç„¶è€Œï¼Œè¿™åªæ˜¯å½±å“æ€§èƒ½çš„ä¼—å¤šå› ç´ ä¹‹ä¸€ã€‚å› æ­¤ï¼Œä½ åº”è¯¥å§‹ç»ˆæ£€æŸ¥æ¡¥æ¥æ˜¯å¦ä¼šå¯¼è‡´æ€§èƒ½ç“¶é¢ˆï¼Œæˆ–è€…éƒ¨åˆ†æ¡¥æ¥æ˜¯å¦èƒ½è§£å†³æ€§èƒ½é—®é¢˜ã€‚æœ€å¥½çš„éªŒè¯æ–¹æ³•æ˜¯åŸºäºå®é™…ä»£ç å’Œå°½å¯èƒ½å¤šçš„å®é™…æ•°æ®è¿›è¡Œæœ‰ä»£è¡¨æ€§çš„åŸºå‡†æµ‹è¯•ã€‚</p>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>è¯·è®°ä½ï¼Œæ¡¥æ¥å¯èƒ½ä¼šå¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚</li>
<li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“åˆ†ç¦»å¸¸ç”¨æ•°æ®å’Œä¸å¸¸ç”¨æ•°æ®æ—¶ï¼Œéƒ¨åˆ†æ¡¥æ¥å¯èƒ½å¯¹æ€§èƒ½æœ‰æ­£é¢å½±å“ã€‚</li>
<li>å§‹ç»ˆé€šè¿‡æœ‰ä»£è¡¨æ€§çš„åŸºå‡†æµ‹è¯•æ¥ç¡®è®¤æ€§èƒ½ç“¶é¢ˆæˆ–æ”¹è¿›ï¼›ä¸è¦ä¾èµ–ä½ çš„ç›´è§‰ã€‚</li>
</ul>
<h3 id="å‡†åˆ™-30åº”ç”¨åŸå‹æ¨¡å¼è¿›è¡ŒæŠ½è±¡å¤åˆ¶æ“ä½œ">å‡†åˆ™ 30ï¼šåº”ç”¨åŸå‹æ¨¡å¼è¿›è¡ŒæŠ½è±¡å¤åˆ¶æ“ä½œ
</h3><p>æƒ³è±¡ä¸€ä¸‹ä½ ååœ¨ä¸€å®¶é«˜æ¡£çš„æ„å¤§åˆ©é¤å…é‡Œï¼Œæ­£åœ¨ç ”ç©¶èœå•ã€‚å“¦ï¼Œå¤©å“ªï¼Œä»–ä»¬æä¾›äº†è¿™ä¹ˆå¤šç¾å‘³çš„ä¸œè¥¿ï¼›åƒå±‚é¢å¬èµ·æ¥å¾ˆæ£’ã€‚ä½†ä»–ä»¬æä¾›çš„æ¯”è¨é€‰æ‹©ä¹Ÿå¾ˆæ£’ã€‚çœŸæ˜¯éš¾ä»¥é€‰æ‹©â€¦â€¦ç„¶è€Œï¼Œä½ çš„æ€ç»ªè¢«æ‰“æ–­äº†ï¼Œå› ä¸ºæœåŠ¡å‘˜ç«¯ç€ä¸€é“çœ‹èµ·æ¥éå¸¸è¯±äººçš„èœè‚´èµ°è¿‡ã€‚ä¸å¹¸çš„æ˜¯ï¼Œé‚£é“èœä¸æ˜¯ä¸ºä½ å‡†å¤‡çš„ï¼Œè€Œæ˜¯ä¸ºå¦ä¸€æ¡Œå®¢äººå‡†å¤‡çš„ã€‚å“¦ï¼Œå“‡ï¼Œé‚£é¦™å‘³â€¦â€¦åœ¨è¿™ä¸€åˆ»ï¼Œä½ çŸ¥é“ä¸å†éœ€è¦è€ƒè™‘ä½ æƒ³åƒä»€ä¹ˆäº†ï¼šæ— è®ºæ˜¯ä»€ä¹ˆï¼Œä½ éƒ½è¦ç‚¹åŒæ ·çš„èœã€‚â€œå•Šï¼ŒæœåŠ¡å‘˜ï¼Œæˆ‘æƒ³è¦ä»–ä»¬ç‚¹çš„é‚£é“èœã€‚â€</p>
<p>åŒæ ·çš„é—®é¢˜ä¹Ÿå¯èƒ½å‡ºç°åœ¨ä½ çš„ä»£ç ä¸­ã€‚ç”¨C++æœ¯è¯­æ¥è¯´ï¼Œä½ å‘æœåŠ¡å‘˜è¯·æ±‚çš„æ˜¯åˆ«äººç›˜å­é‡Œèœè‚´çš„å‰¯æœ¬ã€‚å¤åˆ¶ä¸€ä¸ªå¯¹è±¡ï¼Œå³åˆ›å»ºå®ä¾‹çš„ç²¾ç¡®å‰¯æœ¬ï¼Œæ˜¯C++ä¸­ä¸€é¡¹åŸºæœ¬é‡è¦çš„æ“ä½œã€‚å¦‚æ­¤é‡è¦ä»¥è‡³äºç±»é»˜è®¤é…å¤‡äº†æ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦â€”â€”è¿™æ˜¯æ‰€è°“çš„â€œç‰¹æ®Šæˆå‘˜å‡½æ•°â€ä¸­çš„ä¸¤ä¸ªã€‚ç„¶è€Œï¼Œåœ¨è¯·æ±‚ä¸€ä»½èœè‚´çš„å‰¯æœ¬æ—¶ï¼Œä¸å¹¸çš„æ˜¯ä½ å¹¶ä¸çŸ¥é“å…·ä½“æ˜¯ä»€ä¹ˆèœè‚´ã€‚ç”¨C++æœ¯è¯­æ¥è¯´ï¼Œä½ åªæœ‰ä¸€ä¸ªæŒ‡å‘åŸºç±»çš„æŒ‡é’ˆï¼ˆæ¯”å¦‚è¯´ï¼Œä¸€ä¸ª <code>Dish*</code>ï¼‰ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå°è¯•é€šè¿‡ <code>Dish*</code> ä½¿ç”¨æ‹·è´æ„é€ å‡½æ•°æˆ–æ‹·è´èµ‹å€¼è¿ç®—ç¬¦é€šå¸¸ä¸èµ·ä½œç”¨ã€‚å°½ç®¡å¦‚æ­¤ï¼Œä½ ä»ç„¶æƒ³è¦ä¸€ä¸ªç²¾ç¡®çš„å‰¯æœ¬ã€‚è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ˜¯å¦ä¸€ä¸ªç»å…¸çš„GoFè®¾è®¡æ¨¡å¼ï¼šåŸå‹è®¾è®¡æ¨¡å¼ã€‚</p>
<p><strong>ä¸€ä¸ªå…³äºå¤åˆ¶åŠ¨ç‰©çš„ä¾‹å­ï¼šç»µç¾Š</strong></p>
<p>ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ä»¥ä¸‹ <code>Animal</code> åŸºç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Animal.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Animal</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">Animal</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">makeSound</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... æ›´å¤šä¸åŠ¨ç‰©ç›¸å…³çš„å‡½æ•° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é™¤äº†è¡¨ç¤º <code>Animal</code> åº”è¯¥æ˜¯ä¸€ä¸ªåŸºç±»çš„è™šææ„å‡½æ•°å¤–ï¼Œç±»åªæä¾›äº†ä¸€ä¸ªå¤„ç†æ‰“å°å¯çˆ±åŠ¨ç‰©å£°éŸ³çš„ <code>makeSound()</code> å‡½æ•°ã€‚ä¸€ä¸ªè¿™æ ·çš„åŠ¨ç‰©ç¤ºä¾‹æ˜¯ <code>Sheep</code> ç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Sheep.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Animal.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">Sheep</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Animal</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Sheep</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">)</span> <span class="o">:</span> <span class="n">name_</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">name</span><span class="p">)}</span> <span class="p">{}</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">makeSound</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... æ›´å¤šä¸åŠ¨ç‰©ç›¸å…³çš„å‡½æ•° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Sheep.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Sheep.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="n">Sheep</span><span class="o">::</span><span class="n">makeSound</span><span class="p">()</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;baa</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ <code>main()</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥åˆ›å»ºä¸€åªç»µç¾Šå¹¶è®©å®ƒå‘å‡ºå£°éŸ³ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Sheep.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ›å»ºå”¯ä¸€çš„ Dolly 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&gt;</span> <span class="k">const</span> <span class="n">dolly</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Sheep</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;Dolly&#34;</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// è§¦å‘ Dolly çš„å«å£° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">dolly</span><span class="o">-&gt;</span><span class="n">makeSound</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Dolly å¾ˆæ£’ï¼Œå¯¹å§ï¼Ÿè€Œä¸”éå¸¸å¯çˆ±ï¼äº‹å®ä¸Šï¼Œå¥¹éå¸¸æœ‰è¶£ï¼Œæˆ‘ä»¬å¸Œæœ›å†æœ‰ä¸€ä¸ª Dollyã€‚ç„¶è€Œï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªæŒ‡å‘åŸºç±»çš„æŒ‡é’ˆâ€”â€”ä¸€ä¸ª <code>Animal*</code>ã€‚æˆ‘ä»¬ä¸èƒ½é€šè¿‡ <code>Sheep</code> çš„æ‹·è´æ„é€ å‡½æ•°æˆ–æ‹·è´èµ‹å€¼è¿ç®—ç¬¦æ¥å¤åˆ¶å®ƒï¼Œå› ä¸ºæˆ‘ä»¬ï¼ˆæŠ€æœ¯ä¸Šï¼‰ç”šè‡³ä¸çŸ¥é“æˆ‘ä»¬æ­£åœ¨å¤„ç†çš„æ˜¯ä¸€åª <code>Sheep</code>ã€‚å®ƒå¯ä»¥æ˜¯ä»»ä½•ç§ç±»çš„åŠ¨ç‰©ï¼ˆä¾‹å¦‚ç‹—ã€çŒ«ã€ç»µç¾Šç­‰ï¼‰ã€‚æˆ‘ä»¬ä¹Ÿä¸æƒ³åªå¤åˆ¶ <code>Sheep</code> çš„ <code>Animal</code> éƒ¨åˆ†ï¼Œå› ä¸ºè¿™è¢«ç§°ä¸ºåˆ‡ç‰‡ã€‚å“¦ï¼Œæˆ‘çš„å¤©ï¼Œæˆ‘åˆšåˆšæ„è¯†åˆ°è¿™ä¸ªä¾‹å­å¯èƒ½ç‰¹åˆ«ä¸é€‚åˆè§£é‡ŠåŸå‹è®¾è®¡æ¨¡å¼ã€‚åˆ†å‰²åŠ¨ç‰©å¬èµ·æ¥å¾ˆç³Ÿç³•ã€‚æ‰€ä»¥è®©æˆ‘ä»¬è¿…é€Ÿç»§ç»­ã€‚æˆ‘ä»¬åœ¨å“ªå„¿ï¼Ÿå•Šï¼Œæ˜¯çš„ï¼Œæˆ‘ä»¬æƒ³è¦ä¸€ä¸ª Dolly çš„å‰¯æœ¬ï¼Œä½†æˆ‘ä»¬åªæœ‰ä¸€ä¸ª <code>Animal*</code>ã€‚è¿™æ—¶åŸå‹è®¾è®¡æ¨¡å¼å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p>
<p><strong>åŸå‹è®¾è®¡æ¨¡å¼è§£é‡Š</strong></p>
<p>åŸå‹è®¾è®¡æ¨¡å¼æ˜¯ç”±å››äººç»„æ”¶é›†çš„äº”ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚å®ƒä¸“æ³¨äºæä¾›ä¸€ç§åˆ›å»ºæŸäº›æŠ½è±¡å®ä½“å‰¯æœ¬çš„æŠ½è±¡æ–¹å¼ã€‚</p>
<p>æ„å›¾ï¼šâ€œæŒ‡å®šè¦åˆ›å»ºçš„å¯¹è±¡ç§ç±»ï¼Œä½¿ç”¨ä¸€ä¸ªåŸå‹å®ä¾‹ï¼Œå¹¶é€šè¿‡å¤åˆ¶è¿™ä¸ªåŸå‹åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚â€</p>
<p>åŸå‹è®¾è®¡æ¨¡å¼é€šå¸¸é€šè¿‡åŸºç±»ä¸­çš„ <code>virutal clone()</code> å‡½æ•°å®ç°ã€‚è€ƒè™‘æ›´æ–°åçš„ <code>Animal</code> åŸºç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Animal.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Animal</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">Animal</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">makeSound</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&gt;</span> <span class="n">clone</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// åŸå‹è®¾è®¡æ¨¡å¼ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡è¿™ä¸ª <code>clone()</code> å‡½æ•°ï¼Œä»»ä½•äººéƒ½å¯ä»¥è¯·æ±‚ç»™å®šï¼ˆåŸå‹ï¼‰åŠ¨ç‰©çš„æŠ½è±¡å‰¯æœ¬ï¼Œè€Œæ— éœ€äº†è§£ä»»ä½•ç‰¹å®šç±»å‹çš„åŠ¨ç‰©ï¼ˆå¦‚ Dogã€Cat æˆ– Sheepï¼‰ã€‚å½“ <code>Animal</code> åŸºç±»æ­£ç¡®åˆ†é…åˆ°æ¶æ„çš„é«˜å±‚æ—¶ï¼Œå®ƒéµå¾ªä¾èµ–å€’ç½®åŸåˆ™ã€‚</p>
<p><code>clone()</code> å‡½æ•°è¢«å£°æ˜ä¸ºçº¯è™šå‡½æ•°ï¼Œè¿™æ„å‘³ç€æ´¾ç”Ÿç±»å¿…é¡»å®ç°å®ƒã€‚ä½†æ˜¯ï¼Œæ´¾ç”Ÿç±»ä¸èƒ½éšæ„å®ç°è¯¥å‡½æ•°ï¼Œè€Œæ˜¯åº”è¯¥è¿”å›è‡ªèº«çš„ç²¾ç¡®å‰¯æœ¬ï¼ˆä»»ä½•å…¶ä»–ç»“æœéƒ½ä¼šè¿åLSPï¼›å‚è§â€œå‡†åˆ™ 6ï¼šéµå®ˆæŠ½è±¡çš„é¢„æœŸè¡Œä¸ºâ€ï¼‰ã€‚è¿™ä¸ªå‰¯æœ¬é€šå¸¸æ˜¯é€šè¿‡ <code>new</code> åŠ¨æ€åˆ›å»ºå¹¶é€šè¿‡æŒ‡å‘åŸºç±»çš„æŒ‡é’ˆè¿”å›çš„ã€‚å½“ç„¶ï¼Œè¿™ä¸ä»…å¯¼è‡´äº†ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿˜éœ€è¦æ˜¾å¼åœ°åˆ é™¤å‰¯æœ¬ã€‚ç”±äºæ‰‹åŠ¨æ¸…ç†åœ¨ç°ä»£C++ä¸­è¢«è®¤ä¸ºæ˜¯ä¸å¥½çš„åšæ³•ï¼ŒæŒ‡é’ˆä»¥ <code>std::unique_ptr</code> åˆ° <code>Animal</code> çš„å½¢å¼è¿”å›ã€‚</p>
<p><code>Sheep</code> ç±»ç›¸åº”åœ°è¿›è¡Œäº†æ›´æ–°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Sheep.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Animal.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">class</span> <span class="nc">Sheep</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Animal</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Sheep</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">)</span> <span class="o">:</span> <span class="n">name_</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">name</span><span class="p">)}</span> <span class="p">{}</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">makeSound</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&gt;</span> <span class="n">clone</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>  <span class="c1">// åŸå‹è®¾è®¡æ¨¡å¼ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Sheep.cpp&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;Sheep.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="n">Sheep</span><span class="o">::</span><span class="n">makeSound</span><span class="p">()</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;baa</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&gt;</span> <span class="n">Sheep</span><span class="o">::</span><span class="n">clone</span><span class="p">()</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Sheep</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>  <span class="c1">// å¤åˆ¶æ„é€ ä¸€åªç»µç¾Š 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ <code>Sheep</code> ç±»å¿…é¡»å®ç° <code>clone()</code> å‡½æ•°å¹¶è¿”å›å…¶è‡ªèº«çš„ç²¾ç¡®å‰¯æœ¬ï¼šåœ¨å…¶è‡ªå·±çš„ <code>clone()</code> å‡½æ•°å†…éƒ¨ï¼Œå®ƒä½¿ç”¨ <code>std::make_unique()</code> å‡½æ•°åŠå…¶è‡ªå·±çš„æ‹·è´æ„é€ å‡½æ•°ï¼Œå³ä½¿ <code>Sheep</code> ç±»åœ¨æœªæ¥å‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿæ€»æ˜¯å‡å®šä¼šåšæ­£ç¡®çš„äº‹æƒ…ã€‚è¿™ç§æ–¹æ³•æœ‰åŠ©äºé¿å…ä¸å¿…è¦çš„é‡å¤ï¼Œä»è€Œéµå¾ªDRYåŸåˆ™ï¼ˆå‚è§â€œæŒ‡å— 2ï¼šè®¾è®¡å˜åŒ–â€ï¼‰ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œ<code>Sheep</code> ç±»æ—¢æ²¡æœ‰åˆ é™¤ä¹Ÿæ²¡æœ‰éšè—å…¶æ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦ã€‚å› æ­¤ï¼Œå¦‚æœä½ æœ‰ä¸€åªç»µç¾Šï¼Œä½ ä»ç„¶å¯ä»¥é€šè¿‡ç‰¹æ®Šæˆå‘˜å‡½æ•°å¤åˆ¶è¿™åªç»µç¾Šã€‚è¿™æ˜¯å®Œå…¨å¯ä»¥çš„ï¼š<code>clone()</code> ä»…å¢åŠ äº†ä¸€ç§åˆ›å»ºå‰¯æœ¬çš„æ–¹å¼â€”â€”ä¸€ç§æ‰§è¡Œè™šæ‹Ÿå¤åˆ¶çš„æ–¹å¼ã€‚</p>
<h3 id="å‡†åˆ™-31ä½¿ç”¨å¤–éƒ¨å¤šæ€å®ç°éä¾µå…¥å¼è¿è¡Œæ—¶å¤šæ€">å‡†åˆ™ 31ï¼šä½¿ç”¨å¤–éƒ¨å¤šæ€å®ç°éä¾µå…¥å¼è¿è¡Œæ—¶å¤šæ€
</h3><p>åœ¨â€œå‡†åˆ™ 2ï¼šè®¾è®¡å˜åŒ–â€ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å…³æ³¨ç‚¹åˆ†ç¦»è®¾è®¡åŸåˆ™çš„å·¨å¤§ä¼˜åŠ¿ã€‚åœ¨â€œå‡†åˆ™ 19ï¼šä½¿ç”¨ç­–ç•¥éš”ç¦»äº‹ç‰©çš„æ‰§è¡Œæ–¹å¼â€ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨è¿™ç§åŠ›é‡é€šè¿‡ç­–ç•¥è®¾è®¡æ¨¡å¼ä»ä¸€ç»„å½¢çŠ¶ä¸­æå–ç»˜å›¾å®ç°ç»†èŠ‚ã€‚</p>
<p>ç„¶è€Œï¼Œå°½ç®¡è¿™æ˜¾è‘—å‡å°‘äº†ä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨â€œå‡†åˆ™ 23ï¼šä¼˜å…ˆä½¿ç”¨åŸºäºå€¼çš„ç­–ç•¥å’Œå‘½ä»¤å®ç°â€ä¸­å€ŸåŠ© <code>std::function</code> ç°ä»£åŒ–äº†è§£å†³æ–¹æ¡ˆï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€äº›ç¼ºç‚¹ã€‚ç‰¹åˆ«æ˜¯ï¼Œå½¢çŠ¶ç±»ä»ç„¶ä¸å¾—ä¸å¤„ç† <code>draw()</code> æ“ä½œï¼Œè™½ç„¶å‡ºäºè€¦åˆçš„åŸå› ï¼Œå¤„ç†å®ç°ç»†èŠ‚æ˜¯ä¸å¯å–çš„ã€‚</p>
<p>æ­¤å¤–ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œç­–ç•¥æ–¹æ³•åœ¨æå–å¤šä¸ªå¤šæ€æ“ä½œæ—¶æ˜¾å¾—æœ‰äº›ä¸åˆ‡å®é™…ã€‚ä¸ºäº†è¿›ä¸€æ­¥å‡å°‘è€¦åˆå¹¶ä»æˆ‘ä»¬çš„å½¢çŠ¶ä¸­æå–å¤šæ€æ“ä½œï¼Œæˆ‘ä»¬å°†ç»§ç»­è¿™ä¸€æ—…ç¨‹ï¼Œå¹¶å°†å…³æ³¨ç‚¹åˆ†ç¦»åŸåˆ™æå‡åˆ°ä¸€ä¸ªå…¨æ–°çš„ã€å¯èƒ½ä¸ç†Ÿæ‚‰çš„æ°´å¹³ï¼šæˆ‘ä»¬å°†å®Œå…¨åˆ†ç¦»å¤šæ€è¡Œä¸ºã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åº”ç”¨å¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼ã€‚</p>
<p><strong>å¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼è§£é‡Š</strong></p>
<p>è®©æˆ‘ä»¬å›åˆ°ç»˜åˆ¶å½¢çŠ¶çš„ä¾‹å­å’Œæˆ‘ä»¬åœ¨â€œå‡†åˆ™ 23ï¼šä¼˜å…ˆä½¿ç”¨åŸºäºå€¼çš„ç­–ç•¥å’Œå‘½ä»¤å®ç°â€ä¸­çš„æœ€æ–°ç‰ˆ <code>Circle</code> ç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Shape.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">Shape</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Circle.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;functional&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Circle</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Shape</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">using</span> <span class="n">DrawStrategy</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="n">Circle</span> <span class="k">const</span><span class="o">&amp;</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="nf">Circle</span><span class="p">(</span><span class="kt">double</span> <span class="n">radius</span><span class="p">,</span> <span class="n">DrawStrategy</span> <span class="n">drawer</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">radius_</span><span class="p">(</span><span class="n">radius</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">          <span class="n">drawer_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">drawer</span><span class="p">))</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* æ£€æŸ¥ç»™å®šçš„åŠå¾„æ˜¯å¦æœ‰æ•ˆä¸”ç»™å®šçš„ &#39;std::function&#39; å®ä¾‹ä¸ä¸ºç©º */</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span>   
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">drawer_</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="cm">/* some arguments */</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">radius</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">radius_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">radius_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">DrawStrategy</span> <span class="n">drawer_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡ç­–ç•¥è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬å…‹æœäº†æœ€åˆå¯¹ <code>draw()</code> æˆå‘˜å‡½æ•°å®ç°ç»†èŠ‚çš„å¼ºè€¦åˆï¼ˆï¼‰ã€‚æˆ‘ä»¬ä¹Ÿæ‰¾åˆ°äº†ä¸€ä¸ªåŸºäº <code>std::function</code> çš„å€¼è¯­ä¹‰è§£å†³æ–¹æ¡ˆï¼ˆï¼‰ã€‚ç„¶è€Œï¼Œ<code>draw()</code> æˆå‘˜å‡½æ•°ä»ç„¶æ˜¯æ‰€æœ‰ä» <code>Shape</code> åŸºç±»æ´¾ç”Ÿçš„ç±»çš„å…¬å…±æ¥å£çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€æœ‰çš„å½¢çŠ¶éƒ½ç»§æ‰¿äº†å®ç°å®ƒçš„ä¹‰åŠ¡ï¼ˆï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªæ˜æ˜¾çš„ç¼ºé™·ï¼šå¯ä»¥è¯´ï¼Œç»˜åˆ¶åŠŸèƒ½åº”è¯¥æ˜¯ç‹¬ç«‹çš„ï¼Œæ˜¯å½¢çŠ¶çš„ä¸€ä¸ªå­¤ç«‹æ–¹é¢ï¼Œè€Œå½¢çŠ¶æœ¬èº«ä¸åº”è¯¥çŸ¥é“å®ƒä»¬å¯ä»¥è¢«ç»˜åˆ¶çš„äº‹å®ã€‚æˆ‘ä»¬å·²ç»æå–äº†å®ç°ç»†èŠ‚è¿™ä¸€äº‹å®è¿›ä¸€æ­¥åŠ å¼ºäº†è¿™ä¸€è®ºç‚¹ã€‚</p>
<p>â€œé‚£ä¹ˆï¼Œè®©æˆ‘ä»¬ç›´æ¥æå– <code>draw()</code> æˆå‘˜å‡½æ•°ï¼Œå¯¹å§ï¼Ÿâ€ä½ äº‰è¾©é“ã€‚ä½ æ˜¯å¯¹çš„ã€‚ä¸å¹¸çš„æ˜¯ï¼Œä¹ä¸€çœ‹è¿™ä¼¼ä¹æ˜¯ä¸€ä»¶å¾ˆéš¾åšåˆ°çš„äº‹æƒ…ã€‚æˆ‘å¸Œæœ›ä½ è¿˜è®°å¾—â€œæŒ‡å— 15ï¼šä¸ºç±»å‹æˆ–æ“ä½œçš„æ·»åŠ è¿›è¡Œè®¾è®¡â€ï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬å¾—å‡ºç»“è®ºï¼Œå½“ä½ ä¸»è¦æƒ³æ·»åŠ ç±»å‹æ—¶ï¼Œä½ åº”è¯¥ä¼˜å…ˆé€‰æ‹©é¢å‘å¯¹è±¡çš„è§£å†³æ–¹æ¡ˆã€‚ä»è¿™ä¸ªè§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬ä¼¼ä¹è¢«è™šæ‹Ÿçš„ <code>draw()</code> å‡½æ•°å’Œè¡¨ç¤ºæ‰€æœ‰å½¢çŠ¶å¯ç”¨æ“ä½œé›†çš„ <code>Shape</code> åŸºç±»æ‰€å›°ï¼Œå³éœ€æ±‚åˆ—è¡¨ã€‚</p>
<p>ä¸è¿‡ï¼Œæœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚ä¸€ä¸ªç›¸å½“ä»¤äººæƒŠè®¶çš„æ–¹æ¡ˆï¼šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼æ¥æå–å®Œæ•´çš„å¤šæ€è¡Œä¸ºã€‚è¯¥æ¨¡å¼ç”± Chris Cleelandã€Douglas C. Schmidt å’Œ Timothy H. Harrison åœ¨ 1996 å¹´çš„ä¸€ç¯‡è®ºæ–‡ä¸­å¼•å…¥ã€‚å…¶æ„å›¾æ˜¯ä½¿éå¤šæ€ç±»å‹ï¼ˆæ²¡æœ‰å•ä¸ªè™šæ‹Ÿå‡½æ•°çš„ç±»å‹ï¼‰èƒ½å¤Ÿä»¥å¤šæ€æ–¹å¼å¤„ç†ã€‚</p>
<p><strong>å¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼</strong></p>
<p><strong>æ„å›¾</strong>ï¼šâ€œå…è®¸ä¸ç›¸å…³ä¸”æ²¡æœ‰è™šæ‹Ÿæ–¹æ³•çš„ C++ ç±»ä»¥å¤šæ€æ–¹å¼å¤„ç†ã€‚è¿™äº›ä¸ç›¸å…³çš„ç±»å¯ä»¥é€šè¿‡ä½¿ç”¨å®ƒä»¬çš„è½¯ä»¶ä»¥ç»Ÿä¸€çš„æ–¹å¼å¤„ç†ã€‚â€</p>
<p>é¦–å…ˆå¼•äººæ³¨ç›®çš„æ˜¯ï¼Œä¸å†æœ‰ <code>Shape</code> åŸºç±»ã€‚åœ¨å¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼ä¸­ï¼Œä¸åŒç§ç±»çš„å½¢çŠ¶ï¼ˆå¦‚ <code>Circle</code>ã€<code>Square</code> ç­‰ï¼‰è¢«è®¤ä¸ºæ˜¯ç®€å•çš„ã€éå¤šæ€ç±»å‹ã€‚æ­¤å¤–ï¼Œå½¢çŠ¶ä¸éœ€è¦çŸ¥é“ä»»ä½•å…³äºç»˜åˆ¶çš„ä¿¡æ¯ã€‚è®¾è®¡æ¨¡å¼ä¸æ˜¯è¦æ±‚å½¢çŠ¶ç»§æ‰¿è‡ª <code>Shape</code> åŸºç±»ï¼Œè€Œæ˜¯å¼•å…¥äº†ä¸€ä¸ªç‹¬ç«‹çš„ç»§æ‰¿å±‚æ¬¡ç»“æ„ï¼Œå½¢å¼ä¸Šè¡¨ç°ä¸º <code>ShapeConcept</code> å’Œ <code>ShapeModel</code> ç±»ã€‚è¿™ç§å¤–éƒ¨å±‚æ¬¡ç»“æ„é€šè¿‡å¼•å…¥æ‰€æœ‰æœŸæœ›çš„å½¢çŠ¶æ“ä½œå’Œè¦æ±‚æ¥ä¸ºå½¢çŠ¶å¼•å…¥å¤šæ€è¡Œä¸ºã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„ç®€å•ä¾‹å­ä¸­ï¼Œå¤šæ€è¡Œä¸ºä»…åŒ…å« <code>draw()</code> å‡½æ•°ã€‚ç„¶è€Œï¼Œå½“ç„¶ï¼Œéœ€æ±‚é›†åˆå¯ä»¥æ›´å¤§ï¼ˆä¾‹å¦‚ <code>rotate()</code>ã€<code>serialize()</code> ç­‰ï¼‰ã€‚è¿™ä¸€ç»„è™šæ‹Ÿå‡½æ•°å·²è¢«ç§»åˆ°æŠ½è±¡çš„ <code>ShapeConcept</code> ç±»ä¸­ï¼Œç°åœ¨å®ƒå–ä»£äº†ä¹‹å‰çš„ <code>Shape</code> åŸºç±»ã€‚ä¸»è¦çš„åŒºåˆ«åœ¨äºå…·ä½“å½¢çŠ¶ä¸éœ€è¦äº†è§£ <code>ShapeConcept</code>ï¼Œç‰¹åˆ«æ˜¯ä¸éœ€è¦ç»§æ‰¿å®ƒã€‚å› æ­¤ï¼Œå½¢çŠ¶å®Œå…¨è§£è€¦äºè™šæ‹Ÿå‡½æ•°é›†ã€‚å”¯ä¸€ç»§æ‰¿è‡ª <code>ShapeConcept</code> çš„ç±»æ˜¯ <code>ShapeModel</code> ç±»æ¨¡æ¿ã€‚è¿™ä¸ªç±»ä¸ºç‰¹å®šç±»å‹çš„å½¢çŠ¶ï¼ˆå¦‚ <code>Circle</code>ã€<code>Square</code> ç­‰ï¼‰å®ä¾‹åŒ–ï¼Œå¹¶ä½œä¸ºå…¶åŒ…è£…å™¨ã€‚ç„¶è€Œï¼Œ<code>ShapeModel</code> ä¸ä¼šè‡ªå·±å®ç°è™šæ‹Ÿå‡½æ•°çš„é€»è¾‘ï¼Œè€Œæ˜¯å°†è¯·æ±‚å§”æ‰˜ç»™æ‰€éœ€çš„å®ç°ã€‚</p>
<p>â€œå“‡ï¼Œå¤ªæ£’äº†ï¼æˆ‘æ˜ç™½äº†ï¼šè¿™ä¸ªå¤–éƒ¨å±‚æ¬¡ç»“æ„æå–äº†æ•´ä¸ªè™šæ‹Ÿå‡½æ•°é›†ï¼Œä»è€Œæå–äº†å½¢çŠ¶çš„æ‰€æœ‰å¤šæ€è¡Œä¸ºã€‚â€ æ˜¯çš„ï¼Œæ­£æ˜¯å¦‚æ­¤ã€‚å†æ¬¡å¼ºè°ƒï¼Œè¿™æ˜¯å…³æ³¨ç‚¹åˆ†ç¦»å’Œå•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰çš„ä¸€ä¸ªä¾‹å­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®Œæ•´çš„å¤šæ€è¡Œä¸ºè¢«è¯†åˆ«ä¸ºå˜åŒ–ç‚¹å¹¶ä»å½¢çŠ¶ä¸­æå–å‡ºæ¥ã€‚è€Œä¸”ï¼ŒSRP ä½œä¸ºå¼€é—­åŸåˆ™ï¼ˆOCPï¼‰çš„æ¨åŠ¨è€…ï¼šæœ‰äº† <code>ShapeModel</code> ç±»æ¨¡æ¿ï¼Œä½ å¯ä»¥è½»æ¾åœ°å°†ä»»ä½•æ–°çš„éå¤šæ€å½¢çŠ¶ç±»å‹æ·»åŠ åˆ° <code>ShapeConcept</code> å±‚æ¬¡ç»“æ„ä¸­ã€‚åªè¦æ–°ç±»å‹æ»¡è¶³æ‰€æœ‰æ‰€éœ€çš„æ“ä½œï¼Œè¿™å°±å¯ä»¥å·¥ä½œã€‚</p>
<p>â€œæˆ‘çœŸçš„å¾ˆå°è±¡æ·±åˆ»ã€‚ç„¶è€Œï¼Œæˆ‘ä¸ç¡®å®šä½ æ‰€è¯´çš„â€˜æ»¡è¶³æ‰€æœ‰æ‰€éœ€çš„æ“ä½œâ€™æ˜¯ä»€ä¹ˆæ„æ€ã€‚ä½ èƒ½è¯¦ç»†è¯´æ˜ä¸€ä¸‹å—ï¼Ÿâ€</p>
<p>å½“ç„¶å¯ä»¥ï¼æˆ‘è®¤ä¸ºå½“å±•ç¤ºå…·ä½“çš„ä»£ç ç¤ºä¾‹æ—¶ï¼Œå¥½å¤„ä¼šå˜å¾—æ¸…æ™°ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬ç”¨å¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼é‡æ„å®Œæ•´çš„å½¢çŠ¶ç»˜åˆ¶ç¤ºä¾‹ã€‚</p>
<p><strong>å…·ä½“ä»£ç ç¤ºä¾‹</strong></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ <code>ShapeConcept</code> å’Œ <code>ShapeModel</code> ç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;ShapeConcept.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ShapeConcept</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">ShapeConcept</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;ShapeModel.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;ShapeConcept.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">ShapeType</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ShapeModel</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ShapeConcept</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">ShapeModel</span><span class="p">(</span><span class="n">ShapeType</span> <span class="n">shape</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">shape_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="c1">// è¿™é‡Œè°ƒç”¨å®é™…çš„ç»˜åˆ¶é€»è¾‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">shape_</span><span class="p">.</span><span class="n">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">ShapeType</span> <span class="n">shape_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œæˆ‘ä»¬ä¿®æ”¹ <code>Circle</code> ç±»ï¼Œä½¿å…¶ä¸ç»§æ‰¿è‡ª <code>Shape</code>ï¼Œå¹¶ä¸”åªåŒ…å«ç»˜åˆ¶é€»è¾‘ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Circle.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;functional&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Circle</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Circle</span><span class="p">(</span><span class="kt">double</span> <span class="n">radius</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">radius_</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* æ£€æŸ¥ç»™å®šçš„åŠå¾„æ˜¯å¦æœ‰æ•ˆ */</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">)</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="c1">// ç»˜åˆ¶é€»è¾‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Drawing a circle with radius &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">radius_</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">radius</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">radius_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">radius_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åï¼Œåœ¨ä¸»ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»º <code>ShapeModel</code> çš„å®ä¾‹å¹¶ä½¿ç”¨å®ƒï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;ShapeModel.h&#34;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;Circle.h&#34;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ShapeConcept</span><span class="o">&gt;&gt;</span> <span class="n">shapes</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ›å»ºä¸€ä¸ª Circle å¯¹è±¡å¹¶å°†å…¶åŒ…è£…åœ¨ ShapeModel ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Circle</span> <span class="n">circle</span><span class="p">(</span><span class="mf">10.0</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">circleModel</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">ShapeModel</span><span class="o">&lt;</span><span class="n">Circle</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">circle</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">shapes</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">circleModel</span><span class="p">));</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è°ƒç”¨ç»˜åˆ¶å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">shape</span> <span class="p">:</span> <span class="n">shapes</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">shape</span><span class="o">-&gt;</span><span class="n">draw</span><span class="p">(</span><span class="cm">/* some arguments */</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç»˜åˆ¶é€»è¾‘ä¸å½¢çŠ¶çš„å…·ä½“å®ç°è§£è€¦ï¼Œå¹¶å…è®¸çµæ´»åœ°æ·»åŠ æ–°çš„å½¢çŠ¶ç±»å‹ï¼Œè€Œæ— éœ€ä¿®æ”¹ç°æœ‰çš„ä»£ç ã€‚</p>
<p><strong>å½¢çŠ¶ç»˜åˆ¶å†æ¢è®¨</strong></p>
<p>è®©æˆ‘ä»¬ä» <code>Circle</code> å’Œ <code>Square</code> ç±»å¼€å§‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Circle.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Circle</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Circle</span><span class="p">(</span><span class="kt">double</span> <span class="n">radius</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">radius_</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* æ£€æŸ¥ç»™å®šçš„åŠå¾„æ˜¯å¦æœ‰æ•ˆ */</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">radius</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">radius_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="cm">/* æ›´å¤šè·å–å™¨å’Œä¸åœ†ç›¸å…³çš„å®ç”¨å‡½æ•° */</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">radius_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="cm">/* æ›´å¤šæ•°æ®æˆå‘˜ */</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---- &lt;Square.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Square</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">Square</span><span class="p">(</span><span class="kt">double</span> <span class="n">side</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">side_</span><span class="p">(</span><span class="n">side</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* æ£€æŸ¥ç»™å®šçš„è¾¹é•¿æ˜¯å¦æœ‰æ•ˆ */</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">side</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">side_</span><span class="p">;</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="cm">/* æ›´å¤šè·å–å™¨å’Œä¸æ­£æ–¹å½¢ç›¸å…³çš„å®ç”¨å‡½æ•° */</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">side_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="cm">/* æ›´å¤šæ•°æ®æˆå‘˜ */</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸¤ä¸ªç±»å·²ç»è¢«ç®€åŒ–ä¸ºåŸºæœ¬çš„å‡ ä½•å®ä½“ã€‚å®ƒä»¬å®Œå…¨æ˜¯éå¤šæ€çš„ï¼Œå³ä¸å†æœ‰åŸºç±»ä¸”æ²¡æœ‰è™šæ‹Ÿå‡½æ•°ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªç±»å®Œå…¨ä¸çŸ¥é“ä»»ä½•å¯èƒ½å¼•å…¥äººå·¥ä¾èµ–çš„æ“ä½œï¼Œå¦‚ç»˜åˆ¶ã€æ—‹è½¬ã€åºåˆ—åŒ–ç­‰ã€‚</p>
<p>ç›¸åï¼Œæ‰€æœ‰è¿™äº›åŠŸèƒ½éƒ½åœ¨ <code>ShapeConcept</code> åŸºç±»ä¸­å¼•å…¥ï¼Œå¹¶ç”± <code>ShapeModel</code> ç±»æ¨¡æ¿å®ç°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;Shape.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;functional&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdexcept&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ShapeConcept</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">ShapeConcept</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">    <span class="c1">// ... å¯èƒ½æ›´å¤šçš„å¤šæ€æ“ä½œ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">ShapeT</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ShapeModel</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ShapeConcept</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">using</span> <span class="n">DrawStrategy</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="n">ShapeT</span> <span class="k">const</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="nf">ShapeModel</span><span class="p">(</span><span class="n">ShapeT</span> <span class="n">shape</span><span class="p">,</span> <span class="n">DrawStrategy</span> <span class="n">drawer</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">shape_</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">shape</span><span class="p">)},</span> 
</span></span><span class="line"><span class="cl">          <span class="n">drawer_</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">drawer</span><span class="p">)}</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="cm">/* æ£€æŸ¥ç»™å®šçš„ &#39;std::function&#39; ä¸ä¸ºç©º */</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span> <span class="n">drawer_</span><span class="p">(</span><span class="n">shape_</span><span class="p">);</span> <span class="p">}</span>   
</span></span><span class="line"><span class="cl">    <span class="c1">// ... å¯èƒ½æ›´å¤šçš„å¤šæ€æ“ä½œ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">ShapeT</span> <span class="n">shape_</span><span class="p">;</span>   <span class="c1">// ç»„åˆè€Œéç»§æ‰¿ï¼ˆè®°ä½â€œæŒ‡å— 20ï¼šä¼˜å…ˆä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿â€ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">DrawStrategy</span> <span class="n">drawer_</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>ShapeConcept</code> ç±»å¼•å…¥äº†ä¸€ä¸ªçº¯è™šå‡½æ•° <code>draw()</code>ï¼ˆï¼‰ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™ä¸ªå”¯ä¸€çš„è™šæ‹Ÿå‡½æ•°ä»£è¡¨äº†å½¢çŠ¶çš„æ‰€æœ‰è¦æ±‚é›†ã€‚å°½ç®¡é›†åˆå¾ˆå°ï¼Œä½† <code>ShapeConcept</code> ç±»ä»£è¡¨äº†ä¸€ç§ç»å…¸çš„æŠ½è±¡ï¼Œç¬¦åˆé‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLSPï¼‰ï¼ˆè§â€œæŒ‡å— 6ï¼šéµå®ˆæŠ½è±¡çš„é¢„æœŸè¡Œä¸ºâ€ï¼‰ã€‚è¿™ç§æŠ½è±¡åœ¨ <code>ShapeModel</code> ç±»æ¨¡æ¿ä¸­å®ç°ï¼ˆï¼‰ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>ShapeModel</code> çš„å®ä¾‹æ˜¯å”¯ä¸€ç»§æ‰¿è‡ª <code>ShapeConcept</code> çš„ç±»ï¼›ä¸æœŸæœ›å…¶ä»–ç±»è¿›å…¥è¿™ç§å…³ç³»ã€‚<code>ShapeModel</code> ç±»æ¨¡æ¿å°†ä¸ºæ¯ç§æ‰€éœ€çš„å½¢çŠ¶ç±»å‹å®ä¾‹åŒ–ï¼Œå³ <code>ShapeT</code> æ¨¡æ¿å‚æ•°å¯ä»¥æ˜¯ <code>Circle</code>ã€<code>Square</code> ç­‰ç±»å‹ã€‚è¯·æ³¨æ„ï¼Œ<code>ShapeModel</code> å­˜å‚¨äº†ç›¸åº”å½¢çŠ¶çš„ä¸€ä¸ªå®ä¾‹ï¼ˆï¼‰ï¼Œå®ƒä½œä¸ºä¸€ä¸ªåŒ…è£…å™¨ï¼Œé€šè¿‡æ‰€éœ€çš„å¤šæ€è¡Œä¸ºï¼ˆåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹æ˜¯ <code>draw()</code> å‡½æ•°ï¼‰å¢å¼ºç‰¹å®šå½¢çŠ¶ç±»å‹ã€‚</p>
<p>ç”±äº <code>ShapeModel</code> å®ç°äº† <code>ShapeConcept</code> æŠ½è±¡ï¼Œå› æ­¤éœ€è¦æä¾› <code>draw()</code> å‡½æ•°çš„å®ç°ã€‚ç„¶è€Œï¼Œå®ç° <code>draw()</code> ç»†èŠ‚çš„è´£ä»»å¹¶ä¸åœ¨äº <code>ShapeModel</code> è‡ªèº«ã€‚ç›¸åï¼Œå®ƒåº”è¯¥å°†ç»˜åˆ¶è¯·æ±‚è½¬å‘åˆ°å®é™…çš„å®ç°ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡ä½¿ç”¨ç­–ç•¥è®¾è®¡æ¨¡å¼å’Œ <code>std::function</code> çš„æŠ½è±¡èƒ½åŠ›ï¼ˆï¼‰ã€‚è¿™ä¸€é€‰æ‹©å¾ˆå¥½åœ°è§£è€¦äº†ç»˜åˆ¶çš„å®ç°ç»†èŠ‚å’Œæ‰€æœ‰å¿…è¦çš„ç»˜åˆ¶æ•°æ®ï¼ˆé¢œè‰²ã€çº¹ç†ã€é€æ˜åº¦ç­‰ï¼‰ï¼Œè¿™äº›æ•°æ®å¯ä»¥å­˜å‚¨åœ¨å¯è°ƒç”¨å¯¹è±¡ä¸­ã€‚å› æ­¤ï¼Œ<code>ShapeModel</code> å­˜å‚¨äº†ä¸€ä¸ª <code>DrawStrategy</code> å®ä¾‹ï¼ˆï¼‰ï¼Œå¹¶åœ¨è§¦å‘ <code>draw()</code> å‡½æ•°æ—¶ä½¿ç”¨è¯¥ç­–ç•¥ï¼ˆï¼‰ã€‚</p>
<p>å°½ç®¡å¦‚æ­¤ï¼Œç­–ç•¥è®¾è®¡æ¨¡å¼å’Œ <code>std::function</code> å¹¶ä¸æ˜¯å”¯ä¸€çš„é€‰æ‹©ã€‚åœ¨ <code>ShapeModel</code> ç±»æ¨¡æ¿å†…ï¼Œä½ å¯ä»¥å®Œå…¨çµæ´»åœ°æŒ‰è‡ªå·±çš„æ–¹å¼å®ç°ç»˜åˆ¶ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨ <code>ShapeModel::draw()</code> å‡½æ•°ä¸­ï¼Œä½ å®šä¹‰äº†ç‰¹å®šå½¢çŠ¶ç±»å‹çš„çœŸæ­£éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥é€‰æ‹©è½¬å‘åˆ° <code>ShapeT</code> å½¢çŠ¶çš„æˆå‘˜å‡½æ•°ï¼ˆä¸å¿…å‘½åä¸º <code>draw()</code>ï¼ï¼‰ï¼Œæˆ–è€…è½¬å‘åˆ°å½¢çŠ¶çš„è‡ªç”±å‡½æ•°ã€‚åªéœ€ç¡®ä¿ä¸è¦å¯¹ <code>ShapeModel</code> æˆ– <code>ShapeConcept</code> æŠ½è±¡æ–½åŠ äººä¸ºçš„è¦æ±‚ã€‚æ— è®ºå“ªç§æ–¹å¼ï¼Œç”¨äºå®ä¾‹åŒ– <code>ShapeModel</code> çš„ä»»ä½•ç±»å‹éƒ½å¿…é¡»æ»¡è¶³è¿™äº›è¦æ±‚æ‰èƒ½ä½¿ä»£ç ç¼–è¯‘ã€‚</p>
<p>â€œ<code>ShapeModel</code> æ˜¯å¦æ˜¯å¯¹æœ€åˆçš„ <code>Circle</code> å’Œ <code>Square</code> ç±»çš„ä¸€ç§æ³›åŒ–ï¼Ÿé‚£äº›ä¹ŸæŒæœ‰ <code>std::function</code> å®ä¾‹çš„ç±»ï¼Ÿâ€ æ˜¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è®¤è¯†ã€‚å®é™…ä¸Šï¼Œå¯ä»¥è¯´ <code>ShapeModel</code> æ˜¯åˆå§‹å½¢çŠ¶ç±»çš„æ¨¡æ¿ç‰ˆæœ¬ã€‚å› æ­¤ï¼Œå®ƒæœ‰åŠ©äºå‡å°‘å¼•å…¥ç­–ç•¥è¡Œä¸ºæ‰€éœ€çš„æ ·æ¿ä»£ç ï¼Œå¹¶æ ¹æ® DRY åŸåˆ™æ”¹è¿›å®ç°ï¼ˆè§â€œæŒ‡å— 2ï¼šè®¾è®¡å˜åŒ–â€ï¼‰ã€‚ç„¶è€Œï¼Œä½ è·å¾—çš„å¥½å¤„æ›´å¤šï¼šä¾‹å¦‚ï¼Œç”±äº <code>ShapeModel</code> å·²ç»æ˜¯ä¸€ä¸ªç±»æ¨¡æ¿ï¼Œä½ å¯ä»¥è½»æ¾åœ°ä»å½“å‰çš„è¿è¡Œæ—¶ç­–ç•¥å®ç°åˆ‡æ¢åˆ°ç¼–è¯‘æ—¶ç­–ç•¥å®ç°ï¼ˆå³åŸºäºç­–ç•¥çš„è®¾è®¡ï¼›è§â€œæŒ‡å— 19ï¼šä½¿ç”¨ç­–ç•¥éš”ç¦»äº‹ç‰©çš„æ‰§è¡Œæ–¹å¼â€ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">ShapeT</span><span class="p">,</span> <span class="k">typename</span> <span class="n">DrawStrategy</span> <span class="o">&gt;</span>   
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ShapeModel</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ShapeConcept</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">ShapeModel</span><span class="p">(</span><span class="n">ShapeT</span> <span class="n">shape</span><span class="p">,</span> <span class="n">DrawStrategy</span> <span class="n">drawer</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">shape_</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">shape</span><span class="p">)},</span> 
</span></span><span class="line"><span class="cl">          <span class="n">drawer_</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">drawer</span><span class="p">)}</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span> <span class="n">drawer_</span><span class="p">(</span><span class="n">shape_</span><span class="p">);</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">ShapeT</span> <span class="n">shape_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="n">DrawStrategy</span> <span class="n">drawer_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>é™¤äº†åŸºäº <code>std::function</code>ï¼Œä½ è¿˜å¯ä»¥å‘ <code>ShapeModel</code> ç±»æ¨¡æ¿ä¼ é€’ä¸€ä¸ªé¢å¤–çš„æ¨¡æ¿å‚æ•°ï¼Œè¡¨ç¤ºç»˜åˆ¶ç­–ç•¥ï¼ˆï¼‰ã€‚è¿™ä¸ªæ¨¡æ¿å‚æ•°ç”šè‡³å¯ä»¥æœ‰ä¸€ä¸ªé»˜è®¤å€¼ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">DefaultDrawer</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">T</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="k">operator</span><span class="p">()(</span> <span class="n">T</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">obj</span> <span class="p">)</span> <span class="k">const</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">draw</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span> <span class="k">typename</span> <span class="n">ShapeT</span><span class="p">,</span> <span class="k">typename</span> <span class="n">DrawStrategy</span> <span class="o">=</span> <span class="n">DefaultDrawer</span> <span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ShapeModel</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ShapeConcept</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">ShapeModel</span><span class="p">(</span><span class="n">ShapeT</span> <span class="n">shape</span><span class="p">,</span> <span class="n">DrawStrategy</span> <span class="n">drawer</span> <span class="o">=</span> <span class="n">DefaultDrawer</span><span class="p">{})</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... å¦‚å‰æ‰€è¿° 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸ç›´æ¥å¯¹ <code>Circle</code> å’Œ <code>Square</code> ç±»åº”ç”¨åŸºäºç­–ç•¥çš„è®¾è®¡ç›¸æ¯”ï¼Œè¿™ç§ç¼–è¯‘æ—¶æ–¹æ³•åœ¨æ­¤ä¸Šä¸‹æ–‡ä¸­åªæœ‰å¥½å¤„è€Œæ²¡æœ‰ç¼ºç‚¹ã€‚é¦–å…ˆï¼Œç”±äºå‡å°‘äº†è¿è¡Œæ—¶é—´æ¥è°ƒç”¨ï¼ˆ<code>std::function</code> çš„é¢„æœŸæ€§èƒ½åŠ£åŠ¿ï¼‰ï¼Œä½ è·å¾—äº†æ€§èƒ½æå‡ã€‚å…¶æ¬¡ï¼Œä½ ä¸éœ€è¦é€šè¿‡æ·»åŠ æ¨¡æ¿å‚æ•°æ¥äººä¸ºåœ°æ‰©å…… <code>Circle</code>ã€<code>Square</code> å’Œæ‰€æœ‰å…¶ä»–å½¢çŠ¶ç±»ä»¥é…ç½®ç»˜åˆ¶è¡Œä¸ºã€‚ä½ ç°åœ¨åªéœ€è¦ä¸ºåŒ…è£…å™¨è¿™æ ·åšï¼Œè¿™ä¼šå¢å¼ºç»˜åˆ¶è¡Œä¸ºï¼Œå¹¶ä¸”åªåœ¨ä¸€ä¸ªåœ°æ–¹å®Œæˆï¼ˆè¿™å†æ¬¡å¾ˆå¥½åœ°éµå¾ªäº† DRY åŸåˆ™ï¼‰ã€‚ç¬¬ä¸‰ï¼Œä½ ä¸éœ€è¦é€šè¿‡å°†å¸¸è§„ç±»è½¬æ¢ä¸ºç±»æ¨¡æ¿è€Œåœ¨å¤´æ–‡ä»¶ä¸­å¢åŠ é¢å¤–çš„ä»£ç ã€‚åªæœ‰å·²ç»ä½œä¸ºç±»æ¨¡æ¿çš„ç²¾ç®€ç‰ˆ <code>ShapeModel</code> éœ€è¦é©»ç•™åœ¨å¤´æ–‡ä»¶ä¸­ã€‚å› æ­¤ï¼Œä½ é¿å…äº†åˆ›å»ºé¢å¤–çš„ä¾èµ–å…³ç³»ã€‚</p>
<p>â€œå“‡ï¼Œè¿™ä¸ªè®¾è®¡æ¨¡å¼è¶Šæ¥è¶Šå¥½äº†ã€‚è¿™çœŸæ˜¯ç»§æ‰¿å’Œæ¨¡æ¿çš„å¼ºå¤§ç»“åˆï¼â€ æ˜¯çš„ï¼Œæˆ‘å®Œå…¨åŒæ„ã€‚è¿™æ˜¯ç»“åˆè¿è¡Œæ—¶å’Œç¼–è¯‘æ—¶å¤šæ€çš„ä¸€ä¸ªèŒƒä¾‹ï¼š<code>ShapeConcept</code> åŸºç±»ä¸ºæ‰€æœ‰å¯èƒ½çš„ç±»å‹æä¾›äº†æŠ½è±¡ï¼Œè€Œæ´¾ç”Ÿçš„ <code>ShapeModel</code> ç±»æ¨¡æ¿ä¸ºç‰¹å®šå½¢çŠ¶ä»£ç æä¾›äº†ä»£ç ç”Ÿæˆã€‚æœ€ä»¤äººå°è±¡æ·±åˆ»çš„æ˜¯ï¼Œè¿™ç§ç»“åˆå¸¦æ¥äº†å·¨å¤§çš„ä¼˜åŠ¿ï¼Œå‡å°‘äº†ä¾èµ–å…³ç³»ã€‚</p>
<p>çœ‹çœ‹å›¾7-8ï¼Œå®ƒå±•ç¤ºäº†æˆ‘ä»¬å®ç°å¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼çš„ä¾èµ–å…³ç³»å›¾ã€‚åœ¨æ¶æ„çš„æœ€é«˜å±‚æ¬¡ä¸Šæ˜¯ <code>ShapeConcept</code> å’Œ <code>ShapeModel</code> ç±»ï¼Œå®ƒä»¬å…±åŒä»£è¡¨äº†å½¢çŠ¶çš„æŠ½è±¡ã€‚<code>Circle</code> å’Œ <code>Square</code> æ˜¯è¿™ç§æŠ½è±¡çš„å¯èƒ½å®ç°ï¼Œä½†ä»ç„¶å®Œå…¨ç‹¬ç«‹ï¼šæ²¡æœ‰ç»§æ‰¿å…³ç³»ï¼Œæ²¡æœ‰ç»„åˆï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚åªæœ‰ä¸ºç‰¹å®šç±»å‹çš„å½¢çŠ¶å’Œç‰¹å®šçš„ <code>DrawStrategy</code> å®ç°å®ä¾‹åŒ– <code>ShapeModel</code> ç±»æ¨¡æ¿æ—¶ï¼Œæ‰ä¼šå°†æ‰€æœ‰æ–¹é¢ç»“åˆèµ·æ¥ã€‚ç„¶è€Œï¼Œè¯·ç‰¹åˆ«æ³¨æ„ï¼Œæ‰€æœ‰è¿™ä¸€åˆ‡éƒ½å‘ç”Ÿåœ¨æˆ‘ä»¬æ¶æ„çš„æœ€ä½å±‚ï¼šæ¨¡æ¿ä»£ç åœ¨æ‰€æœ‰ä¾èµ–å…³ç³»å·²çŸ¥çš„åœ°æ–¹ç”Ÿæˆï¼Œå¹¶â€œæ³¨å…¥â€åˆ°æˆ‘ä»¬æ¶æ„çš„æ­£ç¡®å±‚çº§ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ç¡®å®æ‹¥æœ‰ä¸€ä¸ªé€‚å½“çš„æ¶æ„ï¼šæ‰€æœ‰ä¾èµ–å…³ç³»è¿æ¥éƒ½æœç€æ›´é«˜çš„å±‚çº§è¿è¡Œï¼Œå¹¶å‡ ä¹è‡ªåŠ¨éµå¾ªä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDIPï¼‰ã€‚</p>
<p><strong>åŠŸèƒ½å®ç°åï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±å®ç°ä»»ä½•æ‰€éœ€çš„ç»˜åˆ¶è¡Œä¸º</strong></p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡ä½¿ç”¨OpenGLï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//---- &lt;OpenGLDrawStrategy.h&gt; ---------------- 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Circle&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Square&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include </span><span class="cm">/* OpenGL å›¾å½¢åº“å¤´æ–‡ä»¶ */</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OpenGLDrawStrategy</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">explicit</span> <span class="n">OpenGLDrawStrategy</span><span class="p">(</span><span class="cm">/* ä¸ç»˜åˆ¶ç›¸å…³çš„å‚æ•° */</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="n">Circle</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">circle</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">operator</span><span class="p">()(</span><span class="n">Square</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">square</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="cm">/* ä¸ç»˜åˆ¶ç›¸å…³çš„æ•°æ®æˆå‘˜ï¼Œå¦‚é¢œè‰²ã€çº¹ç†ç­‰ */</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”±äº <code>OpenGLDrawStrategy</code> ä¸éœ€è¦ç»§æ‰¿è‡ªä»»ä½•åŸºç±»ï¼Œä½ å¯ä»¥è‡ªç”±åœ°æŒ‰éœ€å®ç°å®ƒã€‚å¦‚æœæ„¿æ„ï¼Œä½ å¯ä»¥å°†ç»˜åˆ¶åœ†å’Œç»˜åˆ¶æ­£æ–¹å½¢çš„å®ç°åˆå¹¶åˆ°ä¸€ä¸ªç±»ä¸­ã€‚è¿™ä¸ä¼šåˆ›å»ºä»»ä½•äººä¸ºçš„ä¾èµ–å…³ç³»ï¼Œç±»ä¼¼äºæˆ‘ä»¬åœ¨â€œæŒ‡å— 19ï¼šä½¿ç”¨ç­–ç•¥éš”ç¦»äº‹ç‰©çš„æ‰§è¡Œæ–¹å¼â€ä¸­æ‰€ç»å†çš„ï¼Œæˆ‘ä»¬å°†è¿™äº›åŠŸèƒ½åˆå¹¶åˆ°äº†åŸºç±»ä¸­ã€‚</p>
<p><strong>æ³¨æ„</strong></p>
<p>å°†ç»˜åˆ¶åœ†å’Œæ­£æ–¹å½¢ç»“åˆåœ¨ä¸€ä¸ªç±»ä¸­è¡¨ç¤ºçš„å†…å®¹ä¸ä»ä¸¤ä¸ªç­–ç•¥åŸºç±»ç»§æ‰¿ç±»æ˜¯ç›¸åŒçš„ã€‚åœ¨æ¶æ„çš„è¿™ä¸€å±‚é¢ä¸Šï¼Œè¿™ä¸ä¼šåˆ›å»ºä»»ä½•äººä¸ºçš„ä¾èµ–å…³ç³»ï¼Œä»…æ˜¯ä¸€ä¸ªå®ç°ç»†èŠ‚ã€‚å”¯ä¸€éœ€è¦éµå¾ªçš„çº¦å®šæ˜¯ä¸º <code>Circle</code> å’Œ <code>Square</code> æä¾›å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦ï¼ˆï¼‰ï¼Œå› ä¸ºè¿™æ˜¯ <code>ShapeModel</code> ç±»æ¨¡æ¿ä¸­å®šä¹‰çš„è°ƒç”¨çº¦å®šã€‚</p>
<p>åœ¨ <code>main()</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰ç»†èŠ‚ç»„åˆåœ¨ä¸€èµ·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Circle.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Square.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Shape.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;OpenGLDrawStrategy.h&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"> 
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">using</span> <span class="n">Shapes</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">ShapeConcept</span><span class="o">&gt;&gt;</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">using</span> <span class="n">CircleModel</span> <span class="o">=</span> <span class="n">ShapeModel</span><span class="o">&lt;</span><span class="n">Circle</span><span class="p">,</span> <span class="n">OpenGLDrawStrategy</span><span class="o">&gt;</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">    <span class="k">using</span> <span class="n">SquareModel</span> <span class="o">=</span> <span class="n">ShapeModel</span><span class="o">&lt;</span><span class="n">Square</span><span class="p">,</span> <span class="n">OpenGLDrawStrategy</span><span class="o">&gt;</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Shapes</span> <span class="n">shapes</span><span class="p">{};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆ›å»ºä¸€äº›å½¢çŠ¶ï¼Œæ¯ä¸ªéƒ½é…å¤‡äº†OpenGLç»˜åˆ¶ç­–ç•¥ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">shapes</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span> 
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">CircleModel</span><span class="o">&gt;</span><span class="p">(</span> 
</span></span><span class="line"><span class="cl">            <span class="n">Circle</span><span class="p">{</span><span class="mf">2.3</span><span class="p">},</span> <span class="n">OpenGLDrawStrategy</span><span class="p">(</span><span class="cm">/*...çº¢è‰²...*/</span><span class="p">)</span> <span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="n">shapes</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span> 
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">SquareModel</span><span class="o">&gt;</span><span class="p">(</span> 
</span></span><span class="line"><span class="cl">            <span class="n">Square</span><span class="p">{</span><span class="mf">1.2</span><span class="p">},</span> <span class="n">OpenGLDrawStrategy</span><span class="p">(</span><span class="cm">/*...ç»¿è‰²...*/</span><span class="p">)</span> <span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="n">shapes</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span> 
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">CircleModel</span><span class="o">&gt;</span><span class="p">(</span> 
</span></span><span class="line"><span class="cl">            <span class="n">Circle</span><span class="p">{</span><span class="mf">4.1</span><span class="p">},</span> <span class="n">OpenGLDrawStrategy</span><span class="p">(</span><span class="cm">/*...è“è‰²...*/</span><span class="p">)</span> <span class="p">)</span> <span class="p">);</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ç»˜åˆ¶æ‰€æœ‰å½¢çŠ¶ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="k">const</span><span class="o">&amp;</span> <span class="nl">shape</span> <span class="p">:</span> <span class="n">shapes</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">shape</span><span class="o">-&gt;</span><span class="n">draw</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åŒæ ·ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„å½¢çŠ¶å‘é‡ï¼ˆè¿™æ¬¡æ˜¯ <code>std::unique_ptr&lt;ShapeConcept&gt;</code> çš„å‘é‡ï¼‰ï¼ˆï¼‰ï¼Œç„¶åæ·»åŠ ä¸‰ä¸ªå½¢çŠ¶ã€‚åœ¨è°ƒç”¨ <code>std::make_unique()</code> æ—¶ï¼Œæˆ‘ä»¬å®ä¾‹åŒ–äº† <code>ShapeModel</code> ç±»ç”¨äº <code>Circle</code> å’Œ <code>Square</code>ï¼ˆç§°ä¸º <code>CircleModel</code> å’Œ <code>SquareModel</code> ä»¥æé«˜å¯è¯»æ€§ï¼‰ï¼Œå¹¶ä¼ é€’äº†å¿…è¦çš„ç»†èŠ‚ï¼ˆå…·ä½“çš„å½¢çŠ¶å’Œç›¸åº”çš„ <code>OpenGLDrawStrategy</code>ï¼‰ã€‚ä¹‹åï¼Œæˆ‘ä»¬èƒ½å¤Ÿä»¥æ‰€éœ€çš„æ–¹å¼ç»˜åˆ¶æ‰€æœ‰å½¢çŠ¶ã€‚</p>
<p>æ€»ä½“è€Œè¨€ï¼Œè¿™ç§æ–¹æ³•æä¾›äº†è®¸å¤šæ˜¾è‘—çš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li><strong>å…³æ³¨ç‚¹åˆ†ç¦»å’Œä»å½¢çŠ¶ç±»å‹ä¸­æå–å¤šæ€è¡Œä¸º</strong>ï¼šæ¶ˆé™¤äº†å¯¹å›¾å½¢åº“ç­‰çš„æ‰€æœ‰ä¾èµ–ï¼Œåˆ›å»ºäº†éå¸¸æ¾æ•£çš„è€¦åˆï¼Œå¹¶ä¸”å¾ˆå¥½åœ°éµå¾ªäº†å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰ã€‚</li>
<li><strong>å½¢çŠ¶ç±»å‹å˜å¾—æ›´ç®€å•ä¸”éå¤šæ€</strong>ï¼šå¯ä»¥è½»æ¾æ·»åŠ æ–°çš„å½¢çŠ¶ç±»å‹ï¼Œç”šè‡³å¯èƒ½æ˜¯ç¬¬ä¸‰æ–¹ç±»å‹ï¼Œå› ä¸ºä½ ä¸å†éœ€è¦ä¾µå…¥å¼åœ°ç»§æ‰¿è‡ª <code>Shape</code> åŸºç±»æˆ–åˆ›å»ºé€‚é…å™¨ï¼ˆè§â€œæŒ‡å— 24ï¼šä½¿ç”¨é€‚é…å™¨æ ‡å‡†åŒ–æ¥å£â€ï¼‰ã€‚å› æ­¤ï¼Œå®Œç¾åœ°éµå¾ªäº†å¼€é—­åŸåˆ™ï¼ˆOCPï¼‰ã€‚</li>
<li><strong>æ˜¾è‘—å‡å°‘é€šå¸¸ä¸ç»§æ‰¿ç›¸å…³çš„æ ·æ¿ä»£ç </strong>ï¼šåªéœ€åœ¨ä¸€ä¸ªåœ°æ–¹å®ç°ï¼Œè¿™å¾ˆå¥½åœ°éµå¾ªäº†DRYåŸåˆ™ã€‚</li>
<li><strong>ç”±äº <code>ShapeConcept</code> å’Œ <code>ShapeModel</code> ç±»å±äºä¸€èµ·å¹¶ä¸”å…±åŒå½¢æˆæŠ½è±¡</strong>ï¼Œæ›´å®¹æ˜“éµå¾ªä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDIPï¼‰ã€‚</li>
<li><strong>é€šè¿‡åˆ©ç”¨å¯ç”¨çš„ç±»æ¨¡æ¿å‡å°‘é—´æ¥è°ƒç”¨çš„æ•°é‡</strong>ï¼Œå¯ä»¥æé«˜æ€§èƒ½ã€‚</li>
</ul>
<p>æ­¤å¤–ï¼Œå¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼è¿˜æœ‰ä¸€ä¸ªæ›´ä¸ºä»¤äººå°è±¡æ·±åˆ»çš„ä¼˜åŠ¿ï¼šä½ å¯ä»¥éä¾µå…¥å¼åœ°ä¸ºä»»ä½•ç±»å‹é…å¤‡å¤šæ€è¡Œä¸ºã€‚çœŸçš„ï¼Œä»»ä½•ç±»å‹ï¼Œç”šè‡³æ˜¯åƒ <code>int</code> è¿™æ ·ç®€å•çš„ç±»å‹ã€‚ä¸ºäº†æ¼”ç¤ºè¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä»¥ä¸‹ä»£ç ç‰‡æ®µï¼Œå‡è®¾ <code>ShapeModel</code> é…å¤‡äº†ä¸€ä¸ªé»˜è®¤ç»˜åˆ¶å™¨ï¼ˆDefaultDrawerï¼‰ï¼Œè¯¥ç»˜åˆ¶å™¨æœŸæœ›è¢«åŒ…è£…çš„ç±»å‹æä¾›ä¸€ä¸ªè‡ªç”±çš„ <code>draw()</code> å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">draw</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... ç»˜åˆ¶ä¸€ä¸ªæ•´æ•°ï¼Œä¾‹å¦‚å°†å…¶æ‰“å°åˆ°å‘½ä»¤è¡Œ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">ShapeModel</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>   
</span></span><span class="line"><span class="cl">    <span class="n">shape</span><span class="o">-&gt;</span><span class="n">draw</span><span class="p">();</span>  <span class="c1">// ç»˜åˆ¶æ•´æ•°   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">EXIT_SUCCESS</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä¸º <code>int</code> æä¾›äº†ä¸€ä¸ªè‡ªç”±çš„ <code>draw()</code> å‡½æ•°ï¼ˆï¼‰ã€‚åœ¨ <code>main()</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ç°åœ¨å®ä¾‹åŒ–äº†ä¸€ä¸ª <code>ShapeModel</code> ç”¨äº <code>int</code>ã€‚è¿™ä¸€è¡Œä¼šç¼–è¯‘ï¼Œå› ä¸º <code>int</code> æ»¡è¶³æ‰€æœ‰è¦æ±‚ï¼šå®ƒæä¾›äº†ä¸€ä¸ªè‡ªç”±çš„ <code>draw()</code> å‡½æ•°ã€‚å› æ­¤ï¼Œåœ¨ä¸‹ä¸€è¡Œæˆ‘ä»¬å¯ä»¥â€œç»˜åˆ¶â€è¿™ä¸ªæ•´æ•°ã€‚</p>
<p>â€œä½ çœŸçš„å¸Œæœ›æˆ‘è¿™æ ·åšå—ï¼Ÿâ€ä½ çš±ç€çœ‰å¤´é—®é“ã€‚ä¸ï¼Œæˆ‘ä¸å»ºè®®ä½ åœ¨å®é™…é¡¹ç›®ä¸­è¿™æ ·åšã€‚è¯·å°†æ­¤è§†ä¸ºæŠ€æœ¯æ¼”ç¤ºï¼Œè€Œä¸æ˜¯æ¨èåšæ³•ã€‚ä½†æ˜¯å°½ç®¡å¦‚æ­¤ï¼Œè¿™ç¡®å®ä»¤äººå°è±¡æ·±åˆ»ï¼šæˆ‘ä»¬åˆšåˆšéä¾µå…¥å¼åœ°ä¸ºä¸€ä¸ª <code>int</code> é…å¤‡äº†å¤šæ€è¡Œä¸ºã€‚ç¡®å®ä»¤äººå°è±¡æ·±åˆ»ï¼</p>
<p><strong>å¤–éƒ¨å¤šæ€ä¸é€‚é…å™¨çš„æ¯”è¾ƒ</strong></p>
<p>â€œæ—¢ç„¶ä½ æåˆ°é€‚é…å™¨è®¾è®¡æ¨¡å¼ï¼Œæˆ‘è§‰å¾—å®ƒä¸å¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼éå¸¸ç›¸ä¼¼ã€‚è¿™ä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿâ€ å¾ˆå¥½çš„é—®é¢˜ï¼ä½ æå‡ºäº†åŸå§‹è®ºæ–‡ä¸­Cleelandã€Schmidtå’ŒHarrisonä¹Ÿè®¨è®ºè¿‡çš„é—®é¢˜ã€‚æ˜¯çš„ï¼Œè¿™ä¸¤ç§è®¾è®¡æ¨¡å¼ç¡®å®éå¸¸ç›¸ä¼¼ï¼Œä½†æœ‰ä¸€ä¸ªéå¸¸æ˜æ˜¾çš„åŒºåˆ«ï¼šè™½ç„¶é€‚é…å™¨è®¾è®¡æ¨¡å¼ä¸“æ³¨äºæ ‡å‡†åŒ–æ¥å£ï¼Œå¹¶ä½¿ç±»å‹æˆ–å‡½æ•°é€‚åº”ç°æœ‰çš„æ¥å£ï¼Œä½†å¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼åˆ›å»ºä¸€ä¸ªæ–°çš„å¤–éƒ¨å±‚æ¬¡ç»“æ„ï¼Œä»ä¸€ç»„ç›¸å…³çš„éå¤šæ€ç±»å‹ä¸­è¿›è¡ŒæŠ½è±¡ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ å°†æŸäº›ä¸œè¥¿é€‚åº”ç°æœ‰æ¥å£ï¼Œåˆ™ï¼ˆå¾ˆå¯èƒ½ï¼‰åº”ç”¨çš„æ˜¯é€‚é…å™¨è®¾è®¡æ¨¡å¼ã€‚ç„¶è€Œï¼Œå¦‚æœä½ ä¸ºäº†ä»¥å¤šæ€æ–¹å¼å¤„ç†ä¸€ç»„ç°æœ‰ç±»å‹è€Œåˆ›å»ºä¸€ä¸ªæ–°çš„æŠ½è±¡ï¼Œåˆ™ï¼ˆæœ€æœ‰å¯èƒ½ï¼‰åº”ç”¨çš„æ˜¯å¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼ã€‚</p>
<p><strong>åˆ†æå¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼çš„ä¸è¶³</strong></p>
<p>â€œæˆ‘æ„Ÿè§‰ä½ éå¸¸å–œæ¬¢å¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼ï¼Œå¯¹å—ï¼Ÿâ€ä½ å¯èƒ½ä¼šè¿™ä¹ˆæƒ³ã€‚æ˜¯çš„ï¼Œç¡®å®å¦‚æ­¤ï¼Œæˆ‘å¯¹è¿™ç§è®¾è®¡æ¨¡å¼æ„Ÿåˆ°éå¸¸æƒŠè®¶ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™ç§è®¾è®¡æ¨¡å¼æ˜¯å®ç°æ¾è€¦åˆçš„å…³é”®ï¼Œé—æ†¾çš„æ˜¯å®ƒå¹¶ä¸å¹¿ä¸ºäººçŸ¥ã€‚ä¹Ÿè®¸æ˜¯å› ä¸ºè®¸å¤šå¼€å‘è€…å¹¶æ²¡æœ‰å®Œå…¨æ¥å—å…³æ³¨ç‚¹åˆ†ç¦»çš„åŸåˆ™ï¼Œå¹¶å€¾å‘äºå°†æ‰€æœ‰å†…å®¹éƒ½æ”¾å…¥å°‘æ•°å‡ ä¸ªç±»ä¸­ã€‚å°½ç®¡æˆ‘å¯¹å¤–éƒ¨å¤šæ€å……æ»¡çƒ­æƒ…ï¼Œä½†æˆ‘ä¸æƒ³ç»™äººç•™ä¸‹è¿™ç§è®¾è®¡æ¨¡å¼å®Œç¾æ— ç¼ºçš„å°è±¡ã€‚ä¸ï¼Œæ­£å¦‚å¤šæ¬¡æåˆ°çš„ï¼Œæ¯ä¸ªè®¾è®¡éƒ½æœ‰å…¶ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œå¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼ä¹Ÿä¸ä¾‹å¤–ã€‚</p>
<p>å¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼çš„ä¸»è¦ä¸è¶³åœ¨äºå®ƒå¹¶æ²¡æœ‰çœŸæ­£æ»¡è¶³ç®€æ´å’Œç®€å•è§£å†³æ–¹æ¡ˆçš„æœŸæœ›ï¼Œå°¤å…¶æ˜¯åŸºäºå€¼è¯­ä¹‰çš„è§£å†³æ–¹æ¡ˆã€‚å®ƒä¸ä¼šå‡å°‘æŒ‡é’ˆçš„ä½¿ç”¨ï¼Œä¸ä¼šå‡å°‘æ‰‹åŠ¨åˆ†é…çš„æ•°é‡ï¼Œä¹Ÿä¸ä¼šé™ä½ç»§æ‰¿å±‚æ¬¡ç»“æ„çš„æ•°é‡ï¼Œæ›´ä¸ä¼šç®€åŒ–ç”¨æˆ·ä»£ç ã€‚ç›¸åï¼Œç”±äºéœ€è¦æ˜¾å¼åœ°å®ä¾‹åŒ– <code>ShapeModel</code> ç±»ï¼Œç”¨æˆ·ä»£ç ä¼šæ˜¾å¾—ç¨å¾®å¤æ‚ä¸€äº›ã€‚ç„¶è€Œï¼Œå¦‚æœä½ è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªä¸¥é‡çš„ç¼ºç‚¹ï¼Œæˆ–è€…ä½ åœ¨æƒ³â€œè¿™åº”è¯¥ä»¥æŸç§æ–¹å¼è‡ªåŠ¨åŒ–â€ï¼Œé‚£ä¹ˆæˆ‘æœ‰ä¸€ä¸ªå¥½æ¶ˆæ¯ï¼šåœ¨â€œæŒ‡å— 32ï¼šè€ƒè™‘ç”¨ç±»å‹æ“¦é™¤æ›¿ä»£ç»§æ‰¿å±‚æ¬¡ç»“æ„â€ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ä¸€ç§ç°ä»£ C++ è§£å†³æ–¹æ¡ˆï¼Œå®ƒå¯ä»¥ä¼˜é›…åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘è¿˜æƒ³æé†’ä¸¤ç‚¹éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š</p>
<p><strong>é€‚å½“çš„æŠ½è±¡</strong>ï¼šå¤–éƒ¨å¤šæ€çš„åº”ç”¨å¹¶ä¸ä¼šå…é™¤ä½ æ€è€ƒé€‚å½“æŠ½è±¡çš„è´£ä»»ã€‚<code>ShapeConcept</code> åŸºç±»åŒæ ·è¦éµå¾ªæ¥å£éš”ç¦»åŸåˆ™ï¼ˆISPï¼‰ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å°†å¤–éƒ¨å¤šæ€åº”ç”¨åˆ°â€œæŒ‡å— 3ï¼šé€šè¿‡åˆ†ç¦»æ¥å£é¿å…äººä¸ºè€¦åˆâ€ä¸­çš„ <code>Document</code> ç¤ºä¾‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DocumentConcept</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="o">~</span><span class="n">Document</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">exportToJSON</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">ByteStream</span><span class="o">&amp;</span> <span class="n">bs</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DocumentT</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DocumentModel</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> 
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">exportToJSON</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">ByteStream</span><span class="o">&amp;</span> <span class="n">bs</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">    <span class="n">DocumentT</span> <span class="n">document_</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>DocumentConcept</code> ç±»æ‰®æ¼”äº† <code>ShapeConcept</code> åŸºç±»çš„è§’è‰²ï¼Œè€Œ <code>DocumentModel</code> ç±»æ¨¡æ¿åˆ™æ‰®æ¼”äº† <code>ShapeModel</code> ç±»æ¨¡æ¿çš„è§’è‰²ã€‚ç„¶è€Œï¼Œè¿™ä¸ªå¤–éƒ¨åŒ–çš„å±‚æ¬¡ç»“æ„ä¸åŸå§‹å±‚æ¬¡ç»“æ„å­˜åœ¨åŒæ ·çš„é—®é¢˜ï¼šå¯¹äºåªéœ€è¦ <code>exportToJSON()</code> åŠŸèƒ½çš„æ‰€æœ‰ä»£ç æ¥è¯´ï¼Œå®ƒå¼•å…¥äº†å¯¹ <code>ByteStream</code> çš„äººä¸ºä¾èµ–ã€‚æ­£ç¡®çš„åšæ³•æ˜¯é€šè¿‡å°†æ¥å£åˆ†ç¦»ä¸º JSON å¯¼å‡ºå’Œåºåˆ—åŒ–è¿™ä¸¤ä¸ªæ­£äº¤æ–¹é¢æ¥åˆ†ç¦»å…³æ³¨ç‚¹ã€‚</p>
<p><strong>è¯­ä¹‰ä¸€è‡´æ€§</strong>ï¼š</p>
<p>å¤–éƒ¨å¤šæ€ï¼Œå°±åƒé€‚é…å™¨è®¾è®¡æ¨¡å¼ä¸€æ ·ï¼Œä½¿å¾—åŒ…è£…é‚£äº›ä¸ç¬¦åˆè¯­ä¹‰é¢„æœŸçš„ç±»å‹å˜å¾—éå¸¸å®¹æ˜“ã€‚ç±»ä¼¼äºâ€œæŒ‡å— 24ï¼šä½¿ç”¨é€‚é…å™¨æ ‡å‡†åŒ–æ¥å£â€ä¸­çš„é¸­å­ç±»å‹ç¤ºä¾‹ï¼Œæˆ‘ä»¬å‡è£…ç«é¸¡æ˜¯ä¸€åªé¸­å­ï¼Œæˆ‘ä»¬ä¹Ÿå‡è£… <code>int</code> æ˜¯ä¸€ä¸ªå½¢çŠ¶ã€‚ä¸ºäº†æ»¡è¶³è¦æ±‚ï¼Œæˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯æä¾›ä¸€ä¸ªè‡ªç”±çš„ <code>draw()</code> å‡½æ•°ã€‚è™½ç„¶è¿™å¾ˆç®€å•ï¼Œä½†å¯èƒ½è¿‡äºç®€å•ã€‚</p>
<p>å› æ­¤ï¼Œè¯·è®°ä½ç”¨äºå®ä¾‹åŒ– <code>ShapeModel</code> ç±»æ¨¡æ¿çš„ç±»ï¼ˆå¦‚ <code>Circle</code>ã€<code>Square</code> ç­‰ï¼‰å¿…é¡»éµå®ˆé‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLSPï¼‰ã€‚æ¯•ç«Ÿï¼Œ<code>ShapeModel</code> ç±»åªæ˜¯ä¸€ä¸ªåŒ…è£…å™¨ï¼Œå¹¶å°† <code>ShapeConcept</code> ç±»å®šä¹‰çš„è¦æ±‚ä¼ é€’ç»™å…·ä½“çš„å½¢çŠ¶ã€‚</p>
<p>å› æ­¤ï¼Œå…·ä½“çš„å½¢çŠ¶è´Ÿè´£æ­£ç¡®å®ç°é¢„æœŸçš„è¡Œä¸ºã€‚ä»»ä½•æœªèƒ½å®Œå…¨æ»¡è¶³è¿™äº›æœŸæœ›çš„æƒ…å†µéƒ½å¯èƒ½å¯¼è‡´ï¼ˆæ½œåœ¨çš„å¾®å¦™ï¼‰è¡Œä¸ºå¼‚å¸¸ã€‚ä¸å¹¸çš„æ˜¯ï¼Œç”±äºè¿™äº›è¦æ±‚å·²ç»è¢«å¤–éƒ¨åŒ–ï¼Œæ²Ÿé€šé¢„æœŸè¡Œä¸ºå˜å¾—æ›´åŠ å›°éš¾ã€‚</p>
<p>ç„¶è€Œï¼Œåœ¨ <code>int</code> ç¤ºä¾‹ä¸­ï¼Œå¯èƒ½æ˜¯æˆ‘ä»¬è‡ªå·±é€‰æ‹©çš„æŠ½è±¡æœ‰é—®é¢˜ã€‚æˆ–è®¸ <code>ShapeConcept</code> åŸºç±»å¹¶ä¸èƒ½å¾ˆå¥½åœ°ä»£è¡¨å½¢çŠ¶çš„æŠ½è±¡ã€‚åˆç†åœ°è¯´ï¼Œå½¢çŠ¶ä¸ä»…ä»…æ˜¯ç»˜åˆ¶ã€‚ä¹Ÿè®¸æˆ‘ä»¬åº”è¯¥å°†æŠ½è±¡å‘½åä¸º <code>Drawable</code>ï¼Œè¿™æ · LSP å°±ä¼šè¢«æ»¡è¶³ã€‚ä¹Ÿè®¸ä¸æ˜¯ã€‚æœ€ç»ˆï¼Œä¸€åˆ‡éƒ½å½’ç»“äºæŠ½è±¡çš„é€‰æ‹©ã€‚è¿™è®©æˆ‘ä»¬å›åˆ°ç¬¬ 2 ç« çš„ä¸»é¢˜ï¼šâ€œæ„å»ºæŠ½è±¡çš„è‰ºæœ¯â€ã€‚è¿™å¹¶ä¸å®¹æ˜“ï¼Œä½†ä¹Ÿè®¸è¿™äº›ä¾‹å­è¡¨æ˜å®ƒæ˜¯é‡è¦çš„ï¼Œéå¸¸é‡è¦ã€‚è¿™å¯èƒ½æ˜¯è½¯ä»¶è®¾è®¡çš„æœ¬è´¨ã€‚</p>
<p>æ€»ä¹‹ï¼Œå°½ç®¡å¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼å¯èƒ½æ— æ³•æ»¡è¶³ä½ å¯¹ç®€å•æˆ–åŸºäºå€¼çš„è§£å†³æ–¹æ¡ˆçš„æœŸæœ›ï¼Œä½†å®ƒä»ç„¶æ˜¯å®ç°è½¯ä»¶å®ä½“è§£è€¦çš„é‡è¦ä¸€æ­¥ã€‚ä»å‡å°‘ä¾èµ–çš„è§’åº¦æ¥çœ‹ï¼Œè¿™ç§è®¾è®¡æ¨¡å¼ä¼¼ä¹æ˜¯æ¾è€¦åˆçš„å…³é”®æˆåˆ†ï¼Œå¹¶ä¸”æ˜¯å…³æ³¨ç‚¹åˆ†ç¦»åŠ›é‡çš„ä¸€ä¸ªç»ä½³ç¤ºä¾‹ã€‚</p>
<p>å®ƒè¿˜ç»™æˆ‘ä»¬ä¸€ä¸ªé‡è¦å¯ç¤ºï¼šä½¿ç”¨è¿™ç§è®¾è®¡æ¨¡å¼ï¼Œä½ å¯ä»¥éä¾µå…¥å¼åœ°ä¸ºä»»ä½•ç±»å‹é…å¤‡å¤šæ€è¡Œä¸ºï¼ˆä¾‹å¦‚è™šæ‹Ÿå‡½æ•°ï¼‰ï¼Œä»è€Œä½¿ä»»ä½•ç±»å‹éƒ½å¯ä»¥è¡¨ç°å¾—å¤šæ€ï¼Œç”šè‡³æ˜¯ä¸€ä¸ªç®€å•çš„å€¼ç±»å‹å¦‚ <code>int</code>ã€‚è¿™ä¸€è®¤è¯†å¼€å¯äº†ä¸€ä¸ªå…¨æ–°çš„ã€ä»¤äººå…´å¥‹çš„è®¾è®¡ç©ºé—´ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« ç»§ç»­æ¢ç´¢ã€‚</p>
<p><strong>æœ¬èŠ‚æ€»ç»“</strong></p>
<ul>
<li>åº”ç”¨å¤–éƒ¨å¤šæ€è®¾è®¡æ¨¡å¼çš„ç›®çš„æ˜¯æ”¯æŒå¯¹éå¤šæ€ç±»å‹çš„å¤šæ€å¤„ç†ã€‚</li>
<li>å°†å¤–éƒ¨å¤šæ€æ€§è®¾è®¡æ¨¡å¼è§†ä¸ºå®ç°æ¾è€¦åˆçš„å…³é”®ã€‚</li>
<li>åˆ©ç”¨å¤–éƒ¨åŒ–ç»§æ‰¿å±‚æ¬¡ç»“æ„çš„è®¾è®¡çµæ´»æ€§ã€‚</li>
<li>ç†è§£å¤–éƒ¨å¤šæ€å’Œé€‚é…å™¨ä¹‹é—´çš„åŒºåˆ«ã€‚</li>
<li>é€‰æ‹©éä¾µå…¥æ€§è§£å†³æ–¹æ¡ˆè€Œä¸æ˜¯ä¾µå…¥æ€§è§£å†³æ–¹æ¡ˆã€‚</li>
</ul>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            å›½çª–1573 - 
        
        2025 AKaKLya
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.0f4e44504cf40ab34cf124bb8fa71a5615b897b6d3841a1d2857b604319620c7.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
