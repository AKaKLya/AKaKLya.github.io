<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="éœ€è¦ä¼šä¸€äº›æ¨¡æ¿. ç±»å‹åˆ«å æ¨¡æ¿ç±»ç‰‡æ®µ: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 template&lt;typename InElementType, typename InAllocatorType&gt; class TArray { template &lt;typename OtherInElementType, typename OtherAllocator&gt; friend class TArray; public: using SizeType = typename InAllocatorType::SizeType ; using ElementType = InElementType; using AllocatorType = InAllocatorType; private: using USizeType = typename std::make_unsigned_t&lt;SizeType&gt;; public: using ElementAllocatorType = std::conditional_t&lt; AllocatorType::NeedsElementType, typename AllocatorType::template ForElementType&lt;ElementType&gt;, typename AllocatorType::ForAnyElementType &gt;; static_assert(std::is_signed_v&lt;SizeType&gt;, &#34;TArray only supports signed index types&#34;); } ä½¿ç”¨TArrayå­˜æ”¾Actoræ—¶ï¼Œé»˜è®¤çš„åˆ«åç±»å‹:">
<title>TArray</title>

<link rel='canonical' href='http://localhost:1313/p/tarray/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="TArray">
<meta property='og:description' content="éœ€è¦ä¼šä¸€äº›æ¨¡æ¿. ç±»å‹åˆ«å æ¨¡æ¿ç±»ç‰‡æ®µ: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 template&lt;typename InElementType, typename InAllocatorType&gt; class TArray { template &lt;typename OtherInElementType, typename OtherAllocator&gt; friend class TArray; public: using SizeType = typename InAllocatorType::SizeType ; using ElementType = InElementType; using AllocatorType = InAllocatorType; private: using USizeType = typename std::make_unsigned_t&lt;SizeType&gt;; public: using ElementAllocatorType = std::conditional_t&lt; AllocatorType::NeedsElementType, typename AllocatorType::template ForElementType&lt;ElementType&gt;, typename AllocatorType::ForAnyElementType &gt;; static_assert(std::is_signed_v&lt;SizeType&gt;, &#34;TArray only supports signed index types&#34;); } ä½¿ç”¨TArrayå­˜æ”¾Actoræ—¶ï¼Œé»˜è®¤çš„åˆ«åç±»å‹:">
<meta property='og:url' content='http://localhost:1313/p/tarray/'>
<meta property='og:site_name' content='AKaKLya'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2000-01-21T23:31:36&#43;08:00'/><meta property='article:modified_time' content='2000-01-21T23:31:36&#43;08:00'/>
<meta name="twitter:title" content="TArray">
<meta name="twitter:description" content="éœ€è¦ä¼šä¸€äº›æ¨¡æ¿. ç±»å‹åˆ«å æ¨¡æ¿ç±»ç‰‡æ®µ: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 template&lt;typename InElementType, typename InAllocatorType&gt; class TArray { template &lt;typename OtherInElementType, typename OtherAllocator&gt; friend class TArray; public: using SizeType = typename InAllocatorType::SizeType ; using ElementType = InElementType; using AllocatorType = InAllocatorType; private: using USizeType = typename std::make_unsigned_t&lt;SizeType&gt;; public: using ElementAllocatorType = std::conditional_t&lt; AllocatorType::NeedsElementType, typename AllocatorType::template ForElementType&lt;ElementType&gt;, typename AllocatorType::ForAnyElementType &gt;; static_assert(std::is_signed_v&lt;SizeType&gt;, &#34;TArray only supports signed index types&#34;); } ä½¿ç”¨TArrayå­˜æ”¾Actoræ—¶ï¼Œé»˜è®¤çš„åˆ«åç±»å‹:">
  


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/d_hu15622052934649275245.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">AKaKLya</a></h1>
            <h2 class="site-description">ç‚¹å‡»</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/CaiJimmy/hugo-theme-stack'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#ç±»å‹åˆ«å">ç±»å‹åˆ«å</a>
      <ol>
        <li><a href="#allocatortype">AllocatorType</a></li>
        <li><a href="#sizetype">SizeType</a></li>
        <li><a href="#elementtype">ElementType</a></li>
        <li><a href="#usizetype">USizeType</a></li>
        <li><a href="#elementallocatortype">ElementAllocatorType</a></li>
        <li><a href="#static_assert">static_assert</a></li>
        <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
      </ol>
    </li>
    <li><a href="#æ„é€ å‡½æ•°">æ„é€ å‡½æ•°</a>
      <ol>
        <li><a href="#é»˜è®¤æ„é€ ">é»˜è®¤æ„é€ </a></li>
        <li><a href="#ä»åŸå§‹æ•°ç»„æ„é€ ">ä»åŸå§‹æ•°ç»„æ„é€ </a>
          <ol>
            <li><a href="#copytoempty">CopyToEmpty</a></li>
          </ol>
        </li>
        <li><a href="#ä»tarrayviewæ„é€ ">ä»TArrayViewæ„é€ </a></li>
        <li><a href="#åˆå§‹åŒ–åˆ—è¡¨">åˆå§‹åŒ–åˆ—è¡¨</a></li>
        <li><a href="#è·¨åˆ†é…å™¨">è·¨åˆ†é…å™¨</a></li>
        <li><a href="#æ‹·è´æ„é€ ">æ‹·è´æ„é€ </a></li>
        <li><a href="#å¸¦é¢„åˆ†é…å†…å­˜çš„æ‹·è´æ„é€ ">å¸¦é¢„åˆ†é…å†…å­˜çš„æ‹·è´æ„é€ </a></li>
        <li><a href="#ç§»åŠ¨æ„é€ ">ç§»åŠ¨æ„é€ </a>
          <ol>
            <li><a href="#moveorcpoy">MoveOrCpoy</a></li>
          </ol>
        </li>
        <li><a href="#ææ„">ææ„</a></li>
        <li><a href="#æ€»ç»“-2">æ€»ç»“</a></li>
      </ol>
    </li>
    <li><a href="#å¢åˆ æ”¹æŸ¥">å¢åˆ æ”¹æŸ¥</a>
      <ol>
        <li><a href="#pop">Pop</a>
          <ol>
            <li><a href="#movetempifpossible-å³å€¼å¼•ç”¨"><code>MoveTempIfPossible</code> å³å€¼å¼•ç”¨</a></li>
            <li><a href="#å·¦å€¼å³å€¼">å·¦å€¼å³å€¼</a></li>
          </ol>
        </li>
        <li><a href="#add">Add</a>
          <ol>
            <li><a href="#emplace"><strong>Emplace</strong></a></li>
            <li><a href="#fprivatetoken">FPrivateToken</a></li>
          </ol>
        </li>
        <li><a href="#remove">Remove</a></li>
        <li><a href="#removeat">RemoveAt</a>
          <ol>
            <li><a href="#destructitem">DestructItem</a></li>
          </ol>
        </li>
        <li><a href="#top">Top</a>
          <ol>
            <li><a href="#last">Last</a></li>
          </ol>
        </li>
        <li><a href="#sort">Sort</a>
          <ol>
            <li><a href="#tdereferencewrapperçš„ç‰¹åŒ–"><code>TDereferenceWrapper</code>çš„ç‰¹åŒ–</a></li>
          </ol>
        </li>
        <li><a href="#find">Find</a>
          <ol>
            <li><a href="#restrict">RESTRICT</a></li>
          </ol>
        </li>
        <li><a href="#findbypredicate">FindByPredicate</a>
          <ol>
            <li><a href="#invoke">Invoke</a></li>
            <li><a href="#forward">Forward</a></li>
          </ol>
        </li>
        <li><a href="#reserve">Reserve</a></li>
        <li><a href="#init">Init</a></li>
      </ol>
    </li>
    <li><a href="#å…¶å®ƒå‡½æ•°">å…¶å®ƒå‡½æ•°</a>
      <ol>
        <li><a href="#toptional">TOptional</a></li>
        <li><a href="#getdata">GetData</a></li>
        <li><a href="#gettypesize">GetTypeSize</a></li>
        <li><a href="#getslack">GetSlack</a></li>
        <li><a href="#checkinvariants">CheckInvariants</a></li>
        <li><a href="#rangecheck">RangeCheck</a></li>
        <li><a href="#isvalidindex">IsValidIndex</a></li>
        <li><a href="#numbytes">NumBytes</a></li>
        <li><a href="#getallocatedsize">GetAllocatedSize</a></li>
        <li><a href="#é‡è½½">é‡è½½[]</a>
          <ol>
            <li><a href="#getdata-1"><strong>GetData</strong></a></li>
            <li><a href="#ue_lifetimebound-å®"><strong>UE_LIFETIMEBOUND å®</strong></a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/tarray/">TArray</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jan 21, 2000</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 34 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p><strong>éœ€è¦ä¼šä¸€äº›æ¨¡æ¿.</strong></p>
<h2 id="ç±»å‹åˆ«å">ç±»å‹åˆ«å
</h2><p>æ¨¡æ¿ç±»ç‰‡æ®µ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">InElementType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">InAllocatorType</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TArray</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">OtherInElementType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">OtherAllocator</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="k">friend</span> <span class="k">class</span> <span class="nc">TArray</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">using</span> <span class="n">SizeType</span>      <span class="o">=</span> <span class="k">typename</span> <span class="n">InAllocatorType</span><span class="o">::</span><span class="n">SizeType</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">using</span> <span class="n">ElementType</span>   <span class="o">=</span> <span class="n">InElementType</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">using</span> <span class="n">AllocatorType</span> <span class="o">=</span> <span class="n">InAllocatorType</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">using</span> <span class="n">USizeType</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unsigned_t</span><span class="o">&lt;</span><span class="n">SizeType</span><span class="o">&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">using</span> <span class="n">ElementAllocatorType</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">conditional_t</span><span class="o">&lt;</span>
</span></span><span class="line"><span class="cl">		<span class="n">AllocatorType</span><span class="o">::</span><span class="n">NeedsElementType</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="k">typename</span> <span class="n">AllocatorType</span><span class="o">::</span><span class="k">template</span> <span class="n">ForElementType</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="o">&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="k">typename</span> <span class="n">AllocatorType</span><span class="o">::</span><span class="n">ForAnyElementType</span>
</span></span><span class="line"><span class="cl">	<span class="o">&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_signed_v</span><span class="o">&lt;</span><span class="n">SizeType</span><span class="o">&gt;</span><span class="p">,</span> <span class="s">&#34;TArray only supports signed index types&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨TArrayå­˜æ”¾Actoræ—¶ï¼Œé»˜è®¤çš„åˆ«åç±»å‹:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">	<span class="k">using</span> <span class="n">Array</span> <span class="o">=</span> <span class="n">TArray</span><span class="o">&lt;</span><span class="n">AActor</span><span class="o">*&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//signed int 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">using</span> <span class="n">ArraySizeType</span> <span class="o">=</span> <span class="n">Array</span><span class="o">::</span><span class="n">SizeType</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//AActor*
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">using</span> <span class="n">ArrayElementType</span> <span class="o">=</span> <span class="n">Array</span><span class="o">::</span><span class="n">ElementType</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// TSizedDefaultAllocator&lt;32&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">using</span> <span class="n">ArrayAllocatorType</span> <span class="o">=</span> <span class="n">Array</span><span class="o">::</span><span class="n">AllocatorType</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1">// TSizedHeapAllocator&lt;32&gt;::ForElementType&lt;AActor*&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">using</span> <span class="n">ArrayElementAllocatorType</span> <span class="o">=</span> <span class="n">Array</span><span class="o">::</span><span class="n">ElementAllocatorType</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1">// TSizedHeapAllocator&lt;32&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">using</span> <span class="n">ArrayAllocatorTypeTypedef</span> <span class="o">=</span> <span class="n">ArrayAllocatorType</span><span class="o">::</span><span class="n">Typedef</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	 <span class="c1">//signed int 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">using</span> <span class="n">ArrayAllocatorSizeType</span> <span class="o">=</span> <span class="n">ArrayAllocatorType</span><span class="o">::</span><span class="n">SizeType</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="allocatortype">AllocatorType
</h3><p>TArray::AllocatorType é»˜è®¤åˆ†é…å™¨æ˜¯ TSizedDefaultAllocator&lt;32&gt;</p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šå®šä¹‰å®¹å™¨ä½¿ç”¨çš„ <strong>å†…å­˜åˆ†é…å™¨ç±»å‹</strong>ï¼ˆå¦‚ <code>FDefaultAllocator</code>ã€<code>TInlineAllocator</code>ï¼‰ã€‚</li>
<li><strong>è®¾è®¡åŸå› </strong>ï¼š
å…è®¸ç”¨æˆ·è‡ªå®šä¹‰å†…å­˜ç®¡ç†ç­–ç•¥ï¼ˆå †åˆ†é…ã€æ ˆåˆ†é…ã€å†…å­˜æ± ç­‰ï¼‰ã€‚</li>
</ul>
<h3 id="sizetype">SizeType
</h3><ul>
<li><strong>ä½œç”¨</strong>ï¼šå®šä¹‰å®¹å™¨ä¸­ <strong>ç´¢å¼•å’Œå¤§å°</strong> çš„ç±»å‹ï¼ˆå¦‚ <code>int32</code>ã€<code>int64</code>ï¼‰ã€‚</li>
<li><strong>è®¾è®¡åŸå› </strong>ï¼š
ç”±åˆ†é…å™¨ <code>InAllocatorType</code> å†³å®šï¼Œå…è®¸ä¸åŒåˆ†é…å™¨æ ¹æ®éœ€æ±‚é€‰æ‹©ä¸åŒå¤§å°çš„æ•´æ•°ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œå°å†…å­˜å®¹å™¨ç”¨ <code>int32</code>ï¼Œå¤§å†…å­˜ç”¨ <code>int64</code>ï¼‰ã€‚</li>
<li><strong>ç¤ºä¾‹</strong>ï¼š
è‹¥åˆ†é…å™¨å®šä¹‰ä¸º <code>TSizedHeapAllocator&lt;32&gt;</code>ï¼Œåˆ™ <code>SizeType</code> å¯èƒ½æ˜¯ <code>int32</code>ã€‚</li>
</ul>
<p>SizeTypeæ¥è‡ªäºåˆ†é…å™¨çš„SizeTypeï¼Œå› ä¸ºé»˜è®¤åˆ†é…å™¨ä½¿ç”¨ TSizedDefaultAllocator&lt;32&gt;ï¼Œæ‰€ä»¥è¦å»æ‰¾TSizedDefaultAllocatoré‡Œé¢çš„SizeTypeæ˜¯ä»€ä¹ˆ.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">using</span> <span class="n">SizeType</span>      <span class="o">=</span> <span class="k">typename</span> <span class="n">InAllocatorType</span><span class="o">::</span><span class="n">SizeType</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//----------åˆ†é…å™¨ç±»-------//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span> <span class="o">&lt;</span><span class="kt">int</span> <span class="n">IndexSize</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">TSizedDefaultAllocator</span> 
</span></span><span class="line"><span class="cl"><span class="o">:</span> <span class="k">public</span> <span class="n">TSizedHeapAllocator</span><span class="o">&lt;</span><span class="n">IndexSize</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span> <span class="k">public</span><span class="o">:</span> <span class="k">typedef</span> <span class="n">TSizedHeapAllocator</span><span class="o">&lt;</span><span class="n">IndexSize</span><span class="o">&gt;</span> <span class="n">Typedef</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="kt">int</span> <span class="n">IndexSize</span><span class="p">,</span> <span class="k">typename</span> <span class="n">BaseMallocType</span> <span class="o">=</span> <span class="n">FMemory</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TSizedHeapAllocator</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">using</span> <span class="n">SizeType</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">TBitsToSizeType</span><span class="o">&lt;</span><span class="n">IndexSize</span><span class="o">&gt;::</span><span class="n">Type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---------------------//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span> <span class="o">&lt;</span><span class="kt">int</span> <span class="n">IndexSize</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">TBitsToSizeType</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Fabricate a compile-time false result that&#39;s still dependent on the template parameter
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">static_assert</span><span class="p">(</span><span class="n">IndexSize</span> <span class="o">==</span> <span class="n">IndexSize</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#34;Unsupported allocator index size.&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;&gt;</span> <span class="k">struct</span> <span class="nc">TBitsToSizeType</span><span class="o">&lt;</span><span class="mi">8</span><span class="o">&gt;</span>  <span class="p">{</span> <span class="k">using</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">int8</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;&gt;</span> <span class="k">struct</span> <span class="nc">TBitsToSizeType</span><span class="o">&lt;</span><span class="mi">16</span><span class="o">&gt;</span> <span class="p">{</span> <span class="k">using</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">int16</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;&gt;</span> <span class="k">struct</span> <span class="nc">TBitsToSizeType</span><span class="o">&lt;</span><span class="mi">32</span><span class="o">&gt;</span> <span class="p">{</span> <span class="k">using</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">int32</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;&gt;</span> <span class="k">struct</span> <span class="nc">TBitsToSizeType</span><span class="o">&lt;</span><span class="mi">64</span><span class="o">&gt;</span> <span class="p">{</span> <span class="k">using</span> <span class="n">Type</span> <span class="o">=</span> <span class="n">int64</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//----------UEåœ¨Windowsç¯å¢ƒä¸‹çš„intç±»å‹--------------//
</span></span></span><span class="line"><span class="cl"><span class="c1">// 8-bit signed integer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">typedef</span>	<span class="kt">signed</span> <span class="kt">char</span>			<span class="n">int8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 16-bit signed integer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">typedef</span> <span class="kt">signed</span> <span class="kt">short</span> <span class="kt">int</span>	<span class="n">int16</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 32-bit signed integer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">typedef</span> <span class="kt">signed</span> <span class="kt">int</span>	 		<span class="n">int32</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 64-bit signed integer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">typedef</span> <span class="kt">signed</span> <span class="kt">long</span> <span class="kt">long</span>	<span class="n">int64</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>TSizedDefaultAllocator ç»§æ‰¿è‡ª TSizedHeapAllocatorï¼Œ TSizedHeapAllocatorä¸­å®šä¹‰äº†SizeTypeï¼Œ</p>
<p>é€šè¿‡åç‰¹åŒ–ï¼Œå½“IndexSizeæ˜¯32æ—¶ ï¼ŒSizeType = int32.</p>
<h3 id="elementtype">ElementType
</h3><ul>
<li><strong>ä½œç”¨</strong>ï¼šè¡¨ç¤ºå®¹å™¨å­˜å‚¨çš„ <strong>å…ƒç´ ç±»å‹</strong>ï¼ˆå¦‚ <code>int</code>ã€<code>FString</code>ï¼‰ã€‚</li>
<li><strong>è®¾è®¡åŸå› </strong>ï¼š
ç›´æ¥é€ä¼ æ¨¡æ¿å‚æ•° <code>InElementType</code>ï¼Œç®€åŒ–ä»£ç ä¸­å¯¹å…ƒç´ ç±»å‹çš„å¼•ç”¨ã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">using</span> <span class="n">Array</span> <span class="o">=</span> <span class="n">TArray</span><span class="o">&lt;</span><span class="n">AActor</span><span class="o">*&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//AActor*
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">using</span> <span class="n">ArrayElementType</span> <span class="o">=</span> <span class="n">Array</span><span class="o">::</span><span class="n">ElementType</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>TArrayå­˜æ”¾Actor*ï¼Œé‚£ä¹ˆElementTypeå°±æ˜¯AActor*ç±»å‹.</p>
<h3 id="usizetype">USizeType
</h3><ul>
<li><strong>ä½œç”¨</strong>ï¼šå°† <code>SizeType</code> è½¬æ¢ä¸º <strong>æ— ç¬¦å·æ•´æ•°ç±»å‹</strong>ï¼ˆå¦‚ <code>uint32</code>ã€<code>uint64</code>ï¼‰ã€‚</li>
<li><strong>è®¾è®¡åŸå› </strong>ï¼š
åœ¨éœ€è¦æ— ç¬¦å·è¿ç®—çš„åœºæ™¯ï¼ˆå¦‚å†…å­˜å—å¤§å°è®¡ç®—ï¼‰é¿å…è´Ÿæ•°æº¢å‡ºé—®é¢˜ã€‚</li>
</ul>
<h3 id="elementallocatortype">ElementAllocatorType
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">using</span> <span class="n">ElementAllocatorType</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">conditional_t</span><span class="o">&lt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">AllocatorType</span><span class="o">::</span><span class="n">NeedsElementType</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">typename</span> <span class="n">AllocatorType</span><span class="o">::</span><span class="k">template</span> <span class="n">ForElementType</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="o">&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">typename</span> <span class="n">AllocatorType</span><span class="o">::</span><span class="n">ForAnyElementType</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šæ ¹æ®åˆ†é…å™¨æ˜¯å¦éœ€è¦å…ƒç´ ç±»å‹ï¼Œé€‰æ‹©å…·ä½“çš„ <strong>å†…å­˜åˆ†é…å™¨å®ç°</strong>ã€‚</p>
</li>
<li>
<p><strong>è®¾è®¡åŸå› </strong>ï¼š</p>
</li>
<li>
<p><code>**NeedsElementType = true**</code>ï¼šåˆ†é…å™¨éœ€è¦çŸ¥é“å…ƒç´ ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œä¸ºå…ƒç´ æ„é€ /ææ„æˆ–å¯¹é½ä¼˜åŒ–ï¼‰ã€‚æ­¤æ—¶ä½¿ç”¨ <code>ForElementType&lt;ElementType&gt;</code>ï¼Œå³ä¸å…ƒç´ ç±»å‹ç»‘å®šçš„åˆ†é…å™¨ã€‚</p>
</li>
<li>
<p><code>**NeedsElementType = false**</code>ï¼šåˆ†é…å™¨ä¸ä¾èµ–å…ƒç´ ç±»å‹ï¼ˆä¾‹å¦‚ï¼ŒåŸå§‹å†…å­˜å—ç®¡ç†ï¼‰ã€‚æ­¤æ—¶ä½¿ç”¨ <code>ForAnyElementType</code>ï¼Œå³é€šç”¨åˆ†é…å™¨ã€‚</p>
</li>
</ul>
<p><strong>é»˜è®¤çš„åˆ†é…å™¨å®šä¹‰äº†è¿™ä¸ªNeedsElementTypeç±»å‹ï¼š</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="kt">int</span> <span class="n">IndexSize</span><span class="p">,</span> <span class="k">typename</span> <span class="n">BaseMallocType</span> <span class="o">=</span> <span class="n">FMemory</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TSizedHeapAllocator</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">using</span> <span class="n">SizeType</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">TBitsToSizeType</span><span class="o">&lt;</span><span class="n">IndexSize</span><span class="o">&gt;::</span><span class="n">Type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">using</span> <span class="n">USizeType</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unsigned_t</span><span class="o">&lt;</span><span class="n">SizeType</span><span class="o">&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">enum</span> <span class="p">{</span> <span class="n">NeedsElementType</span> <span class="o">=</span> <span class="nb">true</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">	<span class="k">enum</span> <span class="p">{</span> <span class="n">RequireRangeCheck</span> <span class="o">=</span> <span class="nb">true</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å› æ­¤é€šè¿‡std::conditional_tçš„åŒ¹é…ï¼Œé€‰æ‹©ForElementType<ElementType></p>
<p>TArrayå­˜æ”¾AActor<em>æ—¶ï¼Œç±»å‹ä¸º:TSizedHeapAllocator&lt;32&gt;::ForElementType&lt;AActor</em>&gt;</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// TSizedHeapAllocator&lt;32&gt;::ForElementType&lt;AActor*&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">using</span> <span class="n">ArrayElementAllocatorType</span> <span class="o">=</span> <span class="n">Array</span><span class="o">::</span><span class="n">ElementAllocatorType</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">using</span> <span class="n">ElementAllocatorType</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">conditional_t</span><span class="o">&lt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">AllocatorType</span><span class="o">::</span><span class="n">NeedsElementType</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">typename</span> <span class="n">AllocatorType</span><span class="o">::</span><span class="k">template</span> <span class="n">ForElementType</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="o">&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">typename</span> <span class="n">AllocatorType</span><span class="o">::</span><span class="n">ForAnyElementType</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---------conditionalçš„æºç ---------//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span> <span class="o">&lt;</span><span class="kt">bool</span> <span class="n">_Test</span><span class="p">,</span> <span class="k">class</span> <span class="nc">_Ty1</span><span class="p">,</span> <span class="k">class</span> <span class="nc">_Ty2</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">conditional</span> <span class="p">{</span> <span class="c1">// Choose _Ty1 if _Test is true, and _Ty2 otherwise
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">using</span> <span class="n">type</span> <span class="o">=</span> <span class="n">_Ty1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">_Ty1</span><span class="p">,</span> <span class="k">class</span> <span class="nc">_Ty2</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">conditional</span><span class="o">&lt;</span><span class="nb">false</span><span class="p">,</span> <span class="n">_Ty1</span><span class="p">,</span> <span class="n">_Ty2</span><span class="o">&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">using</span> <span class="n">type</span> <span class="o">=</span> <span class="n">_Ty2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="kt">bool</span> <span class="n">_Test</span><span class="p">,</span> <span class="k">class</span> <span class="nc">_Ty1</span><span class="p">,</span> <span class="k">class</span> <span class="nc">_Ty2</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">conditional_t</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">conditional</span><span class="o">&lt;</span><span class="n">_Test</span><span class="p">,</span> <span class="n">_Ty1</span><span class="p">,</span> <span class="n">_Ty2</span><span class="o">&gt;::</span><span class="n">type</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“ç¬¬ä¸€ä¸ªboolå€¼ä¸ºtrueæ—¶ï¼Œå³  AllocatorType::NeedsElementType ä¸ºtrueï¼Œ</p>
<p>é‚£ä¹ˆconditionalçš„typeé€‰æ‹© AllocatorType::template ForElementType<ElementType></p>
<p>å¦‚æœæ˜¯falseï¼Œconditionalçš„typeå°†ä¼šé€‰æ‹© AllocatorType::ForAnyElementType</p>
<h3 id="static_assert">static_assert
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_signed_v</span><span class="o">&lt;</span><span class="n">SizeType</span><span class="o">&gt;</span><span class="p">,</span> <span class="s">&#34;TArray only supports signed index types&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šç¼–è¯‘æ—¶æ£€æŸ¥ <code>SizeType</code> æ˜¯å¦ä¸º <strong>æœ‰ç¬¦å·æ•´æ•°ç±»å‹</strong>ã€‚</p>
</li>
<li>
<p><strong>è®¾è®¡åŸå› </strong>ï¼š</p>
</li>
<li>
<p><strong>å®‰å…¨æ€§</strong>ï¼šæœ‰ç¬¦å·æ•´æ•°å¯ä»¥è¡¨ç¤ºè´Ÿæ•°ï¼Œä¾¿äºå¤„ç† <code>InvalidIndex</code>ï¼ˆå¦‚ <code>INDEX_NONE = -1</code>ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å…¼å®¹æ€§</strong>ï¼šUE ä»£ç ä¸­è®¸å¤šæ¥å£ä¾èµ–æœ‰ç¬¦å·ç´¢å¼•ï¼ˆå¦‚ <code>TArray::Find</code> è¿”å› <code>int32</code>ï¼‰ã€‚</p>
</li>
<li>
<p><strong>é”™è¯¯é¢„é˜²</strong>ï¼šé¿å…ç”¨æˆ·è¯¯ç”¨æ— ç¬¦å·ç±»å‹å¯¼è‡´ç´¢å¼•è®¡ç®—é”™è¯¯ï¼ˆå¦‚ <code>0u - 1</code> æº¢å‡ºä¸ºæœ€å¤§å€¼ï¼‰ã€‚</p>
</li>
</ul>
<h3 id="æ€»ç»“">æ€»ç»“
</h3><div class="table-wrapper"><table>
<thead>
<tr>
<th><strong>ç»„ä»¶</strong></th>
<th><strong>åŠŸèƒ½</strong></th>
<th><strong>è®¾è®¡ç›®æ ‡</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>**SizeType**</code></td>
<td>å®šä¹‰ç´¢å¼•å’Œå®¹é‡ç±»å‹ï¼Œç”±åˆ†é…å™¨å†³å®š</td>
<td>æ”¯æŒä¸åŒå†…å­˜è§„æ¨¡çš„å®¹å™¨</td>
</tr>
<tr>
<td><code>**ElementType**</code></td>
<td>å®¹å™¨å­˜å‚¨çš„å…ƒç´ ç±»å‹</td>
<td>æ³›å‹ç¼–ç¨‹çš„æ ¸å¿ƒ</td>
</tr>
<tr>
<td><code>**AllocatorType**</code></td>
<td>å†…å­˜åˆ†é…ç­–ç•¥ï¼ˆå †ã€æ ˆã€æ± ç­‰ï¼‰</td>
<td>çµæ´»çš„å†…å­˜ç®¡ç†</td>
</tr>
<tr>
<td><code>**USizeType**</code></td>
<td>æ— ç¬¦å·ç±»å‹ï¼Œç”¨äºå†…å­˜å¤§å°è®¡ç®—</td>
<td>é¿å…æ— ç¬¦å·è¿ç®—çš„æº¢å‡ºé—®é¢˜</td>
</tr>
<tr>
<td><code>**ElementAllocatorType**</code></td>
<td>æ ¹æ®åˆ†é…å™¨éœ€æ±‚é€‰æ‹©ç±»å‹ç›¸å…³æˆ–æ— å…³çš„å®ç°</td>
<td>ä¼˜åŒ–å†…å­˜æ“ä½œï¼ˆæ„é€ /ææ„ã€å¯¹é½ï¼‰</td>
</tr>
<tr>
<td><code>**static_assert**</code></td>
<td>å¼ºåˆ¶ <code>SizeType</code> ä¸ºæœ‰ç¬¦å·ç±»å‹</td>
<td>ç¡®ä¿ç´¢å¼•é€»è¾‘å®‰å…¨</td>
</tr>
</tbody>
</table></div>
<h2 id="æ„é€ å‡½æ•°">æ„é€ å‡½æ•°
</h2><p>TArrayçš„æˆå‘˜å˜é‡</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">ElementAllocatorType</span> <span class="n">AllocatorInstance</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">SizeType</span>             <span class="n">ArrayNum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">SizeType</span>             <span class="n">ArrayMax</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>SizeType = int32 = signed int</p>
<p>ElementAllocatorType = TSizedHeapAllocator&lt;32&gt;::ForElementType&lt;AActor*&gt;</p>
<h3 id="é»˜è®¤æ„é€ ">é»˜è®¤æ„é€ 
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Constructor, initializes element number counters.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="nf">TArray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="o">:</span> <span class="n">ArrayNum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">,</span> <span class="n">ArrayMax</span><span class="p">(</span><span class="n">AllocatorInstance</span><span class="p">.</span><span class="n">GetInitialCapacity</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">SizeType</span> <span class="nf">GetInitialCapacity</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// åˆ›å»ºä¸€ä¸ªç©ºçš„ TArrayï¼ˆå…ƒç´ ç±»å‹ä¸º int32ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">int32</span><span class="o">&gt;</span> <span class="n">MyArray</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// MyArray åˆå§‹çŠ¶æ€ï¼šNum() = 0, Max() = Allocator çš„åˆå§‹å®¹é‡ï¼ˆä¾‹å¦‚ 4ï¼‰
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åªå®šä¹‰ä¸€ä¸ªTArray<int> Arrayï¼Œä¸ä¼ å…¥ä»»ä½•å‚æ•°æ—¶ï¼ŒNumå’ŒMaxéƒ½è®¾ä¸º0.</p>
<h3 id="ä»åŸå§‹æ•°ç»„æ„é€ ">ä»åŸå§‹æ•°ç»„æ„é€ 
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Constructor from a raw array of elements.
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param Ptr   A pointer to an array of elements to copy.
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param Count The number of elements to copy from Ptr.
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @see Append
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="nf">TArray</span><span class="p">(</span><span class="k">const</span> <span class="n">ElementType</span><span class="o">*</span> <span class="n">Ptr</span><span class="p">,</span> <span class="n">SizeType</span> <span class="n">Count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">Count</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Cast to USizeType first to prevent sign extension on negative sizes, producing unusually large values.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// é¦–å…ˆè½¬æ¢ä¸º USizeType ä»¥é˜²æ­¢è´Ÿæ•°å¤§å°åœ¨ç¬¦å·æ‰©å±•æ—¶äº§ç”Ÿå¼‚å¸¸å¤§çš„å€¼ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">UE</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">Private</span><span class="o">::</span><span class="n">OnInvalidArrayNum</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)(</span><span class="n">USizeType</span><span class="p">)</span><span class="n">Count</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">check</span><span class="p">(</span><span class="n">Ptr</span> <span class="o">!=</span> <span class="k">nullptr</span> <span class="o">||</span> <span class="n">Count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">CopyToEmpty</span><span class="p">(</span><span class="n">Ptr</span><span class="p">,</span> <span class="n">Count</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// åŸå§‹ C é£æ ¼æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">int32</span> <span class="n">RawArray</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä» RawArray æ„é€  TArrayï¼ˆå¤åˆ¶å‰3ä¸ªå…ƒç´ ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">int32</span><span class="o">&gt;</span> <span class="n">MyArray</span><span class="p">(</span><span class="n">RawArray</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// MyArray å†…å®¹ï¼š{10, 20, 30}
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="copytoempty">CopyToEmpty
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">OtherElementType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">OtherSizeType</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">CopyToEmpty</span><span class="p">(</span><span class="k">const</span> <span class="n">OtherElementType</span><span class="o">*</span> <span class="n">OtherData</span><span class="p">,</span> <span class="n">OtherSizeType</span> <span class="n">OtherNum</span><span class="p">,</span> <span class="n">SizeType</span> <span class="n">PrevMax</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//ç±»å‹è½¬æ¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">SizeType</span> <span class="n">NewNum</span> <span class="o">=</span> <span class="p">(</span><span class="n">SizeType</span><span class="p">)</span><span class="n">OtherNum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//æ£€æµ‹ æº¢å‡º/ä¸¢å¤±ç²¾åº¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">checkf</span><span class="p">((</span><span class="n">OtherSizeType</span><span class="p">)</span><span class="n">NewNum</span> <span class="o">==</span> <span class="n">OtherNum</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">&#34;Invalid number of elements to add to this array type: %lld&#34;</span><span class="p">),</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">NewNum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//æ›´æ–°å…ƒç´ æ•°é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">ArrayNum</span> <span class="o">=</span> <span class="n">NewNum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//å¦‚æœ OtherNum æˆ– PrevMax ä¸ä¸ºé›¶ï¼Œåˆ™éœ€è¦è°ƒæ•´å½“å‰æ•°ç»„çš„å¤§å°ä»¥é€‚åº”æ–°æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="n">OtherNum</span> <span class="o">||</span> <span class="n">PrevMax</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//è°ƒæ•´æ•°ç»„çš„å®¹é‡ä»¥é€‚åº”æ–°çš„å…ƒç´ æ•°é‡ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">ResizeForCopy</span><span class="p">(</span><span class="n">NewNum</span><span class="p">,</span> <span class="n">PrevMax</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//æ„é€ å…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">ConstructItems</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="o">&gt;</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">GetData</span><span class="p">(),</span> <span class="n">OtherData</span><span class="p">,</span> <span class="n">OtherNum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// è®¾ä¸º0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">ArrayMax</span> <span class="o">=</span> <span class="n">AllocatorInstance</span><span class="p">.</span><span class="n">GetInitialCapacity</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">SlackTrackerNumChanged</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="constructitems">ConstructItems
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Constructs a range of items into memory from a set of arguments.  The arguments come from an another array.
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param	Dest		The memory location to start copying into.
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param	Source		A pointer to the first argument to pass to the constructor.
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param	Count		The number of elements to copy.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span>
</span></span><span class="line"><span class="cl">	<span class="k">typename</span> <span class="n">DestinationElementType</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="k">typename</span> <span class="n">SourceElementType</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="k">typename</span> <span class="n">SizeType</span>
</span></span><span class="line"><span class="cl">	<span class="n">UE_REQUIRES</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">DestinationElementType</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SourceElementType</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">TIsBitwiseConstructible</span><span class="o">&lt;</span><span class="n">DestinationElementType</span><span class="p">,</span> <span class="n">SourceElementType</span><span class="o">&gt;::</span><span class="n">Value</span><span class="p">)</span> <span class="c1">// the sizeof here should improve the error messages we get when we try to call this function with incomplete types
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="kt">void</span> <span class="n">ConstructItems</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">Dest</span><span class="p">,</span> <span class="k">const</span> <span class="n">SourceElementType</span><span class="o">*</span> <span class="n">Source</span><span class="p">,</span> <span class="n">SizeType</span> <span class="n">Count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">Count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">FMemory</span><span class="o">::</span><span class="n">Memcpy</span><span class="p">(</span><span class="n">Dest</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SourceElementType</span><span class="p">)</span> <span class="o">*</span> <span class="n">Count</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span> <span class="o">&lt;</span>
</span></span><span class="line"><span class="cl">	<span class="k">typename</span> <span class="n">DestinationElementType</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="k">typename</span> <span class="n">SourceElementType</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="k">typename</span> <span class="n">SizeType</span>
</span></span><span class="line"><span class="cl">	<span class="n">UE_REQUIRES</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">DestinationElementType</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SourceElementType</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">TIsBitwiseConstructible</span><span class="o">&lt;</span><span class="n">DestinationElementType</span><span class="p">,</span> <span class="n">SourceElementType</span><span class="o">&gt;::</span><span class="n">Value</span><span class="p">)</span> <span class="c1">// the sizeof here should improve the error messages we get when we try to call this function with incomplete types
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCENOINLINE</span> <span class="kt">void</span> <span class="n">ConstructItems</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">Dest</span><span class="p">,</span> <span class="k">const</span> <span class="n">SourceElementType</span><span class="o">*</span> <span class="n">Source</span><span class="p">,</span> <span class="n">SizeType</span> <span class="n">Count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	 <span class="k">while</span> <span class="p">(</span><span class="n">Count</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">     <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="o">::</span><span class="k">new</span> <span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">Dest</span><span class="p">)</span> <span class="n">DestinationElementType</span><span class="p">(</span><span class="o">*</span><span class="n">Source</span><span class="p">);</span> <span class="c1">// Placement new æ„é€ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="o">++</span><span class="p">(</span><span class="n">DestinationElementType</span><span class="o">*&amp;</span><span class="p">)</span><span class="n">Dest</span><span class="p">;</span> <span class="c1">// æŒ‡é’ˆæ­¥è¿›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="o">++</span><span class="n">Source</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">--</span><span class="n">Count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸¤ä¸ªæ¨¡æ¿å‡½æ•°ç”¨äºå°†æºæ•°ç»„å…ƒç´ æ„é€ åˆ°ç›®æ ‡å†…å­˜ä¸­ï¼Œæ ¹æ®ç±»å‹æ˜¯å¦æ”¯æŒä½æ‹·è´ï¼ˆbitwise copyï¼‰é€‰æ‹©ä¸åŒçš„æ„é€ ç­–ç•¥ã€‚</p>
<p>é€šè¿‡æ¨¡æ¿ç‰¹åŒ–å’Œç±»å‹ç‰¹æ€§æ£€æŸ¥ï¼Œåœ¨ä¿è¯ç±»å‹å®‰å…¨çš„å‰æä¸‹ï¼Œä¸ºç®€å•ç±»å‹æä¾›é«˜æ•ˆå†…å­˜æ‹·è´ï¼Œä¸ºå¤æ‚ç±»å‹æä¾›å®‰å…¨çš„é€ä¸ªæ„é€ é€»è¾‘ï¼Œæ˜¯ UE å®¹å™¨é«˜æ€§èƒ½è®¾è®¡çš„æ ¸å¿ƒæœºåˆ¶ä¹‹ä¸€ã€‚</p>
<p>ç¬¬ä¸€ä¸ªç‰ˆæœ¬ å³ä½¿ç”¨Memcpyï¼Œ æ˜¯ ä½æ‹·è´ä¼˜åŒ–ç‰ˆæœ¬ï¼ˆå¿«é€Ÿè·¯å¾„ï¼‰</p>
<p><strong>TIsBitwiseConstructible</strong> ç±»å‹ç‰¹æ€§æ£€æŸ¥ï¼Œåˆ¤æ–­ SourceElementType æ˜¯å¦å¯ä»¥ç›´æ¥æŒ‰ä½å¤åˆ¶åˆ° DestinationElementType çš„å†…å­˜ä¸­ï¼ˆå¦‚åŸºæœ¬ç±»å‹ã€POD ç±»å‹ï¼‰</p>
<p><strong>FMemory::Memcpy</strong> ç›´æ¥å†…å­˜æ‹·è´ï¼Œæ•ˆç‡é«˜ï¼ˆO(n) æ—¶é—´ï¼Œæ— é¢å¤–æ„é€ /ææ„è°ƒç”¨ï¼‰</p>
<p><strong>ä½¿ç”¨åœºæ™¯:</strong></p>
<ul>
<li><strong>åŸºç¡€ç±»å‹</strong>ï¼š<code>int32</code>, <code>float</code>, <code>FVector</code> ç­‰ã€‚</li>
<li><strong>POD ç±»å‹</strong>ï¼šæ— è‡ªå®šä¹‰æ„é€ å‡½æ•°/ææ„å‡½æ•°çš„ç»“æ„ä½“ã€‚</li>
<li><strong>å†…å­˜å¸ƒå±€å…¼å®¹çš„ç±»å‹</strong>ï¼šä¿è¯ <code>Source</code> å’Œ <code>Dest</code> çš„äºŒè¿›åˆ¶å…¼å®¹æ€§ã€‚</li>
</ul>
<p>ç¬¬äºŒä¸ªç‰ˆæœ¬ å³ä½¿ç”¨whileå¾ªç¯ï¼Œæ˜¯é€ä¸ªæ„é€ ç‰ˆæœ¬ï¼ˆå®‰å…¨è·¯å¾„ï¼‰</p>
<p><strong>!TIsBitwiseConstructible</strong> ç±»å‹ä¸å…¼å®¹ä½æ‹·è´æ—¶å¯ç”¨æ­¤ç‰ˆæœ¬</p>
<p><strong>Placement new</strong> åœ¨ç›®æ ‡å†…å­˜åœ°å€è°ƒç”¨æ„é€ å‡½æ•°ï¼ˆæ”¯æŒé POD ç±»å‹ï¼‰</p>
<p><strong>æŒ‡é’ˆæ­¥è¿›</strong> æ‰‹åŠ¨ç§»åŠ¨ç›®æ ‡æŒ‡é’ˆåˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ä½ç½®</p>
<p><strong>ä½¿ç”¨åœºæ™¯:</strong></p>
<ul>
<li><strong>é POD ç±»å‹</strong>ï¼šå¦‚åŒ…å« <code>FString</code>ã€<code>TSharedPtr</code> ç­‰éœ€è¦æ„é€ /ææ„çš„ç±»å‹ã€‚</li>
<li><strong>æœ‰è‡ªå®šä¹‰æ„é€ é€»è¾‘</strong>ï¼šéœ€è¦è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°æˆ–è½¬æ¢æ„é€ å‡½æ•°ã€‚</li>
</ul>
<div class="table-wrapper"><table>
<thead>
<tr>
<th><strong>æ“ä½œ</strong></th>
<th><strong>ä½æ‹·è´ç‰ˆæœ¬</strong></th>
<th><strong>é€ä¸ªæ„é€ ç‰ˆæœ¬</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æ—¶é—´å¤æ‚åº¦</strong></td>
<td>O(n)ï¼ˆå†…å­˜è¿ç»­æ‹·è´ï¼‰</td>
<td>O(n)ï¼ˆå¾ªç¯è°ƒç”¨æ„é€ å‡½æ•°ï¼‰</td>
</tr>
<tr>
<td><strong>é€‚ç”¨ç±»å‹</strong></td>
<td>ç®€å•ç±»å‹</td>
<td>å¤æ‚ç±»å‹</td>
</tr>
<tr>
<td><strong>å†…å­˜å®‰å…¨æ€§</strong></td>
<td>ä¾èµ–ç±»å‹å…¼å®¹æ€§</td>
<td>å®‰å…¨</td>
</tr>
</tbody>
</table></div>
<p><strong>åº”ç”¨åœºæ™¯:</strong></p>
<ul>
<li><strong>å®¹å™¨æ‰©å®¹</strong>ï¼š<code>TArray::Add</code> æˆ– <code>TArray::Append</code> æ—¶é€‰æ‹©æœ€ä¼˜æ„é€ æ–¹å¼ã€‚</li>
<li><strong>åºåˆ—åŒ–</strong>ï¼šååºåˆ—åŒ–äºŒè¿›åˆ¶æ•°æ®åˆ°å¯¹è±¡ã€‚</li>
<li><strong>å†…å­˜å¤ç”¨</strong>ï¼šé‡ç”¨å·²åˆ†é…å†…å­˜é¿å…é‡å¤æ„é€ ã€‚</li>
</ul>
<h3 id="ä»tarrayviewæ„é€ ">ä»TArrayViewæ„é€ 
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">OtherElementType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">OtherSizeType</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">explicit</span> <span class="n">TArray</span><span class="p">(</span><span class="k">const</span> <span class="n">TArrayView</span><span class="o">&lt;</span><span class="n">OtherElementType</span><span class="p">,</span> <span class="n">OtherSizeType</span><span class="o">&gt;&amp;</span> <span class="n">Other</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//--------------//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">InElementType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">InAllocatorType</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">OtherElementType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">OtherSizeType</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="n">TArray</span><span class="o">&lt;</span><span class="n">InElementType</span><span class="p">,</span> <span class="n">InAllocatorType</span><span class="o">&gt;::</span><span class="n">TArray</span><span class="p">(</span><span class="k">const</span> <span class="n">TArrayView</span><span class="o">&lt;</span><span class="n">OtherElementType</span><span class="p">,</span> <span class="n">OtherSizeType</span><span class="o">&gt;&amp;</span> <span class="n">Other</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CopyToEmpty</span><span class="p">(</span><span class="n">Other</span><span class="p">.</span><span class="n">GetData</span><span class="p">(),</span> <span class="n">Other</span><span class="p">.</span><span class="n">Num</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// åŸå§‹ C é£æ ¼æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">int32</span> <span class="n">RawArray</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// åˆ›å»ºä¸€ä¸ª TArrayViewï¼ˆè§†å›¾ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">TArrayView</span><span class="o">&lt;</span><span class="n">int32</span><span class="o">&gt;</span> <span class="n">View</span> <span class="o">=</span> <span class="n">MakeArrayView</span><span class="p">(</span><span class="n">RawArray</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä» View æ„é€  TArrayï¼ˆå¤åˆ¶æ•°æ®ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">int32</span><span class="o">&gt;</span> <span class="n">MyArray</span><span class="p">(</span><span class="n">View</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// MyArray å†…å®¹ï¼š{10, 20, 30}
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åˆå§‹åŒ–åˆ—è¡¨">åˆå§‹åŒ–åˆ—è¡¨
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Initializer list constructor
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="n">TArray</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">initializer_list</span><span class="o">&lt;</span><span class="n">InElementType</span><span class="o">&gt;</span> <span class="n">InitList</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// This is not strictly legal, as std::initializer_list&#39;s iterators are not guaranteed to be pointers, but
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// this appears to be the case on all of our implementations.  Also, if it&#39;s not true on a new implementation,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// it will fail to compile rather than behave badly.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CopyToEmpty</span><span class="p">(</span><span class="n">InitList</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="p">(</span><span class="n">SizeType</span><span class="p">)</span><span class="n">InitList</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç›´æ¥é€šè¿‡åˆå§‹åŒ–åˆ—è¡¨æ„é€ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FString</span><span class="o">&gt;</span> <span class="n">MyArray</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#34;Apple&#34;</span><span class="p">,</span> <span class="s">&#34;Banana&#34;</span><span class="p">,</span> <span class="s">&#34;Cherry&#34;</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">// MyArray å†…å®¹ï¼š{&#34;Apple&#34;, &#34;Banana&#34;, &#34;Cherry&#34;}
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨é‡Šé‡Œé¢å½é‡Œå‘±å•¦è¯´å•¥å‘¢ï¼Ÿ</p>
<p>// ä¸¥æ ¼æ¥è¯´ï¼Œè¿™æ˜¯ä¸åˆæ³•çš„ï¼Œå› ä¸º std::initializer_list çš„è¿­ä»£å™¨å¹¶ä¸ä¿è¯æ˜¯æŒ‡é’ˆï¼Œ</p>
<p>// ä½†æ˜¯åœ¨æˆ‘ä»¬æ‰€æœ‰çš„å®ç°ä¸­ä¼¼ä¹éƒ½æ˜¯è¿™æ ·çš„æƒ…å†µã€‚æ­¤å¤–ï¼Œå¦‚æœåœ¨æ–°çš„å®ç°ä¸­å®ƒä¸æ˜¯æŒ‡é’ˆï¼Œ</p>
<p>// é‚£ä¹ˆå®ƒå°†ä¼šç¼–è¯‘å¤±è´¥ï¼Œè€Œä¸æ˜¯è¡¨ç°ç³Ÿç³•ã€‚</p>
<p>åˆæ³•æ€§é—®é¢˜ï¼šä»æŠ€æœ¯ä¸Šè®²ï¼Œå‡è®¾ std::initializer_list çš„è¿­ä»£å™¨æ˜¯æŒ‡é’ˆæ˜¯ä¸ç¬¦åˆæ ‡å‡†çš„ï¼Œå› ä¸ºæ ‡å‡†å¹¶æ²¡æœ‰ä¿è¯è¿™ä¸€ç‚¹ã€‚</p>
<p>å®é™…å®ç°æƒ…å†µï¼šå°½ç®¡æ ‡å‡†æ²¡æœ‰ä¿è¯ï¼Œä½†åœ¨å½“å‰çš„æ‰€æœ‰å®ç°ä¸­ï¼Œè¿™äº›è¿­ä»£å™¨å®é™…ä¸Šç¡®å®æ˜¯æŒ‡é’ˆã€‚</p>
<p>å®‰å…¨æ€§ï¼šå¦‚æœåœ¨æœªæ¥æŸä¸ªæ–°çš„å®ç°ä¸­ï¼Œè¿™ç§å‡è®¾ä¸å†æˆç«‹ï¼ˆå³è¿­ä»£å™¨ä¸æ˜¯æŒ‡é’ˆï¼‰ï¼Œé‚£ä¹ˆä»£ç ä¼šåœ¨ç¼–è¯‘æ—¶å°±æŠ¥é”™ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶äº§ç”Ÿéš¾ä»¥è°ƒè¯•çš„è¡Œä¸ºé—®é¢˜ã€‚è¿™æä¾›äº†ä¸€ç§æ—©æœŸæ£€æµ‹é”™è¯¯çš„æ–¹å¼ï¼Œé¿å…äº†æ½œåœ¨çš„è¿è¡Œæ—¶é”™è¯¯ã€‚</p>
<h3 id="è·¨åˆ†é…å™¨">è·¨åˆ†é…å™¨
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Copy constructor with changed allocator. Use the common routine to perform the copy.
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param Other The source array to copy.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span>
</span></span><span class="line"><span class="cl">	<span class="k">typename</span> <span class="n">OtherElementType</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="k">typename</span> <span class="n">OtherAllocator</span>
</span></span><span class="line"><span class="cl">	<span class="n">UE_REQUIRES</span><span class="p">(</span><span class="n">UE</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">Private</span><span class="o">::</span><span class="n">TArrayElementsAreCompatible_V</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="p">,</span> <span class="k">const</span> <span class="n">OtherElementType</span><span class="o">&amp;&gt;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="k">explicit</span> <span class="n">TArray</span><span class="p">(</span><span class="k">const</span> <span class="n">TArray</span><span class="o">&lt;</span><span class="n">OtherElementType</span><span class="p">,</span> <span class="n">OtherAllocator</span><span class="o">&gt;&amp;</span> <span class="n">Other</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CopyToEmpty</span><span class="p">(</span><span class="n">Other</span><span class="p">.</span><span class="n">GetData</span><span class="p">(),</span> <span class="n">Other</span><span class="p">.</span><span class="n">Num</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æºæ•°ç»„ï¼ˆä½¿ç”¨é»˜è®¤åˆ†é…å™¨ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">int32</span><span class="p">,</span> <span class="n">FDefaultAllocator</span><span class="o">&gt;</span> <span class="n">SourceArray</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç›®æ ‡æ•°ç»„ï¼ˆä½¿ç”¨å…¶ä»–åˆ†é…å™¨ï¼Œå¦‚æ ˆåˆ†é…å™¨ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">int32</span><span class="p">,</span> <span class="n">TInlineAllocator</span><span class="o">&lt;</span><span class="mi">16</span><span class="o">&gt;&gt;</span> <span class="n">MyArray</span><span class="p">(</span><span class="n">SourceArray</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// MyArray å†…å®¹ï¼š{1, 2, 3}ï¼ˆå…ƒç´ ç±»å‹å…¼å®¹å³å¯æ‹·è´ï¼‰
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ‹·è´æ„é€ ">æ‹·è´æ„é€ 
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Copy constructor. Use the common routine to perform the copy.
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param Other The source array to copy.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="nf">TArray</span><span class="p">(</span><span class="k">const</span> <span class="n">TArray</span><span class="o">&amp;</span> <span class="n">Other</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CopyToEmpty</span><span class="p">(</span><span class="n">Other</span><span class="p">.</span><span class="n">GetData</span><span class="p">(),</span> <span class="n">Other</span><span class="p">.</span><span class="n">Num</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FVector</span><span class="o">&gt;</span> <span class="n">SourceArray</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">SourceArray</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">FVector</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span> <span class="mf">2.0f</span><span class="p">,</span> <span class="mf">3.0f</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ‹·è´æ„é€ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FVector</span><span class="o">&gt;</span> <span class="n">MyArray</span><span class="p">(</span><span class="n">SourceArray</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// MyArray å†…å®¹ï¼š{FVector(1,2,3)}
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å¸¦é¢„åˆ†é…å†…å­˜çš„æ‹·è´æ„é€ ">å¸¦é¢„åˆ†é…å†…å­˜çš„æ‹·è´æ„é€ 
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Copy constructor. Use the common routine to perform the copy.
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param Other The source array to copy.
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param ExtraSlack Tells how much extra memory should be preallocated
</span></span></span><span class="line"><span class="cl"><span class="cm"> *                   at the end of the array in the number of elements.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="nf">TArray</span><span class="p">(</span><span class="k">const</span> <span class="n">TArray</span><span class="o">&amp;</span> <span class="n">Other</span><span class="p">,</span> <span class="n">SizeType</span> <span class="n">ExtraSlack</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CopyToEmptyWithSlack</span><span class="p">(</span><span class="n">Other</span><span class="p">.</span><span class="n">GetData</span><span class="p">(),</span> <span class="n">Other</span><span class="p">.</span><span class="n">Num</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ExtraSlack</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">TArray</span><span class="o">&lt;</span><span class="n">int32</span><span class="o">&gt;</span> <span class="n">SourceArray</span> <span class="o">=</span> <span class="p">{</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ‹·è´æ„é€ å¹¶é¢„ç•™ 5 ä¸ªé¢å¤–ç©ºé—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">int32</span><span class="o">&gt;</span> <span class="n">MyArray</span><span class="p">(</span><span class="n">SourceArray</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// MyArray å†…å®¹ï¼š{100, 200}
</span></span></span><span class="line"><span class="cl"><span class="c1">// MyArray å®¹é‡ï¼š2ï¼ˆå…ƒç´ æ•°ï¼‰ + 5ï¼ˆé¢å¤–ç©ºé—´ï¼‰ = 7
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ExtraSlack æ•°ç»„æœ«å°¾æŒ‰å…ƒç´ çš„æ•°é‡é¢„å…ˆåˆ†é…å¤šå°‘é¢å¤–å†…å­˜ã€‚</p>
<h3 id="ç§»åŠ¨æ„é€ ">ç§»åŠ¨æ„é€ 
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="nf">TArray</span><span class="p">(</span><span class="n">TArray</span><span class="o">&amp;&amp;</span> <span class="n">Other</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">MoveOrCopy</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="n">Other</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//-------------------------//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span> <span class="o">&lt;</span>
</span></span><span class="line"><span class="cl">	<span class="k">typename</span> <span class="n">OtherElementType</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="k">typename</span> <span class="n">OtherAllocator</span>
</span></span><span class="line"><span class="cl">	<span class="n">UE_REQUIRES</span><span class="p">(</span><span class="n">UE</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">Private</span><span class="o">::</span><span class="n">TArrayElementsAreCompatible_V</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="p">,</span> <span class="n">OtherElementType</span><span class="o">&amp;&amp;&gt;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="k">explicit</span> <span class="n">TArray</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">OtherElementType</span><span class="p">,</span> <span class="n">OtherAllocator</span><span class="o">&gt;&amp;&amp;</span> <span class="n">Other</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">MoveOrCopy</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="n">Other</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//---------------------------//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span> <span class="o">&lt;</span>
</span></span><span class="line"><span class="cl">	<span class="k">typename</span> <span class="n">OtherElementType</span>
</span></span><span class="line"><span class="cl">	<span class="n">UE_REQUIRES</span><span class="p">(</span><span class="n">UE</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">Private</span><span class="o">::</span><span class="n">TArrayElementsAreCompatible_V</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="p">,</span> <span class="n">OtherElementType</span><span class="o">&amp;&amp;&gt;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">TArray</span><span class="p">(</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">OtherElementType</span><span class="p">,</span> <span class="n">AllocatorType</span><span class="o">&gt;&amp;&amp;</span> <span class="n">Other</span><span class="p">,</span> <span class="n">SizeType</span> <span class="n">ExtraSlack</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">MoveOrCopyWithSlack</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="n">Other</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ExtraSlack</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="moveorcpoy">MoveOrCpoy
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">FromArrayType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">ToArrayType</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">static</span> <span class="n">FORCEINLINE</span> <span class="kt">void</span> <span class="n">MoveOrCopy</span><span class="p">(</span><span class="n">ToArrayType</span><span class="o">&amp;</span> <span class="n">ToArray</span><span class="p">,</span> <span class="n">FromArrayType</span><span class="o">&amp;</span> <span class="n">FromArray</span><span class="p">,</span> <span class="n">SizeType</span> <span class="n">PrevMax</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nf">constexpr</span> <span class="p">(</span><span class="n">UE</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">Private</span><span class="o">::</span><span class="n">CanMoveTArrayPointersBetweenArrayTypes</span><span class="o">&lt;</span><span class="n">FromArrayType</span><span class="p">,</span> <span class="n">ToArrayType</span><span class="o">&gt;</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Move
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">TArray</span><span class="p">,</span> <span class="n">ToArrayType</span><span class="o">&gt;</span><span class="p">,</span> <span class="s">&#34;MoveOrCopy is expected to be called with the current array type as the destination&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">using</span> <span class="n">FromAllocatorType</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">FromArrayType</span><span class="o">::</span><span class="n">AllocatorType</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">using</span> <span class="n">ToAllocatorType</span>   <span class="o">=</span> <span class="k">typename</span> <span class="n">ToArrayType</span><span class="o">::</span><span class="n">AllocatorType</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="k">constexpr</span> <span class="p">(</span><span class="n">TCanMoveBetweenAllocators</span><span class="o">&lt;</span><span class="n">FromAllocatorType</span><span class="p">,</span> <span class="n">ToAllocatorType</span><span class="o">&gt;::</span><span class="n">Value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">ToArray</span><span class="p">.</span><span class="n">AllocatorInstance</span><span class="p">.</span><span class="k">template</span> <span class="n">MoveToEmptyFromOtherAllocator</span><span class="o">&lt;</span><span class="n">FromAllocatorType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">FromArray</span><span class="p">.</span><span class="n">AllocatorInstance</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">ToArray</span><span class="p">.</span><span class="n">AllocatorInstance</span><span class="p">.</span><span class="n">MoveToEmpty</span><span class="p">(</span><span class="n">FromArray</span><span class="p">.</span><span class="n">AllocatorInstance</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="n">ToArray</span>  <span class="p">.</span><span class="n">ArrayNum</span> <span class="o">=</span> <span class="p">(</span><span class="n">SizeType</span><span class="p">)</span><span class="n">FromArray</span><span class="p">.</span><span class="n">ArrayNum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">ToArray</span>  <span class="p">.</span><span class="n">ArrayMax</span> <span class="o">=</span> <span class="p">(</span><span class="n">SizeType</span><span class="p">)</span><span class="n">FromArray</span><span class="p">.</span><span class="n">ArrayMax</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Ensure the destination container could hold the source range (when the allocator size types shrink)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="k">constexpr</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">USizeType</span><span class="p">)</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">typename</span> <span class="n">FromArrayType</span><span class="o">::</span><span class="n">USizeType</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">ToArray</span><span class="p">.</span><span class="n">ArrayNum</span> <span class="o">!=</span> <span class="n">FromArray</span><span class="p">.</span><span class="n">ArrayNum</span> <span class="o">||</span> <span class="n">ToArray</span><span class="p">.</span><span class="n">ArrayMax</span> <span class="o">!=</span> <span class="n">FromArray</span><span class="p">.</span><span class="n">ArrayMax</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// Cast to USizeType first to prevent sign extension on negative sizes, producing unusually large values.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">UE</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">Private</span><span class="o">::</span><span class="n">OnInvalidArrayNum</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)(</span><span class="n">USizeType</span><span class="p">)</span><span class="n">ToArray</span><span class="p">.</span><span class="n">ArrayNum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="n">FromArray</span><span class="p">.</span><span class="n">ArrayNum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">FromArray</span><span class="p">.</span><span class="n">ArrayMax</span> <span class="o">=</span> <span class="n">FromArray</span><span class="p">.</span><span class="n">AllocatorInstance</span><span class="p">.</span><span class="n">GetInitialCapacity</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">FromArray</span><span class="p">.</span><span class="n">SlackTrackerNumChanged</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">ToArray</span><span class="p">.</span><span class="n">SlackTrackerNumChanged</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Copy
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">ToArray</span><span class="p">.</span><span class="n">CopyToEmpty</span><span class="p">(</span><span class="n">FromArray</span><span class="p">.</span><span class="n">GetData</span><span class="p">(),</span> <span class="n">FromArray</span><span class="p">.</span><span class="n">Num</span><span class="p">(),</span> <span class="n">PrevMax</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>MoveOrCopy</code> æ˜¯ç”¨äºåœ¨ä¸¤ä¸ª <code>TArray</code>ï¼ˆæˆ–ç±»ä¼¼å®¹å™¨ï¼‰ä¹‹é—´é«˜æ•ˆåœ° <strong>ç§»åŠ¨æˆ–æ‹·è´æ•°æ®</strong> çš„æ¨¡æ¿å‡½æ•°ã€‚</p>
<p>å…¶æ ¸å¿ƒé€»è¾‘æ˜¯ï¼š</p>
<ul>
<li><strong>ç§»åŠ¨ï¼ˆMoveï¼‰</strong>ï¼šè‹¥æºæ•°ç»„ï¼ˆ<code>FromArray</code>ï¼‰å’Œç›®æ ‡æ•°ç»„ï¼ˆ<code>ToArray</code>ï¼‰çš„ <strong>å†…å­˜åˆ†é…å™¨ï¼ˆAllocatorï¼‰å’Œå…ƒç´ ç±»å‹å…¼å®¹</strong>ï¼Œç›´æ¥è½¬ç§»å†…å­˜æ‰€æœ‰æƒï¼ˆé›¶æ‹·è´ï¼‰ã€‚</li>
<li><strong>æ‹·è´ï¼ˆCopyï¼‰</strong>ï¼šè‹¥æ¡ä»¶ä¸æ»¡è¶³ï¼Œåˆ™æ‰§è¡Œæ·±æ‹·è´ã€‚</li>
</ul>
<h5 id="ç‰‡æ®µ1"><strong>ç‰‡æ®µ1</strong>
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">if</span> <span class="nf">constexpr</span> <span class="p">(</span><span class="n">TCanMoveBetweenAllocators</span><span class="o">&lt;</span><span class="n">FromAllocatorType</span><span class="p">,</span> <span class="n">ToAllocatorType</span><span class="o">&gt;::</span><span class="n">Value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">ToArray</span><span class="p">.</span><span class="n">AllocatorInstance</span><span class="p">.</span><span class="k">template</span> <span class="n">MoveToEmptyFromOtherAllocator</span><span class="o">&lt;</span><span class="n">FromAllocatorType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">FromArray</span><span class="p">.</span><span class="n">AllocatorInstance</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">ToArray</span><span class="p">.</span><span class="n">AllocatorInstance</span><span class="p">.</span><span class="n">MoveToEmpty</span><span class="p">(</span><span class="n">FromArray</span><span class="p">.</span><span class="n">AllocatorInstance</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//------------------------------------------------//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">FromAllocatorType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">ToAllocatorType</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">TCanMoveBetweenAllocators</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">enum</span> <span class="p">{</span> <span class="n">Value</span> <span class="o">=</span> <span class="nb">false</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="n">uint8</span> <span class="n">FromIndexSize</span><span class="p">,</span> <span class="n">uint8</span> <span class="n">ToIndexSize</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">TCanMoveBetweenAllocators</span><span class="o">&lt;</span><span class="n">TSizedHeapAllocator</span><span class="o">&lt;</span><span class="n">FromIndexSize</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">TSizedHeapAllocator</span><span class="o">&lt;</span><span class="n">ToIndexSize</span><span class="o">&gt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Allow conversions between different int width versions of the allocator
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">enum</span> <span class="p">{</span> <span class="n">Value</span> <span class="o">=</span> <span class="nb">true</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="n">uint8</span> <span class="n">FromIndexSize</span><span class="p">,</span> <span class="n">uint8</span> <span class="n">ToIndexSize</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">TCanMoveBetweenAllocators</span><span class="o">&lt;</span><span class="n">TSizedDefaultAllocator</span><span class="o">&lt;</span><span class="n">FromIndexSize</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">TSizedDefaultAllocator</span><span class="o">&lt;</span><span class="n">ToIndexSize</span><span class="o">&gt;&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="o">:</span> <span class="n">TCanMoveBetweenAllocators</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">TSizedDefaultAllocator</span><span class="o">&lt;</span><span class="n">FromIndexSize</span><span class="o">&gt;::</span><span class="n">Typedef</span><span class="p">,</span> <span class="k">typename</span> <span class="n">TSizedDefaultAllocator</span><span class="o">&lt;</span><span class="n">ToIndexSize</span><span class="o">&gt;::</span><span class="n">Typedef</span><span class="o">&gt;</span> <span class="p">{};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>TCanMoveBetweenAllocators</code> æ¥å—ä¸¤ä¸ªæ¨¡æ¿å‚æ•°</p>
<p>ä¼ å…¥çš„ä¸¤ä¸ªéƒ½ä¸æ˜¯TSizedHeapAllocatoræˆ–TSizedDefaultAllocatorï¼ŒValueä¸ºfalseï¼Œ</p>
<p>ä¼ å…¥çš„éƒ½æ˜¯TSizedHeapAllocatorï¼ŒValueä¸ºtrue</p>
<p>ä¼ å…¥çš„éƒ½æ˜¯TSizedDefaultAllocatorï¼Œåˆ™æ ¹æ®TSizedDefaultAllocatorå†…éƒ¨çš„å…¼å®¹æ€§åˆ¤æ–­trueå’Œfalse.</p>
<p>Value=true è°ƒç”¨MoveToEmptyFromOtherAllocator</p>
<p>Value=false è°ƒç”¨MoveToEmpty</p>
<p><strong>é«˜åƒ§è§£é‡Š:</strong></p>
<p><code>TCanMoveBetweenAllocators</code> :ä½ ç»™æˆ‘ä¼ çš„æ˜¯ä»€ä¹ˆä¸œè¥¿æˆ‘è¯·é—®äº†ï¼Œ</p>
<p>ä¼ ä¿©TSizedHeapAllocatorç»™æˆ‘ï¼ŒOK æˆ‘å›ç­”ä½ true.</p>
<p>ä¼ ä¿©TSizedDefaultAllocatorï¼Œæˆ‘åªèƒ½è¯´ å…·ä½“é—®é¢˜å…·ä½“åˆ†æ.</p>
<p>ä¼ æ¥ä¸¤ä¸ªæ—¢ä¸æ˜¯TSizedHeapAllocator ä¹Ÿä¸æ˜¯ TSizedDefaultAllocatorï¼Œé‚£æˆ‘åªèƒ½å‘Šè¯‰ä½  false.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">if</span> <span class="nf">constexpr</span> <span class="p">(</span><span class="n">TCanMoveBetweenAllocators</span><span class="o">&lt;</span><span class="n">FromAllocatorType</span><span class="p">,</span> <span class="n">ToAllocatorType</span><span class="o">&gt;::</span><span class="n">Value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">ToArray</span><span class="p">.</span><span class="n">AllocatorInstance</span><span class="p">.</span><span class="k">template</span> <span class="n">MoveToEmptyFromOtherAllocator</span><span class="o">&lt;</span><span class="n">FromAllocatorType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">FromArray</span><span class="p">.</span><span class="n">AllocatorInstance</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">ToArray</span><span class="p">.</span><span class="n">AllocatorInstance</span><span class="p">.</span><span class="n">MoveToEmpty</span><span class="p">(</span><span class="n">FromArray</span><span class="p">.</span><span class="n">AllocatorInstance</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//-----------------------------------//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">OtherAllocator</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="kt">void</span> <span class="n">MoveToEmptyFromOtherAllocator</span><span class="p">(</span><span class="k">typename</span> <span class="n">OtherAllocator</span><span class="o">::</span><span class="n">ForAnyElementType</span><span class="o">&amp;</span> <span class="n">Other</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ£€æŸ¥å½“å‰åˆ†é…å™¨å®ä¾‹å’Œä¼ å…¥çš„åˆ†é…å™¨å®ä¾‹ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">checkSlow</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="k">this</span> <span class="o">!=</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">Other</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// å¦‚æœå½“å‰åˆ†é…å™¨å·²ç»æœ‰åˆ†é…çš„æ•°æ®ï¼Œåˆ™é‡Šæ”¾è¿™äº›æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">Data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">BaseMallocType</span><span class="o">::</span><span class="n">Free</span><span class="p">(</span><span class="n">Data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// å°†æºåˆ†é…å™¨çš„æ•°æ®æŒ‡é’ˆèµ‹å€¼ç»™å½“å‰åˆ†é…å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Data</span> <span class="o">=</span> <span class="n">Other</span><span class="p">.</span><span class="n">Data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// å°†æºåˆ†é…å™¨çš„æ•°æ®æŒ‡é’ˆè®¾ç½®ä¸º nullptrï¼Œè¡¨ç¤ºå®ƒç°åœ¨ä¸ºç©º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Other</span><span class="p">.</span><span class="n">Data</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="kt">void</span> <span class="nf">MoveToEmpty</span><span class="p">(</span><span class="n">ForAnyElementType</span><span class="o">&amp;</span> <span class="n">Other</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è°ƒç”¨æ¨¡æ¿å‡½æ•°ï¼ŒæŒ‡å®š TSizedHeapAllocator ä½œä¸ºæ¨¡æ¿å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="o">-&gt;</span><span class="n">MoveToEmptyFromOtherAllocator</span><span class="o">&lt;</span><span class="n">TSizedHeapAllocator</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Other</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸¤æ®µä»£ç çš„æ ¸å¿ƒåŒºåˆ«åœ¨äº <strong>åˆ†é…å™¨ç±»å‹å…¼å®¹æ€§å¤„ç†</strong>ï¼Œå…·ä½“åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p>
<p><strong>1. å½“åˆ†é…å™¨ç±»å‹å…¼å®¹æ—¶ (TCanMoveBetweenAllocators = true)</strong></p>
<ul>
<li><strong>æ¨¡æ¿å‚æ•°</strong>ï¼šæ˜¾å¼æŒ‡å®šæºåˆ†é…å™¨ç±»å‹ <code>FromAllocatorType</code>ã€‚</li>
<li><strong>ç›®çš„</strong>ï¼š
å½“æºåˆ†é…å™¨å’Œç›®æ ‡åˆ†é…å™¨ <strong>ç±»å‹ä¸åŒä½†å…¼å®¹</strong>ï¼ˆå¦‚ <code>TSizedHeapAllocator&lt;32&gt;</code> å’Œ <code>TSizedHeapAllocator&lt;64&gt;</code>ï¼‰ï¼Œé€šè¿‡æ¨¡æ¿å‚æ•°ä¼ é€’æºåˆ†é…å™¨çš„ç±»å‹ï¼Œç¡®ä¿æ­£ç¡®è°ƒç”¨å…¶å†…å­˜ç®¡ç†é€»è¾‘ï¼ˆå¦‚é‡Šæ”¾æ—§å†…å­˜ã€æ¥ç®¡æ–°å†…å­˜ï¼‰ã€‚</li>
<li><strong>ç¤ºä¾‹åœºæ™¯</strong>ï¼š
æºæ•°ç»„ä½¿ç”¨ <code>TSizedHeapAllocator&lt;32&gt;</code>ï¼Œç›®æ ‡æ•°ç»„ä½¿ç”¨ <code>TSizedHeapAllocator&lt;64&gt;</code>ï¼Œä½†ä¸¤è€…æ”¯æŒè·¨åˆ†é…å™¨ç§»åŠ¨ã€‚</li>
</ul>
<p><strong>2. å½“åˆ†é…å™¨ç±»å‹ä¸å…¼å®¹æ—¶ (TCanMoveBetweenAllocators = false)</strong></p>
<ul>
<li><strong>å®é™…è°ƒç”¨</strong>ï¼š
<code>MoveToEmpty</code> å†…éƒ¨è°ƒç”¨ <code>MoveToEmptyFromOtherAllocator&lt;TSizedHeapAllocator&gt;</code>ï¼Œå³å¼ºåˆ¶å°†æºåˆ†é…å™¨è§†ä¸ºé»˜è®¤çš„ <code>TSizedHeapAllocator</code>ã€‚</li>
<li><strong>ç›®çš„</strong>ï¼š
å½“åˆ†é…å™¨ç±»å‹ <strong>ä¸å…¼å®¹</strong> æ—¶ï¼Œå‡è®¾æºåˆ†é…å™¨ä¸ç›®æ ‡åˆ†é…å™¨å…±äº«ç›¸åŒçš„é»˜è®¤å†…å­˜ç®¡ç†ç­–ç•¥ï¼ˆå¦‚å †åˆ†é…ï¼‰ï¼Œç›´æ¥é€šè¿‡é»˜è®¤é€»è¾‘è½¬ç§»å†…å­˜ã€‚</li>
<li><strong>é£é™©</strong>ï¼š
è‹¥æºåˆ†é…å™¨å®é™…ç±»å‹é <code>TSizedHeapAllocator</code>ï¼Œå¯èƒ½å¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼ˆå¦‚å†…å­˜æ³„æ¼æˆ–å´©æºƒï¼‰ã€‚å› æ­¤æ­¤è·¯å¾„ä»…åœ¨ç±»å‹ä¸¥æ ¼å…¼å®¹æ—¶å®‰å…¨ã€‚</li>
</ul>
<p><strong>åœºæ™¯ 1ï¼šåŒç±»å‹åˆ†é…å™¨ç§»åŠ¨</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">TArray</span><span class="o">&lt;</span><span class="n">int32</span><span class="p">,</span> <span class="n">TSizedHeapAllocator</span><span class="o">&lt;</span><span class="mi">32</span><span class="o">&gt;&gt;</span> <span class="n">Source</span><span class="p">,</span> <span class="n">Dest</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">MoveOrCopy</span><span class="p">(</span><span class="n">Dest</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>è°ƒç”¨è·¯å¾„</strong>ï¼š
<code>MoveToEmptyFromOtherAllocator&lt;TSizedHeapAllocator&lt;32&gt;&gt;</code>ã€‚</li>
<li><strong>è¡Œä¸º</strong>ï¼š
å®‰å…¨è½¬ç§»å†…å­˜ï¼Œæ— é¢å¤–å¼€é”€ã€‚</li>
</ul>
<p><strong>åœºæ™¯ 2ï¼šä¸åŒç±»å‹åˆ†é…å™¨ç§»åŠ¨ï¼ˆä½†å…¼å®¹ï¼‰</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">TArray</span><span class="o">&lt;</span><span class="n">int32</span><span class="p">,</span> <span class="n">TSizedHeapAllocator</span><span class="o">&lt;</span><span class="mi">32</span><span class="o">&gt;&gt;</span> <span class="n">Source</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">TArray</span><span class="o">&lt;</span><span class="n">int32</span><span class="p">,</span> <span class="n">TSizedHeapAllocator</span><span class="o">&lt;</span><span class="mi">64</span><span class="o">&gt;&gt;</span> <span class="n">Dest</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">MoveOrCopy</span><span class="p">(</span><span class="n">Dest</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>è°ƒç”¨è·¯å¾„</strong>ï¼š
<code>MoveToEmptyFromOtherAllocator&lt;TSizedHeapAllocator&lt;32&gt;&gt;</code>ã€‚</li>
<li><strong>è¡Œä¸º</strong>ï¼š
æ ¹æ®æºåˆ†é…å™¨ç±»å‹é‡Šæ”¾æ—§å†…å­˜ï¼Œæ­£ç¡®æ¥ç®¡æ–°å†…å­˜ã€‚</li>
</ul>
<p><strong>åœºæ™¯ 3ï¼šä¸å…¼å®¹åˆ†é…å™¨ç§»åŠ¨</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">TArray</span><span class="o">&lt;</span><span class="n">int32</span><span class="p">,</span> <span class="n">TInlineAllocator</span><span class="o">&lt;</span><span class="mi">16</span><span class="o">&gt;&gt;</span> <span class="n">Source</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">TArray</span><span class="o">&lt;</span><span class="n">int32</span><span class="p">,</span> <span class="n">TSizedHeapAllocator</span><span class="o">&lt;</span><span class="mi">32</span><span class="o">&gt;&gt;</span> <span class="n">Dest</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">MoveOrCopy</span><span class="p">(</span><span class="n">Dest</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>è°ƒç”¨è·¯å¾„</strong>ï¼š
<code>MoveToEmpty</code> â†’ <code>MoveToEmptyFromOtherAllocator&lt;TSizedHeapAllocator&gt;</code>ã€‚</li>
<li><strong>è¡Œä¸º</strong>ï¼š
é”™è¯¯ï¼<code>TInlineAllocator</code>ï¼ˆæ ˆåˆ†é…ï¼‰ä¸ <code>TSizedHeapAllocator</code>ï¼ˆå †åˆ†é…ï¼‰ç­–ç•¥ä¸åŒï¼Œå¼ºåˆ¶è½¬æ¢å¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚</li>
</ul>
<div class="table-wrapper"><table>
<thead>
<tr>
<th><strong>æ¡ä»¶</strong></th>
<th><strong>è°ƒç”¨æ–¹å¼</strong></th>
<th><strong>å®‰å…¨æ€§</strong></th>
<th><strong>é€‚ç”¨åœºæ™¯</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>åˆ†é…å™¨å…¼å®¹</strong> (<code>TCanMove=true</code>)</td>
<td>æ˜¾å¼æ¨¡æ¿å‚æ•°ä¼ é€’ (<code>FromAllocatorType</code>)</td>
<td>é«˜</td>
<td>ä¸åŒç±»å‹ä½†å†…å­˜ç­–ç•¥å…¼å®¹çš„åˆ†é…å™¨</td>
</tr>
<tr>
<td><strong>åˆ†é…å™¨ä¸å…¼å®¹</strong> (<code>TCanMove=false</code>)</td>
<td>å¼ºåˆ¶é»˜è®¤åˆ†é…å™¨ç±»å‹ (<code>TSizedHeapAllocator</code>)</td>
<td>ä½</td>
<td>ä»…é™åŒç±»å‹æˆ–è®¾è®¡ç¡®ä¿å®‰å…¨çš„åˆ†é…å™¨</td>
</tr>
</tbody>
</table></div>
<p><strong>è®¾è®¡åŸåˆ™ï¼š</strong></p>
<ul>
<li><strong>é›¶å¼€é”€æŠ½è±¡</strong>ï¼šé€šè¿‡ç¼–è¯‘æ—¶åˆ†æ”¯é€‰æ‹©æœ€ä¼˜è·¯å¾„ã€‚</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šåˆ©ç”¨æ¨¡æ¿ç‰¹æ€§ç¡®ä¿å†…å­˜æ“ä½œæ­£ç¡®æ€§ã€‚</li>
<li><strong>æ‰©å±•æ€§</strong>ï¼šå…è®¸è‡ªå®šä¹‰åˆ†é…å™¨é€šè¿‡ç‰¹åŒ–å£°æ˜å…¼å®¹æ€§ã€‚</li>
</ul>
<p><strong>æœ€ä½³å®è·µï¼š</strong></p>
<ul>
<li><strong>è‡ªå®šä¹‰åˆ†é…å™¨</strong>ï¼šè‹¥éœ€æ”¯æŒè·¨ç±»å‹ç§»åŠ¨ï¼Œéœ€ç‰¹åŒ– <code>TCanMoveBetweenAllocators</code>ã€‚</li>
<li><strong>è°¨æ…ä½¿ç”¨é»˜è®¤è·¯å¾„</strong>ï¼šç¡®ä¿ä¸å…¼å®¹åˆ†é…å™¨çš„ç§»åŠ¨æ“ä½œåœ¨è®¾è®¡ä¸­æ— å®³ã€‚</li>
</ul>
<h5 id="ç‰‡æ®µ2"><strong>ç‰‡æ®µ2</strong>
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">ToArray</span><span class="p">.</span><span class="n">ArrayNum</span> <span class="o">=</span> <span class="p">(</span><span class="n">SizeType</span><span class="p">)</span><span class="n">FromArray</span><span class="p">.</span><span class="n">ArrayNum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ToArray</span><span class="p">.</span><span class="n">ArrayMax</span> <span class="o">=</span> <span class="p">(</span><span class="n">SizeType</span><span class="p">)</span><span class="n">FromArray</span><span class="p">.</span><span class="n">ArrayMax</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç¡®ä¿ç›®æ ‡å®¹å™¨èƒ½å¤Ÿå®¹çº³æºå®¹å™¨ä¸­çš„æ•°æ®èŒƒå›´ï¼Œç‰¹åˆ«æ˜¯åœ¨åˆ†é…å™¨å¤§å°ç±»å‹ç¼©å°çš„æƒ…å†µä¸‹ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1">// æ£€æŸ¥ç›®æ ‡å®¹å™¨çš„å¤§å°ç±»å‹ USizeType æ˜¯å¦æ¯”æºå®¹å™¨çš„å¤§å°ç±»å‹å°ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="nf">constexpr</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">USizeType</span><span class="p">)</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">typename</span> <span class="n">FromArrayType</span><span class="o">::</span><span class="n">USizeType</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//æ£€æŸ¥ç›®æ ‡å®¹å™¨çš„å½“å‰å…ƒç´ æ•°é‡ (ArrayNum) å’Œæœ€å¤§å®¹é‡ (ArrayMax) æ˜¯å¦ä¸æºå®¹å™¨ç›¸åŒ¹é…ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="n">ToArray</span><span class="p">.</span><span class="n">ArrayNum</span> <span class="o">!=</span> <span class="n">FromArray</span><span class="p">.</span><span class="n">ArrayNum</span> <span class="o">||</span> <span class="n">ToArray</span><span class="p">.</span><span class="n">ArrayMax</span> <span class="o">!=</span> <span class="n">FromArray</span><span class="p">.</span><span class="n">ArrayMax</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Cast to USizeType first to prevent sign extension on negative sizes, producing unusually large values.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">UE</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">Private</span><span class="o">::</span><span class="n">OnInvalidArrayNum</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)(</span><span class="n">USizeType</span><span class="p">)</span><span class="n">ToArray</span><span class="p">.</span><span class="n">ArrayNum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//----------------------------------------------------------------//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="n">UE</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">Private</span><span class="o">::</span><span class="n">OnInvalidArrayNum</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">NewNum</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogCore</span><span class="p">,</span> <span class="n">Fatal</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">&#34;Trying to resize TArray to an invalid size of %llu&#34;</span><span class="p">),</span> <span class="n">NewNum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(;;);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>UE::Core::Private::OnInvalidArrayNum Logä½¿ç”¨äº†Fatalï¼Œå¼•æ“å´©æºƒæŠ¥é”™.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">FromArray</span><span class="p">.</span><span class="n">ArrayNum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">FromArray</span><span class="p">.</span><span class="n">ArrayMax</span> <span class="o">=</span> <span class="n">FromArray</span><span class="p">.</span><span class="n">AllocatorInstance</span><span class="p">.</span><span class="n">GetInitialCapacity</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="n">FromArray</span><span class="p">.</span><span class="n">SlackTrackerNumChanged</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="n">ToArray</span><span class="p">.</span><span class="n">SlackTrackerNumChanged</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>FromArrayçš„ArrayNumã€ArrayMaxè®¾ç½®ä¸º0ï¼Œ</p>
<h5 id="æ€»ç»“-1"><strong>æ€»ç»“</strong>
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">if</span> <span class="nf">constexpr</span> <span class="p">(</span><span class="n">UE</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">Private</span><span class="o">::</span><span class="n">CanMoveTArrayPointersBetweenArrayTypes</span><span class="o">&lt;</span><span class="n">FromArrayType</span><span class="p">,</span> <span class="n">ToArrayType</span><span class="o">&gt;</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Move
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">TArray</span><span class="p">,</span> <span class="n">ToArrayType</span><span class="o">&gt;</span><span class="p">,</span> <span class="s">&#34;MoveOrCopy is expected to be called with the current array type as the destination&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">using</span> <span class="n">FromAllocatorType</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">FromArrayType</span><span class="o">::</span><span class="n">AllocatorType</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">using</span> <span class="n">ToAllocatorType</span>   <span class="o">=</span> <span class="k">typename</span> <span class="n">ToArrayType</span><span class="o">::</span><span class="n">AllocatorType</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//åˆ¤æ–­ä¼ å…¥çš„ä¸¤ä¸ªåˆ†é…å™¨èƒ½å¦ç§»åŠ¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="k">constexpr</span> <span class="p">(</span><span class="n">TCanMoveBetweenAllocators</span><span class="o">&lt;</span><span class="n">FromAllocatorType</span><span class="p">,</span> <span class="n">ToAllocatorType</span><span class="o">&gt;::</span><span class="n">Value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//ç§»åŠ¨åˆ†é…å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">ToArray</span><span class="p">.</span><span class="n">AllocatorInstance</span><span class="p">.</span><span class="k">template</span> <span class="n">MoveToEmptyFromOtherAllocator</span><span class="o">&lt;</span><span class="n">FromAllocatorType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">FromArray</span><span class="p">.</span><span class="n">AllocatorInstance</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">ToArray</span><span class="p">.</span><span class="n">AllocatorInstance</span><span class="p">.</span><span class="n">MoveToEmpty</span><span class="p">(</span><span class="n">FromArray</span><span class="p">.</span><span class="n">AllocatorInstance</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//æ‹¿æ¥å§ä½ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">ToArray</span>  <span class="p">.</span><span class="n">ArrayNum</span> <span class="o">=</span> <span class="p">(</span><span class="n">SizeType</span><span class="p">)</span><span class="n">FromArray</span><span class="p">.</span><span class="n">ArrayNum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">ToArray</span>  <span class="p">.</span><span class="n">ArrayMax</span> <span class="o">=</span> <span class="p">(</span><span class="n">SizeType</span><span class="p">)</span><span class="n">FromArray</span><span class="p">.</span><span class="n">ArrayMax</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">	<span class="c1">// ç¡®ä¿ç›®æ ‡å®¹å™¨èƒ½å¤Ÿå®¹çº³æºå®¹å™¨ä¸­çš„æ•°æ®èŒƒå›´ï¼Œç‰¹åˆ«æ˜¯åœ¨åˆ†é…å™¨å¤§å°ç±»å‹ç¼©å°çš„æƒ…å†µä¸‹ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// æ£€æŸ¥ç›®æ ‡å®¹å™¨çš„å¤§å°ç±»å‹ USizeType æ˜¯å¦æ¯”æºå®¹å™¨çš„å¤§å°ç±»å‹å°ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="k">constexpr</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">USizeType</span><span class="p">)</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">typename</span> <span class="n">FromArrayType</span><span class="o">::</span><span class="n">USizeType</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//æ£€æŸ¥ç›®æ ‡å®¹å™¨çš„å½“å‰å…ƒç´ æ•°é‡ (ArrayNum) å’Œæœ€å¤§å®¹é‡ (ArrayMax) æ˜¯å¦ä¸æºå®¹å™¨ç›¸åŒ¹é…ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    	<span class="k">if</span> <span class="p">(</span><span class="n">ToArray</span><span class="p">.</span><span class="n">ArrayNum</span> <span class="o">!=</span> <span class="n">FromArray</span><span class="p">.</span><span class="n">ArrayNum</span> <span class="o">||</span> <span class="n">ToArray</span><span class="p">.</span><span class="n">ArrayMax</span> <span class="o">!=</span> <span class="n">FromArray</span><span class="p">.</span><span class="n">ArrayMax</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    	<span class="p">{</span>
</span></span><span class="line"><span class="cl">    		<span class="c1">// Cast to USizeType first to prevent sign extension on negative sizes, producing unusually large values.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// è§¦å‘å´©æºƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    		<span class="n">UE</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">Private</span><span class="o">::</span><span class="n">OnInvalidArrayNum</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)(</span><span class="n">USizeType</span><span class="p">)</span><span class="n">ToArray</span><span class="p">.</span><span class="n">ArrayNum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    	<span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">//FromArrayçš„ArrayNumã€ArrayMaxè®¾ä¸º0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">FromArray</span><span class="p">.</span><span class="n">ArrayNum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">FromArray</span><span class="p">.</span><span class="n">ArrayMax</span> <span class="o">=</span> <span class="n">FromArray</span><span class="p">.</span><span class="n">AllocatorInstance</span><span class="p">.</span><span class="n">GetInitialCapacity</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">	<span class="n">FromArray</span><span class="p">.</span><span class="n">SlackTrackerNumChanged</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">ToArray</span><span class="p">.</span><span class="n">SlackTrackerNumChanged</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ææ„">ææ„
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cm">/** Destructor. */</span>
</span></span><span class="line"><span class="cl"><span class="o">~</span><span class="n">TArray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">DestructItems</span><span class="p">(</span><span class="n">GetData</span><span class="p">(),</span> <span class="n">ArrayNum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// note ArrayNum, ArrayMax and data pointer are not invalidated
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// they are left unchanged and use-after-destruct will see them the same as before destruct
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//--------------------------------//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span> <span class="o">&lt;</span>
</span></span><span class="line"><span class="cl">	<span class="k">typename</span> <span class="n">ElementType</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="k">typename</span> <span class="n">SizeType</span>
</span></span><span class="line"><span class="cl">	<span class="n">UE_REQUIRES</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">ElementType</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">std</span><span class="o">::</span><span class="n">is_trivially_destructible_v</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="o">&gt;</span><span class="p">)</span> <span class="c1">// the sizeof here should improve the error messages we get when we try to call this function with incomplete types
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="kt">void</span> <span class="n">DestructItems</span><span class="p">(</span><span class="n">ElementType</span><span class="o">*</span> <span class="n">Element</span><span class="p">,</span> <span class="n">SizeType</span> <span class="n">Count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span>
</span></span><span class="line"><span class="cl">	<span class="k">typename</span> <span class="n">ElementType</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="k">typename</span> <span class="n">SizeType</span>
</span></span><span class="line"><span class="cl">	<span class="n">UE_REQUIRES</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">ElementType</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">std</span><span class="o">::</span><span class="n">is_trivially_destructible_v</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="o">&gt;</span><span class="p">)</span> <span class="c1">// the sizeof here should improve the error messages we get when we try to call this function with incomplete types
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCENOINLINE</span> <span class="kt">void</span> <span class="n">DestructItems</span><span class="p">(</span><span class="n">ElementType</span><span class="o">*</span> <span class="n">Element</span><span class="p">,</span> <span class="n">SizeType</span> <span class="n">Count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">while</span> <span class="p">(</span><span class="n">Count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// We need a typedef here because VC won&#39;t compile the destructor call below if ElementType itself has a member called ElementType
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">typedef</span> <span class="n">ElementType</span> <span class="n">DestructItemsElementTypeTypedef</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">Element</span><span class="o">-&gt;</span><span class="n">DestructItemsElementTypeTypedef</span><span class="o">::~</span><span class="n">DestructItemsElementTypeTypedef</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="o">++</span><span class="n">Element</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="o">--</span><span class="n">Count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>is_trivially_destructible_v</code> æ£€æŸ¥ç»™å®šç±»å‹çš„ææ„å‡½æ•°æ˜¯å¦æ˜¯å¹³å‡¡çš„ï¼ˆtrivialï¼‰ã€‚</p>
<ul>
<li>
<p><strong>å¹³å‡¡ææ„å‡½æ•°</strong>ï¼šç±»å‹æ²¡æœ‰ç”¨æˆ·å®šä¹‰çš„ææ„å‡½æ•°ï¼Œæ‰€æœ‰éé™æ€æˆå‘˜å’ŒåŸºç±»éƒ½æœ‰å¹³å‡¡ææ„å‡½æ•°ã€‚</p>
</li>
<li>
<p>ç¤ºä¾‹ï¼šåŸºæœ¬æ•°æ®ç±»å‹ã€ç®€å•çš„PODï¼ˆPlain Old Dataï¼‰ç»“æ„ä½“ã€æŸäº›æ ‡å‡†åº“ç±»å‹ï¼ˆå¦‚ <code>std::array</code> å½“å…ƒç´ ç±»å‹ä¸ºå¹³å‡¡ç±»å‹æ—¶ï¼‰ã€‚</p>
</li>
<li>
<p><strong>éå¹³å‡¡ææ„å‡½æ•°</strong>ï¼šç±»å‹æœ‰ç”¨æˆ·å®šä¹‰çš„ææ„å‡½æ•°ï¼Œæˆ–è€…å…¶æˆå‘˜æˆ–åŸºç±»æœ‰éå¹³å‡¡ææ„å‡½æ•°ã€‚</p>
</li>
<li>
<p>ç¤ºä¾‹ï¼šç”¨æˆ·å®šä¹‰ææ„å‡½æ•°çš„ç±»ã€åŒ…å«æ ‡å‡†åº“å®¹å™¨ï¼ˆå¦‚ <code>std::vector</code>ï¼‰çš„ç±»ã€ä»å…·æœ‰éå¹³å‡¡ææ„å‡½æ•°çš„åŸºç±»æ´¾ç”Ÿçš„ç±»ã€‚</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;type_traits&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;array&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// åŸºæœ¬æ•°æ®ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;int: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">is_trivially_destructible_v</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// è¾“å‡º: true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// ç®€å•ç»“æ„ä½“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">struct</span> <span class="nc">Trivial</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Trivial: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">is_trivially_destructible_v</span><span class="o">&lt;</span><span class="n">Trivial</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// è¾“å‡º: true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// ç”¨æˆ·å®šä¹‰ææ„å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">struct</span> <span class="nc">NonTrivial</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">~</span><span class="n">NonTrivial</span><span class="p">()</span> <span class="k">noexcept</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;NonTrivial: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">is_trivially_destructible_v</span><span class="o">&lt;</span><span class="n">NonTrivial</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// è¾“å‡º: false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æˆå‘˜ç±»å‹æœ‰éå¹³å‡¡ææ„å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">struct</span> <span class="nc">NonTrivialMember</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;NonTrivialMember: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">is_trivially_destructible_v</span><span class="o">&lt;</span><span class="n">NonTrivialMember</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// è¾“å‡º: false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// åŸºç±»æœ‰éå¹³å‡¡ææ„å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">struct</span> <span class="nc">Base</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">~</span><span class="n">Base</span><span class="p">()</span> <span class="k">noexcept</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Derived</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Base</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Derived: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">is_trivially_destructible_v</span><span class="o">&lt;</span><span class="n">Derived</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// è¾“å‡º: false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ ‡å‡†åº“å®¹å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vec</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;std::vector&lt;int&gt;: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">is_trivially_destructible_v</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// è¾“å‡º: false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ ‡å‡†åº“ç±»å‹ï¼ˆå½“å…ƒç´ ç±»å‹ä¸ºå¹³å‡¡ç±»å‹æ—¶ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">5</span><span class="o">&gt;</span> <span class="n">arr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;std::array&lt;int, 5&gt;: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">is_trivially_destructible_v</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="c1">// è¾“å‡º: true
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>POD</strong></p>
<p>æ ¹æ®C++æ ‡å‡†ï¼ŒPODç±»å‹å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<ol>
<li><strong>å¹³å‡¡çš„é»˜è®¤æ„é€ å‡½æ•°ï¼ˆTrivial Default Constructorï¼‰</strong>ï¼š</li>
</ol>
<ul>
<li>ç±»å‹æ²¡æœ‰ç”¨æˆ·å®šä¹‰çš„é»˜è®¤æ„é€ å‡½æ•°ï¼Œæˆ–è€…å®ƒçš„é»˜è®¤æ„é€ å‡½æ•°æ˜¯å¹³å‡¡çš„ï¼ˆå³ç¼–è¯‘å™¨ç”Ÿæˆçš„é»˜è®¤æ„é€ å‡½æ•°ï¼‰ã€‚</li>
</ul>
<ol>
<li><strong>å¹³å‡¡çš„ææ„å‡½æ•°ï¼ˆTrivial Destructorï¼‰</strong>ï¼š</li>
</ol>
<ul>
<li>ç±»å‹æ²¡æœ‰ç”¨æˆ·å®šä¹‰çš„ææ„å‡½æ•°ï¼Œæˆ–è€…å®ƒçš„ææ„å‡½æ•°æ˜¯å¹³å‡¡çš„ï¼ˆå³ç¼–è¯‘å™¨ç”Ÿæˆçš„ææ„å‡½æ•°ï¼‰ã€‚</li>
</ul>
<ol>
<li><strong>å¹³å‡¡çš„æ‹·è´/ç§»åŠ¨æ“ä½œï¼ˆTrivial Copy/Move Operationsï¼‰</strong>ï¼š</li>
</ol>
<ul>
<li>ç±»å‹æ²¡æœ‰ç”¨æˆ·å®šä¹‰çš„æ‹·è´æ„é€ å‡½æ•°ã€æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ã€ç§»åŠ¨æ„é€ å‡½æ•°æˆ–ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ï¼Œæˆ–è€…è¿™äº›æ“ä½œæ˜¯å¹³å‡¡çš„ï¼ˆå³ç¼–è¯‘å™¨ç”Ÿæˆçš„æ“ä½œï¼‰ã€‚</li>
</ul>
<ol>
<li><strong>æ ‡å‡†å¸ƒå±€ï¼ˆStandard Layoutï¼‰</strong>ï¼š</li>
</ol>
<ul>
<li>
<p>ç±»å‹çš„æ‰€æœ‰éé™æ€æ•°æ®æˆå‘˜éƒ½å…·æœ‰ç›¸åŒçš„è®¿é—®æ§åˆ¶ï¼ˆpublic, protected, privateï¼‰ï¼Œå¹¶ä¸”åŸºç±»å’Œéé™æ€æ•°æ®æˆå‘˜ä¸èƒ½æœ‰è™šå‡½æ•°æˆ–è™šåŸºç±»ã€‚</p>
</li>
<li>
<p>æ‰€æœ‰éé™æ€æ•°æ®æˆå‘˜éƒ½å¿…é¡»å…·æœ‰æ ‡å‡†å¸ƒå±€ç±»å‹ï¼ˆstandard-layout typeï¼‰ã€‚</p>
</li>
<li>
<p>ç±»å‹æ²¡æœ‰è™šå‡½æ•°æˆ–è™šåŸºç±»ã€‚</p>
</li>
<li>
<p><code>**std::is_trivial**</code>ï¼šæ£€æŸ¥ç±»å‹æ˜¯å¦æœ‰å¹³å‡¡çš„æ„é€ å‡½æ•°ã€ææ„å‡½æ•°å’Œæ‹·è´/ç§»åŠ¨æ“ä½œã€‚</p>
</li>
<li>
<p><code>**std::is_standard_layout**</code>ï¼šæ£€æŸ¥ç±»å‹æ˜¯å¦å…·æœ‰æ ‡å‡†å¸ƒå±€ã€‚</p>
</li>
</ul>
<p>å¹³å‡¡ç±»å‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;type_traits&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Trivial</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">boolalpha</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// æ£€æŸ¥æ˜¯å¦ä¸ºå¹³å‡¡ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Trivial is trivial: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">is_trivial_v</span><span class="o">&lt;</span><span class="n">Trivial</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// è¾“å‡º: true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ£€æŸ¥æ˜¯å¦ä¸ºæ ‡å‡†å¸ƒå±€ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Trivial is standard layout: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">is_standard_layout_v</span><span class="o">&lt;</span><span class="n">Trivial</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// è¾“å‡º: true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>éå¹³å‡¡ç±»å‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;type_traits&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">NonTrivial</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">~</span><span class="n">NonTrivial</span><span class="p">()</span> <span class="k">noexcept</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">NonStandardLayout</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">NonTrivialMember</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">boolalpha</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// æ£€æŸ¥æ˜¯å¦ä¸ºå¹³å‡¡ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;NonTrivial is trivial: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">is_trivial_v</span><span class="o">&lt;</span><span class="n">NonTrivial</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// è¾“å‡º: false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;NonStandardLayout is trivial: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">is_trivial_v</span><span class="o">&lt;</span><span class="n">NonStandardLayout</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// è¾“å‡º: false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;NonTrivialMember is trivial: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">is_trivial_v</span><span class="o">&lt;</span><span class="n">NonTrivialMember</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// è¾“å‡º: false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ£€æŸ¥æ˜¯å¦ä¸ºæ ‡å‡†å¸ƒå±€ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;NonStandardLayout is standard layout: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">is_standard_layout_v</span><span class="o">&lt;</span><span class="n">NonStandardLayout</span><span class="o">&gt;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// è¾“å‡º: false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ€»ç»“-2">æ€»ç»“
</h3><div class="table-wrapper"><table>
<thead>
<tr>
<th><strong>æ„é€ å‡½æ•°</strong></th>
<th><strong>ç¤ºä¾‹åœºæ™¯</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>é»˜è®¤æ„é€ </strong></td>
<td>åˆ›å»ºç©ºæ•°ç»„</td>
</tr>
<tr>
<td><strong>åŸå§‹æ•°ç»„æ„é€ </strong></td>
<td>ä» C æ•°ç»„æˆ–å†…å­˜å—åˆå§‹åŒ–</td>
</tr>
<tr>
<td><strong>TArrayView æ„é€ </strong></td>
<td>ä»æ•°æ®è§†å›¾ï¼ˆæ— æ‰€æœ‰æƒï¼‰åˆå§‹åŒ–</td>
</tr>
<tr>
<td><strong>åˆå§‹åŒ–åˆ—è¡¨æ„é€ </strong></td>
<td>å¿«é€Ÿåˆå§‹åŒ–å°å‹æ•°ç»„</td>
</tr>
<tr>
<td><strong>è·¨åˆ†é…å™¨æ‹·è´</strong></td>
<td>ä¸åŒå†…å­˜ç­–ç•¥çš„æ•°ç»„é—´å¤åˆ¶æ•°æ®</td>
</tr>
<tr>
<td><strong>æ™®é€šæ‹·è´æ„é€ </strong></td>
<td>åŒç±»å‹æ•°ç»„çš„æ·±æ‹·è´</td>
</tr>
<tr>
<td><strong>å¸¦é¢å¤–å®¹é‡çš„æ‹·è´æ„é€ </strong></td>
<td>é¢„åˆ†é…ç©ºé—´ä»¥å‡å°‘åç»­æ‰©å®¹å¼€é”€</td>
</tr>
<tr>
<td><strong>ç§»åŠ¨æ„é€ </strong></td>
<td><strong>å‡å°‘ä¸´æ—¶å¯¹è±¡çš„å¼€é”€</strong></td>
</tr>
</tbody>
</table></div>
<h2 id="å¢åˆ æ”¹æŸ¥">å¢åˆ æ”¹æŸ¥
</h2><div class="table-wrapper"><table>
<thead>
<tr>
<th><strong>æ–¹æ³•</strong></th>
<th><strong>åŠŸèƒ½</strong></th>
<th><strong>æ—¶é—´å¤æ‚åº¦</strong></th>
<th><strong>ç¤ºä¾‹</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Push</code> / <code>Add</code></td>
<td>åœ¨æ•°ç»„æœ«å°¾æ·»åŠ å…ƒç´ </td>
<td>å‡æ‘Š O(1)</td>
<td><code>TArray&lt;int&gt; arr; ``arr.Add(1);</code></td>
</tr>
<tr>
<td><code>Pop</code></td>
<td>ç§»é™¤å¹¶è¿”å›æ•°ç»„æœ«å°¾å…ƒç´ </td>
<td>O(1)</td>
<td><code>int val = arr.Pop();</code></td>
</tr>
<tr>
<td><code>Top</code> / <code>Last</code></td>
<td>è·å–æ•°ç»„æœ«å°¾å…ƒç´ ï¼ˆä¸ç§»é™¤ï¼‰</td>
<td>O(1)</td>
<td><code>int val = arr.Last();</code></td>
</tr>
<tr>
<td><code>Emplace</code></td>
<td>åœ¨æœ«å°¾ç›´æ¥æ„é€ å…ƒç´ ï¼ˆé¿å…æ‹·è´ï¼‰</td>
<td>å‡æ‘Š O(1)</td>
<td><code>arr.Emplace(42);</code></td>
</tr>
</tbody>
</table></div>
<h3 id="pop">Pop
</h3><p><code>Pop</code> å‡½æ•°æ˜¯ <code>TArray</code> ç±»ä¸­çš„ä¸€ä¸ªæˆå‘˜å‡½æ•°ï¼Œç”¨äºä»æ•°ç»„ä¸­ç§»é™¤å¹¶è¿”å›æœ€åä¸€ä¸ªå…ƒç´ ã€‚</p>
<p>è¿™ä¸ªå‡½æ•°è¿˜æä¾›äº†å¯é€‰çš„æ”¶ç¼©ï¼ˆshrinkï¼‰åŠŸèƒ½ï¼Œå…è®¸åœ¨ç§»é™¤å…ƒç´ åè°ƒæ•´æ•°ç»„çš„å®¹é‡ä»¥èŠ‚çœå†…å­˜ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// * *
</span></span></span><span class="line"><span class="cl"><span class="c1">// *ä»æ•°ç»„ä¸­å¼¹å‡ºå…ƒç´ ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1">// *
</span></span></span><span class="line"><span class="cl"><span class="c1">// * @param allowshrinkæ˜¯å¦å…è®¸åœ¨åˆ é™¤å…ƒç´ æœŸé—´æ”¶ç¼©æ•°ç»„ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1">// * @è¿”å›å¼¹å‡ºçš„å…ƒç´ ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1">// * 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">ElementType</span> <span class="nf">Pop</span><span class="p">(</span><span class="n">EAllowShrinking</span> <span class="n">AllowShrinking</span> <span class="o">=</span> <span class="n">EAllowShrinking</span><span class="o">::</span><span class="n">Yes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//ç¡®ä¿æ•°ç»„è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">RangeCheck</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">//è·å–æ•°ç»„ä¸­æœ€åä¸€ä¸ªå…ƒç´ ï¼ˆç´¢å¼•ä¸º ArrayNum - 1ï¼‰ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//ä½¿ç”¨ MoveTempIfPossible å°†å…¶è½¬æ¢ä¸ºå³å€¼å¼•ç”¨ï¼Œä»è€Œå¯ç”¨ç§»åŠ¨è¯­ä¹‰ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//è¿™å¯ä»¥é¿å…ä¸å¿…è¦çš„æ‹·è´æ“ä½œï¼Œæé«˜æ€§èƒ½ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">ElementType</span> <span class="n">Result</span> <span class="o">=</span> <span class="n">MoveTempIfPossible</span><span class="p">(</span><span class="n">GetData</span><span class="p">()[</span><span class="n">ArrayNum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//ä»æ•°ç»„ä¸­ç§»é™¤æœ€åä¸€ä¸ªå…ƒç´ ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">RemoveAtImpl</span><span class="p">(</span><span class="n">ArrayNum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">AllowShrinking</span> <span class="o">==</span> <span class="n">EAllowShrinking</span><span class="o">::</span><span class="n">Yes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//é‡Šæ”¾æœªä½¿ç”¨çš„å†…å­˜ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">ResizeShrink</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">UE_INTRINSIC_CAST</span> <span class="n">FORCEINLINE</span> <span class="k">constexpr</span> <span class="n">std</span><span class="o">::</span><span class="n">remove_reference_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;&amp;</span> <span class="n">MoveTempIfPossible</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;&amp;</span> <span class="n">Obj</span><span class="p">)</span> <span class="k">noexcept</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//å®šä¹‰ä¸€ä¸ªç±»å‹åˆ«å CastTypeï¼Œå®ƒæ˜¯ç§»é™¤äº†å¼•ç”¨å±æ€§åçš„ T ç±»å‹ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">using</span> <span class="n">CastType</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">remove_reference_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//å°†ä¼ å…¥çš„å¯¹è±¡ Obj è½¬æ¢ä¸ºå³å€¼å¼•ç”¨ï¼Œå¹¶è¿”å›ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//è¿™æ ·åšçš„ç›®çš„æ˜¯å¯ç”¨ç§»åŠ¨è¯­ä¹‰ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">return</span> <span class="p">(</span><span class="n">CastType</span><span class="o">&amp;&amp;</span><span class="p">)</span><span class="n">Obj</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="movetempifpossible-å³å€¼å¼•ç”¨"><code>MoveTempIfPossible</code> å³å€¼å¼•ç”¨
</h4><ul>
<li><strong>å‚æ•°</strong> <code>**T&amp;&amp; Obj**</code>ï¼šä½¿ç”¨äº†é€šç”¨å¼•ç”¨ï¼ˆuniversal referenceï¼‰ï¼Œå¯ä»¥æ¥å—å·¦å€¼å¼•ç”¨æˆ–å³å€¼å¼•ç”¨ã€‚</li>
<li><strong>è¿”å›ç±»å‹</strong> <code>**std::remove_reference_t&lt;T&gt;&amp;&amp;**</code>ï¼šç§»é™¤ <code>T</code> çš„å¼•ç”¨å±æ€§åå°†å…¶è½¬æ¢ä¸ºå³å€¼å¼•ç”¨ã€‚</li>
</ul>
<p>å°†ä¸€ä¸ªå¼•ç”¨è½¬æ¢ä¸ºå³å€¼å¼•ç”¨ï¼ˆrvalue referenceï¼‰ï¼Œ è¿™æ˜¯ UE ä¸­ <code>std::move</code> çš„ç­‰ä»·å®ç°ã€‚</p>
<p>ä¸ <code>MoveTemp</code> ä¸åŒï¼Œå®ƒä¸ä¼šè¿›è¡Œé™æ€æ–­è¨€ï¼Œå› æ­¤åœ¨æ¨¡æ¿æˆ–å®ä¸­ä½¿ç”¨æ—¶æ›´åŠ çµæ´»ï¼Œä¸ä¼šä¸­æ–­ç¼–è¯‘ã€‚</p>
<p>å› ä¸ºåœ¨æ¨¡æ¿æˆ–å®ä¸­ä½¿ç”¨æ—¶ï¼Œå‚æ•°çš„å…·ä½“ç±»å‹å¯èƒ½ä¸æ˜ç¡®ï¼Œä½†ä½ ä»ç„¶å¸Œæœ›åœ¨å¯ä»¥çš„æƒ…å†µä¸‹åˆ©ç”¨ç§»åŠ¨è¯­ä¹‰ï¼Œè€Œä¸ä¸­æ–­ç¼–è¯‘ã€‚</p>
<h4 id="å·¦å€¼å³å€¼">å·¦å€¼å³å€¼
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyClass</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">MyClass</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">MyClass</span><span class="p">(</span><span class="n">MyClass</span><span class="o">&amp;&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="k">noexcept</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ç§»åŠ¨æ„é€ å‡½æ•°çš„å®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä½¿ç”¨ MoveTempIfPossible
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">ProcessObject</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;&amp;</span> <span class="n">Obj</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">MyClass</span> <span class="n">MovedObj</span> <span class="o">=</span> <span class="n">MoveTempIfPossible</span><span class="p">(</span><span class="n">Obj</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">MyClass</span> <span class="n">Obj</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ProcessObject</span><span class="p">(</span><span class="n">Obj</span><span class="p">);</span> <span class="c1">// å·¦å€¼å¼•ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">ProcessObject</span><span class="p">(</span><span class="n">MyClass</span><span class="p">());</span> <span class="c1">// å³å€¼å¼•ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>Obj</code> æ˜¯ä¸€ä¸ªå·¦å€¼å¼•ç”¨ã€‚<code>MoveTempIfPossible</code> ä¼šå°†å…¶è½¬æ¢ä¸ºå³å€¼å¼•ç”¨ï¼Œä»è€Œè§¦å‘ç§»åŠ¨æ„é€ å‡½æ•°ã€‚</li>
<li><code>MyClass()</code> æ˜¯ä¸€ä¸ªä¸´æ—¶å¯¹è±¡ï¼ˆå³å€¼ï¼‰ã€‚<code>MoveTempIfPossible</code> ä¹Ÿä¼šå°†å…¶è½¬æ¢ä¸ºå³å€¼å¼•ç”¨ï¼Œä»è€Œè§¦å‘ç§»åŠ¨æ„é€ å‡½æ•°ã€‚</li>
</ul>
<h3 id="add">Add
</h3><p>åœ¨æ•°ç»„æœ«å°¾æ·»åŠ ä¸€ä¸ªæ–°é¡¹ï¼Œå¯èƒ½ä¼šé‡æ–°åˆ†é…æ•´ä¸ªæ•°ç»„ä»¥å®¹çº³å®ƒã€‚</p>
<p>è¿”å›ä¸€ä¸ªç´¢å¼•ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="n">SizeType</span> <span class="nf">Add</span><span class="p">(</span><span class="k">const</span> <span class="n">ElementType</span><span class="o">&amp;</span> <span class="n">Item</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">CheckAddress</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Item</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Emplace</span><span class="p">(</span><span class="n">Item</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="n">SizeType</span> <span class="nf">Add</span><span class="p">(</span><span class="n">ElementType</span><span class="o">&amp;&amp;</span> <span class="n">Item</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CheckAddress</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Item</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">Emplace</span><span class="p">(</span><span class="n">MoveTempIfPossible</span><span class="p">(</span><span class="n">Item</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ£€æŸ¥æŒ‡å®šçš„åœ°å€æ˜¯å¦ä¸æ˜¯å®¹å™¨å†…å…ƒç´ çš„ä¸€éƒ¨åˆ†ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1">// ç”¨äºåœ¨å®ç°ä¸­æ£€æŸ¥å¼•ç”¨å‚æ•°æ˜¯å¦ä¼šå› ä¸ºå¯èƒ½çš„é‡æ–°åˆ†é…è€Œå¤±æ•ˆã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">FORCEINLINE</span> <span class="kt">void</span> <span class="nf">CheckAddress</span><span class="p">(</span><span class="k">const</span> <span class="n">ElementType</span><span class="o">*</span> <span class="n">Addr</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">checkf</span><span class="p">(</span><span class="n">Addr</span> <span class="o">&lt;</span> <span class="n">GetData</span><span class="p">()</span> <span class="o">||</span> <span class="n">Addr</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">GetData</span><span class="p">()</span> <span class="o">+</span> <span class="n">ArrayMax</span><span class="p">),</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">&#34;Attempting to use a container element (%p) which already comes from the container being modified (%p, ArrayMax: %lld, ArrayNum: %lld, SizeofElement: %d)!&#34;</span><span class="p">),</span> <span class="n">Addr</span><span class="p">,</span> <span class="n">GetData</span><span class="p">(),</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">ArrayMax</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">ArrayNum</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ElementType</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="emplace"><strong>Emplace</strong>
</h4><p>åœ¨æ•°ç»„çš„æœ«å°¾æ„é€ ä¸€ä¸ªæ–°å…ƒç´ ï¼Œå¯èƒ½ä¼šé‡æ–°åˆ†é…æ•´ä¸ªæ•°ç»„æ¥å®¹çº³å®ƒã€‚</p>
<p>è¿”å›ä¸€ä¸ªç´¢å¼•ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Constructs a new item at the end of the array, possibly reallocating the whole array to fit.
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param Args  The arguments to forward to the constructor of the new item.
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @return     Index to the new item
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">ArgsType</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="n">SizeType</span> <span class="n">Emplace</span><span class="p">(</span><span class="n">ArgsType</span><span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">Args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//å¢åŠ æ•°ç»„çš„å¤§å°ï¼Œå¹¶è¿”å›æ–°å…ƒç´ å°†è¦æ’å…¥çš„ä½ç½®ç´¢å¼•ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">const</span> <span class="n">SizeType</span> <span class="n">Index</span> <span class="o">=</span> <span class="n">AddUninitialized</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//GetData() è¿”å›æŒ‡å‘æ•°ç»„æ•°æ®çš„æŒ‡é’ˆï¼ŒGetData() + Index è®¡ç®—å‡ºæ–°å…ƒç´ åº”æ”¾ç½®çš„ä½ç½®ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//ä½¿ç”¨ ::new è¿›è¡ŒåŸä½æ„é€ ï¼ˆplacement newï¼‰ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//ç›´æ¥åœ¨æŒ‡å®šå†…å­˜ä½ç½®æ„é€ æ–°å¯¹è±¡ï¼Œé¿å…é¢å¤–çš„æ‹·è´æˆ–ç§»åŠ¨æ“ä½œã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//Forward&lt;ArgsType&gt;(Args)... å°†å‚æ•°å®Œç¾è½¬å‘ç»™æ„é€ å‡½æ•°ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">::</span><span class="k">new</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="n">GetData</span><span class="p">()</span> <span class="o">+</span> <span class="n">Index</span><span class="p">))</span> <span class="n">ElementType</span><span class="p">(</span><span class="n">Forward</span><span class="o">&lt;</span><span class="n">ArgsType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Args</span><span class="p">)...);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Index</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="n">SizeType</span> <span class="nf">AddUninitialized</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//ç¡®ä¿æ•°ç»„å†…éƒ¨çŠ¶æ€çš„ä¸€è‡´æ€§ï¼Œé˜²æ­¢éæ³•çŠ¶æ€ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//checkSlow((ArrayNum &gt;= 0) &amp; (ArrayMax &gt;= ArrayNum)); 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">CheckInvariants</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ArrayNum = ArrayNum + 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">const</span> <span class="n">USizeType</span> <span class="n">OldNum</span> <span class="o">=</span> <span class="p">(</span><span class="n">USizeType</span><span class="p">)</span><span class="n">ArrayNum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">USizeType</span> <span class="n">NewNum</span> <span class="o">=</span> <span class="n">OldNum</span> <span class="o">+</span> <span class="p">(</span><span class="n">USizeType</span><span class="p">)</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ArrayNum</span> <span class="o">=</span> <span class="p">(</span><span class="n">SizeType</span><span class="p">)</span><span class="n">NewNum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">NewNum</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">USizeType</span><span class="p">)</span><span class="n">ArrayMax</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//å¦‚æœ NewNum è¶…è¿‡äº† ArrayMaxï¼Œåˆ™è°ƒç”¨ ResizeGrow å¢åŠ æ•°ç»„çš„å®¹é‡ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">ResizeGrow</span><span class="p">((</span><span class="n">SizeType</span><span class="p">)</span><span class="n">OldNum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//è°ƒç”¨ SlackTrackerNumChanged æ›´æ–°æ¾å¼›ï¼ˆslackï¼‰ä¿¡æ¯ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">SlackTrackerNumChanged</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//è¿”å› OldNumï¼Œå³æ–°å…ƒç´ å°†è¦æ’å…¥çš„ä½ç½®ç´¢å¼•ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">OldNum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="fprivatetoken">FPrivateToken
</h4><p>è®©TArrayå¯ä»¥è°ƒç”¨ç§æœ‰æ„é€ å‡½æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">FMyType</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="nc">FPrivateToken</span> <span class="p">{</span> <span class="k">explicit</span> <span class="nf">FPrivateToken</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// This has an equivalent access level to a private constructor,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// as only friends of FMyType will have access to FPrivateToken,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// but Emplace can legally call it since it&#39;s public.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">explicit</span> <span class="n">FMyType</span><span class="p">(</span><span class="n">FPrivateToken</span><span class="p">,</span> <span class="n">int32</span> <span class="n">Int</span><span class="p">,</span> <span class="kt">float</span> <span class="n">Real</span><span class="p">,</span> <span class="k">const</span> <span class="n">TCHAR</span><span class="o">*</span> <span class="n">String</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FMyType</span><span class="o">&gt;</span> <span class="n">Arr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Arr</span><span class="p">.</span><span class="n">Emplace</span><span class="p">(</span><span class="n">FMyType</span><span class="o">::</span><span class="n">FPrivateToken</span><span class="p">{},</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">3.14f</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">&#34;Banana&#34;</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="remove">Remove
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">SizeType</span> <span class="nf">Remove</span><span class="p">(</span><span class="k">const</span> <span class="n">ElementType</span><span class="o">&amp;</span> <span class="n">Item</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ£€æŸ¥æŒ‡å®šçš„åœ°å€æ˜¯å¦ä¸æ˜¯å®¹å™¨å†…å…ƒç´ çš„ä¸€éƒ¨åˆ†ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">CheckAddress</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Item</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Element is non-const to preserve compatibility with existing code with a non-const operator==() member function
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// å…ƒç´ æ˜¯é const çš„ï¼Œä»¥ä¿æŒä¸ç°æœ‰ä»£ç ä¸­å…·æœ‰é const operator==() æˆå‘˜å‡½æ•°çš„å…¼å®¹æ€§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">RemoveAll</span><span class="p">([</span><span class="o">&amp;</span><span class="n">Item</span><span class="p">](</span><span class="n">ElementType</span><span class="o">&amp;</span> <span class="n">Element</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Element</span> <span class="o">==</span> <span class="n">Item</span><span class="p">;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">PREDICATE_CLASS</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">SizeType</span> <span class="n">RemoveAll</span><span class="p">(</span><span class="k">const</span> <span class="n">PREDICATE_CLASS</span><span class="o">&amp;</span> <span class="n">Predicate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//å¦‚æœä¸ºç©ºï¼Œåˆ™ç›´æ¥è¿”å› 0ï¼Œå› ä¸ºæ²¡æœ‰å…ƒç´ å¯ä»¥ç§»é™¤ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//OriginalNum è®°å½•æ•°ç»„çš„åŸå§‹å¤§å°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">const</span> <span class="n">SizeType</span> <span class="n">OriginalNum</span> <span class="o">=</span> <span class="n">ArrayNum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">OriginalNum</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// nothing to do, loop assumes one item so need to deal with this edge case here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//æŒ‡å‘æ•°ç»„æ•°æ®çš„æŒ‡é’ˆã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">ElementType</span><span class="o">*</span> <span class="n">Data</span> <span class="o">=</span> <span class="n">GetData</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//WriteIndex ReadIndexåˆ†åˆ«ç”¨äºå†™å…¥å’Œè¯»å–æ“ä½œçš„ç´¢å¼•ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">SizeType</span> <span class="n">WriteIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">//ä¸æ–­å¢åŠ ï¼Œç›´åˆ°é‡åˆ°ä¸å½“å‰è¿è¡Œç±»å‹ä¸åŒçš„å…ƒç´ ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">SizeType</span> <span class="n">ReadIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//æ ¹æ®ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å¦æ»¡è¶³è°“è¯ï¼Œåˆå§‹åŒ– bNotMatch å˜é‡ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//å¦‚æœbNotMatch = falseï¼Œåˆ™è¯´æ˜åŒ¹é…æˆåŠŸï¼Œåœ¨do-whileä¸­çš„if-elseä¼šæ‰§è¡Œfalseåˆ†æ”¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//elseåˆ†æ”¯è°ƒç”¨DestructItemsï¼Œé”€æ¯å…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//å¦‚æœbNotMatch = trueï¼ŒåŒ¹é…å¤±è´¥ï¼Œif-elseæ‰§è¡Œtrueåˆ†æ”¯ï¼Œç§»åŠ¨å…ƒç´ é‡æ–°æ’åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">bool</span> <span class="n">bNotMatch</span> <span class="o">=</span> <span class="o">!::</span><span class="n">Invoke</span><span class="p">(</span><span class="n">Predicate</span><span class="p">,</span> <span class="n">Data</span><span class="p">[</span><span class="n">ReadIndex</span><span class="p">]);</span> <span class="c1">// use a ! to guarantee it can&#39;t be anything other than zero or one
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="k">do</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//è®°å½•å½“å‰è¿è¡Œçš„èµ·å§‹ä½ç½®ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">SizeType</span> <span class="n">RunStartIndex</span> <span class="o">=</span> <span class="n">ReadIndex</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">while</span> <span class="p">(</span><span class="n">ReadIndex</span> <span class="o">&lt;</span> <span class="n">OriginalNum</span> <span class="o">&amp;&amp;</span> <span class="n">bNotMatch</span> <span class="o">==</span> <span class="o">!::</span><span class="n">Invoke</span><span class="p">(</span><span class="n">Predicate</span><span class="p">,</span> <span class="n">Data</span><span class="p">[</span><span class="n">ReadIndex</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">ReadIndex</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">//è®¡ç®—å½“å‰è¿è¡Œçš„é•¿åº¦ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">SizeType</span> <span class="n">RunLength</span> <span class="o">=</span> <span class="n">ReadIndex</span> <span class="o">-</span> <span class="n">RunStartIndex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">checkSlow</span><span class="p">(</span><span class="n">RunLength</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">bNotMatch</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// this was a non-matching run, we need to move it
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">if</span> <span class="p">(</span><span class="n">WriteIndex</span> <span class="o">!=</span> <span class="n">RunStartIndex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">//å°†è¿™äº›å…ƒç´ ç§»åŠ¨åˆ° WriteIndex æŒ‡å‘çš„ä½ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="n">RelocateConstructItems</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="o">&gt;</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="n">Data</span> <span class="o">+</span> <span class="n">WriteIndex</span><span class="p">),</span> <span class="n">Data</span> <span class="o">+</span> <span class="n">RunStartIndex</span><span class="p">,</span> <span class="n">RunLength</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//æ›´æ–° WriteIndexï¼Œä½¿å…¶æŒ‡å‘ä¸‹ä¸€ä¸ªéœ€è¦å†™å…¥æ•°æ®çš„ä½ç½®ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">WriteIndex</span> <span class="o">+=</span> <span class="n">RunLength</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// this was a matching run, delete it
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">//é”€æ¯è¿™äº›å…ƒç´ ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">DestructItems</span><span class="p">(</span><span class="n">Data</span> <span class="o">+</span> <span class="n">RunStartIndex</span><span class="p">,</span> <span class="n">RunLength</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">bNotMatch</span> <span class="o">=</span> <span class="o">!</span><span class="n">bNotMatch</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">ReadIndex</span> <span class="o">&lt;</span> <span class="n">OriginalNum</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ArrayNum</span> <span class="o">=</span> <span class="n">WriteIndex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">SlackTrackerNumChanged</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//è¿”å›è¢«ç§»é™¤çš„å…ƒç´ æ•°é‡ï¼Œå³åŸå§‹æ•°ç»„å¤§å°å‡å»å½“å‰æ•°ç»„å¤§å°ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">OriginalNum</span> <span class="o">-</span> <span class="n">ArrayNum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>æ¨¡æ¿å‚æ•°</strong> <code>**PREDICATE_CLASS**</code>ï¼šè°“è¯ç±»å®ä¾‹çš„ç±»å‹ã€‚</li>
<li><strong>å‚æ•°</strong> <code>**Predicate**</code>ï¼šä¸€ä¸ªè°“è¯å¯¹è±¡ï¼Œç”¨äºåˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦éœ€è¦è¢«ç§»é™¤ã€‚</li>
<li><strong>è¿”å›å€¼</strong> <code>**SizeType**</code>ï¼šè¿”å›è¢«ç§»é™¤çš„å…ƒç´ æ•°é‡ã€‚</li>
</ul>
<ol>
<li><strong>è·å–åŸå§‹æ•°ç»„å¤§å°</strong>ï¼š</li>
</ol>
<ul>
<li>å¦‚æœæ•°ç»„ä¸ºç©ºï¼Œç›´æ¥è¿”å› 0ã€‚</li>
</ul>
<ol>
<li><strong>åˆå§‹åŒ–å˜é‡</strong>ï¼š</li>
</ol>
<ul>
<li>è·å–æ•°ç»„æ•°æ®æŒ‡é’ˆ <code>Data</code>ã€‚</li>
<li>åˆå§‹åŒ–è¯»å–ç´¢å¼• <code>ReadIndex</code> å’Œå†™å…¥ç´¢å¼• <code>WriteIndex</code>ã€‚</li>
<li>æ ¹æ®ç¬¬ä¸€ä¸ªå…ƒç´ çš„çŠ¶æ€åˆå§‹åŒ– <code>bNotMatch</code> å˜é‡ã€‚</li>
</ul>
<ol>
<li><strong>éå†æ•°ç»„</strong>ï¼š</li>
</ol>
<ul>
<li>ä½¿ç”¨ <code>do...while</code> å¾ªç¯éå†æ•°ç»„ï¼Œæ¯æ¬¡å¤„ç†ä¸€æ®µè¿ç»­çš„åŒ¹é…æˆ–éåŒ¹é…å…ƒç´ æ®µï¼ˆè¿è¡Œï¼‰ã€‚</li>
<li><strong>å†…å±‚å¾ªç¯</strong>ï¼šæ‰¾åˆ°ä¸€æ®µè¿ç»­çš„åŒ¹é…æˆ–éåŒ¹é…å…ƒç´ ã€‚</li>
<li><strong>å¤„ç†éåŒ¹é…è¿è¡Œ</strong>ï¼šå°†è¿™äº›å…ƒç´ ç§»åŠ¨åˆ° <code>WriteIndex</code> æŒ‡å‘çš„ä½ç½®ï¼Œå¹¶æ›´æ–° <code>WriteIndex</code>ã€‚</li>
<li><strong>å¤„ç†åŒ¹é…è¿è¡Œ</strong>ï¼šé”€æ¯è¿™äº›å…ƒç´ ã€‚</li>
<li>åˆ‡æ¢ <code>bNotMatch</code> çš„å€¼ï¼Œå‡†å¤‡å¤„ç†ä¸‹ä¸€ä¸ªè¿è¡Œã€‚</li>
</ul>
<ol>
<li><strong>æ›´æ–°æ•°ç»„å¤§å°</strong>ï¼š</li>
</ol>
<ul>
<li>æ›´æ–°æ•°ç»„çš„æœ‰æ•ˆå…ƒç´ æ•°é‡ <code>ArrayNum</code> ä¸º <code>WriteIndex</code>ã€‚</li>
</ul>
<ol>
<li><strong>è¿”å›ç»“æœ</strong>ï¼š</li>
</ol>
<ul>
<li>è¿”å›è¢«ç§»é™¤çš„å…ƒç´ æ•°é‡ã€‚</li>
</ul>
<h3 id="removeat">RemoveAt
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">RemoveAt</span><span class="p">(</span><span class="n">SizeType</span> <span class="n">Index</span><span class="p">,</span> <span class="n">EAllowShrinking</span> <span class="n">AllowShrinking</span> <span class="o">=</span> <span class="n">EAllowShrinking</span><span class="o">::</span><span class="n">Yes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">RangeCheck</span><span class="p">(</span><span class="n">Index</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">RemoveAtImpl</span><span class="p">(</span><span class="n">Index</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">AllowShrinking</span> <span class="o">==</span> <span class="n">EAllowShrinking</span><span class="o">::</span><span class="n">Yes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æ ¹æ®éœ€è¦ ç¼©å°æ•°ç»„å¤§å°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">ResizeShrink</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">RemoveAtImpl</span><span class="p">(</span><span class="n">SizeType</span> <span class="n">Index</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è·å–è¦ç§»é™¤å…ƒç´ çš„ä½ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">ElementType</span><span class="o">*</span> <span class="n">Dest</span> <span class="o">=</span> <span class="n">GetData</span><span class="p">()</span> <span class="o">+</span> <span class="n">Index</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// é”€æ¯è¯¥ä½ç½®çš„å…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">DestructItem</span><span class="p">(</span><span class="n">Dest</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">	<span class="c1">// Skip relocation in the common case that there is nothing to move.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// åœ¨æ²¡æœ‰ä¸œè¥¿å¯ç§»åŠ¨çš„æƒ…å†µä¸‹ï¼Œè·³è¿‡é‡å®šä½ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">SizeType</span> <span class="n">NumToMove</span> <span class="o">=</span> <span class="p">(</span><span class="n">ArrayNum</span> <span class="o">-</span> <span class="n">Index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">NumToMove</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">RelocateConstructItems</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="o">&gt;</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">Dest</span><span class="p">,</span> <span class="n">Dest</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NumToMove</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//å°†ä¸€ç»„å…ƒç´ ä»ä¸€ä¸ªä½ç½®ç§»åŠ¨åˆ°å¦ä¸€ä¸ªä½ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">//ä¼ å…¥å‚æ•°æ˜¯ä¸¤ä¸ªæŒ‡é’ˆï¼Œæ‰€ä»¥TCanBitwiseRelocate_Vé€šè¿‡ï¼Œåˆ™è°ƒç”¨çš„å‡½æ•°æ˜¯:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">//FMemory::Memmove(Dest, Source, sizeof(SourceElementType) * Count);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// å‡å°‘æ•°ç»„çš„æœ‰æ•ˆå…ƒç´ æ•°é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="o">--</span><span class="n">ArrayNum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// æ›´æ–°æ¾å¼›ä¿¡æ¯ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">SlackTrackerNumChanged</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">namespace</span> <span class="n">UE</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">Private</span><span class="o">::</span><span class="n">MemoryOps</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">DestinationElementType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">SourceElementType</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">constexpr</span> <span class="kr">inline</span> <span class="kt">bool</span> <span class="n">TCanBitwiseRelocate_V</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">DestinationElementType</span><span class="p">,</span> <span class="n">SourceElementType</span><span class="o">&gt;</span> <span class="o">||</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">TIsBitwiseConstructible</span><span class="o">&lt;</span><span class="n">DestinationElementType</span><span class="p">,</span> <span class="n">SourceElementType</span><span class="o">&gt;::</span><span class="n">Value</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">is_trivially_destructible_v</span><span class="o">&lt;</span><span class="n">SourceElementType</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¡ä»¶:</p>
<ol>
<li>å¦‚æœ <code>DestinationElementType</code> å’Œ <code>SourceElementType</code> æ˜¯ç›¸åŒçš„ç±»å‹ã€‚</li>
<li><code>DestinationElementType</code> å¯ä»¥ä» <code>SourceElementType</code> é€ä½æ„é€ ï¼Œå¹¶ä¸” <code>SourceElementType</code> æ˜¯å¹³å‡¡å¯ææ„çš„ï¼ˆtrivially destructibleï¼‰ã€‚</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span>
</span></span><span class="line"><span class="cl"><span class="k">typename</span> <span class="n">DestinationElementType</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="k">typename</span> <span class="n">SourceElementType</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="k">typename</span> <span class="n">SizeType</span>
</span></span><span class="line"><span class="cl"><span class="n">UE_REQUIRES</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">DestinationElementType</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SourceElementType</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">UE</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">Private</span><span class="o">::</span><span class="n">MemoryOps</span><span class="o">::</span><span class="n">TCanBitwiseRelocate_V</span><span class="o">&lt;</span><span class="n">DestinationElementType</span><span class="p">,</span> <span class="n">SourceElementType</span><span class="o">&gt;</span><span class="p">)</span> <span class="c1">// the sizeof here should improve the error messages we get when we try to call this function with incomplete types
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="kt">void</span> <span class="n">RelocateConstructItems</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">Dest</span><span class="p">,</span> <span class="n">SourceElementType</span><span class="o">*</span> <span class="n">Source</span><span class="p">,</span> <span class="n">SizeType</span> <span class="n">Count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">static_assert</span><span class="p">(</span><span class="o">!</span><span class="n">std</span><span class="o">::</span><span class="n">is_const_v</span><span class="o">&lt;</span><span class="n">SourceElementType</span><span class="o">&gt;</span><span class="p">,</span> <span class="s">&#34;RelocateConstructItems: Source cannot be const&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/* All existing UE containers seem to assume trivial relocatability (i.e. memcpy&#39;able) of their members,
</span></span></span><span class="line"><span class="cl"><span class="cm">     * so we&#39;re going to assume that this is safe here.  However, it&#39;s not generally possible to assume this
</span></span></span><span class="line"><span class="cl"><span class="cm">     * in general as objects which contain pointers/references to themselves are not safe to be trivially
</span></span></span><span class="line"><span class="cl"><span class="cm">     * relocated.
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * However, it is not yet possible to automatically infer this at compile time, so we can&#39;t enable
</span></span></span><span class="line"><span class="cl"><span class="cm">     * different (i.e. safer) implementations anyway. */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">FMemory</span><span class="o">::</span><span class="n">Memmove</span><span class="p">(</span><span class="n">Dest</span><span class="p">,</span> <span class="n">Source</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SourceElementType</span><span class="p">)</span> <span class="o">*</span> <span class="n">Count</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span>
</span></span><span class="line"><span class="cl"><span class="k">typename</span> <span class="n">DestinationElementType</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="k">typename</span> <span class="n">SourceElementType</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="k">typename</span> <span class="n">SizeType</span>
</span></span><span class="line"><span class="cl"><span class="n">UE_REQUIRES</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">DestinationElementType</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SourceElementType</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">UE</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">Private</span><span class="o">::</span><span class="n">MemoryOps</span><span class="o">::</span><span class="n">TCanBitwiseRelocate_V</span><span class="o">&lt;</span><span class="n">DestinationElementType</span><span class="p">,</span> <span class="n">SourceElementType</span><span class="o">&gt;</span><span class="p">)</span> <span class="c1">// the sizeof here should improve the error messages we get when we try to call this function with incomplete types
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCENOINLINE</span> <span class="kt">void</span> <span class="n">RelocateConstructItems</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">Dest</span><span class="p">,</span> <span class="n">SourceElementType</span><span class="o">*</span> <span class="n">Source</span><span class="p">,</span> <span class="n">SizeType</span> <span class="n">Count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">static_assert</span><span class="p">(</span><span class="o">!</span><span class="n">std</span><span class="o">::</span><span class="n">is_const_v</span><span class="o">&lt;</span><span class="n">SourceElementType</span><span class="o">&gt;</span><span class="p">,</span> <span class="s">&#34;RelocateConstructItems: Source cannot be const&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//é€ä¸ªå…ƒç´ åœ°è°ƒç”¨æ„é€ å‡½æ•°å’Œææ„å‡½æ•°è¿›è¡Œç§»åŠ¨ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">while</span> <span class="p">(</span><span class="n">Count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// We need a typedef here because VC won&#39;t compile the destructor call below if SourceElementType itself has a member called SourceElementType
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">typedef</span> <span class="n">SourceElementType</span> <span class="n">RelocateConstructItemsElementTypeTypedef</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="o">::</span><span class="k">new</span> <span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">Dest</span><span class="p">)</span> <span class="n">DestinationElementType</span><span class="p">((</span><span class="n">SourceElementType</span><span class="o">&amp;&amp;</span><span class="p">)</span><span class="o">*</span><span class="n">Source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">++</span><span class="p">(</span><span class="n">DestinationElementType</span><span class="o">*&amp;</span><span class="p">)</span><span class="n">Dest</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="n">Source</span><span class="o">++</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">RelocateConstructItemsElementTypeTypedef</span><span class="o">::~</span><span class="n">RelocateConstructItemsElementTypeTypedef</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">--</span><span class="n">Count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="destructitem">DestructItem
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">ElementType</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="kt">void</span> <span class="n">DestructItem</span><span class="p">(</span><span class="n">ElementType</span><span class="o">*</span> <span class="n">Element</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//å¦‚æœ ElementType çš„å¤§å°ä¸º 0ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªä¸å®Œæ•´çš„ç±»å‹ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//è™½ç„¶è¿™ç§æƒ…å†µä¸åº”è¯¥å‘ç”Ÿï¼Œä½†è¿™æ®µä»£ç å¯ä»¥å¸®åŠ©ç”Ÿæˆæ›´æœ‰æ„ä¹‰çš„ç¼–è¯‘é”™è¯¯ä¿¡æ¯ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="nf">constexpr</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">ElementType</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Should never get here, but this construct should improve the error messages we get when we try to call this function with incomplete types
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="c1">//æ£€æµ‹ä¸æ˜¯å¹³å‡¡å¯ææ„çš„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">else</span> <span class="k">if</span> <span class="nf">constexpr</span> <span class="p">(</span><span class="o">!</span><span class="n">std</span><span class="o">::</span><span class="n">is_trivially_destructible_v</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="o">&gt;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// We need a typedef here because VC won&#39;t compile the destructor call below if ElementType itself has a member called ElementType
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">//é¿å…ç¼–è¯‘å™¨åœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆå¦‚ ElementType è‡ªèº«æœ‰ä¸€ä¸ªæˆå‘˜ä¹Ÿå« ElementTypeï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">//æ— æ³•æ­£ç¡®è§£æææ„å‡½æ•°è°ƒç”¨çš„é—®é¢˜ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">typedef</span> <span class="n">ElementType</span> <span class="n">DestructItemsElementTypeTypedef</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1">//æ˜¾å¼è°ƒç”¨å¯¹è±¡çš„ææ„å‡½æ•°ï¼Œé€šè¿‡ typedef ç¡®ä¿ææ„å‡½æ•°è°ƒç”¨çš„è¯­æ³•æ­£ç¡®ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Element</span><span class="o">-&gt;</span><span class="n">DestructItemsElementTypeTypedef</span><span class="o">::~</span><span class="n">DestructItemsElementTypeTypedef</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯¥å‡½æ•°é’ˆå¯¹ç±»å‹ <code>T</code> è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¸ä¼šåŠ¨æ€åˆ†æ´¾ææ„å‡½æ•°è°ƒç”¨ï¼ˆå¦‚æœ <code>T</code> çš„ææ„å‡½æ•°æ˜¯è™šå‡½æ•°ï¼‰ã€‚</p>
<h3 id="top">Top
</h3><p>è¿”å›é¡¶éƒ¨å…ƒç´ ï¼Œå³æœ€åä¸€ä¸ªã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="n">ElementType</span><span class="o">&amp;</span> <span class="n">Top</span><span class="p">()</span> <span class="n">UE_LIFETIMEBOUND</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nf">Last</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="k">const</span> <span class="n">ElementType</span><span class="o">&amp;</span> <span class="n">Top</span><span class="p">()</span> <span class="k">const</span> <span class="n">UE_LIFETIMEBOUND</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nf">Last</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="last">Last
</h4><p>è¿”å›æ•°ç»„ä¸­ä»æœ«å°¾å¼€å§‹è®¡æ•°çš„ç¬¬ n ä¸ªå…ƒç´ .</p>
<p>IndexFromTheEndï¼ˆå¯é€‰ï¼‰ç´¢å¼•ä»æ•°ç»„çš„æœ«å°¾ï¼ˆé»˜è®¤= 0ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="n">ElementType</span><span class="o">&amp;</span> <span class="n">Last</span><span class="p">(</span><span class="n">SizeType</span> <span class="n">IndexFromTheEnd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">UE_LIFETIMEBOUND</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">RangeCheck</span><span class="p">(</span><span class="n">ArrayNum</span> <span class="o">-</span> <span class="n">IndexFromTheEnd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nf">GetData</span><span class="p">()[</span><span class="n">ArrayNum</span> <span class="o">-</span> <span class="n">IndexFromTheEnd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//è·å–å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span><span class="o">&amp;</span> <span class="n">secondLastElement</span> <span class="o">=</span> <span class="n">MyArray</span><span class="p">.</span><span class="n">Last</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="sort">Sort
</h3><p><strong>å‡è®¾é¡¹ç±»å‹å®šä¹‰äº† &lt; è¿ç®—ç¬¦ï¼Œå¯¹æ•°ç»„è¿›è¡Œæ’åºã€‚</strong></p>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>å¦‚æœä½ çš„æ•°ç»„åŒ…å«åŸå§‹æŒ‡é’ˆï¼Œå®ƒä»¬å°†åœ¨æ’åºè¿‡ç¨‹ä¸­è‡ªåŠ¨è§£å¼•ç”¨ã€‚</li>
<li>å› æ­¤ï¼Œä½ çš„æ•°ç»„å°†æ ¹æ®è¢«æŒ‡å‘çš„å€¼è¿›è¡Œæ’åºï¼Œè€Œä¸æ˜¯æŒ‡é’ˆæœ¬èº«çš„å€¼ã€‚</li>
<li>å¦‚æœè¿™ä¸æ˜¯ä½ æƒ³è¦çš„è¡Œä¸ºï¼Œè¯·ç›´æ¥ä½¿ç”¨ Algo::Sort(MyArray)ã€‚</li>
<li>è‡ªåŠ¨è§£å¼•ç”¨è¡Œä¸ºä¸ä¼šå‘ç”Ÿåœ¨æ™ºèƒ½æŒ‡é’ˆä¸Šã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Sort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Algo</span><span class="o">::</span><span class="n">Sort</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="n">TDereferenceWrapper</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="p">,</span> <span class="n">TLess</span><span class="o">&lt;&gt;&gt;</span><span class="p">(</span><span class="n">TLess</span><span class="o">&lt;&gt;</span><span class="p">()));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Algo::Sortä¼ å…¥äº†*this å’Œ ä¸€ä¸ªè°“è¯TDereferenceWrapper</p>
<p>TDereferenceWrapperåˆä¼ å…¥äº† ElementType å’Œ TLess&lt;&gt;</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">PREDICATE_CLASS</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">TDereferenceWrapper</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">PREDICATE_CLASS</span><span class="o">&amp;</span> <span class="n">Predicate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">TDereferenceWrapper</span><span class="p">(</span><span class="k">const</span> <span class="n">PREDICATE_CLASS</span><span class="o">&amp;</span> <span class="n">InPredicate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">Predicate</span><span class="p">(</span><span class="n">InPredicate</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/** Pass through for non-pointer types */</span>
</span></span><span class="line"><span class="cl">    <span class="n">FORCEINLINE</span> <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">A</span><span class="p">,</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Predicate</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="n">FORCEINLINE</span> <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">B</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Predicate</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">PREDICATE_CLASS</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">TDereferenceWrapper</span><span class="o">&lt;</span><span class="n">T</span><span class="o">*</span><span class="p">,</span> <span class="n">PREDICATE_CLASS</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">PREDICATE_CLASS</span><span class="o">&amp;</span> <span class="n">Predicate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">TDereferenceWrapper</span><span class="p">(</span><span class="k">const</span> <span class="n">PREDICATE_CLASS</span><span class="o">&amp;</span> <span class="n">InPredicate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">Predicate</span><span class="p">(</span><span class="n">InPredicate</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/** Dereference pointers */</span>
</span></span><span class="line"><span class="cl">    <span class="n">FORCEINLINE</span> <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="n">T</span><span class="o">*</span> <span class="n">A</span><span class="p">,</span> <span class="n">T</span><span class="o">*</span> <span class="n">B</span><span class="p">)</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Predicate</span><span class="p">(</span><span class="o">*</span><span class="n">A</span><span class="p">,</span> <span class="o">*</span><span class="n">B</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>TLess&lt;&gt;</code>åªæ˜¯ä¸ªæ¯”å¤§å°çš„ä»¿å‡½æ•°ï¼Œé‡è½½äº†()è¿ç®—ç¬¦ è¿›è¡Œæ¯”å¤§å°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">TLess</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">U</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="n">T</span><span class="o">&amp;&amp;</span> <span class="n">A</span><span class="p">,</span> <span class="n">U</span><span class="o">&amp;&amp;</span> <span class="n">B</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Forward</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">Forward</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span><span class="p">(</span><span class="n">B</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">TDereferenceWrapper</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="p">,</span> <span class="n">TLess</span><span class="o">&lt;&gt;&gt;</span><span class="err">`</span>  <span class="err">ä¸‹é¢ç®€ç§°ä¸º`</span><span class="n">TD</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨TDé‡Œé¢ï¼Œæ­¤æ—¶ T = ElementTypeï¼ŒPREDICATE_CLASS = TLess&lt;&gt;</p>
<p>å¹¶ä¸”æŠŠTLess&lt;&gt;å­˜åˆ°ä¸€ä¸ªPredicateå˜é‡é‡Œé¢ã€‚</p>
<p><code>TD</code> ä¹Ÿé‡è½½äº†()è¿ç®—ç¬¦ï¼Œåœ¨é‡Œé¢æ‰§è¡ŒPredicateçš„()è¿ç®—ç¬¦ï¼Œ</p>
<p>æ­¤æ—¶Predicateæ˜¯TLess&lt;&gt;ç±»å‹ï¼Œæ‰€ä»¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">TD(A,B)`-&gt;`TLess(A,B)`-&gt;`æ¯”å¤§å°
</span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆAå’ŒBæ˜¯ä»å“ªæ¥çš„ï¼Ÿå†æ·±å…¥åˆ†æä¸‹å»å°±çœ‹ä¸æ‡‚äº†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Sort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Algo</span><span class="o">::</span><span class="n">Sort</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="n">TDereferenceWrapper</span><span class="o">&lt;</span><span class="n">ElementType</span><span class="p">,</span> <span class="n">TLess</span><span class="o">&lt;&gt;&gt;</span><span class="p">(</span><span class="n">TLess</span><span class="o">&lt;&gt;</span><span class="p">()));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//Algo::Sort
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">RangeType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">PredicateType</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="kt">void</span> <span class="n">Sort</span><span class="p">(</span><span class="n">RangeType</span><span class="o">&amp;&amp;</span> <span class="n">Range</span><span class="p">,</span> <span class="n">PredicateType</span> <span class="n">Pred</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">IntroSort</span><span class="p">(</span><span class="n">Forward</span><span class="o">&lt;</span><span class="n">RangeType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Range</span><span class="p">),</span> <span class="n">MoveTemp</span><span class="p">(</span><span class="n">Pred</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">RangeType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">PredicateType</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="kt">void</span> <span class="n">IntroSort</span><span class="p">(</span><span class="n">RangeType</span><span class="o">&amp;&amp;</span> <span class="n">Range</span><span class="p">,</span> <span class="n">PredicateType</span> <span class="n">Predicate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">AlgoImpl</span><span class="o">::</span><span class="n">IntroSortInternal</span><span class="p">(</span><span class="n">GetData</span><span class="p">(</span><span class="n">Range</span><span class="p">),</span> <span class="n">GetNum</span><span class="p">(</span><span class="n">Range</span><span class="p">),</span> <span class="n">FIdentityFunctor</span><span class="p">(),</span> <span class="n">MoveTemp</span><span class="p">(</span><span class="n">Predicate</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="tdereferencewrapperçš„ç‰¹åŒ–"><code>TDereferenceWrapper</code>çš„ç‰¹åŒ–
</h4><p>æŠ›å¼€Aã€Bä¸è°ˆï¼Œè¿™ä¸ªSortæ˜¯æ€ä¹ˆå›äº‹ï¼Œä¸ºä»€ä¹ˆè¦å¦‚æ­¤å¤æ‚çš„å±‚å±‚åŒ…è£…ï¼Œ</p>
<p>ä¸€ä¸ªæ‹¬å·è¿ç®—ç¬¦é‡è½½ å¥—äº† å¦ä¸€ä¸ªæ‹¬å·è¿ç®—ç¬¦çš„é‡è½½ï¼Œæ€ä¹ˆä¼šè¿™æ ·ï¼Ÿ</p>
<p><code>TDereferenceWrapper</code> çš„æ³¨é‡Šæ˜¯:åœ¨æ’åºå‡½æ•°ä¸­è§£å¼•ç”¨æŒ‡é’ˆç±»å‹çš„å¸®åŠ©ç±»</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Algo::Sort(ArrayInt, TLess&lt;&gt;());
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è¿™é‡Œç›´æ¥ä½¿ç”¨äº†é»˜è®¤çš„ <code>TLess&lt;&gt;</code> æ¯”è¾ƒå™¨ã€‚</li>
<li><code>TLess&lt;&gt;</code> ä½¿ç”¨æ ‡å‡†çš„ <code>&lt;</code> è¿ç®—ç¬¦è¿›è¡Œæ¯”è¾ƒã€‚</li>
<li>é€‚ç”¨äºéæŒ‡é’ˆç±»å‹ï¼ˆå¦‚ <code>int</code>, <code>float</code>, è‡ªå®šä¹‰ç±»ç­‰ï¼‰</li>
<li>æˆ–æ™ºèƒ½æŒ‡é’ˆï¼ˆå¦‚ <code>std::shared_ptr</code>, <code>std::unique_ptr</code>ï¼‰ï¼Œè¿™äº›ç±»å‹çš„æ¯”è¾ƒä¸éœ€è¦é¢å¤–çš„è§£å¼•ç”¨æ“ä½œã€‚</li>
</ul>
<p>å¦‚æœå¯¹ <code>TArray&lt;int*&gt;</code> è¿›è¡ŒTLessæ’åºï¼Œæ’åºå°†åŸºäºæŒ‡é’ˆæœ¬èº«çš„å†…å­˜åœ°å€ï¼Œè€Œä¸æ˜¯æŒ‡é’ˆæ‰€æŒ‡å‘çš„æ•´æ•°å€¼ã€‚</p>
<p>è¿™å°±å’ŒæœŸæœ›ä¸ç¬¦åˆï¼Œè¦çš„æ˜¯å¯¹intæ’åºï¼Œå®é™…ä¸Šå´å¯¹int*æ’åºäº†ï¼Œæ’åºå¯¹è±¡ä¸æ˜¯å€¼ è€Œæ˜¯æŒ‡é’ˆã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Algo::Sort(ArrayInt, TDereferenceWrapper&lt;ElementType, TLess&lt;&gt;&gt;(TLess&lt;&gt;()));
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>è¿™é‡Œä½¿ç”¨äº† <code>TDereferenceWrapper</code> æ¥åŒ…è£¹ <code>TLess&lt;&gt;</code>ã€‚</p>
</li>
<li>
<p><code>TDereferenceWrapper</code> ä¼šæ ¹æ®å…ƒç´ ç±»å‹çš„ä¸åŒè¡Œä¸ºæœ‰æ‰€ä¸åŒï¼š</p>
</li>
<li>
<p>å¦‚æœå…ƒç´ æ˜¯æŒ‡é’ˆç±»å‹ï¼ˆå¦‚ <code>int*</code>ï¼‰ï¼Œåˆ™ä¼šè‡ªåŠ¨è§£å¼•ç”¨æŒ‡é’ˆï¼Œä½¿å¾—æ’åºåŸºäºæŒ‡é’ˆæ‰€æŒ‡å‘çš„å®é™…å€¼ã€‚</p>
</li>
<li>
<p>å¦‚æœå…ƒç´ æ˜¯éæŒ‡é’ˆç±»å‹ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ <code>&lt;</code> è¿ç®—ç¬¦è¿›è¡Œæ¯”è¾ƒã€‚</p>
</li>
<li></li>
</ul>
<p>æ—¢ç„¶å®ƒèƒ½å¤Ÿæ ¹æ® <strong>æŒ‡é’ˆç±»å‹</strong> æˆ– <strong>éæŒ‡é’ˆç±»å‹</strong> éšæœºåº”å˜ï¼Œé‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</p>
<p>å®ƒä¼šæ ¹æ®TArrayå­˜æ”¾çš„å…ƒç´ ç±»å‹ElementType è¿›è¡Œåç‰¹åŒ–ï¼Œ</p>
<p>å¦‚æœElementTypeæ˜¯intï¼Œé‚£ä¹ˆå°±é€‰å–ä¸‹æ–¹ä»£ç ä¸­çš„ ç¬¬ä¸€ä¸ªæ¨¡æ¿ç±».</p>
<p>å¦‚æœElementTypeæ˜¯int*ï¼Œé‚£ä¹ˆå°±é€‰å–ä¸‹æ–¹ä»£ç ä¸­çš„ ç¬¬äºŒä¸ªæ¨¡æ¿ç±».</p>
<p>ç¬¬äºŒä¸ªæ¨¡æ¿ç±»æ˜¯ä¸€ä¸ªåç‰¹åŒ–ï¼Œå½“ä¼ å…¥çš„Tæ˜¯ä¸€ä¸ªT*æ ·å¼çš„æŒ‡é’ˆæ—¶ï¼Œç¬¬äºŒä¸ªæ¨¡æ¿ç±»å°±ä¼šè¢«é€‰æ‹©.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">PREDICATE_CLASS</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">TDereferenceWrapper</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">PREDICATE_CLASS</span><span class="o">&amp;</span> <span class="n">Predicate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">TDereferenceWrapper</span><span class="p">(</span><span class="k">const</span> <span class="n">PREDICATE_CLASS</span><span class="o">&amp;</span> <span class="n">InPredicate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="n">Predicate</span><span class="p">(</span><span class="n">InPredicate</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="cm">/** Pass through for non-pointer types */</span>
</span></span><span class="line"><span class="cl">    <span class="n">FORCEINLINE</span> <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">A</span><span class="p">,</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Predicate</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="n">FORCEINLINE</span> <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">B</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Predicate</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span> <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">PREDICATE_CLASS</span><span class="o">&gt;</span> 
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">TDereferenceWrapper</span><span class="o">&lt;</span><span class="n">T</span><span class="o">*</span><span class="p">,</span> <span class="n">PREDICATE_CLASS</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">PREDICATE_CLASS</span><span class="o">&amp;</span> <span class="n">Predicate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">TDereferenceWrapper</span><span class="p">(</span><span class="k">const</span> <span class="n">PREDICATE_CLASS</span><span class="o">&amp;</span> <span class="n">InPredicate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="n">Predicate</span><span class="p">(</span><span class="n">InPredicate</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="cm">/** Dereference pointers */</span>
</span></span><span class="line"><span class="cl">    <span class="n">FORCEINLINE</span> <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="n">T</span><span class="o">*</span> <span class="n">A</span><span class="p">,</span> <span class="n">T</span><span class="o">*</span> <span class="n">B</span><span class="p">)</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Predicate</span><span class="p">(</span><span class="o">*</span><span class="n">A</span><span class="p">,</span> <span class="o">*</span><span class="n">B</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¬¬äºŒä¸ªæ¨¡æ¿ç±»çš„æ‹¬å·è¿ç®—ç¬¦é‡è½½ï¼Œå¯¹Aã€Bè¿›è¡Œäº†è§£å¼•ç”¨ã€‚</p>
<p>åˆ°æ­¤å°±çœŸç›¸å¤§ç™½äº†ï¼ŒåŸæ¥æ˜¯è¿™ä¹ˆè®¾è®¡çš„ï¼Œ</p>
<p>åœ¨ç¼–è¯‘æ—¶å°±æ ¹æ®TArrayå­˜æ”¾çš„æ•°æ®ç±»å‹ é€‰æ‹©åˆé€‚çš„æ¨¡æ¿ç±»è¿›è¡Œæ’åºã€‚</p>
<p>æ ¹æ® æŒ‡é’ˆç±»å‹/éæŒ‡é’ˆç±»å‹ï¼ŒTDereferenceWrapperä»ä¸‹é¢çš„ä¸¤æ¡è·¯å¾„é‡Œé€‰æ‹©:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">TD(A,B)`-&gt;`TLess(A,B)`-&gt;`æ¯”å¤§å°
</span></span><span class="line"><span class="cl">TD(*A,*B)`-&gt;`TLess(A,B)`-&gt;`æ¯”å¤§å°
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="find">Find
</h3><p>ä¸¤ä¸ªç‰ˆæœ¬ï¼Œ</p>
<p>1.ä¼ å…¥å…ƒç´ å’Œç´¢å¼•ï¼Œåˆ¤æ–­ ç´¢å¼•å¤„çš„å…ƒç´  = ä¼ å…¥çš„å…ƒç´ </p>
<p>2.ä¼ å…¥å…ƒç´ ï¼Œéå†æŸ¥æ‰¾</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="kt">bool</span> <span class="nf">Find</span><span class="p">(</span><span class="k">const</span> <span class="n">ElementType</span><span class="o">&amp;</span> <span class="n">Item</span><span class="p">,</span> <span class="n">SizeType</span><span class="o">&amp;</span> <span class="n">Index</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Index</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">Find</span><span class="p">(</span><span class="n">Item</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Index</span> <span class="o">!=</span> <span class="n">INDEX_NONE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">SizeType</span> <span class="nf">Find</span><span class="p">(</span><span class="k">const</span> <span class="n">ElementType</span><span class="o">&amp;</span> <span class="n">Item</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è¿”å›æŒ‡å‘ç¬¬ä¸€ä¸ªæ•°ç»„æ¡ç›®çš„æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">const</span> <span class="n">ElementType</span><span class="o">*</span> <span class="n">RESTRICT</span> <span class="n">Start</span> <span class="o">=</span> <span class="n">GetData</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// éå†æ•°ç»„ï¼ŒæŸ¥æ‰¾æŒ‡å®šå…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">ElementType</span><span class="o">*</span> <span class="n">RESTRICT</span> <span class="n">Data</span> <span class="o">=</span> <span class="n">Start</span><span class="p">,</span> <span class="o">*</span><span class="n">RESTRICT</span> <span class="n">DataEnd</span> <span class="o">=</span> <span class="n">Data</span> <span class="o">+</span> <span class="n">ArrayNum</span><span class="p">;</span> <span class="n">Data</span> <span class="o">!=</span> <span class="n">DataEnd</span><span class="p">;</span> <span class="o">++</span><span class="n">Data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">Data</span> <span class="o">==</span> <span class="n">Item</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SizeType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Data</span> <span class="o">-</span> <span class="n">Start</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">INDEX_NONE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨Engine\Source\Runtime\Core\Public\Misc\CoreMiscDefines.hä¸­ æœ‰å®šä¹‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="k">enum</span> <span class="p">{</span><span class="n">INDEX_NONE</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰€ä»¥æŸ¥æ‰¾å¤±è´¥æ—¶ è¿”å›-1.</p>
<h4 id="restrict">RESTRICT
</h4><p>Engine\Source\Runtime\Core\Public\HAL\Platform.h</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#define RESTRICT __restrict
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç±»å‹é™å®šç¬¦ï¼Œç”¨äºæŒ‡é’ˆå£°æ˜ï¼Œè¡¨ç¤ºè¯¥æŒ‡é’ˆæ˜¯å”¯ä¸€æŒ‡å‘å…¶ç›®æ ‡å¯¹è±¡çš„æŒ‡é’ˆã€‚</p>
<p>å½“èƒ½ç¡®ä¿æŸä¸ªæŒ‡é’ˆä¸ä¼šä¸å…¶ä»–æŒ‡é’ˆæŒ‡å‘åŒä¸€å—å†…å­˜æ—¶ï¼Œ</p>
<p>å¯ä»¥ä½¿ç”¨ <code>__restrict</code> æ¥å¸®åŠ©ç¼–è¯‘å™¨ç”Ÿæˆæ›´é«˜æ•ˆçš„ä»£ç ã€‚è¿™åœ¨å¾ªç¯å’Œå‡½æ•°å‚æ•°ä¼ é€’ä¸­ç‰¹åˆ«æœ‰ç”¨ï¼Œ</p>
<p>å› ä¸ºè¿™äº›åœ°æ–¹é€šå¸¸æ¶‰åŠå¤§é‡çš„å†…å­˜è®¿é—®æ“ä½œã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">__restrict</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">__restrict</span> <span class="n">q</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// ç¼–è¯‘å™¨çŸ¥é“ p å’Œ q æŒ‡å‘ä¸åŒçš„å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">*</span><span class="n">q</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>__restrict</code> å‘Šè¯‰ç¼–è¯‘å™¨æŒ‡é’ˆ <code>p</code> å’Œ <code>q</code> ä¸ä¼šæŒ‡å‘åŒä¸€å—å†…å­˜åŒºåŸŸã€‚</p>
<p>å› æ­¤ï¼Œç¼–è¯‘å™¨å¯ä»¥å‡è®¾å¯¹ <code>*p</code> å’Œ <code>*q</code> çš„ä¿®æ”¹ä¸ä¼šç›¸äº’å½±å“ï¼Œä»è€Œè¿›è¡Œæ›´å¤šçš„ä¼˜åŒ–ï¼Œä¾‹å¦‚é‡æ’åºæŒ‡ä»¤æˆ–å‡å°‘ä¸å¿…è¦çš„å†…å­˜å±éšœã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">processArrays</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">__restrict</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">__restrict</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">__restrict</span> <span class="n">c</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">n</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>__restrict</code> å…³é”®å­—å‘Šè¯‰ç¼–è¯‘å™¨ï¼š</p>
<ul>
<li><code>a</code>ã€<code>b</code> å’Œ <code>c</code> æŒ‡å‘çš„å†…å­˜åŒºåŸŸäº’ä¸é‡å ã€‚</li>
<li>å› æ­¤ï¼Œç¼–è¯‘å™¨å¯ä»¥å‡è®¾å¯¹ <code>a[i]</code>ã€<code>b[i]</code> å’Œ <code>c[i]</code> çš„è®¿é—®ä¸ä¼šäº’ç›¸å¹²æ‰°ã€‚</li>
</ul>
<p><strong>æ€»ç»“:</strong></p>
<ul>
<li><code>**__restrict**</code> <strong>å…³é”®å­—</strong>ï¼šç”¨äºæŒ‡ç¤ºç¼–è¯‘å™¨ä¼˜åŒ–å†…å­˜è®¿é—®ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨æŒ‡é’ˆä¸ä¼šæŒ‡å‘ç›¸åŒçš„å†…å­˜åŒºåŸŸã€‚</li>
<li><strong>ä½œç”¨</strong>ï¼šå…è®¸ç¼–è¯‘å™¨è¿›è¡Œæ›´å¤šçš„ä¼˜åŒ–ï¼Œå¦‚æŒ‡ä»¤é‡æ’å’Œå‘é‡åŒ–ï¼Œä»è€Œæé«˜ä»£ç æ€§èƒ½ã€‚</li>
<li><strong>æ³¨æ„äº‹é¡¹</strong>ï¼šç¡®ä¿æŒ‡é’ˆç¡®å®ä¸ä¼šæŒ‡å‘ç›¸åŒçš„å†…å­˜åŒºåŸŸï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚</li>
</ul>
<h3 id="findbypredicate">FindByPredicate
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TGetValue</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">x</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">TArray</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ArrayInt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ArrayInt</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">50</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">FindValue</span>  <span class="o">=</span> <span class="o">*</span><span class="n">ArrayInt</span><span class="p">.</span><span class="n">FindByPredicate</span><span class="p">([](</span><span class="kt">int</span> <span class="n">x</span><span class="p">){</span><span class="k">return</span> <span class="n">x</span><span class="o">==</span><span class="mi">2</span><span class="p">;});</span>
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">FindValue2</span>  <span class="o">=</span> <span class="o">*</span><span class="n">ArrayInt</span><span class="p">.</span><span class="n">FindByPredicate</span><span class="p">(</span><span class="n">TGetValue</span><span class="p">());</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è‡ªå®šä¹‰åŒ¹é…æ–¹æ³•ï¼Œå¯ä»¥ä¼ å…¥ä»¿å‡½æ•°ã€lambdaå‡½æ•° ç­‰ç­‰..</p>
<p>æ€»ä¹‹å°±æ˜¯éå†TArrayä¸­çš„å…ƒç´ ï¼Œæ‰§è¡Œä¼ å…¥çš„è°“è¯ï¼Œå¦‚æœè°“è¯çš„ç»“æœä¸ºtrue åˆ™if(true) è¿”å›Data.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Predicate</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">ElementType</span><span class="o">*</span> <span class="n">FindByPredicate</span><span class="p">(</span><span class="n">Predicate</span> <span class="n">Pred</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="n">ElementType</span><span class="o">*</span> <span class="n">RESTRICT</span> <span class="n">Data</span> <span class="o">=</span> <span class="n">GetData</span><span class="p">(),</span> <span class="o">*</span><span class="n">RESTRICT</span> <span class="n">DataEnd</span> <span class="o">=</span> <span class="n">Data</span> <span class="o">+</span> <span class="n">ArrayNum</span><span class="p">;</span> <span class="n">Data</span> <span class="o">!=</span> <span class="n">DataEnd</span><span class="p">;</span> <span class="o">++</span><span class="n">Data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="o">::</span><span class="n">Invoke</span><span class="p">(</span><span class="n">Pred</span><span class="p">,</span> <span class="o">*</span><span class="n">Data</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">Data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="invoke">Invoke
</h4><p>ç”¨äºç»Ÿä¸€è°ƒç”¨ä¸åŒç±»å‹çš„å¯è°ƒç”¨å¯¹è±¡ï¼ˆå¦‚æ™®é€šå‡½æ•°æŒ‡é’ˆã€lambda è¡¨è¾¾å¼ã€æˆå‘˜å‡½æ•°æŒ‡é’ˆç­‰ï¼‰ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">//é€šç”¨å¯è°ƒç”¨å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">FuncType</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">ArgTypes</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="k">auto</span> <span class="n">Invoke</span><span class="p">(</span><span class="n">FuncType</span><span class="o">&amp;&amp;</span> <span class="n">Func</span><span class="p">,</span> <span class="n">ArgTypes</span><span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">Args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">-&gt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">Forward</span><span class="o">&lt;</span><span class="n">FuncType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Func</span><span class="p">)(</span><span class="n">Forward</span><span class="o">&lt;</span><span class="n">ArgTypes</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Args</span><span class="p">)...))</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Forward</span><span class="o">&lt;</span><span class="n">FuncType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Func</span><span class="p">)(</span><span class="n">Forward</span><span class="o">&lt;</span><span class="n">ArgTypes</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Args</span><span class="p">)...);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//æˆå‘˜å˜é‡è®¿é—®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">ReturnType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">ObjType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">TargetType</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="k">auto</span> <span class="n">Invoke</span><span class="p">(</span><span class="n">ReturnType</span> <span class="n">ObjType</span><span class="o">::*</span><span class="n">pdm</span><span class="p">,</span> <span class="n">TargetType</span><span class="o">&amp;&amp;</span> <span class="n">Target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">-&gt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">UE</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">Private</span><span class="o">::</span><span class="n">DereferenceIfNecessary</span><span class="o">&lt;</span><span class="n">ObjType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Forward</span><span class="o">&lt;</span><span class="n">TargetType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Target</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">Target</span><span class="p">).</span><span class="o">*</span><span class="n">pdm</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">UE</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">Private</span><span class="o">::</span><span class="n">DereferenceIfNecessary</span><span class="o">&lt;</span><span class="n">ObjType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Forward</span><span class="o">&lt;</span><span class="n">TargetType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Target</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">Target</span><span class="p">).</span><span class="o">*</span><span class="n">pdm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//æˆå‘˜å‡½æ•°è°ƒç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">template</span> <span class="o">&lt;</span>
</span></span><span class="line"><span class="cl"><span class="k">typename</span>    <span class="n">PtrMemFunType</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="k">typename</span>    <span class="n">TargetType</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="k">typename</span><span class="p">...</span> <span class="n">ArgTypes</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="k">typename</span>    <span class="n">ObjType</span> <span class="o">=</span> <span class="n">TMemberFunctionPtrOuter_T</span><span class="o">&lt;</span><span class="n">PtrMemFunType</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="k">auto</span> <span class="n">Invoke</span><span class="p">(</span><span class="n">PtrMemFunType</span> <span class="n">PtrMemFun</span><span class="p">,</span> <span class="n">TargetType</span><span class="o">&amp;&amp;</span> <span class="n">Target</span><span class="p">,</span> <span class="n">ArgTypes</span><span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">Args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">-&gt;</span> <span class="k">decltype</span><span class="p">((</span><span class="n">UE</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">Private</span><span class="o">::</span><span class="n">DereferenceIfNecessary</span><span class="o">&lt;</span><span class="n">ObjType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Forward</span><span class="o">&lt;</span><span class="n">TargetType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Target</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">Target</span><span class="p">).</span><span class="o">*</span><span class="n">PtrMemFun</span><span class="p">)(</span><span class="n">Forward</span><span class="o">&lt;</span><span class="n">ArgTypes</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Args</span><span class="p">)...))</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">UE</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">Private</span><span class="o">::</span><span class="n">DereferenceIfNecessary</span><span class="o">&lt;</span><span class="n">ObjType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Forward</span><span class="o">&lt;</span><span class="n">TargetType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Target</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">Target</span><span class="p">).</span><span class="o">*</span><span class="n">PtrMemFun</span><span class="p">)(</span><span class="n">Forward</span><span class="o">&lt;</span><span class="n">ArgTypes</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Args</span><span class="p">)...);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸‰ç§å½¢æ€ï¼Œåˆ†åˆ«æ˜¯ <strong>é€šç”¨å¯è°ƒç”¨å¯¹è±¡ã€æˆå‘˜å˜é‡è®¿é—®ã€æˆå‘˜å‡½æ•°è°ƒç”¨</strong></p>
<p>åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œ<code>FindByPredicate</code>ä¼ å…¥äº†ä¸€ä¸ªlambdaè¡¨è¾¾å¼ ï¼Œåˆæµ‹è¯•äº†é‡è½½äº†æ‹¬å·è¿ç®—ç¬¦çš„ä»¿å‡½æ•°ç±».</p>
<p>è¿™äº›æƒ…å†µéƒ½æ˜¯é€šè¿‡ç¬¬ä¸€ä¸ªç‰ˆæœ¬ <code>é€šç”¨å¯è°ƒç”¨å¯¹è±¡</code> è¿›è¡Œè°ƒç”¨çš„.</p>
<h4 id="forward">Forward
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">UE_INTRINSIC_CAST</span> <span class="n">FORCEINLINE</span> <span class="k">constexpr</span> <span class="n">T</span><span class="o">&amp;&amp;</span> <span class="n">Forward</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">remove_reference_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">Obj</span><span class="p">)</span> <span class="k">noexcept</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">T</span><span class="o">&amp;&amp;</span><span class="p">)</span><span class="n">Obj</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">UE_INTRINSIC_CAST</span> <span class="n">FORCEINLINE</span> <span class="k">constexpr</span> <span class="n">T</span><span class="o">&amp;&amp;</span> <span class="n">Forward</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">remove_reference_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;&amp;</span> <span class="n">Obj</span><span class="p">)</span> <span class="k">noexcept</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">T</span><span class="o">&amp;&amp;</span><span class="p">)</span><span class="n">Obj</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å®Œç¾è½¬å‘</strong></p>
<p>ç”¨äºåœ¨å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ä¿ç•™å‚æ•°çš„å€¼ç±»åˆ«ï¼ˆvalue categoryï¼‰ï¼Œå³ä¿æŒå‚æ•°æ˜¯å·¦å€¼è¿˜æ˜¯å³å€¼çš„ç‰¹æ€§ã€‚</p>
<p>è¿™ä½¿å¾—å‡½æ•°å¯ä»¥å°†å‚æ•°â€œå®Œç¾â€åœ°è½¬å‘ç»™å…¶ä»–å‡½æ•°ï¼Œè€Œä¸ä¼šå¼•å…¥ä¸å¿…è¦çš„æ‹·è´æˆ–è½¬æ¢ã€‚</p>
<ul>
<li><strong>å·¦å€¼å¼•ç”¨</strong>ï¼šå½“ä¼ å…¥å·¦å€¼æ—¶ï¼Œ<code>Forward</code> è¿”å›å·¦å€¼å¼•ç”¨ã€‚</li>
<li><strong>å³å€¼å¼•ç”¨</strong>ï¼šå½“ä¼ å…¥å³å€¼æ—¶ï¼Œ<code>Forward</code> è¿”å›å³å€¼å¼•ç”¨ã€‚</li>
</ul>
<p><strong>ä¸‡èƒ½å¼•ç”¨ T&amp;&amp;</strong></p>
<p>æ ¹æ®ä¼ å…¥çš„å‚æ•°ç±»å‹æ¨å¯¼ä¸ºå·¦å€¼å¼•ç”¨æˆ–å³å€¼å¼•ç”¨ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">foo</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;&amp;</span> <span class="n">param</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">process</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Processing: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Func</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">wrapper</span><span class="p">(</span><span class="n">Func</span><span class="o">&amp;&amp;</span> <span class="n">func</span><span class="p">,</span> <span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ä½¿ç”¨ std::forward è¿›è¡Œå®Œç¾è½¬å‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">Func</span><span class="o">&gt;</span><span class="p">(</span><span class="n">func</span><span class="p">)(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="p">(</span><span class="n">args</span><span class="p">)...);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// å·¦å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//std::forward&lt;int&amp;&gt;(value) å°† value ä½œä¸ºå·¦å€¼å¼•ç”¨è½¬å‘ç»™ processã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">wrapper</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// å³å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//std::forward&lt;int&amp;&amp;&gt;(100) å°† 100 ä½œä¸ºå³å€¼å¼•ç”¨è½¬å‘ç»™ processã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">wrapper</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyClass</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">MyClass</span><span class="o">&gt;</span> <span class="n">create</span><span class="p">(</span><span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">MyClass</span><span class="o">&gt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="p">(</span><span class="n">args</span><span class="p">)...);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">MyClass</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="o">:</span> <span class="n">x_</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y_</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">x_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">y_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">obj1</span> <span class="o">=</span> <span class="n">MyClass</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">3.14</span><span class="p">);</span>  <span class="c1">// å³å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">obj2</span> <span class="o">=</span> <span class="n">MyClass</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mf">2.71</span><span class="p">);</span>   <span class="c1">// å·¦å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>create</code> å‡½æ•°æ˜¯ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œæ¥å—ä»»æ„æ•°é‡çš„å‚æ•°å¹¶ä½¿ç”¨ <code>std::make_unique</code> åˆ›å»º <code>MyClass</code> å¯¹è±¡ã€‚</li>
<li>ä½¿ç”¨ <code>std::forward&lt;Args&gt;(args)...</code> æ¥å®Œç¾è½¬å‘æ„é€ å‚æ•°ï¼Œç¡®ä¿å®ƒä»¬çš„å€¼ç±»åˆ«å¾—ä»¥ä¿ç•™ã€‚</li>
</ul>
<h3 id="reserve">Reserve
</h3><p>ä¿ç•™å†…å­˜ï¼Œä½¿æ•°ç»„è‡³å°‘å¯ä»¥åŒ…å«Numberå…ƒç´ ã€‚</p>
<p>Number-åˆ†é…åæ•°ç»„åº”è¯¥èƒ½å¤ŸåŒ…å«çš„å…ƒç´ æ•°é‡ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="kt">void</span> <span class="nf">Reserve</span><span class="p">(</span><span class="n">SizeType</span> <span class="n">Number</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">checkSlow</span><span class="p">(</span><span class="n">Number</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">Number</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Cast to USizeType first to prevent sign extension on negative sizes, producing unusually large values.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">UE</span><span class="o">::</span><span class="n">Core</span><span class="o">::</span><span class="n">Private</span><span class="o">::</span><span class="n">OnInvalidArrayNum</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)(</span><span class="n">USizeType</span><span class="p">)</span><span class="n">Number</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">Number</span> <span class="o">&gt;</span> <span class="n">ArrayMax</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ResizeTo</span><span class="p">(</span><span class="n">Number</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="init">Init
</h3><p>è®¾ç½®æ•°ç»„çš„å¤§å°ï¼Œç”¨ç»™å®šçš„å…ƒç´ å¡«å……å®ƒã€‚</p>
<p>Element-ç”¨æ¥å¡«å……æ•°ç»„çš„å…ƒç´ ã€‚</p>
<p>Number-åˆ†é…åæ•°ç»„åº”è¯¥èƒ½å¤ŸåŒ…å«çš„å…ƒç´ æ•°é‡ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Init</span><span class="p">(</span><span class="k">const</span> <span class="n">ElementType</span><span class="o">&amp;</span> <span class="n">Element</span><span class="p">,</span> <span class="n">SizeType</span> <span class="n">Number</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Empty</span><span class="p">(</span><span class="n">Number</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">SizeType</span> <span class="n">Index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">Index</span> <span class="o">&lt;</span> <span class="n">Number</span><span class="p">;</span> <span class="o">++</span><span class="n">Index</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Add</span><span class="p">(</span><span class="n">Element</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å…¶å®ƒå‡½æ•°">å…¶å®ƒå‡½æ•°
</h2><h3 id="toptional">TOptional
</h3><p><a class="link" href="https://benui.ca/unreal/toptional/#doggy-example"  target="_blank" rel="noopener"
    >Why TOptional is my new favourite tool</a></p>
<p><strong>TOptionalä¸»è¦åŠŸèƒ½:</strong></p>
<p>è¡¨ç¤ºå­˜åœ¨æˆ–ä¸å­˜åœ¨çš„å€¼ã€‚</p>
<p>æä¾›ç±»å‹å®‰å…¨çš„æ–¹å¼æ¥å¤„ç†å¯èƒ½ç¼ºå¤±çš„å€¼ã€‚</p>
<p>æä¾›ä¸°å¯Œçš„æ“ä½œæ¥å£æ¥æ£€æŸ¥æ˜¯å¦æœ‰å€¼ã€è·å–å€¼ä»¥åŠå¤„ç†æ²¡æœ‰å€¼çš„æƒ…å†µã€‚</p>
<p>ç±»ä¼¼äºC++æ ‡å‡†åº“ä¸­çš„ std::optionalã€‚å®ƒç”¨äºè¡¨ç¤ºä¸€ä¸ªå€¼å¯èƒ½å­˜åœ¨æˆ–ä¸å­˜åœ¨çš„çŠ¶æ€ã€‚TOptional æä¾›äº†ä¸€ç§å®‰å…¨ä¸”ç±»å‹å®‰å…¨çš„æ–¹å¼æ¥å¤„ç†å¯é€‰å€¼ï¼Œé¿å…äº†ä½¿ç”¨åŸå§‹æŒ‡é’ˆæˆ–ç‰¹æ®Šæ ‡è®°å€¼ï¼ˆå¦‚ -1 æˆ– nullptrï¼‰æ¥è¡¨ç¤ºç¼ºå¤±å€¼çš„å¸¸è§é—®é¢˜ã€‚</p>
<p><strong>é›¶é¢å¤–å†…å­˜å¼€é”€:</strong>  	TOptional<TArray> çš„å¤§å°ä¸ TArray ç›¸åŒï¼Œæ— éœ€å­˜å‚¨é¢å¤–çŠ¶æ€æ ‡å¿—ã€‚</p>
<p><strong>ä¾µå…¥å¼æ“ä½œé«˜æ•ˆæ€§:</strong>	ç›´æ¥é€šè¿‡ TArray å†…éƒ¨å­—æ®µæ ‡è®°çŠ¶æ€ï¼Œæ— è¿è¡Œæ—¶æ€§èƒ½æŸå¤±ã€‚</p>
<p><strong>ç±»å‹å®‰å…¨:</strong>			ä»…å…è®¸ TOptional é€šè¿‡å‹å…ƒè®¿é—® FIntrusiveUnsetOptionalState æ„é€ å‡½æ•°ã€‚</p>
<p>TArray ä¸­çš„ä¾µå…¥</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">FIntrusiveUnsetOptionalStateæ˜¯ä¸€ä¸ªç”¨äºä¾µå…¥å¼æ•°æ®ç»“æ„çš„è¾…åŠ©å·¥å…·ç±»</span><span class="err">ï¼Œä¸»è¦ç›®çš„æ˜¯ç®¡ç†æ•°æ®ç»“æ„ä¸­å…ƒç´ çš„å¯é€‰çŠ¶æ€æ ‡è®°ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="c1">// é™æ€æ ‡è®°ï¼Œå‘ŠçŸ¥ TOptional æ­¤ç±»å‹ï¼ˆTArrayï¼‰æ”¯æŒä¾µå…¥å¼æœªè®¾ç½®çŠ¶æ€ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">constexpr</span> <span class="k">static</span> <span class="kt">bool</span> <span class="n">bHasIntrusiveUnsetOptionalState</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//æŒ‡å®šç”¨äºæ ‡è®°çš„ç±»å‹ï¼ˆæ­¤å¤„ä¸º TArray è‡ªèº«ï¼‰ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">using</span> <span class="n">IntrusiveUnsetOptionalStateType</span> <span class="o">=</span> <span class="n">TArray</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//åˆ›å»ºä¸€ä¸ªç‰¹æ®ŠçŠ¶æ€çš„ TArrayï¼Œé€šè¿‡ ArrayMax = -1 è¡¨ç¤ºæœªåˆå§‹åŒ–ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">explicit</span> <span class="nf">TArray</span><span class="p">(</span><span class="n">FIntrusiveUnsetOptionalState</span> <span class="n">Tag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="o">:</span> <span class="n">ArrayNum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">,</span> <span class="n">ArrayMax</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ä½¿ç”¨ ArrayMax = -1 æ ‡è®°æœªè®¾ç½®çŠ¶æ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// Use ArrayMax == -1 as our intrusive state so that the destructor still works without change, as it doesn&#39;t use ArrayMax.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å…è®¸ TOptional æ£€æŸ¥ TArray æ˜¯å¦å¤„äºæœªè®¾ç½®çŠ¶æ€ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="n">FIntrusiveUnsetOptionalState</span> <span class="n">Tag</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">ArrayMax</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨ä¸¾ä¾‹1:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"> <span class="c1">//å£°æ˜ä¸€ä¸ªæœªè®¾ç½®çš„ TOptional&lt;TArray&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">TOptional</span><span class="o">&lt;</span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">int32</span><span class="o">&gt;&gt;</span> <span class="n">OptionalArray</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ£€æŸ¥æ˜¯å¦æœªè®¾ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">OptionalArray</span><span class="p">.</span><span class="n">IsSet</span><span class="p">())</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è¾“å‡ºï¼šæœªåˆå§‹åŒ–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span> <span class="n">Warning</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">&#34;OptionalArray is unset.&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// èµ‹å€¼ä¸€ä¸ªæœ‰æ•ˆçš„ TArray
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">OptionalArray</span> <span class="o">=</span> <span class="n">TArray</span><span class="o">&lt;</span><span class="n">int32</span><span class="o">&gt;</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ£€æŸ¥çŠ¶æ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">OptionalArray</span><span class="p">.</span><span class="n">IsSet</span><span class="p">())</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// è¾“å‡ºï¼šå…ƒç´ æ•°é‡ä¸º3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span> <span class="n">Warning</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">&#34;Element count: %d&#34;</span><span class="p">),</span> <span class="n">OptionalArray</span><span class="o">-&gt;</span><span class="n">Num</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¾‹2ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;Misc/Optional.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;UObject/ObjectMacros.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">ExampleUsageOfTOptional</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å®šä¹‰ä¸€ä¸ª TOptional&lt;int&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">TOptional</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">optionalInt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆå§‹åŒ–ä¸ºæœ‰å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">TOptional</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">optionalIntWithValue</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">optionalIntWithValue</span><span class="p">.</span><span class="n">IsSet</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span> <span class="n">Log</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">&#34;optionalIntWithValue has a value: %d&#34;</span><span class="p">),</span> <span class="n">optionalIntWithValue</span><span class="p">.</span><span class="n">GetValue</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// åˆå§‹åŒ–ä¸ºæ— å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">TOptional</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">optionalIntWithoutValue</span> <span class="o">=</span> <span class="n">TOptional</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">optionalIntWithoutValue</span><span class="p">.</span><span class="n">IsSet</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span> <span class="n">Log</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">&#34;optionalIntWithoutValue does not have a value&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ä½¿ç”¨ GetValueOr æä¾›é»˜è®¤å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="n">optionalIntWithoutValue</span><span class="p">.</span><span class="n">GetValueOr</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span> <span class="n">Log</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">&#34;DefaultValue is: %d&#34;</span><span class="p">),</span> <span class="n">defaultValue</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// é‡ç½®ä¸ºæ— å€¼çŠ¶æ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">optionalIntWithValue</span><span class="p">.</span><span class="n">Reset</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">optionalIntWithValue</span><span class="p">.</span><span class="n">IsSet</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span> <span class="n">Log</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">&#34;optionalIntWithValue has been reset and does not have a value&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// è®¾ç½®æ–°å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">optionalIntWithValue</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">optionalIntWithValue</span><span class="p">.</span><span class="n">IsSet</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">UE_LOG</span><span class="p">(</span><span class="n">LogTemp</span><span class="p">,</span> <span class="n">Log</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">&#34;optionalIntWithValue now has a new value: %d&#34;</span><span class="p">),</span> <span class="n">optionalIntWithValue</span><span class="p">.</span><span class="n">GetValue</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="getdata">GetData
</h3><p><code>GetData</code> è¿”å›æŒ‡å‘ç¬¬ä¸€ä¸ªæ•°ç»„æ¡ç›®çš„æŒ‡é’ˆï¼Œå¦‚æœArrayMax == 0ï¼Œåˆ™è¿”å›æŒ‡å‘nullptrçš„æŒ‡é’ˆã€‚</p>
<p>ä»¥ä¸‹æ–‡æœ¬ä¸­ å‡½æ•°çš„è§£é‡Šé¡ºåº å°±æ˜¯ å‡½æ•°çš„è°ƒç”¨é¡ºåº.</p>
<p>GetData()-&gt;GetAllocation()-&gt;GetAllocation()</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="n">ElementType</span><span class="o">*</span> <span class="nf">GetData</span><span class="p">()</span> <span class="n">UE_LIFETIMEBOUND</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">ElementType</span><span class="o">*</span><span class="p">)</span><span class="n">AllocatorInstance</span><span class="p">.</span><span class="n">GetAllocation</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªå‡½æ•°é€šè¿‡è°ƒç”¨ <code>AllocatorInstance.GetAllocation()</code> è·å–åˆ†é…çš„å†…å­˜å—ï¼Œ</p>
<p>å¹¶å°†å…¶è½¬æ¢ä¸º <code>ElementType*</code> ç±»å‹ï¼Œä»è€Œè¿”å›æŒ‡å‘æ•°ç»„æ•°æ®çš„æŒ‡é’ˆã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="n">ElementType</span><span class="o">*</span> <span class="nf">GetAllocation</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">ElementType</span><span class="o">*</span><span class="p">)</span><span class="n">ForAnyElementType</span><span class="o">::</span><span class="n">GetAllocation</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>GetAllocation</code> å‡½æ•°æ˜¯ <code>AllocatorInstance</code> çš„æˆå‘˜å‡½æ•°ï¼Œè´Ÿè´£è¿”å›å®é™…åˆ†é…çš„å†…å­˜å—ã€‚</p>
<p>åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œ<code>ForAnyElementType::GetAllocation()</code> è¢«è°ƒç”¨æ¥è·å–å®é™…çš„å†…å­˜å—ï¼Œ</p>
<p>å¹¶å°†å…¶è½¬æ¢ä¸º <code>ElementType*</code> ç±»å‹ã€‚</p>
<p>æœ€ç»ˆï¼Œ<code>ForAnyElementType::GetAllocation()</code> è°ƒç”¨äº†å¦ä¸€ä¸ª <code>GetAllocation</code> å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="n">FScriptContainerElement</span><span class="o">*</span> <span class="nf">GetAllocation</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//----------------------//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cm">/** A type which is used to represent a script type that is unknown at compile time. */</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">FScriptContainerElement</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="n">FScriptContainerElement</span><span class="o">*</span> <span class="n">Data</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™é‡Œçš„ <code>Data</code> æ˜¯ä¸€ä¸ªæŒ‡å‘ <code>FScriptContainerElement</code> ç±»å‹çš„æŒ‡é’ˆ.</p>
<p><code>FScriptContainerElement</code> æ˜¯ä¸€ä¸ªç©ºç»“æ„ä½“ï¼Œä¸»è¦ç”¨äºè¡¨ç¤ºä¸€ç§åœ¨ç¼–è¯‘æ—¶æœªçŸ¥çš„å…·ä½“ç±»å‹ã€‚</p>
<p><strong>æ€»ç»“:</strong> GetData()æœ€ç»ˆè¿”å›çš„æ˜¯ä¸€ä¸ªData</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">+-------------------+
</span></span><span class="line"><span class="cl">|  MyArray          |
</span></span><span class="line"><span class="cl">+-------------------+
</span></span><span class="line"><span class="cl">|  AllocatorInstance|
</span></span><span class="line"><span class="cl">|  +---------------+|
</span></span><span class="line"><span class="cl">|  |  Data         |---&gt; [10, 20, 30]  (æŒ‡å‘å®é™…å­˜å‚¨å…ƒç´ çš„å†…å­˜å—)
</span></span><span class="line"><span class="cl">|  +---------------+|
</span></span><span class="line"><span class="cl">|  ArrayNum: 3      |
</span></span><span class="line"><span class="cl">|  ArrayMax: 4      |
</span></span><span class="line"><span class="cl">+-------------------+
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Data</code> æ˜¯ <code>AllocatorInstance</code> ä¸­çš„ä¸€ä¸ªæˆå‘˜å˜é‡ï¼ŒæŒ‡å‘å®é™…å­˜å‚¨æ•°ç»„å…ƒç´ çš„å†…å­˜å—ã€‚</p>
<p>è¿™ä¸ªå†…å­˜å—é€šå¸¸æ˜¯åœ¨å †ä¸Šåˆ†é…çš„ï¼Œå¹¶ä¸”ç”± <code>AllocatorInstance</code> è¿›è¡Œç®¡ç†ã€‚</p>
<p><code>GetData()</code> å‡½æ•°ä¼šé€šè¿‡ <code>AllocatorInstance.GetAllocation()</code> è¿”å› <code>Data</code> æŒ‡é’ˆï¼Œ</p>
<p>å³æŒ‡å‘ <code>[10, 20, 30]</code> è¿™ä¸ªå†…å­˜å—çš„é¦–åœ°å€ã€‚</p>
<h3 id="gettypesize">GetTypeSize
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="k">static</span> <span class="k">constexpr</span> <span class="n">uint32</span> <span class="nf">GetTypeSize</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ElementType</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ElementTypeå°±æ˜¯TArray<int32>ä¸­çš„int32ï¼Œç›¸å½“äºsizeof(int32)</p>
<h3 id="getslack">GetSlack
</h3><p>è¿”å›æ­¤æ•°ç»„ä¸­çš„é—²ç½®æ•°é‡ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="n">SizeType</span> <span class="nf">GetSlack</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">ArrayMax</span> <span class="o">-</span> <span class="n">ArrayNum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="checkinvariants">CheckInvariants
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="kt">void</span> <span class="nf">CheckInvariants</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">checkSlow</span><span class="p">((</span><span class="n">ArrayNum</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ArrayMax</span> <span class="o">&gt;=</span> <span class="n">ArrayNum</span><span class="p">));</span> <span class="c1">// &amp; for one branch
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨äº†æŒ‰ä½ä¸æ“ä½œç¬¦ <code>&amp;</code> è€Œä¸æ˜¯é€»è¾‘ä¸æ“ä½œç¬¦ <code>&amp;&amp;</code>ï¼Œç›®çš„æ˜¯ä¸ºäº†ç¡®ä¿ä¸¤ä¸ªæ¡ä»¶éƒ½åœ¨åŒä¸€åˆ†æ”¯ä¸­è¢«è¯„ä¼°ï¼Œ</p>
<p>å³ä½¿ç¬¬ä¸€ä¸ªæ¡ä»¶ä¸ºå‡ä¹Ÿä¸ä¼šçŸ­è·¯è·³è¿‡ç¬¬äºŒä¸ªæ¡ä»¶ã€‚</p>
<p>è™½ç„¶åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ä¸¤è€…çš„æ•ˆæœæ˜¯ç›¸åŒçš„ï¼Œä½†æŒ‰ä½ä¸å¯ä»¥ç¡®ä¿æ‰€æœ‰æ¡ä»¶éƒ½è¢«æ£€æŸ¥åˆ°ã€‚</p>
<p>**CheckInvariants å‡½æ•°ï¼š**ç”¨äºéªŒè¯ TArray çš„å†…éƒ¨çŠ¶æ€æ˜¯å¦åˆæ³•ï¼Œç¡®ä¿ ArrayNum å’Œ ArrayMax æ»¡è¶³åŸºæœ¬çš„çº¦æŸæ¡ä»¶ã€‚</p>
<p>**ç›®çš„ï¼š**é€šè¿‡è¿™äº›æ£€æŸ¥ï¼Œå¯ä»¥åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ•è·æ½œåœ¨çš„é”™è¯¯ï¼Œå¦‚éæ³•çš„çŠ¶æ€è®¾ç½®æˆ–æ•°ç»„ç®¡ç†ä¸å½“ï¼Œä»è€Œæé«˜ä»£ç çš„å¥å£®æ€§å’Œå¯é æ€§ã€‚</p>
<p>**æ€§èƒ½è€ƒè™‘ï¼š**ä½¿ç”¨ checkSlow å®ç¡®ä¿è¿™äº›æ£€æŸ¥åªåœ¨è°ƒè¯•ç‰ˆæœ¬ä¸­ç”Ÿæ•ˆï¼Œåœ¨å‘å¸ƒç‰ˆæœ¬ä¸­è¢«ä¼˜åŒ–æ‰ï¼Œä»¥é¿å…ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€ã€‚</p>
<h3 id="rangecheck">RangeCheck
</h3><p>æ£€æŸ¥indexæ˜¯å¦åœ¨æ•°ç»„èŒƒå›´å†…ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="kt">void</span> <span class="nf">RangeCheck</span><span class="p">(</span><span class="n">SizeType</span> <span class="n">Index</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">CheckInvariants</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Template property, branch will be optimized out
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="k">constexpr</span> <span class="p">(</span><span class="n">AllocatorType</span><span class="o">::</span><span class="n">RequireRangeCheck</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">checkf</span><span class="p">((</span><span class="n">Index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Index</span> <span class="o">&lt;</span> <span class="n">ArrayNum</span><span class="p">),</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&#34;Array index out of bounds: %lld into an array of size %lld&#34;</span><span class="p">),(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">Index</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">ArrayNum</span><span class="p">);</span> <span class="c1">// &amp; for one branch
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>AllocatorType::RequireRangeCheck</p>
<p>åœ¨é»˜è®¤çš„æƒ…å†µä¸‹ï¼ŒAllocatorTypeæ˜¯TSizedHeapAllocator</p>
<p>TSizedHeapAllocator::RequireRangeCheck = true.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span> <span class="o">&lt;</span><span class="kt">int</span> <span class="n">IndexSize</span><span class="p">,</span> <span class="k">typename</span> <span class="n">BaseMallocType</span> <span class="o">=</span> <span class="n">FMemory</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TSizedHeapAllocator</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="c1">//..............
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">enum</span> <span class="p">{</span> <span class="n">NeedsElementType</span> <span class="o">=</span> <span class="nb">true</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">enum</span> <span class="p">{</span> <span class="n">RequireRangeCheck</span> <span class="o">=</span> <span class="nb">true</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">//..............
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">//*æ£€æŸ¥æŒ‡å®šä¸‹æ ‡èŒƒå›´æ˜¯å¦åœ¨æ•°ç»„èŒƒå›´å†…ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1">//*
</span></span></span><span class="line"><span class="cl"><span class="c1">//* @param Indexè¦æ£€æŸ¥çš„èŒƒå›´èµ·å§‹ä½ç½®çš„ç´¢å¼•ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1">//* @param CountèŒƒå›´ä¸­å…ƒç´ çš„æ•°é‡ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">FORCEINLINE</span> <span class="kt">void</span> <span class="nf">RangeCheck</span><span class="p">(</span><span class="n">SizeType</span> <span class="n">Index</span><span class="p">,</span> <span class="n">SizeType</span> <span class="n">Count</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">CheckInvariants</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Template property, branch will be optimized out
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="k">constexpr</span> <span class="p">(</span><span class="n">AllocatorType</span><span class="o">::</span><span class="n">RequireRangeCheck</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">checkf</span><span class="p">((</span><span class="n">Count</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Index</span> <span class="o">+</span> <span class="n">Count</span> <span class="o">&lt;=</span> <span class="n">ArrayNum</span><span class="p">),</span> <span class="n">TEXT</span><span class="p">(</span><span class="s">&#34;Array range out of bounds: index %lld and length %lld into an array of size %lld&#34;</span><span class="p">),</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">Index</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">Count</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">ArrayNum</span><span class="p">);</span> <span class="c1">// &amp; for one branch
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="isvalidindex">IsValidIndex
</h3><p>æµ‹è¯•indexæ˜¯å¦æœ‰æ•ˆï¼Œå³å¤§äºæˆ–ç­‰äº0ï¼Œå°äºæ•°ç»„ä¸­çš„å…ƒç´ æ•°é‡ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="kt">bool</span> <span class="nf">IsValidIndex</span><span class="p">(</span><span class="n">SizeType</span> <span class="n">Index</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Index</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">Index</span> <span class="o">&lt;</span> <span class="n">ArrayNum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="numbytes">NumBytes
</h3><p><code>SIZE_T</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ç±»å‹ï¼Œé€šå¸¸ç”¨äºè¡¨ç¤ºå†…å­˜å¤§å°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cm">/** @returns Number of bytes used, excluding slack */</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="n">SIZE_T</span> <span class="nf">NumBytes</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SIZE_T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ArrayNum</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ElementType</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//å°† ArrayNum è½¬æ¢ä¸º SIZE_T ç±»å‹ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//ä»¥ç¡®ä¿ä¸ sizeof(ElementType) çš„ä¹˜ç§¯ç»“æœæ˜¯ SIZE_T ç±»å‹ï¼Œé¿å…æ½œåœ¨çš„æº¢å‡ºé—®é¢˜ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è®¡ç®—æ•°ç»„å½“å‰ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œä¸åŒ…æ‹¬æœªä½¿ç”¨çš„é¢å¤–ç©ºé—´ï¼ˆå³æ‰€è°“çš„â€œæ¾å¼›â€æˆ–â€œslackâ€ï¼‰ã€‚</p>
<p>è¿™ä¸ªå‡½æ•°å¯¹äºäº†è§£æ•°ç»„çš„å®é™…å†…å­˜å ç”¨éå¸¸æœ‰ç”¨ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">TArray</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">MyArray</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">MyArray</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">MyArray</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">MyArray</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è®¡ç®—å½“å‰ä½¿ç”¨çš„å­—èŠ‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">SIZE_T</span> <span class="n">bytesUsed</span> <span class="o">=</span> <span class="n">MyArray</span><span class="p">.</span><span class="n">NumBytes</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//NumBytesçš„è®¡ç®—è¿‡ç¨‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">bytesUsed</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SIZE_T</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span> <span class="c1">// å‡è®¾ sizeof(int) == 4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">bytesUsed</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">bytesUsed</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span> <span class="c1">// å½“å‰ä½¿ç”¨çš„å­—èŠ‚æ•°æ˜¯ 12 å­—èŠ‚
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="getallocatedsize">GetAllocatedSize
</h3><p>è¿”å›å®¹å™¨åˆ†é…çš„å¤§å°.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="n">SIZE_T</span> <span class="nf">GetAllocatedSize</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">AllocatorInstance</span><span class="p">.</span><span class="n">GetAllocatedSize</span><span class="p">(</span><span class="n">ArrayMax</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ElementType</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">SIZE_T</span> <span class="nf">GetAllocatedSize</span><span class="p">(</span><span class="n">SizeType</span> <span class="n">CurrentMax</span><span class="p">,</span> <span class="n">SIZE_T</span> <span class="n">NumBytesPerElement</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">CurrentMax</span> <span class="o">*</span> <span class="n">NumBytesPerElement</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>SIZE_T</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ç±»å‹ï¼Œé€šå¸¸ç”¨äºè¡¨ç¤ºå†…å­˜å¤§å°ã€‚</p>
<h3 id="é‡è½½">é‡è½½[]
</h3><p>è®¿é—®æ•°ç»„ä¸­æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Array bracket operator. Returns reference to element at given index.
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @returns Reference to indexed element.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="n">ElementType</span><span class="o">&amp;</span> <span class="k">operator</span><span class="p">[](</span><span class="n">SizeType</span> <span class="n">Index</span><span class="p">)</span> <span class="n">UE_LIFETIMEBOUND</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">RangeCheck</span><span class="p">(</span><span class="n">Index</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nf">GetData</span><span class="p">()[</span><span class="n">Index</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">FORCEINLINE</span> <span class="kt">void</span> <span class="nf">RangeCheck</span><span class="p">(</span><span class="n">SizeType</span> <span class="n">Index</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">CheckInvariants</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Template property, branch will be optimized out
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="k">constexpr</span> <span class="p">(</span><span class="n">AllocatorType</span><span class="o">::</span><span class="n">RequireRangeCheck</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">checkf</span><span class="p">((</span><span class="n">Index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Index</span> <span class="o">&lt;</span> <span class="n">ArrayNum</span><span class="p">),</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&#34;Array index out of bounds: %lld into an array of size %lld&#34;</span><span class="p">),(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">Index</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">ArrayNum</span><span class="p">);</span> <span class="c1">// &amp; for one branch
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="getdata-1"><strong>GetData</strong>
</h4><p>è¿”å›æŒ‡å‘æ•°ç»„æ•°æ®çš„æŒ‡é’ˆï¼Œå³å®é™…å­˜å‚¨æ•°ç»„å…ƒç´ çš„å†…å­˜å—çš„é¦–åœ°å€ã€‚</p>
<p>é€šè¿‡ GetData()[Index] è®¿é—®æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ ã€‚</p>
<h4 id="ue_lifetimebound-å®"><strong>UE_LIFETIMEBOUND å®</strong>
</h4><p>ç”¨äº <strong>é™æ€ä»£ç åˆ†æ</strong> çš„æ³¨è§£å®ï¼Œå…¶æ ¸å¿ƒä½œç”¨æ˜¯æ ‡è®°å‡½æ•°è¿”å›çš„æŒ‡é’ˆæˆ–å¼•ç”¨ <strong>ä¾èµ–äºæŸä¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</strong>ï¼Œå¸®åŠ©å¼€å‘è€…é¿å…æ‚¬å‚æŒ‡é’ˆï¼ˆDangling Pointerï¼‰é”™è¯¯ã€‚</p>
<ul>
<li><strong>ç¼–è¯‘è­¦å‘Š/é”™è¯¯</strong>ï¼š
è‹¥è¿”å›çš„æŒ‡é’ˆ/å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸè¶…å‡ºå…¶ä¾èµ–å¯¹è±¡ï¼Œé™æ€åˆ†æå·¥å…·ï¼ˆå¦‚ UE çš„é™æ€åˆ†æå™¨æˆ– Clang/GCC çš„è­¦å‘Šï¼‰ä¼šå‘å‡ºè­¦å‘Šã€‚</li>
<li><strong>æ–‡æ¡£æç¤º</strong>ï¼š
ä»£ç é˜…è¯»è€…å¯ä»¥ç›´è§‚çœ‹å‡ºè¿”å›å€¼éœ€è¦è°¨æ…å¤„ç†ç”Ÿå‘½å‘¨æœŸã€‚</li>
<li>è¯¥å±æ€§ä¸»è¦ç”¨äºå¸®åŠ©é™æ€åˆ†æå·¥å…·æ£€æµ‹æ½œåœ¨çš„ç”Ÿå‘½å‘¨æœŸé—®é¢˜ã€‚è™½ç„¶å®ƒä¸ä¼šç›´æ¥å½±å“ç¼–è¯‘è¡Œä¸ºï¼Œä½†å¯ä»¥å¸®åŠ©å¼€å‘è€…å‘ç°æ½œåœ¨çš„é”™è¯¯ã€‚</li>
<li>ç„¶è€Œï¼Œè¿‡åº¦ä½¿ç”¨å¯èƒ½ä¼šä½¿ä»£ç å˜å¾—å†—é•¿ï¼Œå› æ­¤éœ€è¦åˆç†ä½¿ç”¨ã€‚</li>
</ul>
<p>å®å®šä¹‰åœ¨:</p>
<p><a class="link" href="https://github.com/EpicGames/UnrealEngine/blob/0c544b150542b59fc87bdcf64caae09f4e3bc11c/Engine/Source/Runtime/Core/Public/MSVC/MSVCPlatform.h#L31"  target="_blank" rel="noopener"
    >Engine/Source/Runtime/Core/Public/MSVC/MSVCPlatform.h</a></p>
<p><a class="link" href="https://github.com/EpicGames/UnrealEngine/blob/0c544b150542b59fc87bdcf64caae09f4e3bc11c/Engine/Source/Runtime/Core/Public/Clang/ClangPlatform.h#L28"  target="_blank" rel="noopener"
    >Engine/Source/Runtime/Core/Public/Clang/ClangPlatform.h</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#ifdef __has_cpp_attribute
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>	<span class="cp">#if __has_cpp_attribute(msvc::lifetimebound)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>		<span class="cp">#define UE_LIFETIMEBOUND [[msvc::lifetimebound]]
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>	<span class="cp">#endif
</span></span></span><span class="line"><span class="cl"><span class="cp">#endif
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//---------------//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define UE_LIFETIMEBOUND [[clang::lifetimebound]]
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">FContainer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">int32</span><span class="o">*</span> <span class="n">GetData</span><span class="p">()</span> <span class="n">UE_LIFETIMEBOUND</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Data</span><span class="p">;</span> <span class="c1">// è¿”å›æŒ‡é’ˆï¼Œç”Ÿå‘½å‘¨æœŸä¾èµ– FContainer å®ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">int32</span><span class="o">*</span> <span class="n">Data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">Test</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">int32</span><span class="o">*</span> <span class="n">Ptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">FContainer</span> <span class="n">Container</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Ptr</span> <span class="o">=</span> <span class="n">Container</span><span class="p">.</span><span class="n">GetData</span><span class="p">();</span> <span class="c1">// è­¦å‘Šï¼šPtr çš„ç”Ÿå‘½å‘¨æœŸè¶…å‡º Container
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="n">Ptr</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span> <span class="c1">// å±é™©ï¼æ‚¬å‚æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‡½æ•°æ¥å—ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å‚æ•°ï¼Œå¹¶å¸Œæœ›ç¡®ä¿è¯¥å¼•ç”¨åœ¨å…¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…éƒ½æ˜¯æœ‰æ•ˆçš„</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">ProcessObject</span><span class="p">(</span><span class="na">[[msvc::lifetimebound]]</span> <span class="k">const</span> <span class="n">MyClass</span><span class="o">&amp;</span> <span class="n">obj</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å¤„ç†å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>[[msvc::lifetimebound]]</code> æ ‡è®°äº† <code>obj</code> å‚æ•°ï¼Œè¡¨ç¤ºè¯¥å¼•ç”¨åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…åº”ä¿æŒæœ‰æ•ˆã€‚</p>
<p>å¦‚æœç¼–è¯‘å™¨æˆ–é™æ€åˆ†æå·¥å…·æ£€æµ‹åˆ° <code>obj</code> çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½è¶…å‡ºå…¶æœ‰æ•ˆèŒƒå›´ï¼Œä¼šå‘å‡ºç›¸åº”çš„è­¦å‘Šæˆ–é”™è¯¯ã€‚</p>
<p>å¯¹äºè¿”å›å€¼ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>[[msvc::lifetimebound]]</code> æ¥æ ‡è®°ç”Ÿå‘½å‘¨æœŸè¾¹ç•Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="na">[[msvc::lifetimebound]]</span> <span class="n">MyClass</span><span class="o">&amp;</span> <span class="n">GetObject</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">static</span> <span class="n">MyClass</span> <span class="n">instance</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">instance</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>GetObject</code> è¿”å›ä¸€ä¸ªé™æ€å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶ä¸”ä½¿ç”¨ <code>[[msvc::lifetimebound]]</code> æ ‡è®°è¿”å›å€¼ï¼Œç¡®ä¿è¿”å›çš„å¼•ç”¨åœ¨å…¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyClass</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">MyClass</span><span class="p">(</span><span class="kt">int</span> <span class="n">v</span><span class="p">)</span> <span class="o">:</span> <span class="n">value</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">PrintValue</span><span class="p">()</span> <span class="k">const</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Value: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä½¿ç”¨ [[msvc::lifetimebound]] æ ‡è®°å‡½æ•°å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">ProcessObject</span><span class="p">(</span><span class="na">[[msvc::lifetimebound]]</span> <span class="k">const</span> <span class="n">MyClass</span><span class="o">&amp;</span> <span class="n">obj</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">obj</span><span class="p">.</span><span class="n">PrintValue</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">MyClass</span> <span class="n">obj</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ProcessObject</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span> <span class="c1">// æ­£ç¡®ä½¿ç”¨ï¼Œobj åœ¨ ProcessObject è°ƒç”¨æœŸé—´æœ‰æ•ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ä¸‹é¢çš„ä»£ç ä¼šå¯¼è‡´æ‚¬ç©ºå¼•ç”¨ï¼Œé™æ€åˆ†æå·¥å…·å¯èƒ½ä¼šå‘å‡ºè­¦å‘Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// MyClass* ptr = new MyClass(100);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ProcessObject(*ptr);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// delete ptr; // obj å·²ç»è¢«åˆ é™¤ï¼ŒProcessObject ä¸­çš„å¼•ç”¨æ— æ•ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            å›½çª–1573 - 
        
        2025 AKaKLya
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.0f4e44504cf40ab34cf124bb8fa71a5615b897b6d3841a1d2857b604319620c7.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
